{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/VideoCropControls.vue?4ceb","webpack:///./src/components/DeveloperUtilities.vue?3c43","webpack:///./src/smoothing-worker.ts","webpack:///./src/App.vue?e52c","webpack:///./src/App.vue?279b","webpack:///./src/components/UserFacingScreening.vue?b66e","webpack:///./src/components/UserFacingScreening.vue?751b","webpack:///./src/components/Histogram.vue?7f1e","webpack:///./src/components/AdminScreening.vue?e0e5","webpack:///./src/components/DeveloperUtilities.vue?36b4","webpack:///./src/components/AdminScreening.vue?ac6d","webpack:///./src/components/VideoStream.vue?c68a","webpack:///./src/components/VideoStream.vue?7f1b","webpack:///./src/components/CalibrationSettings.vue?85e4","webpack:///./src/components/CalibrationSettings.vue?c785","webpack:///./src/components/VideoCropControls.vue?3ed8","webpack:///./src/App.vue?d724","webpack:///./src/components/AdminScreening.vue?806d","webpack:///./src/components/VideoStream.vue?2760","webpack:///./src/components/VideoCropControls.vue?b78d","webpack:///./src/components/VideoCropControls.vue","webpack:///./src/components/VideoCropControls.vue?cda1","webpack:///./src/components/VideoCropControls.vue?5866","webpack:///./src/types.ts","webpack:///./src/geom.ts","webpack:///./src/dbscan.ts","webpack:///./src/face-detection.ts","webpack:///./src/circle-detection.ts","webpack:///./src/body-detection.ts","webpack:///./src/shape-processing.ts","webpack:///./src/components/VideoStream.vue","webpack:///./src/components/VideoStream.vue?652f","webpack:///./src/components/VideoStream.vue?f796","webpack:///./src/utils.ts","webpack:///./src/components/AdminScreening.vue","webpack:///./src/components/AdminScreening.vue?e25e","webpack:///./src/components/AdminScreening.vue?56a8","webpack:///./src/components/UserFacingScreening.vue?5aeb","webpack:///./src/components/AdminSettings.vue?3791","webpack:///./src/components/CalibrationSettings.vue?f482","webpack:///./src/api/api.ts","webpack:///./src/components/CalibrationSettings.vue","webpack:///./src/components/CalibrationSettings.vue?c462","webpack:///./src/components/CalibrationSettings.vue?542b","webpack:///./src/components/DeviceInfo.vue?3c85","webpack:///./src/components/DeviceInfo.vue","webpack:///./src/components/DeviceInfo.vue?78b9","webpack:///./src/components/DeviceInfo.vue?eb81","webpack:///./src/components/DeveloperUtilities.vue?7152","webpack:///./src/components/DeveloperUtilities.vue","webpack:///./src/components/DeveloperUtilities.vue?e97f","webpack:///./src/components/DeveloperUtilities.vue?7e14","webpack:///./src/components/AdminSettings.vue","webpack:///./src/components/AdminSettings.vue?a64d","webpack:///./src/components/AdminSettings.vue?48e7","webpack:///./src/components/UserFacingScreening.vue","webpack:///./src/components/UserFacingScreening.vue?0edd","webpack:///./src/components/UserFacingScreening.vue?4dfa","webpack:///./src/camera.ts","webpack:///./src/processing.ts","webpack:///./src/worker-fns.ts","webpack:///./src/haar-cascade.ts","webpack:///./src/face.ts","webpack:///./src/feature-detection.ts","webpack:///./src/components/FakeThermalCameraControls.vue?5345","webpack:///./src/components/FakeThermalCameraControls.vue","webpack:///./src/components/FakeThermalCameraControls.vue?9ade","webpack:///./src/components/FakeThermalCameraControls.vue?f385","webpack:///./src/api/types.ts","webpack:///./src/components/FpsCounter.vue?ce54","webpack:///./src/components/FpsCounter.vue","webpack:///./src/components/FpsCounter.vue?782b","webpack:///./src/components/FpsCounter.vue?1cd1","webpack:///./src/components/Histogram.vue?6b22","webpack:///./src/components/Histogram.vue","webpack:///./src/components/Histogram.vue?70e6","webpack:///./src/components/Histogram.vue?75e2","webpack:///./src/App.vue","webpack:///./src/App.vue?31c5","webpack:///./src/App.vue?68bd","webpack:///./src/plugins/vuetify.ts","webpack:///./src/main.ts","webpack:///./src/components/FpsCounter.vue?6da9","webpack:///./src/components/Histogram.vue?6fba","webpack:///./src/components/FpsCounter.vue?615e"],"names":[],"mappings":";QAAA;QACA;QACA;QACA;QACA;;QAEA;QACA;QACA;QACA,QAAQ,oBAAoB;QAC5B;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA,iBAAiB,4BAA4B;QAC7C;QACA;QACA,kBAAkB,2BAA2B;QAC7C;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;;QAEA;;QAEA;QACA;QACA,6CAA6C,6BAA6B,wDAAwD;QAClI;;QAEA;QACA;;QAEA,6BAA6B,0BAA0B;;QAEvD;QACA;QACA;QACA;QACA;QACA;QACA,OAAO;QACP;QACA;QACA,OAAO;QACP;QACA;QACA,OAAO;QACP;QACA;QACA,OAAO;QACP;QACA;QACA;QACA;QACA;QACA,IAAI;QACJ;QACA;QACA;QACA;QACA;QACA,OAAO;QACP;QACA;QACA,OAAO;QACP;QACA;QACA,OAAO;QACP;QACA;QACA,OAAO;QACP;QACA;QACA,OAAO;QACP;QACA;QACA,OAAO;QACP;QACA;QACA,OAAO;QACP;QACA;QACA,OAAO;QACP;QACA;QACA,OAAO;QACP;QACA;QACA,OAAO;QACP;QACA;QACA;QACA;QACA;QACA,IAAI;QACJ;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;QAEA;QACA;QACA;QACA;;;QAGA;;QAEA;QACA,iCAAiC;;QAEjC;QACA;QACA;QACA,KAAK;QACL;QACA;QACA;QACA,MAAM;QACN;;QAEA;QACA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,wBAAwB,kCAAkC;QAC1D,MAAM;QACN;QACA;QACA;QACA;;QAEA;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;AAEK,MAAO,IAAP,CAAW;AACf,cACS,EADT,EAES,EAFT,EAGS,EAHT,EAIS,EAJT,EAImB;AAHV;AACA;AACA;AACA;AACL;;AANW,C,CAQjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAAS,kBAAT,CACE,CADF,EAEE,cAFF,EAGE,QAHF,EAIE,UAJF,EAKE,WALF,EAKqB;AAEnB,QAAM,KAAK,GAAG,UAAd;AACA,QAAM,MAAM,GAAG,WAAf;AACA,QAAM,IAAI,GAAG,IAAI,YAAJ,CAAiB,KAAK,GAAG,MAAzB,CAAb;AACA,QAAM,MAAM,GAAG,CAAC,CAAC,KAAF,KAAY,GAA3B;AACA,QAAM,CAAC,KAAD,EAAQ,EAAR,EAAY,EAAZ,IAAkB,kBAAkB,CACxC,QADwC,EAExC,IAFwC,EAGxC,MAHwC,EAIxC,KAJwC,EAKxC,MALwC,EAMxC,CAAC,CAAC,IAAF,KAAW,MAAM,GAAG,CANoB,EAOxC,CAAC,CAAC,IAAF,KAAW,MAAM,GAAG,CAPoB,EAQxC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","file":"js/app.88742f13.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// script path function\n \tfunction jsonpScriptSrc(chunkId) {\n \t\treturn __webpack_require__.p + \"js/\" + ({}[chunkId]||chunkId) + \".\" + {\"chunk-2d843444\":\"e21bc1d7\",\"chunk-fae4a56a\":\"53df0312\"}[chunkId] + \".js\"\n \t}\n\n \t// object to store loaded and loading wasm modules\n \tvar installedWasmModules = {};\n\n \tfunction promiseResolve() { return Promise.resolve(); }\n\n \tvar wasmImportObjects = {\n \t\t\"3826\": function() {\n \t\t\treturn {\n \t\t\t\t\"./curve_fitting_bg.js\": {\n \t\t\t\t\t\"__wbindgen_number_new\": function(p0f64) {\n \t\t\t\t\t\treturn installedModules[\"f470\"].exports[\"c\"](p0f64);\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbindgen_object_drop_ref\": function(p0i32) {\n \t\t\t\t\t\treturn installedModules[\"f470\"].exports[\"d\"](p0i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbg_new_6b6f346b4912cdae\": function() {\n \t\t\t\t\t\treturn installedModules[\"f470\"].exports[\"a\"]();\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbg_push_f353108e20ec67a0\": function(p0i32,p1i32) {\n \t\t\t\t\t\treturn installedModules[\"f470\"].exports[\"b\"](p0i32,p1i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbindgen_throw\": function(p0i32,p1i32) {\n \t\t\t\t\t\treturn installedModules[\"f470\"].exports[\"e\"](p0i32,p1i32);\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t};\n \t\t},\n \t\t\"499d\": function() {\n \t\t\treturn {\n \t\t\t\t\"./cptv_player.js\": {\n \t\t\t\t\t\"__wbindgen_string_new\": function(p0i32,p1i32) {\n \t\t\t\t\t\treturn installedModules[\"327f\"].exports[\"__wbindgen_string_new\"](p0i32,p1i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbindgen_object_drop_ref\": function(p0i32) {\n \t\t\t\t\t\treturn installedModules[\"327f\"].exports[\"__wbindgen_object_drop_ref\"](p0i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbg_new_59cb74e423758ede\": function() {\n \t\t\t\t\t\treturn installedModules[\"327f\"].exports[\"__wbg_new_59cb74e423758ede\"]();\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbg_stack_558ba5917b466edd\": function(p0i32,p1i32) {\n \t\t\t\t\t\treturn installedModules[\"327f\"].exports[\"__wbg_stack_558ba5917b466edd\"](p0i32,p1i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbg_error_4bb6c2a97407129a\": function(p0i32,p1i32) {\n \t\t\t\t\t\treturn installedModules[\"327f\"].exports[\"__wbg_error_4bb6c2a97407129a\"](p0i32,p1i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__wbindgen_throw\": function(p0i32,p1i32) {\n \t\t\t\t\t\treturn installedModules[\"327f\"].exports[\"__wbindgen_throw\"](p0i32,p1i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__widl_f_debug_1_\": function(p0i32) {\n \t\t\t\t\t\treturn installedModules[\"327f\"].exports[\"__widl_f_debug_1_\"](p0i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__widl_f_error_1_\": function(p0i32) {\n \t\t\t\t\t\treturn installedModules[\"327f\"].exports[\"__widl_f_error_1_\"](p0i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__widl_f_info_1_\": function(p0i32) {\n \t\t\t\t\t\treturn installedModules[\"327f\"].exports[\"__widl_f_info_1_\"](p0i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__widl_f_log_1_\": function(p0i32) {\n \t\t\t\t\t\treturn installedModules[\"327f\"].exports[\"__widl_f_log_1_\"](p0i32);\n \t\t\t\t\t},\n \t\t\t\t\t\"__widl_f_warn_1_\": function(p0i32) {\n \t\t\t\t\t\treturn installedModules[\"327f\"].exports[\"__widl_f_warn_1_\"](p0i32);\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t};\n \t\t},\n \t};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\tvar promises = [];\n\n\n \t\t// JSONP chunk loading for javascript\n\n \t\tvar installedChunkData = installedChunks[chunkId];\n \t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n \t\t\t// a Promise means \"currently loading\".\n \t\t\tif(installedChunkData) {\n \t\t\t\tpromises.push(installedChunkData[2]);\n \t\t\t} else {\n \t\t\t\t// setup Promise in chunk cache\n \t\t\t\tvar promise = new Promise(function(resolve, reject) {\n \t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n \t\t\t\t});\n \t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n \t\t\t\t// start chunk loading\n \t\t\t\tvar script = document.createElement('script');\n \t\t\t\tvar onScriptComplete;\n\n \t\t\t\tscript.charset = 'utf-8';\n \t\t\t\tscript.timeout = 120;\n \t\t\t\tif (__webpack_require__.nc) {\n \t\t\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n \t\t\t\t}\n \t\t\t\tscript.src = jsonpScriptSrc(chunkId);\n\n \t\t\t\t// create error before stack unwound to get useful stacktrace later\n \t\t\t\tvar error = new Error();\n \t\t\t\tonScriptComplete = function (event) {\n \t\t\t\t\t// avoid mem leaks in IE.\n \t\t\t\t\tscript.onerror = script.onload = null;\n \t\t\t\t\tclearTimeout(timeout);\n \t\t\t\t\tvar chunk = installedChunks[chunkId];\n \t\t\t\t\tif(chunk !== 0) {\n \t\t\t\t\t\tif(chunk) {\n \t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n \t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n \t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n \t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n \t\t\t\t\t\t\terror.type = errorType;\n \t\t\t\t\t\t\terror.request = realSrc;\n \t\t\t\t\t\t\tchunk[1](error);\n \t\t\t\t\t\t}\n \t\t\t\t\t\tinstalledChunks[chunkId] = undefined;\n \t\t\t\t\t}\n \t\t\t\t};\n \t\t\t\tvar timeout = setTimeout(function(){\n \t\t\t\t\tonScriptComplete({ type: 'timeout', target: script });\n \t\t\t\t}, 120000);\n \t\t\t\tscript.onerror = script.onload = onScriptComplete;\n \t\t\t\tdocument.head.appendChild(script);\n \t\t\t}\n \t\t}\n\n \t\t// Fetch + compile chunk loading for webassembly\n\n \t\tvar wasmModules = {\"chunk-2d843444\":[\"3826\"],\"chunk-fae4a56a\":[\"499d\"]}[chunkId] || [];\n\n \t\twasmModules.forEach(function(wasmModuleId) {\n \t\t\tvar installedWasmModuleData = installedWasmModules[wasmModuleId];\n\n \t\t\t// a Promise means \"currently loading\" or \"already loaded\".\n \t\t\tif(installedWasmModuleData)\n \t\t\t\tpromises.push(installedWasmModuleData);\n \t\t\telse {\n \t\t\t\tvar importObject = wasmImportObjects[wasmModuleId]();\n \t\t\t\tvar req = fetch(__webpack_require__.p + \"\" + {\"3826\":\"f4cb4ffd0ca727aee03d\",\"499d\":\"1f2dad4b75b9825d1453\"}[wasmModuleId] + \".module.wasm\");\n \t\t\t\tvar promise;\n \t\t\t\tif(importObject instanceof Promise && typeof WebAssembly.compileStreaming === 'function') {\n \t\t\t\t\tpromise = Promise.all([WebAssembly.compileStreaming(req), importObject]).then(function(items) {\n \t\t\t\t\t\treturn WebAssembly.instantiate(items[0], items[1]);\n \t\t\t\t\t});\n \t\t\t\t} else if(typeof WebAssembly.instantiateStreaming === 'function') {\n \t\t\t\t\tpromise = WebAssembly.instantiateStreaming(req, importObject);\n \t\t\t\t} else {\n \t\t\t\t\tvar bytesPromise = req.then(function(x) { return x.arrayBuffer(); });\n \t\t\t\t\tpromise = bytesPromise.then(function(bytes) {\n \t\t\t\t\t\treturn WebAssembly.instantiate(bytes, importObject);\n \t\t\t\t\t});\n \t\t\t\t}\n \t\t\t\tpromises.push(installedWasmModules[wasmModuleId] = promise.then(function(res) {\n \t\t\t\t\treturn __webpack_require__.w[wasmModuleId] = (res.instance || res).exports;\n \t\t\t\t}));\n \t\t\t}\n \t\t});\n \t\treturn Promise.all(promises);\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/static/dist/\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \t// object with all WebAssembly.instance exports\n \t__webpack_require__.w = {};\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoCropControls.vue?vue&type=style&index=0&id=af7a6bf4&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoCropControls.vue?vue&type=style&index=0&id=af7a6bf4&scoped=true&lang=scss&\"","// extracted by mini-css-extract-plugin","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"8c5710279cbfeaef1fce.worker.js\");\n};","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserFacingScreening.vue?vue&type=style&index=0&id=501e7b82&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserFacingScreening.vue?vue&type=style&index=0&id=501e7b82&scoped=true&lang=scss&\"","// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeveloperUtilities.vue?vue&type=style&index=0&id=95c24c0e&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeveloperUtilities.vue?vue&type=style&index=0&id=95c24c0e&scoped=true&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AdminScreening.vue?vue&type=style&index=0&id=77c7f7d8&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AdminScreening.vue?vue&type=style&index=0&id=77c7f7d8&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoStream.vue?vue&type=style&index=0&id=3a43902b&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoStream.vue?vue&type=style&index=0&id=3a43902b&scoped=true&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CalibrationSettings.vue?vue&type=style&index=0&id=1630d800&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CalibrationSettings.vue?vue&type=style&index=0&id=1630d800&scoped=true&lang=scss&\"","// extracted by mini-css-extract-plugin","// extracted by mini-css-extract-plugin","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-app',{attrs:{\"id\":\"app\"}},[_c('UserFacingScreening',{attrs:{\"on-reference-device\":_vm.isReferenceDevice,\"state\":_vm.appState.currentScreeningState,\"screening-event\":_vm.appState.currentScreeningEvent,\"calibration\":_vm.appState.currentCalibration,\"face\":_vm.appState.face,\"warmup-seconds-remaining\":_vm.remainingWarmupTime,\"shapes\":[_vm.prevShape, _vm.nextShape]}}),_c('v-dialog',{attrs:{\"width\":\"500\"},model:{value:(_vm.showSoftwareVersionUpdatedPrompt),callback:function ($$v) {_vm.showSoftwareVersionUpdatedPrompt=$$v},expression:\"showSoftwareVersionUpdatedPrompt\"}},[_c('v-card',[_c('v-card-title',[_vm._v(\"This software has been updated. \"+_vm._s(_vm.appVersion))]),_c('v-card-actions',{attrs:{\"center\":\"\"}},[_c('v-btn',{attrs:{\"text\":\"\"},on:{\"click\":function (e) { return (_vm.showSoftwareVersionUpdatedPrompt = false); }}},[_vm._v(\"Proceed\")])],1)],1)],1),_c('v-snackbar',{model:{value:(_vm.showUpdatedCalibrationSnackbar),callback:function ($$v) {_vm.showUpdatedCalibrationSnackbar=$$v},expression:\"showUpdatedCalibrationSnackbar\"}},[_vm._v(\"Calibration was updated\")])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"admin\"}},[_c('div',[_c('VideoStream',{attrs:{\"frame\":_vm.frame.smoothed,\"thermal-reference\":_vm.thermalReference,\"faces\":_vm.faces,\"face\":_vm.faceFeature,\"crop-box\":_vm.cropBox,\"crop-enabled\":false}}),_c('div',{staticClass:\"face-stats\"},[_c('div',{staticClass:\"frame-num\"},[_vm._v(\" Frame #\"+_vm._s((_vm.frame && _vm.frame.frameInfo.Telemetry.FrameCount) || 0)+\" \")]),_c('div',[_vm._v(_vm._s(_vm.face && _vm.face.frontOnPercentage)+\"% front-facing\")]),(_vm.face)?_c('div',[_vm._v(\" Active thermal region: \"+_vm._s(_vm.face.width().toFixed(0))+\" x \"+_vm._s(_vm.face.height().toFixed(0))+\" (\"+_vm._s((_vm.face.width() * _vm.face.height()).toFixed(0))+\"px\"),_c('sup',[_vm._v(\"2\")]),_vm._v(\") \")]):_c('div',[_vm._v(\"--\")])])],1),(false)?_c('v-card-text',[_c('v-checkbox',{attrs:{\"label\":\"Use debug-draw\"},model:{value:(_vm.useDebugDraw),callback:function ($$v) {_vm.useDebugDraw=$$v},expression:\"useDebugDraw\"}}),_c('v-checkbox',{attrs:{\"label\":\"Mirror display\"},model:{value:(_vm.useMirrorMode),callback:function ($$v) {_vm.useMirrorMode=$$v},expression:\"useMirrorMode\"}}),_c('v-checkbox',{attrs:{\"label\":\"Use custom temperature range\"},model:{value:(_vm.useCustomTemperatureRange),callback:function ($$v) {_vm.useCustomTemperatureRange=$$v},expression:\"useCustomTemperatureRange\"}}),(_vm.useCustomTemperatureRange)?_c('v-card-text',[_c('v-range-slider',{attrs:{\"min\":\"30\",\"max\":\"40\",\"step\":\"0.1\",\"thumb-label\":\"\",\"ticks\":true,\"color\":'green',\"track-color\":'rgba(255, 0, 0, 0.25)'},model:{value:(_vm.temperatureThresholds),callback:function ($$v) {_vm.temperatureThresholds=$$v},expression:\"temperatureThresholds\"}})],1):_vm._e()],1):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"container\",class:{ recording: _vm.recording },attrs:{\"id\":\"video-stream-container\"}},[_c('canvas',{ref:\"cameraStream\",attrs:{\"id\":\"camera-stream\",\"width\":\"120\",\"height\":\"160\"}}),_c('canvas',{ref:\"vizOverlay\",attrs:{\"id\":\"debug-overlay\",\"width\":\"480\",\"height\":\"640\"}}),(_vm.canEditCropping && _vm.cropEnabled)?_c('video-crop-controls',{attrs:{\"crop-box\":_vm.cropBox},on:{\"crop-changed\":_vm.gotCropChange}}):_vm._e(),(_vm.cropEnabled)?_c('v-btn',{class:{ on: _vm.canEditCropping },attrs:{\"text\":\"\",\"title\":\"Edit cropping\",\"id\":\"toggle-cropping\",\"dark\":\"\"},on:{\"click\":_vm.toggleCropping}},[_c('v-icon',[_vm._v(_vm._s(_vm.cropIcon))])],1):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"box\",attrs:{\"id\":\"fov-box\"}},[_c('div',[_c('div',{ref:\"top\",staticClass:\"fov-handle\",attrs:{\"id\":\"top-handle\"},on:{\"mousedown\":function (e) { return _vm.startDrag(e); },\"mouseup\":function (e) { return _vm.endDrag(e); },\"touchstart\":function (e) { return _vm.startDrag(e); },\"touchend\":function (e) { return _vm.endDrag(e); }}},[_c('svg',{attrs:{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 256 512\"}},[_c('path',{attrs:{\"fill\":\"currentColor\",\"d\":\"M214.059 377.941H168V134.059h46.059c21.382 0 32.09-25.851 16.971-40.971L144.971 7.029c-9.373-9.373-24.568-9.373-33.941 0L24.971 93.088c-15.119 15.119-4.411 40.971 16.971 40.971H88v243.882H41.941c-21.382 0-32.09 25.851-16.971 40.971l86.059 86.059c9.373 9.373 24.568 9.373 33.941 0l86.059-86.059c15.12-15.119 4.412-40.971-16.97-40.971z\"}})])]),_c('div',{ref:\"left\",staticClass:\"fov-handle\",attrs:{\"id\":\"left-handle\"},on:{\"mousedown\":function (e) { return _vm.startDrag(e); },\"mouseup\":function (e) { return _vm.endDrag(e); },\"touchstart\":function (e) { return _vm.startDrag(e); },\"touchend\":function (e) { return _vm.endDrag(e); }}},[_c('svg',{attrs:{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 512 512\"}},[_c('path',{attrs:{\"fill\":\"currentColor\",\"d\":\"M377.941 169.941V216H134.059v-46.059c0-21.382-25.851-32.09-40.971-16.971L7.029 239.029c-9.373 9.373-9.373 24.568 0 33.941l86.059 86.059c15.119 15.119 40.971 4.411 40.971-16.971V296h243.882v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.568 0-33.941l-86.059-86.059c-15.119-15.12-40.971-4.412-40.971 16.97z\"}})])]),_c('div',{ref:\"right\",staticClass:\"fov-handle\",attrs:{\"id\":\"right-handle\"},on:{\"mousedown\":function (e) { return _vm.startDrag(e); },\"mouseup\":function (e) { return _vm.endDrag(e); },\"touchstart\":function (e) { return _vm.startDrag(e); },\"touchend\":function (e) { return _vm.endDrag(e); }}},[_c('svg',{attrs:{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 512 512\"}},[_c('path',{attrs:{\"fill\":\"currentColor\",\"d\":\"M377.941 169.941V216H134.059v-46.059c0-21.382-25.851-32.09-40.971-16.971L7.029 239.029c-9.373 9.373-9.373 24.568 0 33.941l86.059 86.059c15.119 15.119 40.971 4.411 40.971-16.971V296h243.882v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.568 0-33.941l-86.059-86.059c-15.119-15.12-40.971-4.412-40.971 16.97z\"}})])]),_c('div',{ref:\"bottom\",staticClass:\"fov-handle\",attrs:{\"id\":\"bottom-handle\"},on:{\"mousedown\":function (e) { return _vm.startDrag(e); },\"mouseup\":function (e) { return _vm.endDrag(e); },\"touchstart\":function (e) { return _vm.startDrag(e); },\"touchend\":function (e) { return _vm.endDrag(e); }}},[_c('svg',{attrs:{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 256 512\"}},[_c('path',{attrs:{\"fill\":\"currentColor\",\"d\":\"M214.059 377.941H168V134.059h46.059c21.382 0 32.09-25.851 16.971-40.971L144.971 7.029c-9.373-9.373-24.568-9.373-33.941 0L24.971 93.088c-15.119 15.119-4.411 40.971 16.971 40.971H88v243.882H41.941c-21.382 0-32.09 25.851-16.971 40.971l86.059 86.059c9.373 9.373 24.568 9.373 33.941 0l86.059-86.059c15.12-15.119 4.412-40.971-16.97-40.971z\"}})])])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Emit, Prop, Vue } from \"vue-property-decorator\";\nimport { BoxOffset, CropBox } from \"@/types\";\n\n@Component\nexport default class VideoCropControls extends Vue {\n  @Prop({ required: true }) cropBox!: CropBox;\n\n  private currentTarget: HTMLDivElement | null = null;\n  private boundDragHandle: ((e: MouseEvent | TouchEvent) => void) | null = null;\n  private boundEndDrag: ((e: Event) => void) | null = null;\n\n  $refs!: {\n    top: HTMLDivElement;\n    right: HTMLDivElement;\n    bottom: HTMLDivElement;\n    left: HTMLDivElement;\n    box: HTMLDivElement;\n  };\n\n  created() {\n    this.boundEndDrag = this.endDrag.bind(this);\n    window.addEventListener(\"mouseup\", this.boundEndDrag);\n    window.addEventListener(\"touchend\", this.boundEndDrag);\n  }\n\n  mounted() {\n    const cropBox = this.cropBox;\n    // Set the initial handle positions:\n    const left = cropBox.left;\n    const right = cropBox.right;\n\n    this.$refs.top.style.top = `${cropBox.top}%`;\n    this.$refs.right.style.right = `${right}%`;\n    this.$refs.bottom.style.bottom = `${cropBox.bottom}%`;\n    this.$refs.left.style.left = `${left}%`;\n    let offset = cropBox.top + (100 - (cropBox.bottom + cropBox.top)) * 0.5;\n    this.$refs.left.style.top = `${offset}%`;\n    this.$refs.right.style.top = `${offset}%`;\n    offset = left + (100 - (left + right)) * 0.5;\n    this.$refs.top.style.left = `${offset}%`;\n    this.$refs.bottom.style.left = `${offset}%`;\n  }\n\n  beforeDestroy() {\n    if (this.boundEndDrag) {\n      window.removeEventListener(\"mouseup\", this.boundEndDrag);\n      window.removeEventListener(\"touchend\", this.boundEndDrag);\n    }\n  }\n\n  startDrag(event: Event) {\n    if (this.boundDragHandle === null) {\n      this.boundDragHandle = this.dragHandle.bind(this);\n    }\n    const eventName = event.type === \"mousedown\" ? \"mousemove\" : \"touchmove\";\n    this.currentTarget = event.target as HTMLDivElement;\n    if (this.boundDragHandle) {\n      window.addEventListener(eventName, this.boundDragHandle);\n    }\n  }\n\n  endDrag(event: Event) {\n    const eventName = event.type === \"mouseup\" ? \"mousemove\" : \"touchmove\";\n    this.currentTarget = null;\n    if (this.boundDragHandle) {\n      window.removeEventListener(eventName, this.boundDragHandle);\n    }\n  }\n\n  dragHandle(event: MouseEvent | TouchEvent) {\n    const cropBox = { ...this.cropBox };\n    const cropTopHandle = this.$refs.top;\n    const cropRightHandle = this.$refs.right;\n    const cropBottomHandle = this.$refs.bottom;\n    const cropLeftHandle = this.$refs.left;\n    let position: { clientX: number; clientY: number };\n    if (!(event instanceof MouseEvent)) {\n      position = (event as TouchEvent).touches[0];\n    } else {\n      position = event;\n    }\n    const { clientX: x, clientY: y } = position;\n    const minDimensions = 20;\n    let maxInsetPercentage = 35;\n    const bounds = this.$refs.box.getBoundingClientRect();\n    let offset;\n    if (this.currentTarget) {\n      const l: BoxOffset = \"left\";\n      const r: BoxOffset = \"right\";\n      switch (this.currentTarget.id) {\n        case \"top-handle\":\n          maxInsetPercentage = 100 - (cropBox.bottom + minDimensions);\n          cropBox.top = Math.min(\n            maxInsetPercentage,\n            Math.max(0, 100 * ((y - bounds.top) / bounds.height))\n          );\n          cropTopHandle.style.top = `${cropBox.top}%`;\n          offset = cropBox.top + (100 - (cropBox.bottom + cropBox.top)) * 0.5;\n          cropLeftHandle.style.top = `${offset}%`;\n          cropRightHandle.style.top = `${offset}%`;\n          break;\n        case \"right-handle\":\n          maxInsetPercentage = 100 - (cropBox[l] + minDimensions);\n          cropBox[r] = Math.min(\n            maxInsetPercentage,\n            Math.max(0, 100 * ((bounds.right - x) / bounds.width))\n          );\n          cropRightHandle.style.right = `${cropBox[r]}%`;\n          offset = cropBox[l] + (100 - (cropBox[l] + cropBox[r])) * 0.5;\n          cropTopHandle.style.left = `${offset}%`;\n          cropBottomHandle.style.left = `${offset}%`;\n          break;\n        case \"bottom-handle\":\n          maxInsetPercentage = 100 - (cropBox.top + minDimensions);\n          cropBox.bottom = Math.min(\n            maxInsetPercentage,\n            Math.max(0, 100 * ((bounds.bottom - y) / bounds.height))\n          );\n          cropBottomHandle.style.bottom = `${cropBox.bottom}%`;\n          offset = cropBox.top + (100 - (cropBox.bottom + cropBox.top)) * 0.5;\n          cropLeftHandle.style.top = `${offset}%`;\n          cropRightHandle.style.top = `${offset}%`;\n          break;\n        case \"left-handle\":\n          maxInsetPercentage = 100 - (cropBox[r] + minDimensions);\n          cropBox[l] = Math.min(\n            maxInsetPercentage,\n            Math.max(0, 100 * ((x - bounds.left) / bounds.width))\n          );\n          cropLeftHandle.style.left = `${cropBox[l]}%`;\n          offset = cropBox[l] + (100 - (cropBox[l] + cropBox[r])) * 0.5;\n          cropTopHandle.style.left = `${offset}%`;\n          cropBottomHandle.style.left = `${offset}%`;\n          break;\n      }\n      // Update saved fovBox:\n      this.$parent.$emit(\"crop-changed\", cropBox);\n    }\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoCropControls.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoCropControls.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./VideoCropControls.vue?vue&type=template&id=af7a6bf4&scoped=true&\"\nimport script from \"./VideoCropControls.vue?vue&type=script&lang=ts&\"\nexport * from \"./VideoCropControls.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./VideoCropControls.vue?vue&type=style&index=0&id=af7a6bf4&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"af7a6bf4\",\n  null\n  \n)\n\nexport default component.exports","import { CameraConnectionState, Frame } from \"./camera\";\nimport { Face } from \"./face\";\nimport { HaarCascade } from \"./haar-cascade\";\nimport { ROIFeature } from \"./worker-fns\";\nimport { DegreesCelsius } from \"@/utils\";\nimport { ThermalRefValues } from \"@/circle-detection\";\nimport { TemperatureSource } from \"@/api/types\";\nimport { FaceInfo } from \"@/body-detection\";\nimport { MotionStats } from \"@/main\";\n\nexport type BoxOffset = \"left\" | \"right\" | \"top\" | \"bottom\";\nexport interface CropBox {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n}\nexport interface BoundingBox {\n  x0: number;\n  x1: number;\n  y0: number;\n  y1: number;\n}\n\nexport interface TestAppState {\n  thermalReference: ROIFeature | null;\n  faces: Face[];\n  cropBox: CropBox;\n}\n\nexport enum ScreeningState {\n  WARMING_UP = \"WARMING_UP\",\n  READY = \"READY\", // no face\n  HEAD_LOCK = \"HEAD_LOCK\",\n  TOO_FAR = \"TOO_FAR\",\n  LARGE_BODY = \"LARGE_BODY\",\n  MULTIPLE_HEADS = \"MULTIPLE_HEADS\",\n  FACE_LOCK = \"FACE_LOCK\", // has face\n  FRONTAL_LOCK = \"FRONTAL_LOCK\", // Face is front-on\n  STABLE_LOCK = \"STABLE_LOCK\", // Face has not changed in size or position for a couple of frames.\n  LEAVING = \"LEAVING\", // has face, but not front-on\n  MISSING_THERMAL_REF = \"MISSING_REF\"\n}\n\n// This describes the state machine of allowed state transitions for the screening event.\nexport const ScreeningAcceptanceStates = {\n  [ScreeningState.WARMING_UP]: [\n    ScreeningState.READY,\n    ScreeningState.MISSING_THERMAL_REF\n  ],\n  [ScreeningState.MULTIPLE_HEADS]: [\n    ScreeningState.READY,\n    ScreeningState.HEAD_LOCK,\n    ScreeningState.FACE_LOCK,\n    ScreeningState.FRONTAL_LOCK,\n    ScreeningState.MISSING_THERMAL_REF\n  ],\n  [ScreeningState.LARGE_BODY]: [\n    ScreeningState.READY,\n    ScreeningState.HEAD_LOCK,\n    ScreeningState.MULTIPLE_HEADS,\n    ScreeningState.FACE_LOCK,\n    ScreeningState.FRONTAL_LOCK,\n    ScreeningState.TOO_FAR,\n    ScreeningState.MISSING_THERMAL_REF\n  ],\n  [ScreeningState.TOO_FAR]: [\n    ScreeningState.READY,\n    ScreeningState.HEAD_LOCK,\n    ScreeningState.MULTIPLE_HEADS,\n    ScreeningState.FACE_LOCK,\n    ScreeningState.FRONTAL_LOCK,\n    ScreeningState.MISSING_THERMAL_REF\n  ],\n  [ScreeningState.READY]: [\n    ScreeningState.TOO_FAR,\n    ScreeningState.LARGE_BODY,\n    ScreeningState.HEAD_LOCK,\n    ScreeningState.MULTIPLE_HEADS,\n    ScreeningState.FACE_LOCK,\n    ScreeningState.FRONTAL_LOCK,\n    ScreeningState.MISSING_THERMAL_REF\n  ],\n  [ScreeningState.FACE_LOCK]: [\n    ScreeningState.TOO_FAR,\n    ScreeningState.LARGE_BODY,\n    ScreeningState.HEAD_LOCK,\n    ScreeningState.MULTIPLE_HEADS,\n    ScreeningState.FRONTAL_LOCK,\n    ScreeningState.READY,\n    ScreeningState.MISSING_THERMAL_REF\n  ],\n  [ScreeningState.FRONTAL_LOCK]: [\n    ScreeningState.TOO_FAR,\n    ScreeningState.LARGE_BODY,\n    ScreeningState.STABLE_LOCK,\n    ScreeningState.FACE_LOCK,\n    ScreeningState.MULTIPLE_HEADS,\n    ScreeningState.HEAD_LOCK,\n    ScreeningState.READY,\n    ScreeningState.MISSING_THERMAL_REF\n  ],\n  [ScreeningState.HEAD_LOCK]: [\n    ScreeningState.TOO_FAR,\n    ScreeningState.LARGE_BODY,\n    ScreeningState.FACE_LOCK,\n    ScreeningState.FRONTAL_LOCK,\n    ScreeningState.READY,\n    ScreeningState.MULTIPLE_HEADS,\n    ScreeningState.MISSING_THERMAL_REF\n  ],\n  [ScreeningState.STABLE_LOCK]: [ScreeningState.LEAVING],\n  [ScreeningState.LEAVING]: [ScreeningState.READY],\n  [ScreeningState.MISSING_THERMAL_REF]: [\n    ScreeningState.READY,\n    ScreeningState.TOO_FAR,\n    ScreeningState.LARGE_BODY\n  ]\n};\n\nexport interface CalibrationConfig {\n  cropBox: CropBox;\n  timestamp: Date;\n  thermalReferenceRawValue: number;\n  hotspotRawTemperatureValue: number;\n  calibrationTemperature: DegreesCelsius;\n  thermalRefTemperature: DegreesCelsius;\n  thresholdMinNormal: number;\n  thresholdMinFever: number;\n  // TODO(jon): Custom temperature range.\n}\n\nexport interface ScreeningEvent {\n  timestamp: Date;\n  rawTemperatureValue: number;\n  sampleX: number;\n  sampleY: number;\n  frame: Frame;\n  thermalReferenceRawValue: number;\n  thermalReference: ROIFeature;\n  face: FaceInfo;\n}\n\nexport interface AppState {\n  currentFrame: Frame | null;\n  prevFrame: Frame | null;\n  cameraConnectionState: CameraConnectionState;\n  thermalReference: ROIFeature | null;\n  thermalReferenceStats: ThermalRefValues | null;\n  faces: Face[];\n  face: FaceInfo | null;\n  currentCalibration: CalibrationConfig;\n  currentScreeningEvent: ScreeningEvent | null;\n  currentScreeningState: ScreeningState;\n  currentScreeningStateFrameCount: number;\n  paused: boolean;\n  faceModel: HaarCascade | null;\n  lastFrameTime: number;\n  uuid: number;\n  motionStats: MotionStats;\n}\n\nexport interface Span {\n  x0: number;\n  x1: number;\n  y: number;\n  h: number;\n}\nexport type RawShape = Record<number, Span[]>;\n","import { FaceInfo } from \"@/body-detection\";\nimport { ROIFeature } from \"@/worker-fns\";\nimport { Shape } from \"@/shape-processing\";\nimport { RawShape } from \"@/types\";\n\nexport const WIDTH = 120;\nexport const HEIGHT = 160;\n\nexport interface Span {\n  x0: number;\n  x1: number;\n  y: number;\n  h: number; // bit marker\n}\nexport interface Rect {\n  x0: number;\n  x1: number;\n  y0: number;\n  y1: number;\n}\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport interface Vec2 {\n  x: number;\n  y: number;\n}\n\nexport const startP = ({ x0, y }: Span): Point => ({ x: x0, y });\nexport const endP = ({ x1, y }: Span): Point => ({ x: x1, y });\nexport const distanceSq = (a: Point, b: Point): number => {\n  const dX = a.x - b.x;\n  const dY = a.y - b.y;\n  return dX * dX + dY * dY;\n};\nexport const distance = (a: Point, b: Point): number =>\n  Math.sqrt(distanceSq(a, b));\n\nexport const distanceSq2 = (\n  a: [number, number],\n  b: [number, number]\n): number => {\n  const dX = a[0] - b[0];\n  const dY = a[1] - b[1];\n  return dX * dX + dY * dY;\n};\n\nexport const spanWidth = (span: Span): number => span.x1 - span.x0;\n\nexport function shapeArea(shape: Shape): number {\n  return shape.reduce((acc, span) => acc + spanWidth(span), 0);\n}\n\nexport function rawShapeArea(shape: RawShape): number {\n  return Object.values(shape).reduce((acc, span) => acc + shapeArea(span), 0);\n}\n\nexport function largestShape(shapes: Shape[]): Shape {\n  return shapes.reduce((prevBestShape: Shape, shape: Shape) => {\n    const best = shapeArea(prevBestShape);\n    const area = shapeArea(shape);\n    return area > best ? shape : prevBestShape;\n  }, []);\n}\n\nexport function rectDims(rect: Rect): { w: number; h: number } {\n  return { w: rect.x1 - rect.x0, h: rect.y1 - rect.y0 };\n}\n\nexport function boundsForShape(shape: Shape): Rect {\n  const y0 = shape[0].y;\n  const y1 = shape[shape.length - 1].y;\n  const x0 = Math.min(...shape.map(({ x0 }) => x0));\n  const x1 = Math.max(...shape.map(({ x1 }) => x1));\n  return { x0, x1, y0, y1 };\n}\n\nexport function boundsForRawShape(shape: RawShape): Rect {\n  let minY = Number.MAX_SAFE_INTEGER;\n  let maxY = 0;\n  let minX = Number.MAX_SAFE_INTEGER;\n  let maxX = 0;\n  for (const row of Object.values(shape)) {\n    for (const span of row) {\n      minY = Math.min(span.y, minY);\n      maxY = Math.max(span.y, maxY);\n      minX = Math.min(span.x0, minX);\n      maxX = Math.max(span.x1, maxX);\n    }\n  }\n  return { x0: minX, y0: minY, y1: maxY, x1: maxX };\n}\n\nexport function widestSpan(shape: Span[]): Span {\n  let maxWidthSpan = shape[0];\n  for (const span of shape) {\n    if (spanWidth(span) > spanWidth(maxWidthSpan)) {\n      maxWidthSpan = span;\n    }\n  }\n  return maxWidthSpan;\n}\n\nexport function narrowestSpan(shape: Shape): Span {\n  let minWidthSpan;\n  minWidthSpan = shape.find(x => x.x0 !== 0 && x.x1 !== WIDTH - 1);\n  if (!minWidthSpan) {\n    minWidthSpan = shape[0];\n  }\n  // TODO(jon): Ideally the narrowest span doesn't hit the frame edges.\n  for (const span of shape) {\n    if (spanWidth(span) <= spanWidth(minWidthSpan)) {\n      if (span.x0 !== 0 && span.x1 !== WIDTH - 1) {\n        minWidthSpan = span;\n      }\n    }\n  }\n  return minWidthSpan;\n}\n\nexport function narrowestSlanted(shape: Shape, start: Span): [Span, Span] {\n  const nIndex = shape.indexOf(start);\n  // From the narrowest, wiggle about on each side to try to find a shorter distance between spans.\n  const startIndex = Math.max(0, nIndex - 13);\n  const endIndex = Math.min(shape.length - 1, nIndex + 13);\n  const distances = [];\n  for (let i = startIndex; i < endIndex; i++) {\n    for (let j = startIndex; j < endIndex; j++) {\n      if (i !== j) {\n        const d = distanceSq(startP(shape[i]), endP(shape[j]));\n        distances.push({\n          d,\n          skew: Math.abs(shape[i].y - shape[j].y),\n          left: shape[i],\n          right: shape[j]\n        });\n      }\n    }\n  }\n  // If there are a bunch that are similar, prefer the least slanted one.\n  distances.sort((a, b) => {\n    // NOTE(defer spans where x0 or x1 is on the edge of the frame.\n    if (a.left.x0 === 0 || a.right.x1 === WIDTH - 1) {\n      return 1;\n    } else if (b.left.x0 === 0 || b.right.x1 === WIDTH - 1) {\n      return -1;\n    }\n\n    if (a.d < b.d) {\n      return -1;\n    } else if (a.d > b.d) {\n      return 1;\n    } else {\n      if (a.skew < b.skew) {\n        return -1;\n      } else if (a.skew > a.skew) {\n        return 1;\n      } else {\n        return b.right.y + b.left.y - (a.right.y + a.left.y);\n      }\n    }\n  });\n  if (distances.length) {\n    let { left, right, skew: bestSkew } = distances[0];\n    const { d: bestD } = distances[0];\n\n    let i = 1;\n\n    while (Math.abs(Math.sqrt(distances[i].d) - Math.sqrt(bestD)) < 1) {\n      if (distances[i].skew < bestSkew) {\n        bestSkew = distances[i].skew;\n        left = distances[i].left;\n        right = distances[i].right;\n      }\n      i++;\n      if (i === distances.length) {\n        break;\n      }\n    }\n    return [left, right];\n  }\n  return [start, start];\n}\n\nexport function narrowestSpans(shape: Shape): [Span, Span] {\n  const narrowest = narrowestSpan(shape);\n  return narrowestSlanted(shape, narrowest);\n}\n\nexport function magnitude(vec: Vec2): number {\n  return Math.sqrt(vec.x * vec.x + vec.y * vec.y);\n}\n\nexport function normalise(vec: Vec2): Vec2 {\n  const len = magnitude(vec);\n  return {\n    x: vec.x / len,\n    y: vec.y / len\n  };\n}\n\nexport function scale(vec: Vec2, scale: number): Vec2 {\n  return {\n    x: vec.x * scale,\n    y: vec.y * scale\n  };\n}\n\nexport function perp(vec: Vec2): Vec2 {\n  // noinspection JSSuspiciousNameCombination\n  return {\n    x: vec.y,\n    y: -vec.x\n  };\n}\n\nexport function add(a: Vec2, b: Vec2): Vec2 {\n  return {\n    x: a.x + b.x,\n    y: a.y + b.y\n  };\n}\n\nexport function sub(a: Vec2, b: Vec2): Vec2 {\n  return {\n    x: a.x - b.x,\n    y: a.y - b.y\n  };\n}\n\nexport const isLeft = (l0: Point, l1: Point, p: Point): number =>\n  // Use cross-product to determine which side of a line a point is on.\n  (l1.x - l0.x) * (p.y - l0.y) - (l1.y - l0.y) * (p.x - l0.x);\n\nexport const pointIsLeftOfOrOnLine = (\n  l0: Point,\n  l1: Point,\n  p: Point\n): boolean =>\n  // Use cross-product to determine which side of a line a point is on.\n  isLeft(l0, l1, p) >= 0;\n\nexport const pointIsLeftOfLine = (l0: Point, l1: Point, p: Point): boolean =>\n  // Use cross-product to determine which side of a line a point is on.\n  isLeft(l0, l1, p) > 0;\n\nexport function isNotCeilingHeat(shape: Shape): boolean {\n  return !(shape[0].y === 0 && shape.length < 80);\n}\n\nexport interface Quad {\n  topLeft: Point;\n  topRight: Point;\n  bottomLeft: Point;\n  bottomRight: Point;\n}\n\nexport function pointIsInQuad(p: Point, quad: Quad): boolean {\n  return (\n    pointIsLeftOfLine(quad.bottomLeft, quad.topLeft, p) &&\n    pointIsLeftOfLine(quad.topRight, quad.bottomRight, p) &&\n    pointIsLeftOfLine(quad.bottomRight, quad.bottomLeft, p) &&\n    pointIsLeftOfLine(quad.topLeft, quad.topRight, p)\n  );\n}\n\nexport function faceIntersectsThermalRef(\n  face: FaceInfo,\n  thermalReference: ROIFeature | null\n): boolean {\n  if (thermalReference === null) {\n    return false;\n  }\n  const quad = {\n    topLeft: face.head.topLeft,\n    topRight: face.head.topRight,\n    bottomLeft: face.head.bottomLeft,\n    bottomRight: face.head.bottomRight\n  };\n  return (\n    pointIsInQuad({ x: thermalReference.x0, y: thermalReference.y0 }, quad) ||\n    pointIsInQuad({ x: thermalReference.x0, y: thermalReference.y1 }, quad) ||\n    pointIsInQuad({ x: thermalReference.x1, y: thermalReference.y0 }, quad) ||\n    pointIsInQuad({ x: thermalReference.x1, y: thermalReference.y1 }, quad)\n  );\n}\n\nexport function shapesOverlap(a: RawShape, b: RawShape): boolean {\n  for (const [y, rowA] of Object.entries(a)) {\n    if (b[Number(y)]) {\n      for (const spanB of b[Number(y)]) {\n        for (const spanA of rowA) {\n          if (!(spanA.x1 < spanB.x0 || spanA.x0 >= spanB.x1)) {\n            return true;\n          }\n        }\n      }\n    }\n  }\n  return false;\n}\n\nexport function drawRawShapesIntoMask(\n  shapes: RawShape[],\n  data: Uint8Array,\n  bit: number,\n  width = 120\n) {\n  for (const shape of shapes) {\n    for (const row of Object.values(shape)) {\n      for (const span of row) {\n        let i = span.x0;\n        if (span.x0 >= span.x1) {\n          console.warn(\"Weird spans\", span.x0, span.x1);\n          continue;\n        }\n        do {\n          data[span.y * width + i] |= bit;\n          i++;\n        } while (i < span.x1);\n      }\n    }\n  }\n}\n\nexport function drawShapesIntoMask(\n  shapes: Shape[],\n  data: Uint8Array,\n  bit: number,\n  width = 120\n) {\n  for (const shape of shapes) {\n    for (const span of shape) {\n      let i = span.x0;\n      if (span.x0 >= span.x1) {\n        console.warn(\"Weird spans\", span.x0, span.x1);\n        continue;\n      }\n      do {\n        data[span.y * width + i] |= bit;\n        i++;\n      } while (i < span.x1);\n    }\n  }\n}\n\nexport function getSolidShapes(\n  frameShapes: Array<Record<number, Shape>>\n): Shape[] {\n  const solidShapes = [];\n  // Infills vertical cracks.\n  for (const shape of frameShapes) {\n    const solidShape: Shape = [];\n    for (const [row, spans] of Object.entries(shape)) {\n      const minX0 = spans.reduce(\n        (acc, span) => Math.min(acc, span.x0),\n        Number.MAX_SAFE_INTEGER\n      );\n      const maxX1 = spans.reduce((acc, span) => Math.max(acc, span.x1), 0);\n      solidShape.push({\n        x0: minX0,\n        x1: maxX1,\n        y: Number(row),\n        h: 0\n      });\n    }\n    solidShape.sort((a, b) => a.y - b.y);\n    solidShapes.push(solidShape);\n  }\n  return solidShapes;\n}\n\nexport function shapeIsNotCircular(shape: Shape): boolean {\n  const dims = rectDims(boundsForShape(shape));\n  return Math.abs(dims.w - dims.h) > 4;\n}\n\nexport function shapeIsOnSide(shape: Shape): boolean {\n  for (const { x0, x1 } of shape) {\n    if (x0 === 0 || x1 === WIDTH - 1) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function extendToBottom(shape: Shape): Shape {\n  const halfway = Math.floor(shape.length / 2);\n  let prevSpan = shape[halfway];\n  for (let i = halfway + 1; i < shape.length; i++) {\n    const span = shape[i];\n    // Basically, if it's past halfway down the shape, and it's narrowing too much,\n    // don't let it.\n    const width = spanWidth(span);\n    const prevWidth = spanWidth(prevSpan);\n    if (Math.abs(prevWidth - width) > 1) {\n      // Make sure x0 and x1 are always at least as far out as the previous span:\n      span.x0 = Math.min(span.x0, prevSpan.x0);\n      span.x1 = Math.max(span.x1, prevSpan.x1);\n    }\n\n    prevSpan = span;\n  }\n  const inc = 0;\n  while (prevSpan.y < HEIGHT) {\n    const dup = {\n      y: prevSpan.y + 1,\n      x0: prevSpan.x0 - inc,\n      x1: prevSpan.x1 + inc,\n      h: 0\n    };\n    // Add all the duplicate spans:\n    shape.push(dup);\n    prevSpan = dup;\n  }\n  return shape;\n}\n\nexport function spanOverlapsShape(span: Span, shape: RawShape): boolean {\n  if (shape[span.y - 1]) {\n    for (const upperSpan of shape[span.y - 1]) {\n      if (!(upperSpan.x1 < span.x0 || upperSpan.x0 >= span.x1)) {\n        return true;\n      }\n    }\n  }\n  if (shape[span.y + 1]) {\n    for (const lowerSpan of shape[span.y + 1]) {\n      if (!(lowerSpan.x1 < span.x0 || lowerSpan.x0 >= span.x1)) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nexport function mergeShapes(shape: RawShape, other: RawShape) {\n  const rows = [...Object.keys(shape), ...Object.keys(other)];\n  for (const row of rows) {\n    const rowN = Number(row);\n    if (shape[rowN] && other[rowN]) {\n      shape[rowN].push(...other[rowN]);\n    } else if (other[rowN]) {\n      shape[rowN] = other[rowN];\n    }\n  }\n}\n\nexport function getRawShapes(\n  thresholded: Uint8Array,\n  width: number,\n  height: number,\n  maskBit: number\n): RawShape[] {\n  const shapes = [];\n  for (let y = 0; y < height; y++) {\n    let span = { x0: -1, x1: width, y, h: 0 };\n    for (let x = 0; x < width; x++) {\n      const index = y * width + x;\n      if (thresholded[index] & maskBit && span.x0 === -1) {\n        span.x0 = x;\n      }\n      if (\n        span.x0 !== -1 &&\n        (!(thresholded[index] & maskBit) || x === width - 1)\n      ) {\n        if (x === width - 1 && thresholded[index] & maskBit) {\n          span.x1 = width;\n        } else {\n          span.x1 = x;\n        }\n\n        // Either put the span in an existing open shape, or start a new shape with it\n        let assignedSpan = false;\n        let n = shapes.length;\n        let assignedShape;\n        while (n !== 0) {\n          const shape = shapes.shift() as RawShape;\n          const overlap = shape && spanOverlapsShape(span, shape);\n          if (overlap) {\n            // Merge shapes\n            if (!assignedSpan) {\n              assignedSpan = true;\n              if (shape[y]) {\n                (shape[y] as Span[]).push(span);\n              } else {\n                shape[y] = [span];\n              }\n              assignedShape = shape;\n              shapes.push(shape);\n            } else {\n              // Merge this shape with the shape the span was assigned to.\n              mergeShapes(assignedShape as RawShape, shape);\n            }\n          } else {\n            shapes.push(shape);\n          }\n          n--;\n        }\n        if (!assignedSpan) {\n          shapes.push({ [y]: [span] });\n        }\n        span = { x0: -1, x1: width, y, h: 0 };\n      }\n    }\n  }\n  return shapes;\n}\n\nexport function offsetRawShape(shapes: RawShape[], offset: Point): RawShape[] {\n  const newShapes = [];\n  for (const shape of shapes) {\n    const newShape: Record<number, Span[]> = {};\n    for (const row of Object.values(shape)) {\n      for (const span of row) {\n        if (!newShape[span.y + offset.y]) {\n          newShape[span.y + offset.y] = [];\n        }\n        newShape[span.y + offset.y].push({\n          x0: span.x0 + offset.x,\n          x1: span.x1 + offset.x,\n          y: span.y + offset.y,\n          h: span.h\n        });\n      }\n    }\n    newShapes.push(newShape);\n  }\n  return newShapes;\n}\nexport function boundsForConvexHull(hull: ConvexHull): Rect {\n  const x0 = hull.reduce(\n    (minX, point) => (point.x < minX ? point.x : minX),\n    hull[0].x\n  );\n  const x1 = hull.reduce(\n    (maxX, point) => (point.x > maxX ? point.x : maxX),\n    hull[0].x\n  );\n  const y0 = hull.reduce(\n    (minY, point) => (point.y < minY ? point.y : minY),\n    hull[0].y\n  );\n  const y1 = hull.reduce(\n    (maxY, point) => (point.y > maxY ? point.y : maxY),\n    hull[0].y\n  );\n  return { x0, x1, y0, y1 };\n}\n\nexport function joinShapes(top: Shape, bottom: Shape, quad: Quad): Shape {\n  const s: Record<number, Span[]> = {};\n  for (const span of top) {\n    if (s[span.y]) {\n      s[span.y].push(span);\n    } else {\n      s[span.y] = [span];\n    }\n  }\n\n  // TODO(jon): Need to rasterize the quad and add it.\n  // First get the quad bounds, then test every point inside the bounds.\n  const quadBounds = boundsForConvexHull([\n    quad.bottomLeft,\n    quad.bottomRight,\n    quad.topLeft,\n    quad.topRight\n  ]);\n  const width = quadBounds.x1 - quadBounds.x0;\n  const height = quadBounds.y1 - quadBounds.y0;\n  const bitmap = new Uint8Array(width * height);\n\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      const p = { x: quadBounds.x0 + x, y: quadBounds.y0 + y };\n      if (pointIsInQuad(p, quad)) {\n        const index = y * width + x;\n        bitmap[index] = 255;\n      }\n    }\n  }\n\n  // FIXME(jon): This probably doesn't work anymore\n  const rr = getRawShapes(bitmap, width, height, 255);\n  const raw = offsetRawShape(rr, { x: quadBounds.x0, y: quadBounds.y0 });\n  const r = getSolidShapes(raw);\n  if (r.length) {\n    for (const span of r[0]) {\n      if (s[span.y]) {\n        s[span.y].push(span);\n      } else {\n        s[span.y] = [span];\n      }\n    }\n  }\n\n  for (const span of bottom) {\n    if (s[span.y]) {\n      s[span.y].push(span);\n    } else {\n      s[span.y] = [span];\n    }\n  }\n\n  // TODO(jon): Join shapes needs to fill in the gaps with something\n  //const shapes =\n  return getSolidShapes([s])[0];\n}\n\nexport type RawPoint = [number, number];\nexport type ConvexHull = Point[];\n\nexport function closestPoint(point: Point, points: Point[]): Point {\n  let bestP;\n  let bestD = Number.MAX_SAFE_INTEGER;\n  for (const p of points) {\n    const d = distanceSq(p, point);\n    if (d < bestD) {\n      bestD = d;\n      bestP = p;\n    }\n  }\n  return bestP as Point;\n}\n\nexport function allNeighboursEqual(\n  x: number,\n  y: number,\n  data: Uint8Array,\n  bit: number\n): boolean {\n  const w = 120;\n  const top = data[(y - 1) * w + x];\n  const topLeft = data[(y - 1) * w + (x - 1)];\n  const topRight = data[(y - 1) * w + (x + 1)];\n  const left = data[y * w + (x - 1)];\n  const right = data[y * w + (x + 1)];\n  const bottom = data[(y + 1) * w + x];\n  const bottomLeft = data[(y + 1) * w + (x - 1)];\n  const bottomRight = data[(y + 1) * w + (x + 1)];\n  return (\n    top === bit &&\n    topRight === bit &&\n    right === bit &&\n    bottomRight === bit &&\n    bottom === bit &&\n    bottomLeft === bit &&\n    left === bit &&\n    topLeft === bit\n  );\n}\n\nexport function localDensity(\n  x: number,\n  y: number,\n  data: Uint8Array,\n  bit: number\n): number {\n  const x0 = Math.max(x - 2, 0);\n  const x1 = Math.min(x + 2, WIDTH - 1);\n  const y0 = Math.max(y - 2, 0);\n  const y1 = Math.min(y + 2, HEIGHT - 1);\n  let sum = 0;\n  for (let y = y0; y < y1; y++) {\n    for (let x = x0; x < x1; x++) {\n      const index = y * WIDTH + x;\n      if (data[index] & bit) {\n        sum++;\n      }\n    }\n  }\n  return sum;\n}\n\nexport function distToSegmentSquared(p: Point, v: Vec2, w: Vec2): number {\n  const l2 = distanceSq(v, w);\n  if (l2 == 0) {\n    return distanceSq(p, v);\n  }\n  let t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2;\n  t = Math.max(0, Math.min(1, t));\n  return distanceSq(p, { x: v.x + t * (w.x - v.x), y: v.y + t * (w.y - v.y) });\n}\n\nexport function directionOfSet(set: Point[]): { v: Vec2; y: number } {\n  // What's a good way to get the current average direction?\n  // This is \"least squares\"\n  const meanX = set.reduce((acc, { x }) => acc + x, 0) / set.length;\n  const meanY = set.reduce((acc, { y }) => acc + y, 0) / set.length;\n  let num = 0;\n  let den = 0;\n  for (const p of set) {\n    num += (p.x - meanX) * (p.y - meanY);\n    den += (p.x - meanX) ** 2;\n  }\n  const gradient = num / den;\n  const yIntercept = meanY - gradient * meanX;\n  //return {x: gradient, y: yIntercept};\n  return { v: normalise({ x: 1, y: gradient }), y: yIntercept };\n}\n\nexport const pointsAreEqual = (a: Point, b: Point): boolean =>\n  a.x === b.x && a.y === b.y;\nexport const pointIsInSet = (pt: Point, set: Point[]): boolean =>\n  set.find(x => pointsAreEqual(x, pt)) !== undefined;\n\nconst maxSliceLength = 5;\nexport const minYIndex = (arr: Point[]): number => {\n  let lowestY = Number.MAX_SAFE_INTEGER;\n  let lowestIndex = 0;\n  for (let i = 0; i < arr.length; i++) {\n    const y = arr[i].y;\n    if (y < lowestY) {\n      lowestY = y;\n      lowestIndex = i;\n    }\n  }\n  return lowestIndex;\n};\nexport const head = (arr: Point[]): Point[] =>\n  arr.slice(0, Math.min(maxSliceLength, arr.length - 1));\nexport const tail = (arr: Point[]): Point[] =>\n  arr.slice(\n    arr.length - 1 - Math.min(maxSliceLength, arr.length) + 1,\n    Math.min(maxSliceLength, arr.length) + 1\n  );\n\nexport function fillVerticalCracks(shape: Shape) {\n  // Fill gaps?\n  for (let i = 0; i < shape.length; i++) {\n    const startSpan = shape[i];\n    const startWidth = spanWidth(startSpan);\n    let shouldFill = false;\n    const startFillIndex = i;\n    if (i + 1 >= shape.length) {\n      break;\n    }\n    while (i + 1 < shape.length && startWidth / spanWidth(shape[i + 1]) > 2) {\n      shouldFill = true;\n      i++;\n    }\n\n    if (shouldFill) {\n      const endSpan = shape[i];\n      for (let j = startFillIndex + 1; j < i + 1; j++) {\n        shape[j].x0 = Math.min(startSpan.x0, endSpan.x0);\n        shape[j].x1 = Math.max(startSpan.x1, endSpan.x1);\n      }\n    }\n  }\n}\n\n// Convex hull:\n\nfunction pointInPolygon(point: RawPoint, vs: RawPoint[]) {\n  // ray-casting algorithm based on\n  // http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html\n  const [x, y] = point;\n  let inside = false;\n  for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {\n    const xi = vs[i][0],\n      yi = vs[i][1];\n    const xj = vs[j][0],\n      yj = vs[j][1];\n\n    const intersect =\n      yi > y != yj > y && x < ((xj - xi) * (y - yi)) / (yj - yi) + xi;\n    if (intersect) {\n      inside = !inside;\n    }\n  }\n  return inside;\n}\nconst e = 134217729,\n  n = 33306690738754706e-32;\nfunction r(\n  t: number,\n  e: Float64Array,\n  n: number,\n  r: Float64Array,\n  o: Float64Array\n) {\n  let f,\n    i,\n    u,\n    c,\n    s = e[0],\n    a = r[0],\n    d = 0,\n    l = 0;\n  a > s == a > -s ? ((f = s), (s = e[++d])) : ((f = a), (a = r[++l]));\n  let p = 0;\n  if (d < t && l < n)\n    for (\n      a > s == a > -s\n        ? ((u = f - ((i = s + f) - s)), (s = e[++d]))\n        : ((u = f - ((i = a + f) - a)), (a = r[++l])),\n        f = i,\n        0 !== u && (o[p++] = u);\n      d < t && l < n;\n\n    )\n      a > s == a > -s\n        ? ((u = f - ((i = f + s) - (c = i - f)) + (s - c)), (s = e[++d]))\n        : ((u = f - ((i = f + a) - (c = i - f)) + (a - c)), (a = r[++l])),\n        (f = i),\n        0 !== u && (o[p++] = u);\n  for (; d < t; )\n    (u = f - ((i = f + s) - (c = i - f)) + (s - c)),\n      (s = e[++d]),\n      (f = i),\n      0 !== u && (o[p++] = u);\n  for (; l < n; )\n    (u = f - ((i = f + a) - (c = i - f)) + (a - c)),\n      (a = r[++l]),\n      (f = i),\n      0 !== u && (o[p++] = u);\n  return (0 === f && 0 !== p) || (o[p++] = f), p;\n}\nfunction o(t: number) {\n  return new Float64Array(t);\n}\nconst f = 33306690738754716e-32,\n  i = 22204460492503146e-32,\n  u = 11093356479670487e-47,\n  c = o(4),\n  s = o(8),\n  a = o(12),\n  d = o(16),\n  l = o(4);\nexport function orient(\n  t: number,\n  o: number,\n  p: number,\n  b: number,\n  y: number,\n  h: number\n) {\n  const M = (o - h) * (p - y),\n    x = (t - y) * (b - h),\n    j = M - x;\n  if (0 === M || 0 === x || M > 0 != x > 0) return j;\n  const m = Math.abs(M + x);\n  return Math.abs(j) >= f * m\n    ? j\n    : -(function(t, o, f, p, b, y, h) {\n        let M, x, j, m, _, v, w, A, F, O, P, g, k, q, z, B, C, D;\n        const E = t - b,\n          G = f - b,\n          H = o - y,\n          I = p - y;\n        (_ =\n          (z =\n            (A = E - (w = (v = e * E) - (v - E))) *\n              (O = I - (F = (v = e * I) - (v - I))) -\n            ((q = E * I) - w * F - A * F - w * O)) -\n          (P =\n            z -\n            (C =\n              (A = H - (w = (v = e * H) - (v - H))) *\n                (O = G - (F = (v = e * G) - (v - G))) -\n              ((B = H * G) - w * F - A * F - w * O)))),\n          (c[0] = z - (P + _) + (_ - C)),\n          (_ = (k = q - ((g = q + P) - (_ = g - q)) + (P - _)) - (P = k - B)),\n          (c[1] = k - (P + _) + (_ - B)),\n          (_ = (D = g + P) - g),\n          (c[2] = g - (D - _) + (P - _)),\n          (c[3] = D);\n        let J = (function(t, e) {\n            let n = e[0];\n            for (let r = 1; r < t; r++) n += e[r];\n            return n;\n          })(4, c),\n          K = i * h;\n        if (J >= K || -J >= K) return J;\n        if (\n          ((M = t - (E + (_ = t - E)) + (_ - b)),\n          (j = f - (G + (_ = f - G)) + (_ - b)),\n          (x = o - (H + (_ = o - H)) + (_ - y)),\n          (m = p - (I + (_ = p - I)) + (_ - y)),\n          0 === M && 0 === x && 0 === j && 0 === m)\n        )\n          return J;\n        if (\n          ((K = u * h + n * Math.abs(J)),\n          (J += E * m + I * M - (H * j + G * x)) >= K || -J >= K)\n        )\n          return J;\n        (_ =\n          (z =\n            (A = M - (w = (v = e * M) - (v - M))) *\n              (O = I - (F = (v = e * I) - (v - I))) -\n            ((q = M * I) - w * F - A * F - w * O)) -\n          (P =\n            z -\n            (C =\n              (A = x - (w = (v = e * x) - (v - x))) *\n                (O = G - (F = (v = e * G) - (v - G))) -\n              ((B = x * G) - w * F - A * F - w * O)))),\n          (l[0] = z - (P + _) + (_ - C)),\n          (_ = (k = q - ((g = q + P) - (_ = g - q)) + (P - _)) - (P = k - B)),\n          (l[1] = k - (P + _) + (_ - B)),\n          (_ = (D = g + P) - g),\n          (l[2] = g - (D - _) + (P - _)),\n          (l[3] = D);\n        const L = r(4, c, 4, l, s);\n        (_ =\n          (z =\n            (A = E - (w = (v = e * E) - (v - E))) *\n              (O = m - (F = (v = e * m) - (v - m))) -\n            ((q = E * m) - w * F - A * F - w * O)) -\n          (P =\n            z -\n            (C =\n              (A = H - (w = (v = e * H) - (v - H))) *\n                (O = j - (F = (v = e * j) - (v - j))) -\n              ((B = H * j) - w * F - A * F - w * O)))),\n          (l[0] = z - (P + _) + (_ - C)),\n          (_ = (k = q - ((g = q + P) - (_ = g - q)) + (P - _)) - (P = k - B)),\n          (l[1] = k - (P + _) + (_ - B)),\n          (_ = (D = g + P) - g),\n          (l[2] = g - (D - _) + (P - _)),\n          (l[3] = D);\n        const N = r(L, s, 4, l, a);\n        (_ =\n          (z =\n            (A = M - (w = (v = e * M) - (v - M))) *\n              (O = m - (F = (v = e * m) - (v - m))) -\n            ((q = M * m) - w * F - A * F - w * O)) -\n          (P =\n            z -\n            (C =\n              (A = x - (w = (v = e * x) - (v - x))) *\n                (O = j - (F = (v = e * j) - (v - j))) -\n              ((B = x * j) - w * F - A * F - w * O)))),\n          (l[0] = z - (P + _) + (_ - C)),\n          (_ = (k = q - ((g = q + P) - (_ = g - q)) + (P - _)) - (P = k - B)),\n          (l[1] = k - (P + _) + (_ - B)),\n          (_ = (D = g + P) - g),\n          (l[2] = g - (D - _) + (P - _)),\n          (l[3] = D);\n        const Q = r(N, a, 4, l, d);\n        return d[Q - 1];\n      })(t, o, p, b, y, h, m);\n}\n\nfunction cross(p1: RawPoint, p2: RawPoint, p3: RawPoint) {\n  return orient(p1[0], p1[1], p2[0], p2[1], p3[0], p3[1]);\n}\n\nfunction compareByX(a: RawPoint, b: RawPoint) {\n  return a[0] === b[0] ? a[1] - b[1] : a[0] - b[0];\n}\n\nfunction convexHull(points: RawPoint[]): RawPoint[] {\n  points.sort(compareByX);\n  const lower = [];\n  for (let i = 0; i < points.length; i++) {\n    while (\n      lower.length >= 2 &&\n      cross(lower[lower.length - 2], lower[lower.length - 1], points[i]) <= 0\n    ) {\n      lower.pop();\n    }\n    lower.push(points[i]);\n  }\n\n  const upper = [];\n  for (let ii = points.length - 1; ii >= 0; ii--) {\n    while (\n      upper.length >= 2 &&\n      cross(upper[upper.length - 2], upper[upper.length - 1], points[ii]) <= 0\n    ) {\n      upper.pop();\n    }\n    upper.push(points[ii]);\n  }\n\n  upper.pop();\n  lower.pop();\n  return lower.concat(upper);\n}\n\n// speed up convex hull by filtering out points inside quadrilateral formed by 4 extreme points\nexport function fastConvexHull(points: RawPoint[]): RawPoint[] {\n  let left = points[0];\n  let top = points[0];\n  let right = points[0];\n  let bottom = points[0];\n\n  // find the leftmost, rightmost, topmost and bottommost points\n  for (const p of points) {\n    if (p[0] < left[0]) {\n      left = p;\n    }\n    if (p[0] > right[0]) {\n      right = p;\n    }\n    if (p[1] < top[1]) {\n      top = p;\n    }\n    if (p[1] > bottom[1]) {\n      bottom = p;\n    }\n  }\n\n  // filter out points that are inside the resulting quadrilateral\n  const cull = [left, top, right, bottom];\n  const filtered = cull.slice();\n  for (const p of points) {\n    if (!pointInPolygon(p, cull)) filtered.push(p);\n  }\n\n  // get convex hull around the filtered points\n  return convexHull(filtered);\n}\n\nexport function convexHullForShape(shape: Shape): ConvexHull {\n  const points: RawPoint[] = [];\n  for (const span of shape) {\n    points.push([span.x0, span.y]);\n    points.push([span.x1, span.y]);\n  }\n  return fastConvexHull(points).map(([x, y]: RawPoint) => ({ x, y }));\n}\n\nexport function convexHullForPoints(points: RawPoint[]): ConvexHull {\n  return fastConvexHull(points).map(([x, y]: RawPoint) => ({ x, y }));\n  // TODO(jon): Need to \"rasterize\" the convex hull back to our span based form.\n  //  Get the bounds of the convex hull, then iterate through each pixel and check whether or not they are outside\n  //  the shape (maybe divide into triangles, and use pointInsideTriangle?)\n}\n","import { RawPoint } from \"@/geom\";\n\nconst DBScan = ({\n  dataset,\n  epsilon,\n  epsilonCompare,\n  minimumPoints,\n  distanceFunction\n}: {\n  dataset: RawPoint[];\n  epsilon: number;\n  epsilonCompare: (a: any, b: any) => boolean;\n  minimumPoints: number;\n  distanceFunction: (a: any, b: any) => number;\n}): { clusters: number[][]; noise: number[] } => {\n  epsilon = epsilon || 1; // aka maxDistance\n  epsilonCompare =\n    epsilonCompare || ((dist: number, e: number): boolean => dist < e);\n  minimumPoints = minimumPoints || 2;\n  distanceFunction =\n    distanceFunction || ((a: number, b: number): number => Math.abs(a - b));\n\n  const visitedIndices: Record<number, boolean> = {};\n  const isVisited = (i: number): boolean => visitedIndices[i],\n    markVisited = (i: number) => {\n      visitedIndices[i] = true;\n    };\n\n  const clusteredIndices: Record<number, boolean> = {};\n  const isClustered = (i: number): boolean => clusteredIndices[i],\n    markClustered = (i: number) => {\n      clusteredIndices[i] = true;\n    };\n\n  const uniqueMerge = (targetArray: number[], sourceArray: number[]) => {\n    for (let i = 0; i < sourceArray.length; i += 1) {\n      const item = sourceArray[i];\n      if (targetArray.indexOf(item) < 0) {\n        targetArray.push(item);\n      }\n    }\n  };\n\n  const findNeighbors = (index: number): number[] => {\n    const neighbors = [];\n    for (let other = 0; other < dataset.length; other += 1) {\n      const distance = distanceFunction(dataset[index], dataset[other]);\n      if (epsilonCompare(distance, epsilon)) {\n        neighbors.push(other);\n      }\n    }\n    return neighbors;\n  };\n\n  const noise: number[] = [],\n    addNoise = (i: number) => noise.push(i);\n\n  const clusters: number[][] = [],\n    createCluster = () => clusters.push([]) - 1,\n    addIndexToCluster = (c: number, i: number) => {\n      clusters[c].push(i);\n      markClustered(i);\n    };\n\n  const expandCluster = (c: number, neighbors: number[]) => {\n    for (let i = 0; i < neighbors.length; i += 1) {\n      const neighborIndex = neighbors[i];\n      if (!isVisited(neighborIndex)) {\n        markVisited(neighborIndex);\n\n        const secondaryNeighbors = findNeighbors(neighborIndex);\n        if (secondaryNeighbors.length >= minimumPoints) {\n          uniqueMerge(neighbors, secondaryNeighbors);\n        }\n      }\n\n      if (!isClustered(neighborIndex)) {\n        addIndexToCluster(c, neighborIndex);\n      }\n    }\n  };\n\n  dataset.forEach((unused: number[], index: number) => {\n    if (!isVisited(index)) {\n      markVisited(index);\n\n      const neighbors: number[] = findNeighbors(index);\n      if (neighbors.length < minimumPoints) {\n        noise.push(index);\n      } else {\n        const clusterIndex = createCluster();\n        addIndexToCluster(clusterIndex, index);\n        expandCluster(clusterIndex, neighbors);\n      }\n    }\n  });\n\n  return { clusters, noise };\n};\nexport default DBScan;\n","import {\r\n  add,\r\n  HEIGHT,\r\n  magnitude,\r\n  normalise,\r\n  perp,\r\n  Point,\r\n  scale,\r\n  sub,\r\n  Vec2,\r\n  WIDTH\r\n} from \"./geom\";\r\nimport { Shape } from \"@/shape-processing\";\r\n\r\nexport function raymarchFaceDims(\r\n  l1: Point,\r\n  neckBaseMiddleP: Point,\r\n  body: Shape\r\n): {\r\n  normMidline: Vec2;\r\n  leftSymmetry: number[];\r\n  rightSymmetry: number[];\r\n  scaleFactor: number;\r\n  perpLeft: Vec2;\r\n  perpRight: Vec2;\r\n  maxLeftScale: number;\r\n  maxRightScale: number;\r\n  heightProbeP: Point;\r\n} {\r\n  const normMidline = normalise(sub(l1, neckBaseMiddleP));\r\n  // TODO(jon): Discard boxes that are too long/wide ratio-wise.\r\n\r\n  const perpLeft = normalise(perp(normMidline));\r\n  const perpRight = normalise(perp(perp(perp(normMidline))));\r\n\r\n  // TODO(jon): From the middle of the lower part of the face, march across and try to find the coldest point close\r\n  //  to the center, this is probably the nose, and we can use it to help find the center line of the face.\r\n\r\n  const startY = body[0].y;\r\n  // Keep going until there are no spans to the left or right, so ray-march left and then right.\r\n  let scaleFactor = 0;\r\n  let heightProbeP = neckBaseMiddleP;\r\n  let maxLeftScale = 0;\r\n  let maxRightScale = 0;\r\n  const maxHeightScale = magnitude({ x: WIDTH, y: HEIGHT });\r\n  const leftSymmetry = [];\r\n  const rightSymmetry = [];\r\n\r\n  while (scaleFactor < maxHeightScale) {\r\n    const scaled = scale(normMidline, scaleFactor);\r\n    heightProbeP = add(neckBaseMiddleP, scaled);\r\n    let foundLeft = false;\r\n    let foundRight = false;\r\n\r\n    for (let incLeft = 1; incLeft < 50; incLeft++) {\r\n      const probeP = add(heightProbeP, scale(perpLeft, incLeft));\r\n      const xInBounds = probeP.x >= 0 && probeP.x < WIDTH;\r\n      const probeY = Math.round(probeP.y);\r\n      const shapeIndex = probeY - startY;\r\n      if (shapeIndex < 0 || shapeIndex > body.length - 1) {\r\n        break;\r\n      }\r\n\r\n      if (xInBounds && body[shapeIndex]) {\r\n        if (body[shapeIndex].x0 < probeP.x && body[shapeIndex].x1 > probeP.x) {\r\n          //\r\n          foundLeft = true;\r\n          maxLeftScale = Math.max(incLeft, maxLeftScale);\r\n        }\r\n        if (body[shapeIndex].x0 > probeP.x) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    for (let incRight = 1; incRight < 50; incRight++) {\r\n      const probeP = add(heightProbeP, scale(perpRight, incRight));\r\n      const xInBounds = probeP.x >= 0 && probeP.x < WIDTH;\r\n      const probeY = Math.round(probeP.y);\r\n      const shapeIndex = probeY - startY;\r\n\r\n      if (shapeIndex < 0 || shapeIndex > body.length - 1) {\r\n        break;\r\n      }\r\n      if (xInBounds && body[shapeIndex]) {\r\n        if (body[shapeIndex].x1 > probeP.x && body[shapeIndex].x0 < probeP.x) {\r\n          foundRight = true;\r\n          maxRightScale = Math.max(incRight, maxRightScale);\r\n        }\r\n        if (body[shapeIndex].x1 < probeP.x) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    leftSymmetry.push(maxLeftScale);\r\n    rightSymmetry.push(maxRightScale);\r\n    // symmetry.push([maxLeftScale, maxRightScale]);\r\n    if (!(foundLeft || foundRight)) {\r\n      break;\r\n    }\r\n    scaleFactor += 1;\r\n  }\r\n  return {\r\n    normMidline,\r\n    leftSymmetry,\r\n    rightSymmetry,\r\n    scaleFactor,\r\n    perpLeft,\r\n    perpRight,\r\n    maxLeftScale,\r\n    maxRightScale,\r\n    heightProbeP\r\n  };\r\n}\r\n","import { ROIFeature } from \"./worker-fns\";\r\n\r\nfunction accumulatePixel(\r\n  dest: Float32Array,\r\n  x: number,\r\n  y: number,\r\n  amount: number,\r\n  width: number,\r\n  height: number\r\n) {\r\n  x = ~~x;\r\n  y = ~~y;\r\n  if (x < 0 || y < 0) {\r\n    return;\r\n  }\r\n  if (x >= width || y >= height) {\r\n    return;\r\n  }\r\n  const index = y * width + x;\r\n  dest[index] += amount;\r\n}\r\n\r\nfunction addCircle(\r\n  dest: Float32Array,\r\n  cx: number,\r\n  cy: number,\r\n  radius: number,\r\n  amount: number,\r\n  width: number,\r\n  height: number\r\n) {\r\n  accumulatePixel(dest, cx + radius, cy, amount, width, height);\r\n  accumulatePixel(dest, cx - radius, cy, amount, width, height);\r\n  accumulatePixel(dest, cx, cy + radius, amount, width, height);\r\n  accumulatePixel(dest, cx, cy - radius, amount, width, height);\r\n  let d = 3 - 2 * radius;\r\n  let ix = 1;\r\n  let iy = radius;\r\n  while (ix < iy) {\r\n    //Bresenham\r\n    if (d < 0) {\r\n      d += 4 * ix + 6;\r\n    } else {\r\n      iy = iy - 1;\r\n      d += 4 * (ix - iy) + 10;\r\n    }\r\n    accumulatePixel(dest, cx + ix, cy + iy, amount, width, height);\r\n    accumulatePixel(dest, cx - ix, cy + iy, amount, width, height);\r\n    accumulatePixel(dest, cx + ix, cy - iy, amount, width, height);\r\n    accumulatePixel(dest, cx - ix, cy - iy, amount, width, height);\r\n    accumulatePixel(dest, cx + iy, cy + ix, amount, width, height);\r\n    accumulatePixel(dest, cx - iy, cy + ix, amount, width, height);\r\n    accumulatePixel(dest, cx + iy, cy - ix, amount, width, height);\r\n    accumulatePixel(dest, cx - iy, cy - ix, amount, width, height);\r\n    ix += 1;\r\n  }\r\n}\r\n\r\nexport function edgeDetect(\r\n  source: Float32Array,\r\n  frameWidth: number,\r\n  frameHeight: number\r\n) {\r\n  const width = frameWidth;\r\n  const height = frameHeight;\r\n  const dest = new Float32Array(width * height);\r\n  for (let y = 2; y < height - 2; y++) {\r\n    for (let x = 2; x < width - 2; x++) {\r\n      const index = y * width + x;\r\n      const value =\r\n        source[index] * 4 -\r\n        source[index - 1] -\r\n        source[index + 1] -\r\n        source[index + width] -\r\n        source[index - width];\r\n      dest[index] = Math.max(value - 40, 0);\r\n    }\r\n  }\r\n\r\n  return dest;\r\n}\r\n\r\nexport function circleDetectRadius(\r\n  source: Float32Array,\r\n  dest: Float32Array,\r\n  radius: number,\r\n  width: number,\r\n  height: number,\r\n  wx0: number,\r\n  wy0: number,\r\n  wx1: number,\r\n  wy1: number\r\n): [number, number, number] {\r\n  radius = Math.max(radius, 0.00001);\r\n  for (let i = 0; i < width * height; i++) {\r\n    dest[i] = 0;\r\n  }\r\n\r\n  wx0 = Math.max(wx0, 2);\r\n  wy0 = Math.max(wy0, 2);\r\n  wx1 = Math.min(wx1, width - 2);\r\n  wy1 = Math.min(wy1, height - 2);\r\n\r\n  for (let y = wy0; y < wy1; y++) {\r\n    for (let x = wx0; x < wx1; x++) {\r\n      const index = y * width + x;\r\n      const value = source[index];\r\n      if (value < 1) {\r\n        continue;\r\n      }\r\n      addCircle(dest, x, y, radius, 1, width, height);\r\n    }\r\n  }\r\n  let result = 0;\r\n  let rx = 0;\r\n  let ry = 0;\r\n  for (let y = wy0; y < wy1; y++) {\r\n    for (let x = wx0; x < wx1; x++) {\r\n      const index = y * width + x;\r\n      if (result < dest[index]) {\r\n        result = dest[index];\r\n        rx = x;\r\n        ry = y;\r\n      }\r\n    }\r\n  }\r\n  return [result / (2 + radius), rx + 1, ry + 1];\r\n}\r\n\r\nexport function circleDetect(\r\n  source: Float32Array,\r\n  frameWidth: number,\r\n  frameHeight: number\r\n): [number, number, number] {\r\n  const dest = new Float32Array(frameWidth * frameHeight);\r\n  let radius = 3.0;\r\n  let bestRadius = -1;\r\n  let bestValue = 2;\r\n  let bestX = 0;\r\n  let bestY = 0;\r\n\r\n  // TODO(jon): We should be able to know what the max radius we're looking for is.\r\n  while (radius < 20) {\r\n    let value = 0;\r\n    let cx = 0;\r\n    let cy = 0;\r\n    [value, cx, cy] = circleDetectRadius(\r\n      source,\r\n      dest,\r\n      radius,\r\n      frameWidth,\r\n      frameHeight,\r\n      2,\r\n      2,\r\n      frameWidth - 2,\r\n      frameHeight - 2\r\n    );\r\n    if (bestValue < value) {\r\n      bestValue = value;\r\n      bestRadius = radius;\r\n      bestX = cx;\r\n      bestY = cy;\r\n    }\r\n    radius = ~~(radius * 1.03 + 1);\r\n  }\r\n  return [bestRadius, bestX, bestY];\r\n}\r\n\r\nfunction pointIsInCircle(\r\n  px: number,\r\n  py: number,\r\n  cx: number,\r\n  cy: number,\r\n  r: number\r\n): boolean {\r\n  const dx = Math.abs(px - cx);\r\n  const dy = Math.abs(py - cy);\r\n  return Math.sqrt(dx * dx + dy * dy) < r;\r\n}\r\n\r\nexport interface Point {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nexport interface ThermalRefValues {\r\n  coords: Point[];\r\n  mean: number;\r\n  median: number;\r\n  min: number;\r\n  max: number;\r\n  count: number;\r\n}\r\n\r\nexport function extractSensorValueForCircle(\r\n  r: ROIFeature,\r\n  source: Float32Array,\r\n  width: number\r\n): ThermalRefValues {\r\n  const x0 = Math.floor(r.x0);\r\n  const y0 = Math.floor(r.y0);\r\n  const x1 = Math.ceil(r.x1);\r\n  const y1 = Math.ceil(r.y1);\r\n  const values: number[] = [];\r\n  const centerX = r.x0 + (r.x1 - r.x0) / 2;\r\n  const centerY = r.y0 + (r.y1 - r.y0) / 2;\r\n  const radius = (x1 - x0) / 2;\r\n  const coords = [];\r\n  for (let y = y0; y < y1; y++) {\r\n    for (let x = x0; x < x1; x++) {\r\n      if (pointIsInCircle(x + 0.5, y + 0.5, centerX, centerY, radius)) {\r\n        const index = y * width + x;\r\n        coords.push({ x, y });\r\n        values.push(source[index]);\r\n      }\r\n    }\r\n  }\r\n  let sum = 0;\r\n  for (let i = 0; i < values.length; i++) {\r\n    sum += values[i];\r\n  }\r\n  values.sort();\r\n  return {\r\n    coords,\r\n    mean: sum / values.length,\r\n    median: values[Math.floor(values.length / 2)],\r\n    min: values[0],\r\n    max: values[values.length - 1],\r\n    count: values.length\r\n  };\r\n}\r\n","import { RawShape, ScreeningAcceptanceStates, ScreeningState } from \"@/types\";\nimport {\n  distance,\n  faceIntersectsThermalRef,\n  HEIGHT,\n  narrowestSlanted,\n  Point,\n  WIDTH,\n  add,\n  allNeighboursEqual,\n  boundsForConvexHull,\n  boundsForRawShape,\n  boundsForShape,\n  closestPoint,\n  convexHullForShape,\n  distanceSq2,\n  drawRawShapesIntoMask,\n  drawShapesIntoMask,\n  getRawShapes,\n  getSolidShapes,\n  isNotCeilingHeat,\n  joinShapes,\n  largestShape,\n  localDensity,\n  magnitude,\n  normalise,\n  perp,\n  pointIsLeftOfLine,\n  RawPoint,\n  rawShapeArea,\n  scale,\n  shapeArea,\n  shapesOverlap,\n  spanWidth,\n  sub,\n  widestSpan,\n  fastConvexHull\n} from \"@/geom\";\nimport { ROIFeature } from \"@/worker-fns\";\nimport { getHottestSpotInBounds, Shape } from \"@/shape-processing\";\n\nimport DBScan from \"./dbscan\";\nimport { raymarchFaceDims } from \"./face-detection\";\nimport { edgeDetect } from \"@/circle-detection\";\n\nexport interface FaceInfo {\n  halfwayRatio: number;\n  headLock: number;\n  forehead: {\n    bottom: Point;\n    bottomLeft: Point;\n    bottomRight: Point;\n    top: Point;\n    topLeft: Point;\n    topRight: Point;\n  };\n  vertical: {\n    bottom: Point;\n    top: Point;\n  };\n  horizontal: {\n    left: Point;\n    right: Point;\n    middle: Point;\n  };\n  head: {\n    topLeft: Point;\n    topRight: Point;\n    bottomLeft: Point;\n    bottomRight: Point;\n    leftNeckSpan: Point;\n    rightNeckSpan: Point;\n  };\n}\n\ninterface MotionStats {\n  motion: number;\n  thresholded: number;\n  motionPlusThreshold: number;\n  actionInBottomHalf: number;\n}\n\nfunction advanceScreeningState(\n  nextState: ScreeningState,\n  prevState: ScreeningState,\n  currentCount: number\n): { state: ScreeningState; count: number } {\n  // We can only move from certain states to certain other states.\n  if (prevState !== nextState) {\n    const allowedNextState = ScreeningAcceptanceStates[prevState];\n    if ((allowedNextState as ScreeningState[]).includes(nextState)) {\n      // console.log(\"Advanced to state\", nextState);\n      return {\n        state: nextState,\n        count: 1\n      };\n    }\n  }\n  return {\n    state: prevState,\n    count: currentCount + 1\n  };\n}\n\n// Face specific stuff\n\nexport function faceIsFrontOn(face: FaceInfo): boolean {\n  // Face should be full inside frame, or at least forehead should be.\n  // Face should be front-on symmetry wise\n  return face.headLock !== 0;\n}\n\nexport function faceArea(face: FaceInfo): number {\n  // TODO(jon): Could give actual pixel area of face too?\n  const width = distance(face.horizontal.left, face.horizontal.right);\n  const height = distance(face.vertical.top, face.vertical.bottom);\n  return width * height;\n}\n\nexport function faceHasMovedOrChangedInSize(\n  face: FaceInfo,\n  prevFace: FaceInfo | null\n): boolean {\n  if (!prevFace) {\n    return true;\n  }\n  if (!faceIsFrontOn(prevFace)) {\n    return true;\n  }\n  // Now check relative sizes of faces.\n  const prevArea = faceArea(prevFace);\n  const nextArea = faceArea(face);\n  const diffArea = Math.abs(nextArea - prevArea);\n  const changedArea = diffArea > 150;\n  if (changedArea) {\n    /// console.log('area changed too much');\n    return true;\n  }\n  const dTL = distance(face.head.topLeft, prevFace.head.topLeft);\n  const dTR = distance(face.head.topRight, prevFace.head.topRight);\n  const dBL = distance(face.head.bottomLeft, prevFace.head.bottomLeft);\n  const dBR = distance(face.head.bottomRight, prevFace.head.bottomRight);\n  const maxMovement = Math.max(dTL, dTR, dBL, dBR);\n  if (maxMovement > 10) {\n    /// console.log('moved too much', maxMovement);\n    return true;\n  }\n  return false;\n}\n\nfunction advanceState(\n  prevMotionStats: MotionStats,\n  motionStats: MotionStats,\n  face: FaceInfo | null,\n  body: Shape | null,\n  prevFace: FaceInfo | null,\n  screeningState: ScreeningState,\n  screeningStateCount: number,\n  threshold: number,\n  radialSmoothed: Float32Array,\n  thermalReference: ROIFeature | null\n): {\n  prevFace: FaceInfo | null;\n  state: ScreeningState;\n  count: number;\n  event: string;\n} {\n  let next;\n  let event = \"\";\n  //const prevAllMotion = prevMotionStats.motion + prevMotionStats.hotInnerEdge + prevMotionStats.hotInner + prevMotionStats.edge;\n  //const allMotion = motionStats.motion + motionStats.hotInnerEdge + motionStats.hotInner + motionStats.edge;\n  if (thermalReference === null) {\n    next = advanceScreeningState(\n      ScreeningState.MISSING_THERMAL_REF,\n      screeningState,\n      screeningStateCount\n    );\n  } else if (face !== null) {\n    if (screeningState === ScreeningState.MISSING_THERMAL_REF) {\n      if (faceArea(face) < 1500) {\n        next = advanceScreeningState(\n          ScreeningState.TOO_FAR,\n          screeningState,\n          screeningStateCount\n        );\n      } else {\n        next = advanceScreeningState(\n          ScreeningState.LARGE_BODY,\n          screeningState,\n          screeningStateCount\n        );\n      }\n    } else if (faceArea(face) < 1500) {\n      next = advanceScreeningState(\n        ScreeningState.TOO_FAR,\n        screeningState,\n        screeningStateCount\n      );\n    } else if (faceIntersectsThermalRef(face, thermalReference)) {\n      next = advanceScreeningState(\n        ScreeningState.LARGE_BODY,\n        screeningState,\n        screeningStateCount\n      );\n    } else if (face.headLock !== 0) {\n      const temperatureSamplePoint = getHottestSpotInBounds(\n        face,\n        threshold,\n        WIDTH,\n        HEIGHT,\n        radialSmoothed\n      );\n      if (\n        faceIsFrontOn(face)\n        // &&\n        // samplePointIsInsideCroppingArea({\n        //     x: temperatureSamplePoint.x,\n        //     y: temperatureSamplePoint.y\n        // })\n      ) {\n        const faceMoved = faceHasMovedOrChangedInSize(face, prevFace);\n        if (faceMoved) {\n          screeningStateCount--;\n        }\n        if (\n          screeningState === ScreeningState.FRONTAL_LOCK &&\n          !faceMoved &&\n          face.headLock === 1 &&\n          screeningStateCount > 2 // Needs to be on this state for at least two frames.\n        ) {\n          next = advanceScreeningState(\n            ScreeningState.STABLE_LOCK,\n            screeningState,\n            screeningStateCount\n          );\n          if (next.state !== screeningState) {\n            // Capture the screening event here\n            event = \"Captured\";\n          }\n        } else if (screeningState === ScreeningState.STABLE_LOCK) {\n          next = advanceScreeningState(\n            ScreeningState.LEAVING,\n            screeningState,\n            screeningStateCount\n          );\n        } else {\n          next = advanceScreeningState(\n            ScreeningState.FRONTAL_LOCK,\n            screeningState,\n            screeningStateCount\n          );\n        }\n      } else {\n        // NOTE: Could stay here a while if we're in an FFC event.\n        next = advanceScreeningState(\n          ScreeningState.FACE_LOCK,\n          screeningState,\n          screeningStateCount\n        );\n      }\n    } else {\n      next = advanceScreeningState(\n        ScreeningState.HEAD_LOCK,\n        screeningState,\n        screeningStateCount\n      );\n    }\n    prevFace = face;\n  } else {\n    // TODO(jon): Ignore stats around FFC, just say that it's thinking...\n    const hasBody =\n      motionStats.actionInBottomHalf && motionStats.motionPlusThreshold > 45;\n    const prevFrameHasBody =\n      prevMotionStats.actionInBottomHalf &&\n      prevMotionStats.motionPlusThreshold > 45;\n    // TODO(jon): OR the threshold bounds are taller vertically than horizontally?\n    if (hasBody) {\n      next = advanceScreeningState(\n        ScreeningState.LARGE_BODY,\n        screeningState,\n        screeningStateCount\n      );\n    } else {\n      // Require 2 frames without a body before triggering leave event.\n      if (!prevFrameHasBody) {\n        if (screeningState === ScreeningState.LEAVING) {\n          // Record event now that we have lost the face?\n          event = \"Recorded\";\n        }\n        next = advanceScreeningState(\n          ScreeningState.READY,\n          screeningState,\n          screeningStateCount\n        );\n      } else {\n        next = advanceScreeningState(\n          ScreeningState.LARGE_BODY,\n          screeningState,\n          screeningStateCount\n        );\n      }\n    }\n    prevFace = null;\n  }\n  return {\n    prevFace,\n    state: next.state,\n    count: next.count,\n    event\n  };\n}\nexport const motionBit = 1 << 7;\nexport const thresholdBit = 1 << 6;\nexport const edgeBit = 1 << 5;\n\nfunction subtractFrame(\n  frame: Float32Array,\n  prevFrame: Float32Array | null,\n  motionBit: number\n): Uint8Array {\n  const THRESHOLD_DIFF = 20;\n  if (!prevFrame) {\n    return new Uint8Array(frame);\n  } else {\n    const subtracted = new Uint8Array(WIDTH * HEIGHT);\n    for (let i = 0; i < subtracted.length; i++) {\n      // Also compare with sobel edges?\n      // Then do a shrink-wrapped convex hull around the points we have.\n      if (Math.abs(frame[i] - prevFrame[i]) > THRESHOLD_DIFF) {\n        subtracted[i] |= motionBit;\n      }\n    }\n    return subtracted;\n  }\n}\n\nexport function detectBody(\n  thermalReference: ROIFeature | null,\n  medianSmoothed: Float32Array,\n  radialSmoothed: Float32Array,\n  prevRadialSmoothed: Float32Array | null,\n  min: number,\n  max: number,\n  threshold: number,\n  thermalRefC: number,\n  thermalRefRaw: number\n) {\n  // IDEA(jon): We can avoid smoothing altogether, and just smooth when we actually take a sample, when it's really cheap.\n  // TODO(jon): Just calculate the edges\n  const sobel = edgeDetect(medianSmoothed, WIDTH, HEIGHT);\n  let sMin = Number.MAX_SAFE_INTEGER;\n  let sMax = 0;\n  for (let i = 0; i < sobel.length; i++) {\n    sMin = Math.min(sMin, sobel[i]);\n    sMax = Math.max(sMax, sobel[i]);\n  }\n  const motionMask = subtractFrame(\n    radialSmoothed,\n    prevRadialSmoothed,\n    motionBit\n  );\n  // Adjust threshold down if higher than the max of 34degrees\n  let adjustedThreshold = threshold;\n  if (thermalReference) {\n    const thresholdTemp = thermalRefC + (threshold - thermalRefRaw) * 0.01;\n    if (thresholdTemp > 33) {\n      adjustedThreshold = thermalRefRaw - 500;\n    }\n  }\n  // Only apply the threshold bit where the thresholded row contains some motion, if the thresholded row spans the full frame width.\n  for (let y = 0; y < HEIGHT; y++) {\n    let thresholdSpansWholeRow = true;\n    let hasMotion = false;\n    for (let x = 0; x < WIDTH; x++) {\n      const i = y * WIDTH + x;\n      if (!hasMotion && motionMask[i] & motionBit) {\n        hasMotion = true;\n        if (!thresholdSpansWholeRow) {\n          break;\n        }\n      }\n      if (medianSmoothed[i] <= adjustedThreshold) {\n        thresholdSpansWholeRow = false;\n        if (hasMotion) {\n          break;\n        }\n      }\n    }\n    if ((thresholdSpansWholeRow && hasMotion) || !thresholdSpansWholeRow) {\n      for (let x = 0; x < WIDTH; x++) {\n        const i = y * WIDTH + x;\n        if (medianSmoothed[i] > adjustedThreshold) {\n          motionMask[i] |= thresholdBit;\n        }\n      }\n    }\n  }\n\n  const thermalRefWidth = 0;\n  /*\n  const thermalRefWidth = WIDTH - 95;\n  // Remove known thermal ref from mask (make this a factory calibration step)\n  for (let y = 99; y < HEIGHT; y++) {\n    for (let x = 91; x < WIDTH; x++) {\n      const i = y * 120 + x;\n      motionMask[i] = 0;\n    }\n  }\n  */\n\n  const motionShapes = getRawShapes(motionMask, WIDTH, HEIGHT, motionBit);\n  const thresholdShapes = getRawShapes(motionMask, WIDTH, HEIGHT, thresholdBit);\n\n  const filteredMotion = new Set();\n  const filteredThreshold = new Set();\n  for (const motionShape of motionShapes) {\n    for (const thresholdShape of thresholdShapes) {\n      if (shapesOverlap(motionShape, thresholdShape)) {\n        // Make sure the areas are not long thin horizontal boxes taking up the full frame width,\n        const motionShapeArea = rawShapeArea(motionShape);\n        const motionShapeBounds = boundsForRawShape(motionShape);\n        const motionBoundsFilled =\n          (motionShapeBounds.x1 - motionShapeBounds.x0) *\n          (motionShapeBounds.y1 + 1 - motionShapeBounds.y0);\n        if (\n          motionShapeArea / motionBoundsFilled > 0.98 &&\n          motionShapeBounds.x0 === 0 &&\n          motionShapeBounds.x1 === WIDTH\n        ) {\n          continue;\n        }\n        const thresholdShapeArea = rawShapeArea(thresholdShape);\n        const thresholdShapeBounds = boundsForRawShape(thresholdShape);\n        const thresholdBoundsFilled =\n          (thresholdShapeBounds.x1 - thresholdShapeBounds.x0) *\n          (thresholdShapeBounds.y1 + 1 - thresholdShapeBounds.y0);\n        if (\n          thresholdShapeArea / thresholdBoundsFilled > 0.98 &&\n          thresholdShapeBounds.x0 === 0 &&\n          thresholdShapeBounds.x1 === WIDTH\n        ) {\n          continue;\n        }\n        if (thresholdShapeArea > 300) {\n          // At least one of the shapes should pass a size threshold:\n          filteredMotion.add(motionShape);\n          filteredThreshold.add(thresholdShape);\n        }\n      }\n    }\n  }\n  // If there's no motion in the bottom half of the frame, but there is plenty of threshold, just add the threshold?\n  if (filteredMotion.size === 0 && filteredThreshold.size === 0) {\n    for (const thresholdShape of thresholdShapes) {\n      const thresholdShapeArea = rawShapeArea(thresholdShape);\n      const thresholdShapeBounds = boundsForRawShape(thresholdShape);\n      const thresholdBoundsFilled =\n        (thresholdShapeBounds.x1 - thresholdShapeBounds.x0) *\n        (thresholdShapeBounds.y1 + 1 - thresholdShapeBounds.y0);\n      if (\n        thresholdShapeArea / thresholdBoundsFilled > 0.98 &&\n        thresholdShapeBounds.x0 === 0 &&\n        thresholdShapeBounds.x1 === WIDTH\n      ) {\n        continue;\n      }\n      if (\n        thresholdShapeArea > 300 &&\n        !thresholdShape[0] &&\n        thresholdShapeBounds.x1 - thresholdShapeBounds.x0 <\n          WIDTH - thermalRefWidth\n      ) {\n        // At least one of the shapes should pass a size threshold:\n        filteredThreshold.add(thresholdShape);\n      }\n    }\n  }\n\n  // Draw the filtered mask back into a canvas?\n  const data = new Uint8Array(WIDTH * HEIGHT);\n  drawRawShapesIntoMask(\n    Array.from(filteredMotion) as RawShape[],\n    data,\n    motionBit\n  );\n  //drawRawShapesIntoMask(Array.from(filteredThreshold) as RawShape[], newMask, thresholdBit);\n  const solidThresholds = getSolidShapes(\n    Array.from(filteredThreshold) as RawShape[]\n  );\n  drawShapesIntoMask(solidThresholds, data, thresholdBit);\n  let mSum = 0;\n  let mPlusTSum = 0;\n  let tSum = 0;\n  let actionInBottomOfFrame = 0;\n\n  // Remove known thermal ref from mask (make this a factory calibration step)\n  for (let y = 99; y < HEIGHT; y++) {\n    for (let x = 91; x < WIDTH; x++) {\n      const i = y * WIDTH + x;\n      data[i] = 0;\n    }\n  }\n\n  for (let y = 0; y < HEIGHT; y++) {\n    for (let x = 0; x < WIDTH; x++) {\n      const i = y * WIDTH + x;\n      const v = data[i];\n\n      if (sobel[i] !== 0) {\n        data[i] |= edgeBit;\n      }\n\n      if (v & motionBit) {\n        mSum++;\n      }\n      if (v & thresholdBit) {\n        tSum++;\n      }\n      if (v & motionBit && v & thresholdBit) {\n        mPlusTSum++;\n      }\n      if (y > 80 && v !== 0) {\n        actionInBottomOfFrame++;\n      }\n    }\n  }\n  const hasBody = actionInBottomOfFrame && mPlusTSum > 45;\n  return {\n    hasBody,\n    data,\n    filteredMotion: Array.from(filteredMotion),\n    adjustedThreshold,\n    motionStats: {\n      motion: mSum,\n      thresholded: tSum,\n      motionPlusThreshold: mPlusTSum,\n      actionInBottomHalf: actionInBottomOfFrame\n    }\n  };\n}\n\nexport function mergeHeadParts(\n  shapes: Shape[]\n): { shapes: Shape[]; didMerge: boolean } {\n  const mergedShapes: Shape[] = [];\n  if (shapes.length) {\n    const largest = largestShape(shapes);\n    const hullA = convexHullForShape(largest);\n\n    // FIXME(jon): Seems like in a lot of cases the corners of the image are more correct?\n    //const boundsA = boundsForConvexHull(hullA);\n    // Would this be better as closest points to bounding box corners?\n    //const lTopLeft = closestPoint({x: boundsA.x0, y: boundsA.y0 }, hullA);\n    const lTopLeft = closestPoint({ x: 0, y: 0 }, hullA);\n    //const lTopRight = closestPoint({x: boundsA.x1, y: boundsA.y0 }, hullA);\n\n    const lTopRight = closestPoint({ x: WIDTH, y: 0 }, hullA);\n    // const lBottomLeft = closestPoint({x: boundsA.x0, y: boundsA.y1 }, hullA);\n    // const lBottomRight = closestPoint({x: boundsA.x1, y: boundsA.y1 }, hullA);\n    const lBottomLeft = closestPoint({ x: 0, y: HEIGHT }, hullA);\n    const lBottomRight = closestPoint({ x: WIDTH, y: HEIGHT }, hullA);\n    //const {left: lTopLeft, right: lTopRight} = topPoints(hullA);\n    //const {left: lBottomLeft, right: lBottomRight} = bottomPoints(hullA);\n    let merged = false;\n    for (const shape of shapes) {\n      const shapeA = shapeArea(shape);\n      if (shape !== largest && shapeA > 100) {\n        const hullB = convexHullForShape(shape);\n        const boundsB = boundsForConvexHull(hullB);\n        const d = 20 * shapeA;\n        const maxDX = 30; // * Math.floor(shapeA / 100);\n        {\n          // const {left: bottomLeft, right: bottomRight} = bottomPoints(hullB);\n          const bottomLeft = closestPoint(\n            { x: boundsB.x0, y: boundsB.y1 },\n            hullB\n          );\n          const bottomRight = closestPoint(\n            { x: boundsB.x1, y: boundsB.y1 },\n            hullB\n          );\n          if (\n            distance(lTopLeft, bottomLeft) < d &&\n            distance(lTopRight, bottomRight) < d &&\n            Math.abs(lTopLeft.x - bottomLeft.x) < maxDX &&\n            Math.abs(lTopRight.x - bottomRight.x) < maxDX\n          ) {\n            mergedShapes.push(\n              joinShapes(shape, largest, {\n                topLeft: bottomLeft,\n                topRight: bottomRight,\n                bottomLeft: lTopLeft,\n                bottomRight: lTopRight\n              })\n            );\n            merged = true;\n          }\n        }\n        {\n          //const {left: topLeft, right: topRight} = topPoints(hullB);\n          const topLeft = closestPoint({ x: boundsB.x0, y: boundsB.y0 }, hullB);\n          const topRight = closestPoint(\n            { x: boundsB.x1, y: boundsB.y0 },\n            hullB\n          );\n          if (\n            !merged &&\n            distance(topLeft, lBottomLeft) < d &&\n            distance(topRight, lBottomRight) < d &&\n            Math.abs(topLeft.x - lBottomLeft.x) < maxDX &&\n            Math.abs(topRight.x - lBottomRight.x) < maxDX\n          ) {\n            mergedShapes.push(\n              joinShapes(largest, shape, {\n                topLeft,\n                topRight,\n                bottomRight: lBottomRight,\n                bottomLeft: lBottomLeft\n              })\n            );\n            merged = true;\n          }\n        }\n      }\n    }\n    return merged\n      ? { shapes: mergedShapes, didMerge: true }\n      : { shapes: [largest], didMerge: false };\n  }\n  return { shapes: mergedShapes, didMerge: false };\n}\n\nexport function preprocessShapes(\n  frameShapes: RawShape[],\n  thermalReference: ROIFeature | null\n): { shapes: Shape[]; didMerge: boolean } {\n  let shapes = getSolidShapes(frameShapes);\n  // Find the largest shape, and then see if there are any other reasonable sized shapes directly\n  // above or below that shape.  If there are, they may be the other half of a head cut in half by glasses,\n  // and should be merged.\n  if (thermalReference) {\n    shapes = shapes.filter(shape => {\n      const shapeBounds = boundsForShape(shape);\n      const area = shapeArea(shape);\n      const boundsFilled =\n        (shapeBounds.x1 + 1 - shapeBounds.x0) *\n        (shapeBounds.y1 + 1 - shapeBounds.y0);\n      const ratioFilled = area / boundsFilled;\n\n      // TODO(jon): Can also check to see if the top of a shape is flat, or if the side is flat too etc.\n      // if (ratioFilled > 0.9) {\n      //     return false;\n      // }\n\n      const maxVariance = 5;\n      return !(\n        distance(\n          { x: shapeBounds.x0, y: shapeBounds.y0 },\n          { x: thermalReference.x0, y: thermalReference.y0 }\n        ) < maxVariance &&\n        distance(\n          { x: shapeBounds.x1, y: shapeBounds.y0 },\n          { x: thermalReference.x1, y: thermalReference.y0 }\n        ) < maxVariance &&\n        distance(\n          { x: shapeBounds.x0, y: shapeBounds.y1 },\n          { x: thermalReference.x0, y: thermalReference.y1 }\n        ) < maxVariance &&\n        distance(\n          { x: shapeBounds.x1, y: shapeBounds.y1 },\n          { x: thermalReference.x1, y: thermalReference.y1 }\n        ) < maxVariance\n      );\n    });\n  }\n  shapes = shapes.filter(isNotCeilingHeat);\n\n  // TODO(jon): Exclude the thermal reference first.\n  const { shapes: mergedShapes, didMerge } = mergeHeadParts(shapes);\n  return {\n    shapes: mergedShapes\n      // .filter(shape => {\n      //     const area = shapeArea(shape);\n      //     const noLargeShapes =\n      //         shapes.filter(x => shapeArea(x) > 300).length === 0;\n      //     const isLargest = shape == largestShape(mergedShapes);\n      //     return (\n      //         area > 600 ||\n      //         (noLargeShapes &&\n      //             isLargest &&\n      //             shapeIsOnSide(shape) &&\n      //             shapeIsNotCircular(shape))\n      //     );\n      // })\n      //.filter(isNotCeilingHeat)\n      // .map(markWidest)\n      // .map(markNarrowest)\n      .filter(mergedShapes => mergedShapes.length),\n    didMerge\n  };\n}\n\nconst rotate90u8 = (\n  src: Uint8Array,\n  dest: Uint8Array,\n  width: number,\n  height: number\n): Uint8Array => {\n  let i = 0;\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      dest[x * height + y] = src[i];\n      i++;\n    }\n  }\n  return dest;\n};\n\nexport function guessApproximateHeadWidth(shapes: Shape[]): number {\n  // Thresholded\n  const thMask = new Uint8Array(120 * 160);\n  const thMaskRot = new Uint8Array(120 * 160);\n  const nn = new Uint8Array(120 * 160);\n  drawShapesIntoMask(shapes, thMask, thresholdBit);\n  rotate90u8(thMask, thMaskRot, 120, 160);\n  const rotatedRaw = getRawShapes(thMaskRot, 160, 120, thresholdBit);\n  const solidRotated = getSolidShapes(rotatedRaw);\n  drawShapesIntoMask(solidRotated, thMask, 1 << 4, 160);\n  rotate90u8(thMask, nn, 160, 120);\n  const rotatedRaw2 = getSolidShapes(getRawShapes(nn, 120, 160, 1 << 4));\n\n  // Find the duplicates in y\n  const bod = largestShape(rotatedRaw2);\n  bod.sort((a, b) => spanWidth(a) - spanWidth(b));\n  const hist: Record<number, number> = {};\n  const maxWidth = spanWidth(widestSpan(bod));\n  for (const span of bod) {\n    const w = spanWidth(span);\n    if (w !== maxWidth) {\n      if (!hist[w]) {\n        hist[w] = 1;\n      } else {\n        hist[w]++;\n      }\n    }\n  }\n  for (const [key, val] of Object.entries(hist)) {\n    if (val < 10) {\n      delete hist[Number(key)];\n    }\n  }\n  // Try and find the smallest duplicate width with at least a count of 10\n  return Math.min(...Object.keys(hist).map(Number));\n}\n\nexport function refineHeadThresholdData(\n  data: Uint8Array,\n  neck: { left: Point; right: Point },\n  pointCloud: RawPoint[]\n) {\n  // scale out neck left and right 10px.\n  const neckVec = sub(neck.right, neck.left);\n  const p0 = sub(neck.left, scale(normalise(neckVec), 15));\n  const p1 = add(neck.right, scale(normalise(neckVec), 15));\n  const neckLeft = add(p0, scale(normalise(perp(neckVec)), 100));\n  const neckRight = add(p1, scale(normalise(perp(neckVec)), 100));\n\n  // Now halve point-cloud above neck, make convex hull of head:\n  const headPoints: RawPoint[] = [\n    [neck.left.x, neck.left.y],\n    [neck.right.x, neck.right.y]\n  ];\n  for (const p of pointCloud.map(([x, y]) => ({ x, y }))) {\n    if (pointIsLeftOfLine(neck.right, neck.left, p)) {\n      // Discard points too far to the left of neck.left, or too far to the right of neck.right\n      if (\n        pointIsLeftOfLine(p0, neckLeft, p) &&\n        pointIsLeftOfLine(neckRight, p1, p)\n      ) {\n        headPoints.push([p.x, p.y]);\n      }\n    }\n  }\n\n  const headHull: RawPoint[] = fastConvexHull(headPoints);\n  const canvas = document.createElement(\"canvas\");\n  canvas.width = WIDTH;\n  canvas.height = HEIGHT;\n  const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n  ctx.beginPath();\n  ctx.fillStyle = \"rgba(255, 0, 0, 0.1)\";\n  ctx.moveTo(headHull[0][0], headHull[0][1]);\n  for (const [x, y] of headHull.slice(1)) {\n    ctx.lineTo(x, y);\n  }\n  ctx.lineTo(headHull[0][0], headHull[0][1]);\n  ctx.fill();\n\n  const imData = ctx.getImageData(0, 0, WIDTH, HEIGHT);\n  const d = new Uint32Array(imData.data.buffer);\n  for (let i = 0; i < d.length; i++) {\n    if (!(d[i] & 0x000000ff)) {\n      data[i] &= ~thresholdBit;\n    }\n  }\n}\n\nexport function refineThresholdData(data: Uint8Array): RawPoint[] {\n  const points: RawPoint[] = [];\n  const edgePlusThreshold = 1 << 4;\n  const edgePlusMotion = 1 << 3;\n  const pointCloud: RawPoint[] = [];\n  let addedData = false;\n  for (let y = 0; y < 160; y++) {\n    let prev = 0;\n    for (let x = 0; x < 120; x++) {\n      const i = y * 120 + x;\n      const v = data[i];\n\n      // TODO(jon): Optimise\n      if (x > 0 && prev === 0 && v & thresholdBit) {\n        //\n      } else if (prev & thresholdBit && v === 0) {\n        //\n      } else if (\n        v & edgeBit &&\n        v & thresholdBit &&\n        !allNeighboursEqual(x, y, data, edgeBit)\n      ) {\n        data[i] |= edgePlusThreshold;\n        addedData = true;\n      } else if (\n        v & edgeBit &&\n        v & motionBit &&\n        !allNeighboursEqual(x, y, data, motionBit)\n      ) {\n        data[i] |= edgePlusMotion;\n        addedData = true;\n      }\n      prev = v;\n    }\n  }\n  for (let y = 0; y < HEIGHT; y++) {\n    for (let x = 0; x < WIDTH; x++) {\n      const i = y * WIDTH + x;\n      if (\n        data[i] & edgePlusThreshold &&\n        localDensity(x, y, data, edgePlusThreshold) >= 3\n      ) {\n        points.push([x, y]);\n      } else if (\n        data[i] === edgePlusMotion &&\n        localDensity(x, y, data, edgePlusMotion) >= 3\n      ) {\n        points.push([x, y]);\n      }\n    }\n  }\n  if (points.length > 10) {\n    const clusters = DBScan({\n      dataset: points,\n      epsilon: 5 * 5,\n      distanceFunction: distanceSq2,\n      minimumPoints: 3\n    } as any);\n\n    if (clusters.clusters.length) {\n      let i = 0;\n      for (const cluster of clusters.clusters) {\n        if (cluster.length < 15) {\n          let anyPointIsOnThresholdPlusMotion = false;\n          for (const pointIndex of cluster) {\n            const point = points[pointIndex];\n            const index = 120 * point[1] + point[0];\n            const v = data[index];\n            if (v & motionBit && v & thresholdBit) {\n              anyPointIsOnThresholdPlusMotion = true;\n              break;\n            }\n          }\n          for (const pointIndex of cluster) {\n            const point = points[pointIndex];\n            const index = 120 * point[1] + point[0];\n            if (anyPointIsOnThresholdPlusMotion) {\n              pointCloud.push(point);\n            }\n          }\n        } else {\n          for (const pointIndex of cluster) {\n            const point = points[pointIndex];\n            pointCloud.push(point);\n          }\n        }\n        i++;\n      }\n    }\n    if (pointCloud.length > 15) {\n      let hull = fastConvexHull(pointCloud);\n      // Take the leftmost and right most points, and extend to the bottom:\n      let minX = Number.MAX_SAFE_INTEGER;\n      let maxX = 0;\n      let leftIndex = 0;\n      let rightIndex = 0;\n      for (let i = 0; i < hull.length; i++) {\n        const p = hull[i];\n        if (p[0] < minX) {\n          minX = p[0];\n          leftIndex = i;\n        }\n        if (p[0] > maxX) {\n          maxX = p[0];\n          rightIndex = i;\n        }\n      }\n      hull.splice(1, rightIndex - 1);\n      hull.splice(1, 0, [hull[0][0], 159], [hull[1][0], 159]);\n\n      const first = hull.findIndex(([x, y]: RawPoint) => y === 159);\n      hull = [...hull.slice(first + 1), ...hull.slice(0, first + 1)].reverse();\n\n      // Draw the hull to a canvas\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = WIDTH;\n      canvas.height = HEIGHT;\n      const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n      ctx.beginPath();\n      //ctx.strokeStyle = 'blue';\n      ctx.fillStyle = \"rgba(0, 255, 0, 0.1)\";\n      ctx.moveTo(hull[0][0], hull[0][1]);\n      for (const [x, y] of hull.slice(1)) {\n        ctx.lineTo(x, y);\n      }\n      ctx.lineTo(hull[0][0], hull[0][1]);\n      ctx.fill();\n      //ctx.stroke();\n      // Draw the convex hull, then take a mask from it:\n\n      const imData = ctx.getImageData(0, 0, 120, 160);\n      const d = new Uint32Array(imData.data.buffer);\n      for (let i = 0; i < d.length; i++) {\n        if (!(d[i] & 0x0000ff00)) {\n          // TODO(jon): Make sure the pixel is not inside the thermal ref box\n          data[i] &= ~thresholdBit;\n        }\n      }\n    }\n  }\n  return pointCloud;\n}\n\nexport function extractFaceInfo(\n  neck: { left: Point; right: Point },\n  body: Shape,\n  radialSmoothed: Float32Array,\n  maybeHasGlasses: boolean\n): FaceInfo | null {\n  const { left, right } = neck;\n  const startY = body[0].y;\n  const start = left;\n  const vec = sub(right, left);\n  const halfway = scale(vec, 0.5);\n  const perpV = scale(perp(vec), 3);\n  const neckBaseMiddleP = add(start, halfway);\n  let l1 = add(neckBaseMiddleP, perpV);\n  const halfwayRatio = 1;\n  // NOTE(jon): March down this line with a perp vector, and stop when we don't hit any pixels on either side.\n  //  Then go halfway-down the line created by this joining line, and march out to either side to get the width\n  //  of the middle of the face.  Now we should be able to get the forehead box, which we'll only use if\n  //  we think the face is front-on.\n  let perpLeft,\n    perpRight,\n    normMidline,\n    scaleFactor,\n    maxLeftScale,\n    maxRightScale,\n    leftSymmetry,\n    rightSymmetry,\n    heightProbeP;\n  {\n    const dims = raymarchFaceDims(l1, neckBaseMiddleP, body);\n    perpLeft = dims.perpLeft;\n    perpRight = dims.perpRight;\n    normMidline = dims.normMidline;\n    scaleFactor = dims.scaleFactor;\n    maxLeftScale = dims.maxLeftScale;\n    maxRightScale = dims.maxRightScale;\n    leftSymmetry = dims.leftSymmetry;\n    rightSymmetry = dims.rightSymmetry;\n    heightProbeP = dims.heightProbeP;\n\n    // if (false && !maybeHasGlasses) {\n    //   // Let's try and adjust the midline based on colder noses.\n    //   const noseP = add(neckBaseMiddleP, scale(normMidline, scaleFactor * 0.4));\n    //   const noseLeftP = add(noseP, scale(perpLeft, maxLeftScale));\n    //   const noseRightP = add(noseP, scale(perpRight, maxRightScale));\n    //   let foundLeft = false;\n    //   let coldest = Number.MAX_SAFE_INTEGER;\n    //   let coldestP = { x: 0, y: 0 };\n    //   let coldestI = 0;\n    //   const faceWidth = Math.ceil(distance(noseLeftP, noseRightP));\n    //   for (\n    //     let i = Math.floor(faceWidth * 0.1);\n    //     i < Math.ceil(faceWidth * 0.9);\n    //     i++\n    //   ) {\n    //     const probeP = add(noseLeftP, scale(perpRight, i));\n    //     const xInBounds = probeP.x >= 0 && probeP.x < WIDTH;\n    //     const probeY = Math.round(probeP.y);\n    //     const shapeIndex = probeY - startY;\n    //     if (shapeIndex < 0 || shapeIndex > body.length - 1) {\n    //       break;\n    //     }\n    //     if (xInBounds && body[shapeIndex]) {\n    //       if (\n    //         body[shapeIndex].x1 > probeP.x &&\n    //         body[shapeIndex].x0 < probeP.x\n    //       ) {\n    //         foundLeft = true;\n    //         // Sample the pixel.\n    //         const index = 120 * probeY + Math.round(probeP.x);\n    //         const val = radialSmoothed[index];\n    //         if (val < coldest) {\n    //           coldest = val;\n    //           coldestP = probeP;\n    //           coldestI = i;\n    //         }\n    //       }\n    //       if (body[shapeIndex].x1 < probeP.x) {\n    //         break;\n    //       }\n    //     }\n    //   }\n    //   //drawPoint(coldestP, canvas, \"pink\", 2);\n    //   let coldestHalfway = scale(vec, coldestI / faceWidth);\n    //   neckBaseMiddleP = add(start, coldestHalfway);\n    //   halfwayRatio = coldestI / faceWidth;\n    // }\n  }\n  if (!maybeHasGlasses) {\n    l1 = add(neckBaseMiddleP, perpV);\n    const dims = raymarchFaceDims(l1, neckBaseMiddleP, body);\n    perpLeft = dims.perpLeft;\n    perpRight = dims.perpRight;\n    normMidline = dims.normMidline;\n    scaleFactor = dims.scaleFactor;\n    maxLeftScale = dims.maxLeftScale;\n    maxRightScale = dims.maxRightScale;\n    leftSymmetry = dims.leftSymmetry;\n    rightSymmetry = dims.rightSymmetry;\n    heightProbeP = dims.heightProbeP;\n  }\n  // Adjust left and right symmetry, based on how much we're offset from the original neck base center point.\n  //drawPoint(neckBaseMiddleP, canvas, \"pink\", 4);\n\n  const ssym = [];\n  // Divide left and right symmetry by maxLeftScale, maxRightScale;\n  for (let i = 0; i < scaleFactor; i++) {\n    ssym.push(\n      Math.abs(\n        leftSymmetry[i] / maxLeftScale - rightSymmetry[i] / maxRightScale\n      )\n    );\n  }\n\n  // TODO(jon): Detect \"fringe\" cases where there's not enough forehead.\n  if (heightProbeP) {\n    const bottomLeftP = add(neckBaseMiddleP, scale(perpLeft, maxLeftScale));\n    const bottomRightP = add(neckBaseMiddleP, scale(perpRight, maxRightScale));\n    const topLeftP = add(heightProbeP, scale(perpLeft, maxLeftScale));\n    const topRightP = add(heightProbeP, scale(perpRight, maxRightScale));\n\n    const headWidth = magnitude(sub(bottomLeftP, bottomRightP));\n    const headHeight = magnitude(sub(topLeftP, bottomLeftP));\n    const widthHeightRatio = headWidth / headHeight;\n    const isValidHead = widthHeightRatio > 0.5;\n\n    // TODO(jon): remove too small head areas.\n    if (isValidHead) {\n      // We only care about symmetry of the below forehead portion of the face, since above the eyes\n      //  symmetry can be affected by hair parting to one side etc.\n      const symmetryScore = ssym\n        .slice(0, Math.floor(ssym.length / 2))\n        .reduce((a, x) => a + x, 0);\n      const areaLeft = leftSymmetry\n        .slice(0, Math.floor(leftSymmetry.length / 2))\n        .reduce((a, x) => a + x, 0);\n      const areaRight = rightSymmetry\n        .slice(0, Math.floor(rightSymmetry.length / 2))\n        .reduce((a, x) => a + x, 0);\n      // Use maxLeftScale and maxRightScale to get the face side edges.\n      //console.log('area left, right', areaLeft, areaRight);\n      //console.log('head width, height, ratio', headWidth, headHeight, headWidth / headHeight);\n      // console.log(\"symmetry score\", symmetryScore);\n      //console.log(ssym.slice(0, Math.floor(symmetry.length / 2)));\n      //console.log(symmetry.slice(0, Math.floor(symmetry.length / 2)));\n      const areaDiff = Math.abs(areaLeft - areaRight);\n      const isValidSymmetry = symmetryScore < 2; // && areaDiff < 50;\n\n      let headLock = 0;\n\n      if (Math.abs(bottomLeftP.y - bottomRightP.y) > 5) {\n        headLock = 0;\n      }\n\n      // TODO(jon): I think we can relax this quite a bit and still get good results.\n      else if (\n        symmetryScore < 1.2 ||\n        (symmetryScore < 3 && areaDiff < 60) ||\n        (halfwayRatio > 0.4 && halfwayRatio < 0.6)\n      ) {\n        headLock = 1.0;\n      } else if (areaDiff >= 60) {\n        headLock = 0.5;\n      } else {\n        headLock = 0.0;\n      }\n      // TODO(jon): Could also find center of mass in bottom part of the face, and compare with actual center.\n\n      // Draw midline, draw forehead, colour forehead pixels.\n      const midP = add(neckBaseMiddleP, scale(normMidline, scaleFactor * 0.5));\n      const midLeftP = add(midP, scale(perpLeft, maxLeftScale));\n      const midRightP = add(midP, scale(perpRight, maxRightScale));\n\n      const foreheadTopP = add(\n        neckBaseMiddleP,\n        scale(normMidline, scaleFactor * 0.8)\n      );\n      const foreheadBottomP = add(\n        neckBaseMiddleP,\n        scale(normMidline, scaleFactor * 0.65)\n      );\n      const foreheadAmount = 0.4;\n      const foreheadTopLeftP = add(\n        foreheadTopP,\n        scale(perpLeft, maxLeftScale * foreheadAmount)\n      );\n      const foreheadTopRightP = add(\n        foreheadTopP,\n        scale(perpRight, maxRightScale * foreheadAmount)\n      );\n      const foreheadBottomLeftP = add(\n        foreheadBottomP,\n        scale(perpLeft, maxLeftScale * foreheadAmount)\n      );\n      const foreheadBottomRightP = add(\n        foreheadBottomP,\n        scale(perpRight, maxRightScale * foreheadAmount)\n      );\n\n      // TODO(jon): Gather array of forehead pixels.\n\n      return Object.freeze({\n        halfwayRatio,\n        headLock,\n        forehead: {\n          top: foreheadTopP,\n          bottom: foreheadBottomP,\n          bottomLeft: foreheadBottomLeftP,\n          bottomRight: foreheadBottomRightP,\n          topLeft: foreheadTopLeftP,\n          topRight: foreheadTopRightP\n        },\n        vertical: {\n          bottom: neckBaseMiddleP,\n          top: heightProbeP\n        },\n        horizontal: {\n          left: midLeftP,\n          right: midRightP,\n          middle: midP\n        },\n        head: {\n          topLeft: topLeftP,\n          topRight: topRightP,\n          bottomLeft: bottomLeftP,\n          bottomRight: bottomRightP,\n          rightNeckSpan: { ...(right as Point) }, // Was rightNeckSpan, leftNeckSpan\n          leftNeckSpan: { ...(left as Point) }\n        }\n      });\n    }\n  }\n  return null;\n  // TODO(jon): Draw a line perpendicular to this line.\n  // Then we can find the top of the head, and then the widest part of the head.\n  // Then we can draw an oval.\n  // The angle of the neck also helps us know if the head is front-on.\n\n  // If the face is front-on, the width of the neck is roughly a third the width of shoulders, if visible.\n\n  // TODO(jon): Separate case for animated outlines where we paint in irregularities in the head.\n}\n\nexport function getNeck(body: Shape): { left: Point; right: Point } | null {\n  //, maxYForNeck: number\n  // Find the widest span from the last two thirds of the body.\n  const startSpan = body[Math.max(0, body.length - 14)];\n  const [left, right] = narrowestSlanted(body, startSpan);\n  return {\n    left: { x: left.x0, y: left.y },\n    right: { x: right.x1, y: right.y }\n  };\n}\n","import { RawShape } from \"@/types\";\r\nimport { ROIFeature } from \"@/worker-fns\";\r\nimport { FaceInfo, mergeHeadParts } from \"@/body-detection\";\r\n\r\ninterface Span {\r\n  x0: number;\r\n  x1: number;\r\n  y: number;\r\n  h: number; // bit marker\r\n}\r\nexport interface Rect {\r\n  x0: number;\r\n  x1: number;\r\n  y0: number;\r\n  y1: number;\r\n}\r\n\r\nexport interface Point {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nexport interface Vec2 {\r\n  x: number;\r\n  y: number;\r\n}\r\nconst WIDTH = 120;\r\nconst HEIGHT = 160;\r\nexport type Shape = Span[];\r\nexport type ImmutableShape = readonly Span[];\r\n\r\nconst pointIsLeftOfLine = (l0: Point, l1: Point, p: Point): boolean =>\r\n  // Use cross-product to determine which side of a line a point is on.\r\n  (l1.x - l0.x) * (p.y - l0.y) - (l1.y - l0.y) * (p.x - l0.x) > 0;\r\n\r\nfunction isNotCeilingHeat(shape: Shape): boolean {\r\n  return !(shape[0].y === 0 && shape.length < 80);\r\n}\r\n\r\nfunction magnitude(vec: Vec2): number {\r\n  return Math.sqrt(vec.x * vec.x + vec.y * vec.y);\r\n}\r\n\r\nfunction normalise(vec: Vec2): Vec2 {\r\n  const len = magnitude(vec);\r\n  return {\r\n    x: vec.x / len,\r\n    y: vec.y / len\r\n  };\r\n}\r\n\r\nfunction scale(vec: Vec2, scale: number): Vec2 {\r\n  return {\r\n    x: vec.x * scale,\r\n    y: vec.y * scale\r\n  };\r\n}\r\n\r\nfunction perp(vec: Vec2): Vec2 {\r\n  // noinspection JSSuspiciousNameCombination\r\n  return {\r\n    x: vec.y,\r\n    y: -vec.x\r\n  };\r\n}\r\n\r\nfunction add(a: Vec2, b: Vec2): Vec2 {\r\n  return {\r\n    x: a.x + b.x,\r\n    y: a.y + b.y\r\n  };\r\n}\r\n\r\nfunction sub(a: Vec2, b: Vec2): Vec2 {\r\n  return {\r\n    x: a.x - b.x,\r\n    y: a.y - b.y\r\n  };\r\n}\r\n\r\nfunction getSolidShapes(frameShapes: Array<Record<number, Shape>>): Shape[] {\r\n  const solidShapes = [];\r\n  // Infills vertical cracks.\r\n  for (const shape of frameShapes) {\r\n    const solidShape: Shape = [];\r\n    for (const [row, spans] of Object.entries(shape)) {\r\n      const minX0 = spans.reduce(\r\n        (acc, span) => Math.min(acc, span.x0),\r\n        Number.MAX_SAFE_INTEGER\r\n      );\r\n      const maxX1 = spans.reduce((acc, span) => Math.max(acc, span.x1), 0);\r\n      solidShape.push({\r\n        x0: minX0,\r\n        x1: maxX1,\r\n        y: Number(row),\r\n        h: 0\r\n      });\r\n    }\r\n    solidShape.sort((a, b) => a.y - b.y);\r\n    solidShapes.push(solidShape);\r\n  }\r\n  return solidShapes;\r\n}\r\n\r\nconst spanWidth = (span: Span): number => span.x1 - span.x0;\r\n\r\nfunction shapeArea(shape: Shape): number {\r\n  return shape.reduce((acc, span) => acc + spanWidth(span), 0);\r\n}\r\n\r\nfunction largestShape(shapes: Shape[]): Shape {\r\n  return shapes.reduce((prevBestShape: Shape, shape: Shape) => {\r\n    const best = shapeArea(prevBestShape);\r\n    const area = shapeArea(shape);\r\n    return area > best ? shape : prevBestShape;\r\n  }, []);\r\n}\r\n\r\nfunction boundsForShape(shape: Shape): Rect {\r\n  const y0 = shape[0].y;\r\n  const y1 = shape[shape.length - 1].y;\r\n  const x0 = Math.min(...shape.map(({ x0 }) => x0));\r\n  const x1 = Math.max(...shape.map(({ x1 }) => x1));\r\n  return { x0, x1, y0, y1 };\r\n}\r\n\r\nconst startP = ({ x0, y }: Span): Point => ({ x: x0, y });\r\nconst endP = ({ x1, y }: Span): Point => ({ x: x1, y });\r\nconst distance = (a: Point, b: Point): number => {\r\n  const dX = a.x - b.x;\r\n  const dY = a.y - b.y;\r\n  return Math.sqrt(dX * dX + dY * dY);\r\n};\r\n\r\nfunction widestSpan(shape: Span[]): Span {\r\n  let maxWidthSpan = shape[0];\r\n  for (const span of shape) {\r\n    if (spanWidth(span) > spanWidth(maxWidthSpan)) {\r\n      maxWidthSpan = span;\r\n    }\r\n  }\r\n  return maxWidthSpan;\r\n}\r\n\r\nfunction narrowestSpan(shape: Shape): Span {\r\n  let minWidthSpan;\r\n  minWidthSpan = shape.find(x => x.x0 !== 0 && x.x1 !== WIDTH - 1);\r\n  if (!minWidthSpan) {\r\n    minWidthSpan = shape[0];\r\n  }\r\n  // TODO(jon): Ideally the narrowest span doesn't hit the frame edges.\r\n  for (const span of shape) {\r\n    if (spanWidth(span) <= spanWidth(minWidthSpan)) {\r\n      if (span.x0 !== 0 && span.x1 !== WIDTH - 1) {\r\n        minWidthSpan = span;\r\n      }\r\n    }\r\n  }\r\n  return minWidthSpan;\r\n}\r\n\r\nfunction narrowestSlanted(shape: Shape, start: Span): [Span, Span] {\r\n  const nIndex = shape.indexOf(start);\r\n  // From the narrowest, wiggle about on each side to try to find a shorter distance between spans.\r\n  const startIndex = Math.max(0, nIndex - 10);\r\n  const endIndex = Math.min(shape.length - 1, nIndex + 10);\r\n  const distances = [];\r\n  for (let i = startIndex; i < endIndex; i++) {\r\n    for (let j = startIndex; j < endIndex; j++) {\r\n      if (i !== j) {\r\n        const d = distance(startP(shape[i]), endP(shape[j]));\r\n        distances.push({\r\n          d,\r\n          skew: Math.abs(shape[i].y - shape[j].y),\r\n          left: shape[i],\r\n          right: shape[j]\r\n        });\r\n      }\r\n    }\r\n  }\r\n  // If there are a bunch that are similar, prefer the least slanted one.\r\n  distances.sort((a, b) => {\r\n    // NOTE(defer spans where x0 or x1 is on the edge of the frame.\r\n    if (a.left.x0 === 0 || a.right.x1 === WIDTH - 1) {\r\n      return 1;\r\n    } else if (b.left.x0 === 0 || b.right.x1 === WIDTH - 1) {\r\n      return -1;\r\n    }\r\n\r\n    if (a.d < b.d) {\r\n      return -1;\r\n    } else if (a.d > b.d) {\r\n      return 1;\r\n    } else {\r\n      // Give greatest skew first, then prefer highest y sum?\r\n      if (a.skew < b.skew) {\r\n        return -1;\r\n      } else if (a.skew > a.skew) {\r\n        return 1;\r\n      } else {\r\n        return b.right.y + b.left.y - (a.right.y + a.left.y);\r\n      }\r\n    }\r\n  });\r\n  const { left, right } = distances[0];\r\n  return [left, right];\r\n}\r\n\r\nfunction narrowestSpans(shape: Shape): [Span, Span] {\r\n  const narrowest = narrowestSpan(shape.slice(10));\r\n  return narrowestSlanted(shape, narrowest);\r\n}\r\n\r\nexport function drawShapes(shapes: Shape[], canvas: HTMLCanvasElement): any {\r\n  const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n  const width = canvas.width;\r\n  const height = canvas.height;\r\n  ctx.clearRect(0, 0, width, height);\r\n  const img = ctx.getImageData(0, 0, width, height);\r\n  const data = new Uint32Array(img.data.buffer);\r\n  const colours = [\r\n    0x33ffff00,\r\n    0x33ff00ff,\r\n    0x3300ffff,\r\n    0x33ffff00,\r\n    0x3300ffff,\r\n    0x33ff00ff,\r\n    0xffff66ff,\r\n    0xff6633ff,\r\n    0xff0000ff\r\n  ];\r\n  const faceInfo = {};\r\n  const shape = largestShape(shapes);\r\n  {\r\n    const widest = widestSpan(shape.slice(Math.round((shape.length / 3) * 2)));\r\n    const widestIndex = shape.indexOf(widest);\r\n    const widestWidth = spanWidth(widest);\r\n    let halfWidth;\r\n    // Work from bottom and find first span that is past widest point, and is around 1/2 of the width.\r\n    for (let i = widestIndex; i > 10; i--) {\r\n      const span = shape[i];\r\n      if (widestWidth / 2 > spanWidth(span)) {\r\n        halfWidth = span;\r\n        break;\r\n      }\r\n    }\r\n    let left, right;\r\n    if (halfWidth) {\r\n      [left, right] = narrowestSlanted(shape.slice(10), halfWidth);\r\n    } else {\r\n      [left, right] = narrowestSpans(shape.slice(10));\r\n    }\r\n\r\n    const vec = { x: right.x1 - left.x0, y: right.y - left.y };\r\n    const start = { x: left.x0, y: left.y };\r\n    const halfway = scale(vec, 0.5);\r\n    const perpV = scale(perp(vec), 3);\r\n    const neckBaseMiddleP = add(start, halfway);\r\n    const l1 = add(neckBaseMiddleP, perpV);\r\n\r\n    {\r\n      // TODO(jon): Categorise the head pixels as on the left or right side of the \"center line\"\r\n      //  Sum up the pixels on each side, but also look for symmetry in terms of how far each edge is\r\n      //  from the center line.  Ignore the portion above the eyes for this.  The eyes can be inferred\r\n      //  as being half-way up the face.  We can do some more thresholding on the actual pixels there\r\n      //  to try and identify eyes/glasses.\r\n      const colour = colours[0 % colours.length];\r\n      for (const span of shape) {\r\n        let i = span.x0;\r\n        if (span.x0 >= span.x1) {\r\n          console.warn(\"Weird spans\", span.x0, span.x1);\r\n          continue;\r\n        }\r\n        do {\r\n          const p = { x: i, y: span.y };\r\n          if (\r\n            !pointIsLeftOfLine(\r\n              { x: left.x0, y: left.y },\r\n              { x: right.x1, y: right.y },\r\n              p\r\n            )\r\n          ) {\r\n            if (pointIsLeftOfLine(neckBaseMiddleP, l1, p)) {\r\n              //data[span.y * width + i] = 0xffff0000;\r\n            } else {\r\n              //data[span.y * width + i] = 0xffff00ff;\r\n            }\r\n            data[span.y * width + i] = 0x66666666;\r\n          } else if (span.h === 0) {\r\n            data[span.y * width + i] = colour;\r\n          } else if (span.h === 3) {\r\n            data[span.y * width + i] =\r\n              (255 << 24) | (200 << 16) | (200 << 8) | 0;\r\n          } else if (span.h === 4) {\r\n            data[span.y * width + i] =\r\n              (255 << 24) | (200 << 16) | (200 << 8) | 255;\r\n          } else if (span.h === 8) {\r\n            data[span.y * width + i] =\r\n              (255 << 24) | (100 << 16) | (100 << 8) | 255;\r\n          } else if (span.h === 1) {\r\n            data[span.y * width + i] = (255 << 24) | (0 << 16) | (0 << 8) | 200;\r\n          } else if (span.h === 2) {\r\n            data[span.y * width + i] = (255 << 24) | (0 << 16) | (200 << 8) | 0;\r\n          }\r\n          i++;\r\n        } while (i < span.x1);\r\n      }\r\n      ctx.putImageData(img, 0, 0);\r\n    }\r\n\r\n    ctx.lineWidth = 1;\r\n    ctx.strokeStyle = \"red\";\r\n    ctx.beginPath();\r\n    ctx.moveTo(left.x0, left.y);\r\n    ctx.lineTo(right.x1, right.y);\r\n    ctx.stroke();\r\n\r\n    //ctx.moveTo(halfwayP.x - 2, halfwayP.y - 2);\r\n    // ctx.fillStyle = 'yellow';\r\n    // ctx.fillRect(l0.x - 1, l0.y - 1, 2, 2);\r\n\r\n    // TODO(jon): March down this line with a perp vector, and stop when we don't hit any pixels on either side.\r\n    //  Then go halfway-down the line created by this joining line, and march out to either side to get the width\r\n    //  of the middle of the face.  Now we should be able to get the forehead box, which we'll only use if\r\n    //  we think the face is front-on.\r\n    const normMidline = normalise(sub(l1, neckBaseMiddleP));\r\n    // TODO(jon): Discard boxes that are too long/wide ratio-wise.\r\n\r\n    const perpLeft = normalise(perp(normMidline));\r\n    const perpRight = normalise(perp(perp(perp(normMidline))));\r\n\r\n    const startY = shape[0].y;\r\n    // Keep going until there are no spans to the left or right, so ray-march left and then right.\r\n    let scaleFactor = 0;\r\n    let heightProbeP = neckBaseMiddleP;\r\n    ctx.fillStyle = \"rgba(255, 255, 255, 0.5)\";\r\n\r\n    let maxLeftScale = 0;\r\n    let maxRightScale = 0;\r\n    const maxHeightScale = magnitude({ x: WIDTH, y: HEIGHT });\r\n    const leftSymmetry = [];\r\n    const rightSymmetry = [];\r\n    const symmetry = [];\r\n\r\n    while (scaleFactor < maxHeightScale) {\r\n      const scaled = scale(normMidline, scaleFactor);\r\n      heightProbeP = add(neckBaseMiddleP, scaled);\r\n      let foundLeft = false;\r\n      let foundRight = false;\r\n\r\n      for (let incLeft = 1; incLeft < 50; incLeft++) {\r\n        const probeP = add(heightProbeP, scale(perpLeft, incLeft));\r\n        const xInBounds = probeP.x >= 0 && probeP.x < WIDTH;\r\n        const probeY = Math.round(probeP.y);\r\n        const shapeIndex = probeY - startY;\r\n        // ctx.fillRect(probeP.x - 0.5, probeP.y - 0.5, 1, 1);\r\n        if (shapeIndex < 0 || shapeIndex > shape.length - 1) {\r\n          break;\r\n        }\r\n\r\n        if (xInBounds && shape[shapeIndex]) {\r\n          if (\r\n            shape[shapeIndex].x0 < probeP.x &&\r\n            shape[shapeIndex].x1 > probeP.x\r\n          ) {\r\n            //\r\n            foundLeft = true;\r\n            maxLeftScale = Math.max(incLeft, maxLeftScale);\r\n          }\r\n          if (shape[shapeIndex].x0 > probeP.x) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      for (let incRight = 1; incRight < 50; incRight++) {\r\n        const probeP = add(heightProbeP, scale(perpRight, incRight));\r\n        const xInBounds = probeP.x >= 0 && probeP.x < WIDTH;\r\n        const probeY = Math.round(probeP.y);\r\n        const shapeIndex = probeY - startY;\r\n        // ctx.fillRect(probeP.x - 0.5, probeP.y - 0.5, 1, 1);\r\n\r\n        if (shapeIndex < 0 || shapeIndex > shape.length - 1) {\r\n          break;\r\n        }\r\n        if (xInBounds && shape[shapeIndex]) {\r\n          if (\r\n            shape[shapeIndex].x1 > probeP.x &&\r\n            shape[shapeIndex].x0 < probeP.x\r\n          ) {\r\n            //\r\n            foundRight = true;\r\n            maxRightScale = Math.max(incRight, maxRightScale);\r\n          }\r\n          if (shape[shapeIndex].x1 < probeP.x) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      leftSymmetry.push(maxLeftScale);\r\n      rightSymmetry.push(maxRightScale);\r\n      symmetry.push(Math.abs(maxLeftScale - maxRightScale));\r\n      if (!(foundLeft || foundRight)) {\r\n        break;\r\n      }\r\n      scaleFactor += 1;\r\n    }\r\n\r\n    const ssym = [];\r\n    // Divide left and right symmetry by maxLeftScale, maxRightScale;\r\n    for (let i = 0; i < scaleFactor; i++) {\r\n      ssym.push(\r\n        Math.abs(\r\n          leftSymmetry[i] / maxLeftScale - rightSymmetry[i] / maxRightScale\r\n        )\r\n      );\r\n    }\r\n\r\n    // TODO(jon): Detect \"fringe\" cases where there's not enough forehead.\r\n    if (heightProbeP) {\r\n      ctx.lineWidth = 1;\r\n      ctx.strokeStyle = \"orange\";\r\n      ctx.moveTo(neckBaseMiddleP.x, neckBaseMiddleP.y);\r\n      ctx.lineTo(heightProbeP.x, heightProbeP.y);\r\n      ctx.stroke();\r\n\r\n      const bottomLeftP = add(neckBaseMiddleP, scale(perpLeft, maxLeftScale));\r\n      const bottomRightP = add(\r\n        neckBaseMiddleP,\r\n        scale(perpRight, maxRightScale)\r\n      );\r\n      const topLeftP = add(heightProbeP, scale(perpLeft, maxLeftScale));\r\n      const topRightP = add(heightProbeP, scale(perpRight, maxRightScale));\r\n\r\n      const headWidth = magnitude(sub(bottomLeftP, bottomRightP));\r\n      const headHeight = magnitude(sub(topLeftP, bottomLeftP));\r\n      const widthHeightRatio = headWidth / headHeight;\r\n      const isValidHead = headHeight > headWidth && widthHeightRatio > 0.5;\r\n\r\n      // TODO(jon): remove too small head areas.\r\n\r\n      if (isValidHead) {\r\n        // We only care about symmetry of the below forehead portion of the face, since above the eyes\r\n        //  symmetry can be affected by hair parting to one side etc.\r\n        const symmetryScore = ssym\r\n          .slice(0, Math.floor(symmetry.length / 2))\r\n          .reduce((a, x) => a + x, 0);\r\n        const areaLeft = leftSymmetry\r\n          .slice(0, Math.floor(leftSymmetry.length / 2))\r\n          .reduce((a, x) => a + x, 0);\r\n        const areaRight = rightSymmetry\r\n          .slice(0, Math.floor(rightSymmetry.length / 2))\r\n          .reduce((a, x) => a + x, 0);\r\n        // Use maxLeftScale and maxRightScale to get the face side edges.\r\n        //console.log('area left, right', areaLeft, areaRight);\r\n        //console.log('head width, height, ratio', headWidth, headHeight, headWidth / headHeight);\r\n        console.log(\"symmetry score\", symmetryScore);\r\n        //console.log(ssym.slice(0, Math.floor(symmetry.length / 2)));\r\n        //console.log(symmetry.slice(0, Math.floor(symmetry.length / 2)));\r\n        const areaDiff = Math.abs(areaLeft - areaRight);\r\n\r\n        console.log(\"areaDiff\", areaDiff);\r\n\r\n        if (symmetryScore < 2 && areaDiff < 50) {\r\n          ctx.strokeStyle = \"red\";\r\n        } else if (areaDiff >= 50) {\r\n          ctx.strokeStyle = \"blue\";\r\n        } else {\r\n          ctx.strokeStyle = \"rgba(255, 255, 255, 0.6)\";\r\n        }\r\n\r\n        ctx.lineWidth = 1;\r\n        ctx.beginPath();\r\n        ctx.moveTo(topLeftP.x, topLeftP.y);\r\n        ctx.lineTo(topRightP.x, topRightP.y);\r\n        ctx.lineTo(bottomRightP.x, bottomRightP.y);\r\n        ctx.lineTo(bottomLeftP.x, bottomLeftP.y);\r\n        ctx.lineTo(topLeftP.x, topLeftP.y);\r\n        ctx.stroke();\r\n\r\n        // TODO(jon): Could also find center of mass in bottom part of the face, and compare with actual center.\r\n\r\n        // Draw midline, draw forehead, colour forehead pixels.\r\n        const midP = add(\r\n          neckBaseMiddleP,\r\n          scale(normMidline, scaleFactor * 0.5)\r\n        );\r\n        const midLeftP = add(midP, scale(perpLeft, maxLeftScale));\r\n        const midRightP = add(midP, scale(perpRight, maxRightScale));\r\n\r\n        ctx.moveTo(midLeftP.x, midLeftP.y);\r\n        ctx.lineTo(midRightP.x, midRightP.y);\r\n        ctx.stroke();\r\n\r\n        const foreheadTopP = add(\r\n          neckBaseMiddleP,\r\n          scale(normMidline, scaleFactor * 0.8)\r\n        );\r\n        const foreheadTopLeftP = add(\r\n          foreheadTopP,\r\n          scale(perpLeft, maxLeftScale)\r\n        );\r\n        const foreheadTopRightP = add(\r\n          foreheadTopP,\r\n          scale(perpRight, maxRightScale)\r\n        );\r\n\r\n        ctx.beginPath();\r\n        ctx.moveTo(foreheadTopLeftP.x, foreheadTopLeftP.y);\r\n        ctx.lineTo(foreheadTopRightP.x, foreheadTopRightP.y);\r\n        ctx.stroke();\r\n        ctx.beginPath();\r\n        ctx.arc(foreheadTopP.x, foreheadTopP.y, 5, 0, Math.PI * 2);\r\n        ctx.stroke();\r\n        ctx.beginPath();\r\n      }\r\n    }\r\n    // TODO(jon): Draw a line perpendicular to this line.\r\n    // Then we can find the top of the head, and then the widest part of the head.\r\n    // Then we can draw an oval.\r\n    // The angle of the neck also helps us know if the head is front-on.\r\n\r\n    // If the face is front-on, the width of the neck is roughly a third the width of shoulders, if visible.\r\n\r\n    // TODO(jon): Separate case for animated outlines where we paint in irregularities in the head.\r\n  }\r\n  return faceInfo;\r\n}\r\n\r\nexport function areEqual(a: Span, b: Span): boolean {\r\n  return a.x0 === b.x0 && a.x1 === b.x1 && a.y === b.y;\r\n}\r\n//\r\n// export function preprocessShapes(frameShapes: RawShape[]): Shape[] {\r\n//   const shapes = getSolidShapes(frameShapes);\r\n//   return (\r\n//     shapes\r\n//       .filter(shape => {\r\n//         const area = shapeArea(shape);\r\n//         const noLargeShapes =\r\n//           shapes.filter(x => shapeArea(x) > 300).length === 0;\r\n//         const isLargest = shape == largestShape(shapes);\r\n//         return (\r\n//           area > 600 ||\r\n//           (noLargeShapes &&\r\n//             isLargest &&\r\n//             shapeIsOnSide(shape) &&\r\n//             shapeIsNotCircular(shape))\r\n//         );\r\n//       })\r\n//       .filter(isNotCeilingHeat)\r\n//       .map(smoothKnobblyBits)\r\n//       .map(extendToBottom)\r\n//       //.map(markShoulders)\r\n//       .map(markWidest)\r\n//       .map(markNarrowest)\r\n//       .filter(shapes => shapes.length)\r\n//   );\r\n// }\r\n\r\nexport function preprocessShapes(\r\n  frameShapes: RawShape[],\r\n  thermalReference: ROIFeature | null\r\n): { shapes: Shape[]; didMerge: boolean } {\r\n  let shapes = getSolidShapes(frameShapes);\r\n  // Find the largest shape, and then see if there are any other reasonable sized shapes directly\r\n  // above or below that shape.  If there are, they may be the other half of a head cut in half by glasses,\r\n  // and should be merged.\r\n  if (thermalReference) {\r\n    shapes = shapes.filter(shape => {\r\n      const shapeBounds = boundsForShape(shape);\r\n      const area = shapeArea(shape);\r\n      const boundsFilled =\r\n        (shapeBounds.x1 + 1 - shapeBounds.x0) *\r\n        (shapeBounds.y1 + 1 - shapeBounds.y0);\r\n      const ratioFilled = area / boundsFilled;\r\n\r\n      // TODO(jon): Can also check to see if the top of a shape is flat, or if the side is flat too etc.\r\n      // if (ratioFilled > 0.9) {\r\n      //     return false;\r\n      // }\r\n\r\n      const maxVariance = 5;\r\n      return !(\r\n        distance(\r\n          { x: shapeBounds.x0, y: shapeBounds.y0 },\r\n          { x: thermalReference.x0, y: thermalReference.y0 }\r\n        ) < maxVariance &&\r\n        distance(\r\n          { x: shapeBounds.x1, y: shapeBounds.y0 },\r\n          { x: thermalReference.x1, y: thermalReference.y0 }\r\n        ) < maxVariance &&\r\n        distance(\r\n          { x: shapeBounds.x0, y: shapeBounds.y1 },\r\n          { x: thermalReference.x0, y: thermalReference.y1 }\r\n        ) < maxVariance &&\r\n        distance(\r\n          { x: shapeBounds.x1, y: shapeBounds.y1 },\r\n          { x: thermalReference.x1, y: thermalReference.y1 }\r\n        ) < maxVariance\r\n      );\r\n    });\r\n  }\r\n  shapes = shapes.filter(isNotCeilingHeat);\r\n\r\n  // TODO(jon): Exclude the thermal reference first.\r\n  const { shapes: mergedShapes, didMerge } = mergeHeadParts(shapes);\r\n  return {\r\n    shapes: mergedShapes\r\n      // .filter(shape => {\r\n      //     const area = shapeArea(shape);\r\n      //     const noLargeShapes =\r\n      //         shapes.filter(x => shapeArea(x) > 300).length === 0;\r\n      //     const isLargest = shape == largestShape(mergedShapes);\r\n      //     return (\r\n      //         area > 600 ||\r\n      //         (noLargeShapes &&\r\n      //             isLargest &&\r\n      //             shapeIsOnSide(shape) &&\r\n      //             shapeIsNotCircular(shape))\r\n      //     );\r\n      // })\r\n      //.filter(isNotCeilingHeat)\r\n      // .map(markWidest)\r\n      // .map(markNarrowest)\r\n      .filter(mergedShapes => mergedShapes.length),\r\n    didMerge\r\n  };\r\n}\r\n\r\nfunction spanOverlapsShape(span: Span, shape: RawShape): boolean {\r\n  if (shape[span.y - 1]) {\r\n    for (const upperSpan of shape[span.y - 1]) {\r\n      if (!(upperSpan.x1 < span.x0 || upperSpan.x0 >= span.x1)) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  if (shape[span.y + 1]) {\r\n    for (const lowerSpan of shape[span.y + 1]) {\r\n      if (!(lowerSpan.x1 < span.x0 || lowerSpan.x0 >= span.x1)) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  return false;\r\n}\r\nfunction mergeShapes(shape: RawShape, other: RawShape) {\r\n  const rows = [...Object.keys(shape), ...Object.keys(other)];\r\n  for (const row of rows) {\r\n    const rowN = Number(row);\r\n    if (shape[rowN] && other[rowN]) {\r\n      shape[rowN].push(...other[rowN]);\r\n    } else if (other[rowN]) {\r\n      shape[rowN] = other[rowN];\r\n    }\r\n  }\r\n}\r\n\r\nexport const LerpAmount = { amount: 0 };\r\n\r\nexport function faceHasMovedOrChangedInSize(\r\n  face: FaceInfo,\r\n  prevFace: FaceInfo | null\r\n): boolean {\r\n  // FIXME\r\n  if (prevFace === null) {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function faceIsFrontOn(face: FaceInfo): boolean {\r\n  return face.headLock > 0.4;\r\n}\r\n\r\nexport function getHottestSpotInBounds(\r\n  face: FaceInfo,\r\n  threshold: number,\r\n  width: number,\r\n  height: number,\r\n  imageData: Float32Array\r\n): { x: number; y: number; v: number } {\r\n  const forehead = face.forehead;\r\n  const x0 = Math.floor(Math.min(forehead.topLeft.x, forehead.bottomLeft.x));\r\n  const x1 = Math.ceil(Math.max(forehead.topRight.x, forehead.bottomRight.x));\r\n  const y0 = Math.floor(Math.min(forehead.topLeft.y, forehead.topRight.y));\r\n  const y1 = Math.ceil(Math.max(forehead.bottomLeft.y, forehead.bottomRight.y));\r\n\r\n  const idealCenter = add(\r\n    forehead.top,\r\n    scale(\r\n      normalise(sub(forehead.bottom, forehead.top)),\r\n      distance(forehead.bottom, forehead.top) * 0.5\r\n    )\r\n  );\r\n  let bestDistance = Number.MAX_SAFE_INTEGER;\r\n  let bestPoint = { x: 0, y: 0 };\r\n  let bestVal = 0;\r\n\r\n  // NOTE: Sometimes the point we want is covered by hair, and we don't want to sample that, so\r\n  //  take the closest point to that ideal point from the area that we know actually has passed our\r\n  //  threshold temperature test.\r\n  for (let y = y0; y < y1; y++) {\r\n    for (let x = x0; x < x1; x++) {\r\n      const p = { x, y };\r\n      if (\r\n        pointIsLeftOfLine(forehead.bottomLeft, forehead.topLeft, p) &&\r\n        pointIsLeftOfLine(forehead.topRight, forehead.bottomRight, p) &&\r\n        pointIsLeftOfLine(forehead.bottomRight, forehead.bottomLeft, p) &&\r\n        pointIsLeftOfLine(forehead.topLeft, forehead.topRight, p)\r\n      ) {\r\n        const index = y * width + x;\r\n        const temp = imageData[index];\r\n        if (temp > threshold) {\r\n          const d = distance(idealCenter, p);\r\n          if (d < bestDistance) {\r\n            bestDistance = d;\r\n            bestPoint = p;\r\n            bestVal = temp;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return { x: bestPoint.x, y: bestPoint.y, v: bestVal };\r\n}\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Emit, Prop, Vue, Watch } from \"vue-property-decorator\";\nimport { Face } from \"@/face\";\nimport VideoCropControls from \"@/components/VideoCropControls.vue\";\nimport { CropBox } from \"@/types\";\nimport { ROIFeature } from \"@/worker-fns\";\nimport { getHottestSpotInBounds } from \"@/shape-processing\";\nimport { mdiCrop } from \"@mdi/js\";\nimport { State } from \"@/main\";\nimport { ThermalRefValues } from \"@/circle-detection\";\nimport { FaceInfo } from \"@/body-detection\";\n\n@Component({ components: { VideoCropControls } })\nexport default class VideoStream extends Vue {\n  @Prop() public frame!: Float32Array;\n  @Prop() public thermalReference!: ROIFeature | null;\n  @Prop() public thermalReferenceStats!: ThermalRefValues | null;\n  @Prop() public faces!: Face[];\n  @Prop({ required: true }) public face!: FaceInfo | null;\n  @Prop({ required: true }) public cropBox!: CropBox;\n  @Prop({ required: true }) public cropEnabled!: boolean;\n  @Prop({ default: 1.0 }) public scale!: number;\n  @Prop({ default: false }) public drawOverlays!: boolean;\n  @Prop({ default: false }) public recording!: boolean;\n  private canEditCropping = false;\n\n  $refs!: {\n    cameraStream: HTMLCanvasElement;\n    vizOverlay: HTMLCanvasElement;\n    container: HTMLDivElement;\n  };\n\n  get cropIcon() {\n    return mdiCrop;\n  }\n\n  @Watch(\"frame\")\n  onFrameUpdate(next: Float32Array) {\n    // TODO(jon): Why does this sometimes get called when the smoothed image array is empty?\n    const canvas = this.$refs.cameraStream;\n    const context = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n    const imgData = context.getImageData(0, 0, canvas.width, canvas.height);\n    const frameData = next;\n    let max = 0;\n    let min = Number.MAX_SAFE_INTEGER;\n    for (let i = 0; i < frameData.length; i++) {\n      const f32Val = frameData[i];\n      if (f32Val < min) {\n        min = f32Val;\n      }\n      if (f32Val > max) {\n        max = f32Val;\n      }\n    }\n    if (min !== Number.MAX_SAFE_INTEGER) {\n      const data = new Uint32Array(imgData.data.buffer);\n      const range = max - min;\n      for (let i = 0; i < data.length; i++) {\n        const v = Math.max(\n          0,\n          Math.min(255, ((frameData[i] - min) / range) * 255.0)\n        );\n        data[i] = (255 << 24) | (v << 16) | (v << 8) | v;\n      }\n      context.putImageData(imgData, 0, 0);\n    }\n  }\n\n  mounted() {\n    const container = this.$refs.container;\n    container.style.width = `${375 * this.scale}px`;\n    container.style.height = `${500 * this.scale}px`;\n    if (this.frame) {\n      this.onFrameUpdate(this.frame);\n      this.updateOverlayCanvas();\n    }\n  }\n\n  updateOverlayCanvas() {\n    const underlay = this.$refs.cameraStream;\n    const canvas = this.$refs.vizOverlay;\n    const canvasWidth = canvas.width * window.devicePixelRatio;\n    const canvasHeight = canvas.height * window.devicePixelRatio;\n    const context = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n    context.clearRect(0, 0, canvasWidth, canvasHeight);\n    if (this.drawOverlays) {\n      context.save();\n\n      const scaleX = canvasWidth / (underlay.width * window.devicePixelRatio);\n      const scaleY = canvasHeight / (underlay.height * window.devicePixelRatio);\n      context.scale(scaleX, scaleY);\n      const face = this.face;\n      if (face) {\n        // Now find the hotspot - only if we have a good lock!\n        if (face.headLock === 1.0) {\n          const point = getHottestSpotInBounds(\n            face,\n            State.currentFrame!.threshold,\n            120,\n            160,\n            this.frame\n          );\n\n          context.beginPath();\n          context.strokeStyle = \"rgba(255, 0, 0, 0.7)\";\n          context.lineWidth = 1;\n          context.arc(point.x - 0.5, point.y - 0.5, 2, 0, Math.PI * 2);\n          context.stroke();\n        }\n\n        context.lineWidth = 0.25;\n        if (face.headLock === 1.0) {\n          context.strokeStyle = \"red\";\n          context.lineWidth = 0.5;\n        } else if (face.headLock === 0.5) {\n          context.strokeStyle = \"blue\";\n        } else {\n          context.strokeStyle = \"orange\";\n        }\n        context.beginPath();\n        context.moveTo(face.head.bottomLeft.x, face.head.bottomLeft.y);\n        context.lineTo(face.head.topLeft.x, face.head.topLeft.y);\n        context.lineTo(face.head.topRight.x, face.head.topRight.y);\n        context.lineTo(face.head.bottomRight.x, face.head.bottomRight.y);\n        context.lineTo(face.head.bottomLeft.x, face.head.bottomLeft.y);\n        context.moveTo(face.vertical.bottom.x, face.vertical.bottom.y);\n        context.lineTo(face.vertical.top.x, face.vertical.top.y);\n        context.moveTo(face.horizontal.left.x, face.horizontal.left.y);\n        context.lineTo(face.horizontal.right.x, face.horizontal.right.y);\n\n        // context.moveTo(face.forehead.bottomLeft.x, face.forehead.bottomLeft.y);\n        // context.lineTo(\n        //   face.forehead.bottomRight.x,\n        //   face.forehead.bottomRight.y\n        // );\n        // context.moveTo(face.forehead.topLeft.x, face.forehead.topLeft.y);\n        // context.lineTo(face.forehead.topRight.x, face.forehead.topRight.y);\n        context.stroke();\n      }\n      const thermalRef = this.thermalReference;\n      const drawThermalReference = true;\n      if (\n        thermalRef &&\n        drawThermalReference &&\n        this.thermalReferenceStats !== null\n      ) {\n        if (this.thermalReferenceStats.coords) {\n          context.save();\n          context.fillStyle = \"rgba(255, 0, 255, 0.5)\";\n          context.beginPath();\n          for (const { x, y } of this.thermalReferenceStats.coords) {\n            context.rect(x, y, 1, 1);\n          }\n          context.fill();\n          context.restore();\n        }\n\n        // const cx = (thermalRef.x0 + thermalRef.x1) * 0.5 * scaleX;\n        // const cy = ((thermalRef.y0 + thermalRef.y1) * 0.5 - paddingTop) * scaleY;\n        // console.log(cx, cy);\n        // const radius = thermalRef.width() * 0.5 * scaleX;\n        // context.beginPath();\n        // context.arc(cx, cy, radius, 0, 2 * Math.PI, false);\n        // context.lineWidth = 0.5;\n        // context.strokeStyle = \"rgba(100, 0, 200, 0.75)\";\n        // //context.fillStyle = \"rgba(255, 0, 0, 0.25)\";\n        // //context.fill();\n        // context.stroke();\n      }\n      context.restore();\n    }\n\n    context.save();\n    if (this.cropBox) {\n      // Update crop-box overlay:\n      const overlay = new Path2D();\n      const cropBox = this.cropBox;\n      context.scale(1, 1);\n      const width = canvas.width;\n      const height = canvas.height;\n      overlay.rect(0, 0, width, height);\n\n      const onePercentWidth = width / 100;\n      const onePercentHeight = height / 100;\n\n      const leftInset = onePercentWidth * cropBox.left;\n      const rightInset = onePercentWidth * cropBox.right;\n      const topInset = onePercentHeight * cropBox.top;\n      const bottomInset = onePercentHeight * cropBox.bottom;\n      overlay.rect(\n        leftInset,\n        topInset,\n        width - (rightInset + leftInset),\n        height - (bottomInset + topInset)\n      );\n      context.fillStyle = \"rgba(0, 0, 0, 0.5)\";\n      context.fill(overlay, \"evenodd\");\n    }\n    context.restore();\n  }\n\n  toggleCropping() {\n    this.canEditCropping = !this.canEditCropping;\n    if (!this.canEditCropping) {\n      this.saveCropChanges();\n    }\n  }\n\n  saveCropChanges() {\n    this.$parent.$emit(\"save-crop-changes\");\n  }\n\n  @Watch(\"face\")\n  onFaceChanged() {\n    this.updateOverlayCanvas();\n  }\n\n  @Watch(\"thermalReference\")\n  onThermalReferenceChanged() {\n    this.updateOverlayCanvas();\n  }\n\n  @Watch(\"cropBox\")\n  onCropChanged() {\n    this.updateOverlayCanvas();\n  }\n\n  @Emit(\"crop-changed\")\n  gotCropChange(cropBox: CropBox) {\n    this.updateOverlayCanvas();\n    return cropBox;\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoStream.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./VideoStream.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./VideoStream.vue?vue&type=template&id=3a43902b&scoped=true&\"\nimport script from \"./VideoStream.vue?vue&type=script&lang=ts&\"\nexport * from \"./VideoStream.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./VideoStream.vue?vue&type=style&index=0&id=3a43902b&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3a43902b\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\ninstallComponents(component, {VBtn,VIcon})\n","export const BlobReader = (function(): {\r\n  arrayBuffer: (blob: Blob) => Promise<ArrayBuffer>;\r\n} {\r\n  // For comparability with older browsers/iOS that don't yet support arrayBuffer()\r\n  // directly off the blob object\r\n  const arrayBuffer: (blob: Blob) => Promise<ArrayBuffer> =\r\n    \"arrayBuffer\" in Blob.prototype &&\r\n    typeof (Blob.prototype as Blob)[\"arrayBuffer\"] === \"function\"\r\n      ? (blob: Blob) => blob[\"arrayBuffer\"]()\r\n      : (blob: Blob) =>\r\n          new Promise((resolve, reject) => {\r\n            const fileReader = new FileReader();\r\n            fileReader.addEventListener(\"load\", () => {\r\n              resolve(fileReader.result as ArrayBuffer);\r\n            });\r\n            fileReader.addEventListener(\"error\", () => {\r\n              reject();\r\n            });\r\n            fileReader.readAsArrayBuffer(blob);\r\n          });\r\n\r\n  return {\r\n    arrayBuffer\r\n  };\r\n})();\r\n\r\nexport class DegreesCelsius {\r\n  public val: number;\r\n  constructor(val: number) {\r\n    this.val = val;\r\n  }\r\n  public toString(): string {\r\n    return `${this.val.toFixed(1)}`;\r\n  }\r\n}\r\n\r\nexport const getHistogram = (\r\n  data: Float32Array,\r\n  numBuckets: number\r\n): { histogram: Uint16Array; min: number; max: number } => {\r\n  // Find find the total range of the data\r\n  let max = 0;\r\n  let min = Number.MAX_SAFE_INTEGER;\r\n  for (let i = 0; i < data.length; i++) {\r\n    const f32Val = data[i];\r\n    if (f32Val < min) {\r\n      min = f32Val;\r\n    }\r\n    if (f32Val > max) {\r\n      max = f32Val;\r\n    }\r\n  }\r\n\r\n  // A histogram with 16 buckets seems sufficiently coarse for this\r\n  // The histogram is usually bi-modal, so we want to find the trough between the two peaks as our threshold value\r\n  const histogram = new Uint16Array(numBuckets);\r\n  for (let i = 0; i < data.length; i++) {\r\n    // If within a few degrees of constant heat-source white else black.\r\n    const v = ((data[i] - min) / (max - min)) * numBuckets;\r\n    histogram[Math.floor(v)] += 1;\r\n  }\r\n  return {\r\n    histogram,\r\n    min,\r\n    max\r\n  };\r\n};\r\n\r\nexport const getAdaptiveThreshold = (data: Float32Array): number => {\r\n  const { histogram, min, max } = getHistogram(data, 16);\r\n  let peak0Max = 0;\r\n  let peak1Max = 0;\r\n  let peak0Index = 0;\r\n  let peak1Index = 0;\r\n  // First, find the peak value, which is usually in the background temperature range.\r\n  for (let i = 0; i < histogram.length; i++) {\r\n    if (histogram[i] > peak0Max) {\r\n      peak0Max = histogram[i];\r\n      peak0Index = i;\r\n    }\r\n  }\r\n\r\n  // Need to look for a valley in between the two bimodal peaks, so\r\n  // keep descending from the first peak till we find a local minimum.\r\n  let prevIndex = peak0Index;\r\n  let index = peak0Index + 1;\r\n  while (histogram[index] < histogram[prevIndex]) {\r\n    prevIndex++;\r\n    index++;\r\n  }\r\n  // Now climb up from that valley to find the second peak.\r\n  for (let i = prevIndex; i < histogram.length; i++) {\r\n    if (histogram[i] > peak1Max) {\r\n      peak1Max = histogram[i];\r\n      peak1Index = i;\r\n    }\r\n  }\r\n\r\n  // Find the lowest point between the two peaks.\r\n  let valleyMin = peak1Max;\r\n  let valleyIndex = 0;\r\n  for (let i = peak0Index + 1; i < peak1Index; i++) {\r\n    if (histogram[i] < valleyMin) {\r\n      valleyMin = histogram[i];\r\n      valleyIndex = i;\r\n    }\r\n  }\r\n  const range = max - min;\r\n  return min + (range / histogram.length) * valleyIndex + 1;\r\n};\r\n\r\nexport const temperatureForSensorValue = (\r\n  savedThermalRefValue: number,\r\n  rawValue: number,\r\n  currentThermalRefValue: number\r\n): DegreesCelsius => {\r\n  return new DegreesCelsius(\r\n    savedThermalRefValue + (rawValue - currentThermalRefValue) * 0.01\r\n  );\r\n};\r\nexport const ZeroCelsiusInKelvin = 273.15;\r\nexport const mKToCelsius: (val: number) => DegreesCelsius = (mkVal: number) =>\r\n  new DegreesCelsius(mkVal * 0.01 - ZeroCelsiusInKelvin);\r\n\r\nexport function saveCurrentVersion(binaryVersion: string, appVersion: string) {\r\n  window.localStorage.setItem(\r\n    \"softwareVersion\",\r\n    JSON.stringify({\r\n      appVersion,\r\n      binaryVersion\r\n    })\r\n  );\r\n}\r\n\r\nexport function checkForSoftwareUpdates(\r\n  binaryVersion: string,\r\n  appVersion: string,\r\n  shouldReloadIfChanged = true\r\n): boolean {\r\n  const prevVersionJSON = window.localStorage.getItem(\"softwareVersion\");\r\n  if (prevVersionJSON) {\r\n    try {\r\n      const prevVersion = JSON.parse(prevVersionJSON);\r\n      if (\r\n        prevVersion.binaryVersion != binaryVersion ||\r\n        prevVersion.appVersion != appVersion\r\n      ) {\r\n        if (shouldReloadIfChanged) {\r\n          console.log(\r\n            \"reload because version changed\",\r\n            JSON.stringify(prevVersion),\r\n            binaryVersion,\r\n            appVersion\r\n          );\r\n          window.location.reload();\r\n        } else {\r\n          saveCurrentVersion(binaryVersion, appVersion);\r\n          // Display info that the software has updated since last started up.\r\n          return true;\r\n        }\r\n      }\r\n    } catch (e) {\r\n      saveCurrentVersion(binaryVersion, appVersion);\r\n      return false;\r\n    }\r\n  } else {\r\n    saveCurrentVersion(binaryVersion, appVersion);\r\n  }\r\n  return false;\r\n}\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport VideoStream from \"@/components/VideoStream.vue\";\r\nimport { Component, Prop, Vue } from \"vue-property-decorator\";\r\nimport { Frame } from \"@/camera\";\r\nimport { Face } from \"@/face\";\r\nimport { CropBox, ScreeningEvent, ScreeningState } from \"@/types\";\r\nimport { ROIFeature } from \"@/worker-fns\";\r\nimport { mdiMinus, mdiPencil, mdiPlus } from \"@mdi/js\";\r\nimport { DegreesCelsius } from \"@/utils\";\r\nimport { FaceInfo } from \"@/body-detection\";\r\n\r\n@Component({\r\n  components: {\r\n    VideoStream\r\n  }\r\n})\r\nexport default class AdminScreening extends Vue {\r\n  @Prop({ required: true }) public frame!: Frame;\r\n  @Prop({ required: true }) public thermalReference!: ROIFeature | null;\r\n  @Prop({ required: true }) public faceFeature!: FaceInfo | null;\r\n  @Prop({ required: true }) public faces!: Face[];\r\n  @Prop({ required: true }) public cropBox!: CropBox;\r\n  @Prop({ required: true }) public calibration!: DegreesCelsius;\r\n  @Prop({ required: true }) public screeningState!: ScreeningState;\r\n  @Prop({ required: true }) public latestScreeningEvent!: ScreeningEvent | null;\r\n\r\n  private useMirrorMode = true;\r\n  private useDebugDraw = false;\r\n  private useCustomTemperatureRange = false;\r\n  private temperatureThresholds = [32, 38];\r\n  private showCalibrationDialog = false;\r\n  private editedCalibration: DegreesCelsius = new DegreesCelsius(0);\r\n\r\n  getLabel(value: number) {\r\n    return value < this.temperatureThresholds[1] ? \"Low\" : \"High\";\r\n  }\r\n\r\n  get face(): Face {\r\n    return this.faces[0];\r\n  }\r\n\r\n  get plusIcon() {\r\n    return mdiPlus;\r\n  }\r\n\r\n  get pencilIcon() {\r\n    return mdiPencil;\r\n  }\r\n\r\n  get minusIcon() {\r\n    return mdiMinus;\r\n  }\r\n\r\n  updateCalibration(event: FocusEvent) {\r\n    const value = (event.target as HTMLInputElement).value\r\n      .replace(\"&deg;\", \"\")\r\n      .replace(\"\", \"\");\r\n    if (isNaN(Number(value))) {\r\n      this.editedCalibration = new DegreesCelsius(36);\r\n    }\r\n    this.editedCalibration = new DegreesCelsius(Number(value));\r\n  }\r\n\r\n  incrementCalibration(amount: number) {\r\n    this.editedCalibration = new DegreesCelsius(\r\n      this.editedCalibration.val + amount\r\n    );\r\n  }\r\n\r\n  async playFakeVideo() {\r\n    const play = await fetch(\r\n      `http://localhost:2040/sendCPTVFrames?${new URLSearchParams(\r\n        Object.entries({\r\n          //\"cptv-file\": \"no-face-detected.cptv\",\r\n          \"cptv-file\": \"looking_down.cptv\",\r\n          repeat: \"1000\"\r\n        })\r\n      )}`,\r\n      { mode: \"no-cors\", method: \"GET\" }\r\n    );\r\n    console.log(play);\r\n  }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AdminScreening.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AdminScreening.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./AdminScreening.vue?vue&type=template&id=77c7f7d8&scoped=true&\"\nimport script from \"./AdminScreening.vue?vue&type=script&lang=ts&\"\nexport * from \"./AdminScreening.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./AdminScreening.vue?vue&type=style&index=0&id=77c7f7d8&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"77c7f7d8\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VCardText } from 'vuetify/lib/components/VCard';\nimport { VCheckbox } from 'vuetify/lib/components/VCheckbox';\nimport { VRangeSlider } from 'vuetify/lib/components/VRangeSlider';\ninstallComponents(component, {VCardText,VCheckbox,VRangeSlider})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"user-state\",class:[\n    _vm.classNameForState,\n    _vm.screeningResultClass,\n    { 'mini-view': !_vm.onReferenceDevice }\n  ],style:({ background: _vm.warmupBackgroundColour }),attrs:{\"id\":\"user-facing-screening\"},on:{\"click\":function($event){_vm.interacted = true}}},[(!_vm.isWarmingUp)?_c('canvas',{ref:\"beziers\",attrs:{\"id\":\"beziers\",\"width\":\"810\",\"height\":\"1080\"}}):_vm._e(),_c('div',{staticClass:\"center\",class:{ 'warming-up': _vm.isWarmingUp }},[(_vm.hasScreeningResult)?_c('div',{staticClass:\"result\"},[_vm._v(\" \"+_vm._s(_vm.temperature)+\" \")]):(_vm.isAquiring)?_c('div',[_vm._v(\" Hold still a moment... \")]):(_vm.isWarmingUp)?_c('div',[_vm._v(\" Warming up, \"),_c('span',[_vm._v(_vm._s(_vm.remainingWarmupTime))]),_vm._v(\" remaining \")]):(_vm.isTooFar)?_c('div',[_vm._v(\" Come closer \")]):(_vm.missingRef)?_c('div',[_vm._v(\" Missing Thermal Ref \")]):_c('div',[_vm._v(\"Ready \"+_vm._s(_vm.state))]),_vm._l((_vm.stateQueue),function(msg,index){return _c('div',{key:msg.message,staticClass:\"message\",class:(\"msg-\" + index)},[_vm._v(\" \"+_vm._s(msg.message)+\" \")])})],2),(_vm.onReferenceDevice || _vm.isLocal)?_c('v-card',{staticClass:\"settings-toggle-button\",class:{ interacted: _vm.interacted },attrs:{\"dark\":\"\",\"flat\":\"\",\"height\":\"44\",\"tile\":\"\",\"color\":\"transparent\"}},[_c('v-card-actions',[_c('v-btn',{attrs:{\"absolute\":\"\",\"dark\":\"\",\"fab\":\"\",\"bottom\":\"\",\"right\":\"\",\"elevation\":\"0\",\"color\":\"transparent\"},on:{\"click\":function (e) {\n            if (_vm.interacted) {\n              _vm.showSettings = true;\n              _vm.hasSettings = true;\n            }\n          }}},[_c('v-icon',{attrs:{\"color\":\"rgba(255, 255, 255, 0.5)\",\"large\":\"\"}},[_vm._v(_vm._s(_vm.cogIcon))])],1)],1)],1):_vm._e(),_c('v-dialog',{attrs:{\"hide-overlay\":\"\",\"attach\":\"#user-facing-screening\",\"fullscreen\":\"\",\"transition\":\"dialog-bottom-transition\"},model:{value:(_vm.showSettings),callback:function ($$v) {_vm.showSettings=$$v},expression:\"showSettings\"}},[(_vm.hasSettings)?_c('AdminSettings',{on:{\"closed\":_vm.closedAdminSettings}}):_vm._e()],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-card',[_c('v-toolbar',{attrs:{\"color\":\"light-blue\",\"dark\":\"\"},scopedSlots:_vm._u([{key:\"extension\",fn:function(){return [_c('v-tabs',{attrs:{\"centered\":\"\"},model:{value:(_vm.tab),callback:function ($$v) {_vm.tab=$$v},expression:\"tab\"}},_vm._l((_vm.tabItems),function(item){return _c('v-tab',{key:item.tab},[_vm._v(_vm._s(item.tab))])}),1)]},proxy:true}])},[_c('v-toolbar-title',[_vm._v(\"Settings\")]),_c('v-spacer'),_c('v-btn',{attrs:{\"text\":\"\"},on:{\"click\":_vm.close}},[_vm._v(\" close \")])],1),_c('v-tabs-items',{attrs:{\"touchless\":\"\"},model:{value:(_vm.tab),callback:function ($$v) {_vm.tab=$$v},expression:\"tab\"}},_vm._l((_vm.tabItems),function(item){return _c('v-tab-item',{key:item.tab},[_c(item.content,{tag:\"component\"})],1)}),1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-card',{attrs:{\"height\":\"calc(100vh - 112px)\"}},[_c('v-container',{staticClass:\"cont\"},[_c('v-card',{staticClass:\"split\",attrs:{\"flat\":\"\"}},[_c('v-card',[_c('VideoStream',{attrs:{\"frame\":_vm.state.currentFrame.smoothed,\"thermal-reference\":_vm.state.thermalReference,\"thermal-reference-stats\":_vm.state.thermalReferenceStats,\"face\":_vm.state.face,\"crop-box\":_vm.editedCropBox,\"crop-enabled\":true},on:{\"crop-changed\":_vm.onCropChanged}})],1),_c('v-card',{staticClass:\"settings\",attrs:{\"width\":\"700\"}},[_c('v-card-title',[_vm._v(\" Calibration: \"+_vm._s(_vm.pendingCalibration)+\" \"),_c('v-btn',{attrs:{\"text\":\"\",\"disabled\":!_vm.canCalibrate},on:{\"click\":function($event){$event.stopPropagation();return (function () { return _vm.editCalibration(); })($event)}}},[_c('v-icon',{attrs:{\"color\":\"#999\",\"small\":\"\"}},[_vm._v(_vm._s(_vm.pencilIcon))]),_vm._v(\" Edit \")],1)],1),_c('v-dialog',{attrs:{\"max-width\":\"400\"},model:{value:(_vm.showCalibrationDialog),callback:function ($$v) {_vm.showCalibrationDialog=$$v},expression:\"showCalibrationDialog\"}},[_c('v-card',[_c('v-card-title',[_vm._v(\"Edit calibration\")]),_c('v-container',[(_vm.snapshotScreeningEvent)?_c('VideoStream',{attrs:{\"frame\":_vm.snapshotScreeningEvent.frame.smoothed,\"thermal-reference\":_vm.snapshotScreeningEvent.thermalReference,\"face\":_vm.snapshotScreeningEvent.face,\"crop-box\":_vm.state.currentCalibration.cropBox,\"crop-enabled\":false,\"draw-overlays\":true,\"scale\":0.6}}):_vm._e()],1),_c('v-card-subtitle',[_vm._v(\" Take your temperature and enter it here to calibrate the system against the current screening event. \")]),_c('v-card-text',[_c('v-text-field',{attrs:{\"label\":\"calibrated temperature\",\"value\":_vm.editedCalibration},on:{\"blur\":_vm.updateCalibration}}),_c('v-card-actions',[_c('v-btn',{on:{\"click\":function () { return _vm.incrementCalibration(0.1); }}},[_c('v-icon',{attrs:{\"light\":\"\"}},[_vm._v(_vm._s(_vm.plusIcon))])],1),_c('v-spacer'),_c('v-btn',{on:{\"click\":function () { return _vm.incrementCalibration(-0.1); }}},[_c('v-icon',{attrs:{\"light\":\"\"}},[_vm._v(_vm._s(_vm.minusIcon))])],1)],1)],1),_c('v-card-actions',[_c('v-spacer'),_c('v-btn',{attrs:{\"text\":\"\",\"color\":\"grey darken-1\"},on:{\"click\":function($event){_vm.showCalibrationDialog = false}}},[_vm._v(\"Cancel\")]),_c('v-btn',{attrs:{\"text\":\"\",\"color\":\"green darken-1\"},on:{\"click\":function (e) { return _vm.acceptCalibration(); }}},[_vm._v(\"Accept\")])],1)],1)],1),_c('v-card-text',[_c('v-checkbox',{attrs:{\"label\":\"Use custom alerts temperature range\"},on:{\"change\":_vm.toggleCustomTemperatureThresholds},model:{value:(_vm.useCustomTemperatureRange),callback:function ($$v) {_vm.useCustomTemperatureRange=$$v},expression:\"useCustomTemperatureRange\"}}),_c('v-card-text',[_c('v-range-slider',{attrs:{\"disabled\":!_vm.useCustomTemperatureRange,\"min\":\"30\",\"max\":\"40\",\"step\":\"0.1\",\"thumb-label\":\"\",\"ticks\":true,\"color\":'green',\"track-color\":'rgba(255, 0, 0, 0.25)'},model:{value:(_vm.editedTemperatureThresholds),callback:function ($$v) {_vm.editedTemperatureThresholds=$$v},expression:\"editedTemperatureThresholds\"}}),_c('span',{staticClass:\"selected-temp-range\",domProps:{\"innerHTML\":_vm._s(_vm.selectedTemperatureRange)}})],1)],1),_c('v-card-title',[_vm._v(\"Sounds:\")]),_c('v-container',{attrs:{\"fluid\":\"\",\"width\":\"100%\"}},[_c('v-row',[_c('v-col',{attrs:{\"cols\":\"4\"}},[_c('v-switch',{attrs:{\"label\":\"Play normal sound\"},on:{\"change\":function (e) { return _vm.saveSounds(); }},model:{value:(_vm.playNormalSound),callback:function ($$v) {_vm.playNormalSound=$$v},expression:\"playNormalSound\"}})],1),_c('v-col',{attrs:{\"cols\":\"4\"}},[_c('v-switch',{attrs:{\"label\":\"Play warning sound\"},on:{\"change\":function (e) { return _vm.saveSounds(); }},model:{value:(_vm.playWarningSound),callback:function ($$v) {_vm.playWarningSound=$$v},expression:\"playWarningSound\"}})],1),_c('v-col',{attrs:{\"cols\":\"4\"}},[_c('v-switch',{attrs:{\"label\":\"Play error sound\"},on:{\"change\":function (e) { return _vm.saveSounds(); }},model:{value:(_vm.playErrorSound),callback:function ($$v) {_vm.playErrorSound=$$v},expression:\"playErrorSound\"}})],1)],1)],1)],1)],1),_c('v-overlay',{attrs:{\"value\":_vm.saving,\"light\":\"\"}},[_vm._v(\" Saving settings \")]),_c('v-card-actions',{staticClass:\"bottom-nav\"},[_c('v-btn',{attrs:{\"text\":\"\",\"disabled\":!_vm.hasMadeEdits},on:{\"click\":function (e) { return _vm.resetEdits(); }}},[_vm._v(\" Discard changes \")]),_c('v-btn',{attrs:{\"text\":\"\",\"disabled\":!_vm.hasMadeEdits},on:{\"click\":function (e) { return _vm.saveEdits(); }}},[_vm._v(\" Save changes \")])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { CalibrationInfo, NetworkInterface } from \"./types\";\r\nimport { CalibrationConfig, ScreeningEvent } from \"@/types\";\r\nimport { Frame } from \"@/camera\";\r\nconst FAKE_THERMAL_CAMERA_SERVER = \"http://localhost:2040\";\r\n\r\nconst API_BASE =\r\n  \"https://ixg63w0770.execute-api.ap-southeast-2.amazonaws.com/event\";\r\nexport const ScreeningApi = {\r\n  async recordScreeningEvent(\r\n    deviceName: string,\r\n    deviceId: number,\r\n    data: ScreeningEvent\r\n  ) {\r\n    const request = fetch(API_BASE, {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        CameraID: `${deviceName}|${deviceId}|${data.frame.frameInfo.Camera.CameraSerial}`,\r\n        Type: \"Screen\",\r\n        Timestamp: data.timestamp\r\n          .toISOString()\r\n          .replace(/:/g, \"_\")\r\n          .replace(/\\./g, \"_\"),\r\n        TemperatureRawValue: Math.round(data.rawTemperatureValue),\r\n        RefTemperatureValue: Math.round(data.thermalReferenceRawValue),\r\n        AppVersion: data.frame.frameInfo.AppVersion,\r\n        Meta: {\r\n          Sample: { x: data.sampleX, y: data.sampleY },\r\n          Telemetry: data.frame.frameInfo.Telemetry\r\n        }\r\n      })\r\n    });\r\n    const response = await request;\r\n    try {\r\n      const presignedUrl = await response.text();\r\n      // Based on the user, we find out whether or not to upload a reference image.\r\n      if (presignedUrl) {\r\n        // Upload to s3\r\n        const response = await fetch(presignedUrl, {\r\n          method: \"POST\",\r\n          body: data.frame.frame,\r\n          mode: \"no-cors\"\r\n        });\r\n        console.log(await response.text());\r\n      } else {\r\n        // Error?\r\n      }\r\n    } catch (e) {\r\n      console.log(response.status);\r\n    }\r\n  },\r\n  async recordCalibrationEvent(\r\n    deviceName: string,\r\n    deviceId: number,\r\n    calibration: CalibrationConfig,\r\n    frame: Frame,\r\n    x: number,\r\n    y: number\r\n  ) {\r\n    const cameraSerial = frame.frameInfo.Camera.CameraSerial;\r\n    const appVersion = frame.frameInfo.AppVersion;\r\n    const request = fetch(API_BASE, {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        CameraID: `${deviceName}|${deviceId}|${cameraSerial}`,\r\n        Type: \"Calibrate\",\r\n        Timestamp: calibration.timestamp\r\n          .toISOString()\r\n          .replace(/:/g, \"_\")\r\n          .replace(/\\./g, \"_\"),\r\n        CalibratedTemp: calibration.calibrationTemperature.val.toFixed(2),\r\n        MinNormalThreshold: calibration.thresholdMinNormal,\r\n        MinFeverThreshold: calibration.thresholdMinFever,\r\n        ThermalRefTemp: calibration.thermalRefTemperature.val.toFixed(2),\r\n        RefTemperatureValue: Math.round(calibration.thermalReferenceRawValue),\r\n        TemperatureRawValue: Math.round(calibration.hotspotRawTemperatureValue),\r\n        AppVersion: appVersion,\r\n        Meta: {\r\n          Sample: { x, y },\r\n          Telemetry: frame.frameInfo.Telemetry,\r\n          Crop: calibration.cropBox\r\n        }\r\n      })\r\n    });\r\n    const response = await request;\r\n    try {\r\n      const presignedUrl = await response.text();\r\n      // Based on the user, we find out whether or not to upload a reference image.\r\n      if (presignedUrl) {\r\n        // Upload to s3\r\n        const response = await fetch(presignedUrl, {\r\n          method: \"POST\",\r\n          body: frame.frame,\r\n          mode: \"no-cors\"\r\n        });\r\n        console.log(await response.text());\r\n      } else {\r\n        // Error?\r\n      }\r\n    } catch (e) {\r\n      console.log(response.status);\r\n    }\r\n  }\r\n};\r\n\r\nexport const DeviceApi = {\r\n  get debugPrefix() {\r\n    if (window.location.port === \"8080\" || window.location.port === \"5000\") {\r\n      // Used for developing the front-end against an externally running version of the\r\n      // backend, so it's not necessary to package up the build to do front-end testing.\r\n      //return \"http://localhost:2041\";\r\n      return \"http://192.168.178.37\";\r\n    }\r\n    return \"\";\r\n  },\r\n  get SOFTWARE_VERSION() {\r\n    return `${this.debugPrefix}/api/version`;\r\n  },\r\n  get DEVICE_INFO() {\r\n    return `${this.debugPrefix}/api/device-info`;\r\n  },\r\n  get DEVICE_TIME() {\r\n    return `${this.debugPrefix}/api/clock`;\r\n  },\r\n  get DEVICE_CONFIG() {\r\n    return `${this.debugPrefix}/api/config`;\r\n  },\r\n  get NETWORK_INFO() {\r\n    return `${this.debugPrefix}/api/network-info`;\r\n  },\r\n  get SAVE_CALIBRATION() {\r\n    return `${this.debugPrefix}/api/calibration/save`;\r\n  },\r\n  get LOAD_CALIBRATION() {\r\n    return `${this.debugPrefix}/api/calibration/get`;\r\n  },\r\n  get RECORDER_STATUS() {\r\n    return `${this.debugPrefix}/recorderstatus`;\r\n  },\r\n  get START_RECORDING() {\r\n    return `${this.debugPrefix}/record?start=true`;\r\n  },\r\n  get DOWNLOAD_RECORDING() {\r\n    return `${this.debugPrefix}/record?stop=true`;\r\n  },\r\n  async get(url: string) {\r\n    return fetch(url, {\r\n      method: \"GET\",\r\n      headers: {\r\n        Authorization: `Basic ${btoa(\"admin:feathers\")}`\r\n      }\r\n    });\r\n  },\r\n  async post(\r\n    url: string,\r\n    data:\r\n      | Blob\r\n      | BufferSource\r\n      | FormData\r\n      | URLSearchParams\r\n      | ReadableStream<Uint8Array>\r\n      | string\r\n      | null\r\n  ) {\r\n    return fetch(url, {\r\n      method: \"POST\",\r\n      headers: {\r\n        Authorization: `Basic ${btoa(\"admin:feathers\")}`,\r\n        \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n      },\r\n      body: data\r\n    });\r\n  },\r\n  async getJSON(url: string) {\r\n    const response = await this.get(url);\r\n    try {\r\n      return response.json();\r\n    } catch (e) {\r\n      return {};\r\n    }\r\n  },\r\n  async getText(url: string) {\r\n    const response = await this.get(url);\r\n    return response.text();\r\n  },\r\n  async softwareVersion(): Promise<{\r\n    apiVersion: number;\r\n    appVersion: string;\r\n    binaryVersion: string;\r\n  }> {\r\n    return this.getJSON(this.SOFTWARE_VERSION);\r\n  },\r\n  async startRecording(): Promise<boolean> {\r\n    const result = await this.getText(this.START_RECORDING);\r\n    return result === \"<nil>\";\r\n  },\r\n  async deviceInfo(): Promise<{\r\n    serverURL: string;\r\n    groupname: string;\r\n    devicename: string;\r\n    deviceID: number;\r\n  }> {\r\n    return this.getJSON(this.DEVICE_INFO);\r\n  },\r\n  async deviceTime() {\r\n    return this.getJSON(this.DEVICE_TIME);\r\n  },\r\n  async recorderStatus() {\r\n    return this.getJSON(this.RECORDER_STATUS);\r\n  },\r\n  async deviceConfig() {\r\n    return this.getJSON(this.DEVICE_CONFIG);\r\n  },\r\n  async networkInfo(): Promise<{\r\n    Interfaces: NetworkInterface[];\r\n    Config: { Online: boolean };\r\n  }> {\r\n    return this.getJSON(this.NETWORK_INFO);\r\n  },\r\n  async saveCalibration(data: CalibrationInfo) {\r\n    // NOTE: This API only supports a json payload one level deep.  No nested structures.\r\n    const formData = new URLSearchParams();\r\n    formData.append(\"calibration\", JSON.stringify(data));\r\n    return this.post(this.SAVE_CALIBRATION, formData);\r\n  },\r\n  async getCalibration(): Promise<CalibrationInfo> {\r\n    return this.getJSON(this.LOAD_CALIBRATION);\r\n  }\r\n};\r\n\r\nexport const FakeThermalCameraApi = {\r\n  async isFakeThermalCamera(): Promise<boolean> {\r\n    // Try fetching on localhost:2040,\r\n    const response = await fetch(FAKE_THERMAL_CAMERA_SERVER);\r\n    if (response.status !== 200) {\r\n      return false;\r\n    }\r\n    const message = await response.text();\r\n    return message === \"This is a Fake thermal camera test server.\";\r\n  },\r\n  async listFakeThermalCameraFiles(): Promise<string[]> {\r\n    const response = await fetch(`${FAKE_THERMAL_CAMERA_SERVER}/list`);\r\n    try {\r\n      return response.json();\r\n    } catch (e) {\r\n      return [];\r\n    }\r\n  },\r\n  async playbackCptvFile(file: string, repeatCount: number): Promise<boolean> {\r\n    const response = await this.getText(\r\n      `${FAKE_THERMAL_CAMERA_SERVER}/sendCPTVFrames?${new URLSearchParams(\r\n        Object.entries({\r\n          \"cptv-file\": file,\r\n          repeat: repeatCount.toString()\r\n        })\r\n      )}`\r\n    );\r\n    return response === \"Success\";\r\n  },\r\n  async stopPlayback(): Promise<boolean> {\r\n    const response = await this.getText(\r\n      `${FAKE_THERMAL_CAMERA_SERVER}/playback?stop=true`\r\n    );\r\n    return response === \"Success\";\r\n  },\r\n  async pausePlayback(): Promise<boolean> {\r\n    const response = await this.getText(\r\n      `${FAKE_THERMAL_CAMERA_SERVER}/playback?pause=true`\r\n    );\r\n    return response === \"Success\";\r\n  },\r\n  async resumePlayback(): Promise<boolean> {\r\n    const response = await this.getText(\r\n      `${FAKE_THERMAL_CAMERA_SERVER}/playback?play=true`\r\n    );\r\n    return response === \"Success\";\r\n  },\r\n  async get(url: string) {\r\n    return fetch(url, {\r\n      method: \"GET\"\r\n    });\r\n  },\r\n  async getJSON(url: string) {\r\n    const response = await this.get(url);\r\n    try {\r\n      return response.json();\r\n    } catch (e) {\r\n      return {};\r\n    }\r\n  },\r\n  async getText(url: string) {\r\n    const response = await this.get(url);\r\n    return response.text();\r\n  }\r\n};\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Vue } from \"vue-property-decorator\";\nimport { AppState, CropBox, ScreeningEvent, ScreeningState } from \"@/types\";\nimport {\n  DEFAULT_THRESHOLD_MIN_FEVER,\n  DEFAULT_THRESHOLD_MIN_NORMAL,\n  State\n} from \"@/main\";\nimport VideoStream from \"@/components/VideoStream.vue\";\nimport { DegreesCelsius } from \"@/utils\";\nimport { mdiMinus, mdiPencil, mdiPlus } from \"@mdi/js\";\nimport { DeviceApi, ScreeningApi } from \"@/api/api\";\n\n@Component({\n  components: { VideoStream }\n})\nexport default class CalibrationSettings extends Vue {\n  private useCustomTemperatureRange = false;\n  private editedTemperatureThresholds: [number, number] = [0, 0];\n  private showCalibrationDialog = false;\n  private editedCropBox: CropBox | null = null;\n  private editedCalibration: DegreesCelsius = new DegreesCelsius(0);\n  private pendingCalibration: DegreesCelsius = new DegreesCelsius(0);\n  private snapshotScreeningEvent: ScreeningEvent | null = null;\n  private playNormalSound = true;\n  private playWarningSound = true;\n  private playErrorSound = true;\n  private deviceName = \"\";\n  private deviceID = 0;\n\n  toggleCustomTemperatureThresholds(val: boolean) {\n    if (val) {\n      this.editedTemperatureThresholds = [\n        this.state.currentCalibration.thresholdMinNormal,\n        this.state.currentCalibration.thresholdMinFever\n      ];\n    }\n    if (!val) {\n      this.editedTemperatureThresholds = [\n        DEFAULT_THRESHOLD_MIN_NORMAL,\n        DEFAULT_THRESHOLD_MIN_FEVER\n      ];\n    }\n    // Update custom back to defaults\n  }\n\n  get selectedTemperatureRange() {\n    return `${new DegreesCelsius(\n      this.editedTemperatureThresholds[0]\n    )} &ndash; ${new DegreesCelsius(this.editedTemperatureThresholds[1])}`;\n  }\n\n  get hasMadeEdits(): boolean {\n    const unedited = {\n      cropBox: this.state.currentCalibration.cropBox,\n      temperatureThresholds: [\n        this.state.currentCalibration.thresholdMinNormal,\n        this.state.currentCalibration.thresholdMinFever\n      ],\n      calibration: this.state.currentCalibration.calibrationTemperature.val\n    };\n    const edited = {\n      cropBox: this.editedCropBox,\n      temperatureThresholds: this.editedTemperatureThresholds,\n      calibration: parseFloat(this.editedCalibration.val.toFixed(2))\n    };\n    const a = JSON.stringify(edited);\n    const b = JSON.stringify(unedited);\n    return a != b;\n  }\n\n  get plusIcon() {\n    return mdiPlus;\n  }\n\n  get pencilIcon() {\n    return mdiPencil;\n  }\n\n  get minusIcon() {\n    return mdiMinus;\n  }\n\n  get state(): AppState {\n    return State;\n  }\n\n  get canCalibrate() {\n    return this.latestScreeningEvent !== null;\n  }\n\n  onCropChanged(box: CropBox) {\n    this.editedCropBox = box;\n  }\n\n  get screeningState(): ScreeningState {\n    return this.state.currentScreeningState;\n  }\n\n  get latestScreeningEvent(): ScreeningEvent | null {\n    return this.state.currentScreeningEvent;\n  }\n\n  get calibration(): DegreesCelsius {\n    return this.pendingCalibration;\n  }\n\n  editCalibration() {\n    this.editedCalibration = new DegreesCelsius(this.calibration.val);\n    this.snapshotScreeningEvent = this.latestScreeningEvent;\n    this.showCalibrationDialog = true;\n  }\n\n  async acceptCalibration() {\n    this.pendingCalibration = new DegreesCelsius(this.editedCalibration.val);\n    this.snapshotScreeningEvent = null;\n    this.showCalibrationDialog = false;\n  }\n\n  async persistSettings(): Promise<Response | undefined> {\n    // Get these values from the current screening event.\n    const cropBox = this.editedCropBox!;\n    const currentCalibration = this.pendingCalibration;\n    let thermalRefTemp = this.state.currentCalibration.thermalRefTemperature\n      .val;\n    console.log(JSON.stringify(this.state.currentCalibration, null, \"\\t\"));\n    let thermalRefRaw = this.state.currentCalibration.thermalReferenceRawValue;\n    let rawTempValue = this.state.currentCalibration.hotspotRawTemperatureValue;\n    const thresholdMinNormal = this.editedTemperatureThresholds[0];\n    const thresholdMinFever = this.editedTemperatureThresholds[1];\n    let frame = this.state.currentFrame;\n    let sampleX = -1;\n    let sampleY = -1;\n    if (frame) {\n      if (this.latestScreeningEvent) {\n        thermalRefRaw = this.latestScreeningEvent.thermalReferenceRawValue;\n        rawTempValue = this.latestScreeningEvent.rawTemperatureValue;\n        thermalRefTemp =\n          currentCalibration.val - (rawTempValue - thermalRefRaw) * 0.01;\n        frame = this.latestScreeningEvent.frame;\n        sampleX = this.latestScreeningEvent.sampleX;\n        sampleY = this.latestScreeningEvent.sampleY;\n      }\n\n      const timestamp = new Date();\n      await ScreeningApi.recordCalibrationEvent(\n        this.deviceName,\n        this.deviceID,\n        {\n          cropBox,\n          timestamp: timestamp,\n          calibrationTemperature: currentCalibration,\n          hotspotRawTemperatureValue: rawTempValue,\n          thermalRefTemperature: new DegreesCelsius(thermalRefTemp),\n          thermalReferenceRawValue: thermalRefRaw,\n          thresholdMinFever,\n          thresholdMinNormal\n        },\n        frame,\n        sampleX,\n        sampleY\n      );\n\n      return DeviceApi.saveCalibration({\n        ThresholdMinNormal: thresholdMinNormal,\n        ThresholdMinFever: thresholdMinFever,\n        ThermalRefTemp: thermalRefTemp,\n        TemperatureCelsius: currentCalibration.val,\n        Top: cropBox.top,\n        Right: cropBox.right,\n        Left: cropBox.left,\n        Bottom: cropBox.bottom,\n        UuidOfUpdater: this.state.uuid,\n        BodyLocation: \"forehead\",\n        CalibrationBinaryVersion: this.state.currentFrame!.frameInfo\n          .BinaryVersion,\n        SnapshotTime: timestamp.getTime(),\n        SnapshotUncertainty: 0,\n        SnapshotValue: rawTempValue\n      });\n    }\n    return;\n  }\n\n  incrementCalibration(amount: number) {\n    this.editedCalibration = new DegreesCelsius(\n      this.editedCalibration.val + amount\n    );\n  }\n\n  updateCalibration(event: FocusEvent) {\n    const value = (event.target as HTMLInputElement).value\n      .replace(\"&deg;\", \"\")\n      .replace(\"\", \"\");\n    if (isNaN(Number(value))) {\n      this.editedCalibration = new DegreesCelsius(36);\n    }\n    this.editedCalibration = new DegreesCelsius(Number(value));\n  }\n\n  resetEdits() {\n    this.editedCropBox = { ...this.state.currentCalibration.cropBox };\n    this.pendingCalibration = new DegreesCelsius(\n      this.state.currentCalibration.calibrationTemperature.val\n    );\n    this.editedCalibration = new DegreesCelsius(\n      this.state.currentCalibration.calibrationTemperature.val\n    );\n    this.editedTemperatureThresholds = [\n      this.state.currentCalibration.thresholdMinNormal,\n      this.state.currentCalibration.thresholdMinFever\n    ];\n    this.useCustomTemperatureRange =\n      this.editedTemperatureThresholds[0] !== DEFAULT_THRESHOLD_MIN_NORMAL &&\n      this.editedTemperatureThresholds[1] !== DEFAULT_THRESHOLD_MIN_FEVER;\n  }\n\n  private saving = false;\n  async saveEdits() {\n    this.saving = true;\n    await this.persistSettings();\n    this.saving = false;\n  }\n\n  saveSounds() {\n    window.localStorage.setItem(\n      \"playNormalSound\",\n      JSON.stringify(this.playNormalSound)\n    );\n    window.localStorage.setItem(\n      \"playWarningSound\",\n      JSON.stringify(this.playWarningSound)\n    );\n    window.localStorage.setItem(\n      \"playErrorSound\",\n      JSON.stringify(this.playErrorSound)\n    );\n  }\n\n  async beforeMount() {\n    const { deviceID, devicename } = await DeviceApi.deviceInfo();\n    this.deviceID = deviceID;\n    this.deviceName = devicename;\n    this.playNormalSound = JSON.parse(\n      window.localStorage.getItem(\"playNormalSound\") || \"true\"\n    );\n    this.playWarningSound = JSON.parse(\n      window.localStorage.getItem(\"playWarningSound\") || \"true\"\n    );\n    this.playErrorSound = JSON.parse(\n      window.localStorage.getItem(\"playErrorSound\") || \"true\"\n    );\n    this.resetEdits();\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CalibrationSettings.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CalibrationSettings.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./CalibrationSettings.vue?vue&type=template&id=1630d800&scoped=true&\"\nimport script from \"./CalibrationSettings.vue?vue&type=script&lang=ts&\"\nexport * from \"./CalibrationSettings.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./CalibrationSettings.vue?vue&type=style&index=0&id=1630d800&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1630d800\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardActions } from 'vuetify/lib/components/VCard';\nimport { VCardSubtitle } from 'vuetify/lib/components/VCard';\nimport { VCardText } from 'vuetify/lib/components/VCard';\nimport { VCardTitle } from 'vuetify/lib/components/VCard';\nimport { VCheckbox } from 'vuetify/lib/components/VCheckbox';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VDialog } from 'vuetify/lib/components/VDialog';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VOverlay } from 'vuetify/lib/components/VOverlay';\nimport { VRangeSlider } from 'vuetify/lib/components/VRangeSlider';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VSwitch } from 'vuetify/lib/components/VSwitch';\nimport { VTextField } from 'vuetify/lib/components/VTextField';\ninstallComponents(component, {VBtn,VCard,VCardActions,VCardSubtitle,VCardText,VCardTitle,VCheckbox,VCol,VContainer,VDialog,VIcon,VOverlay,VRangeSlider,VRow,VSpacer,VSwitch,VTextField})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-card',{attrs:{\"flat\":\"\"}},[(_vm.items)?_c('v-simple-table',{scopedSlots:_vm._u([{key:\"default\",fn:function(){return [_c('thead',[_c('tr',[_c('th',{staticClass:\"text-left\"},[_vm._v(\"Device config\")]),_c('th',{staticClass:\"text-left\"})])]),_c('tbody',_vm._l((_vm.items),function(ref){\nvar name = ref[0];\nvar item = ref[1];\nreturn _c('tr',{key:name},[_c('td',[_vm._v(_vm._s(name))]),_c('td',[_vm._v(_vm._s(item))])])}),0)]},proxy:true}],null,false,421180828)}):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport { Component, Vue } from \"vue-property-decorator\";\r\nimport { AppState } from \"@/types\";\r\nimport { State } from \"@/main\";\r\nimport { DeviceApi } from \"@/api/api\";\r\nimport { CameraInfo, NetworkInterface } from \"@/api/types\";\r\n\r\n@Component\r\nexport default class DeviceInfo extends Vue {\r\n  private info: {\r\n    serverURL?: string;\r\n    groupname?: string;\r\n    devicename?: string;\r\n    deviceID?: number;\r\n  } = {};\r\n  private networkInfo: {\r\n    Interfaces?: NetworkInterface[];\r\n    IPAddress?: string;\r\n    Config?: { Online: boolean };\r\n    Online?: boolean;\r\n  } = {};\r\n  private softwareVersion: {\r\n    apiVersion?: number;\r\n    appVersion?: string;\r\n    binaryVersion?: string;\r\n  } = {};\r\n\r\n  get items() {\r\n    return [\r\n      ...Object.entries(this.info),\r\n      ...Object.entries(this.softwareVersion),\r\n      ...Object.entries(this.networkInfo),\r\n      ...Object.entries(this.cameraInfo)\r\n    ];\r\n  }\r\n\r\n  get cameraInfo() {\r\n    const camera: CameraInfo = {\r\n      ...State.currentFrame?.frameInfo.Camera\r\n    } as CameraInfo;\r\n    delete camera.ResX;\r\n    delete camera.ResY;\r\n    delete camera.FPS;\r\n    return camera;\r\n  }\r\n\r\n  get state(): AppState {\r\n    return State;\r\n  }\r\n\r\n  async beforeMount() {\r\n    // Get all the device data.\r\n    const info = await DeviceApi.deviceInfo();\r\n\r\n    delete info.serverURL;\r\n    delete info.groupname;\r\n\r\n    this.info = info;\r\n    const networkInfo = await DeviceApi.networkInfo();\r\n    let IPAddress = networkInfo.Interfaces.filter(\r\n      nic => nic.IPAddresses !== null\r\n    ).map(nic => nic.IPAddresses![0])[0];\r\n    IPAddress = IPAddress.substring(0, IPAddress.indexOf(\"/\"));\r\n    this.networkInfo = {\r\n      Online: networkInfo.Config.Online,\r\n      IPAddress\r\n    };\r\n\r\n    const softwareVersion = await DeviceApi.softwareVersion();\r\n    softwareVersion.binaryVersion = softwareVersion.binaryVersion.substring(\r\n      0,\r\n      10\r\n    );\r\n    const newLine = softwareVersion.appVersion.indexOf(\"\\n\");\r\n    if (newLine !== -1) {\r\n      softwareVersion.appVersion = softwareVersion.appVersion.substring(\r\n        0,\r\n        newLine\r\n      );\r\n    }\r\n    delete softwareVersion.apiVersion;\r\n    this.softwareVersion = softwareVersion;\r\n  }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeviceInfo.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeviceInfo.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./DeviceInfo.vue?vue&type=template&id=ba8536b0&scoped=true&\"\nimport script from \"./DeviceInfo.vue?vue&type=script&lang=ts&\"\nexport * from \"./DeviceInfo.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"ba8536b0\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VSimpleTable } from 'vuetify/lib/components/VDataTable';\ninstallComponents(component, {VCard,VSimpleTable})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-card',{attrs:{\"flat\":\"\",\"height\":\"calc(100vh - 112px)\"}},[_c('v-container',{staticClass:\"cont\"},[_c('VideoStream',{attrs:{\"frame\":_vm.state.currentFrame.smoothed,\"thermal-reference\":_vm.state.thermalReference,\"thermal-reference-stats\":_vm.state.thermalReferenceStats,\"face\":_vm.state.face,\"crop-box\":_vm.editedThermalRefMask,\"crop-enabled\":true,\"recording\":_vm.isRecording},on:{\"crop-changed\":_vm.onMaskChanged}}),_c('div',{staticClass:\"buttons\"},[(_vm.isRunningInAndroidWebview)?_c('div',[_vm._v(\" To make recordings this needs to be running inside a browser, not the Te Kahu Ora app. \")]):_c('div',[_c('v-btn',{attrs:{\"center\":\"\"},on:{\"click\":_vm.toggleRecording}},[_vm._v(_vm._s(!_vm.isRecording ? \"Record\" : \"Stop Recording\"))])],1)])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Vue } from \"vue-property-decorator\";\nimport VideoStream from \"@/components/VideoStream.vue\";\nimport { State } from \"@/main\";\nimport { AppState, CropBox } from \"@/types\";\nimport { DeviceApi } from \"@/api/api\";\n\nfunction download(dataurl: string) {\n  const a = document.createElement(\"a\");\n  a.href = dataurl;\n  a.setAttribute(\"download\", dataurl);\n  a.click();\n}\n\n@Component({\n  components: {\n    VideoStream\n  }\n})\nexport default class DeveloperUtilities extends Vue {\n  private editedThermalRefMask: CropBox | null = null;\n  private isRecording = false;\n\n  onMaskChanged(box: CropBox) {\n    this.editedThermalRefMask = box;\n  }\n\n  get state(): AppState {\n    return State;\n  }\n\n  get isRunningInAndroidWebview(): boolean {\n    return window.navigator.userAgent === \"feverscreen-app\";\n  }\n\n  async toggleRecording() {\n    const { recording, processor } = await DeviceApi.recorderStatus();\n    if (!processor) {\n      return false;\n    }\n    if (recording) {\n      download(DeviceApi.DOWNLOAD_RECORDING);\n      this.isRecording = false;\n    } else {\n      this.isRecording = await DeviceApi.startRecording();\n    }\n  }\n\n  async mounted() {\n    const { recording } = await DeviceApi.recorderStatus();\n    this.isRecording = recording;\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeveloperUtilities.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeveloperUtilities.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./DeveloperUtilities.vue?vue&type=template&id=95c24c0e&scoped=true&\"\nimport script from \"./DeveloperUtilities.vue?vue&type=script&lang=ts&\"\nexport * from \"./DeveloperUtilities.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./DeveloperUtilities.vue?vue&type=style&index=0&id=95c24c0e&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"95c24c0e\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VCard,VContainer})\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Emit, Vue } from \"vue-property-decorator\";\nimport CalibrationSettings from \"@/components/CalibrationSettings.vue\";\nimport DeviceInfo from \"@/components/DeviceInfo.vue\";\nimport DeveloperUtilities from \"@/components/DeveloperUtilities.vue\";\n\ninterface TabItem {\n  tab: string;\n  content: any;\n}\n\n@Component({\n  components: {\n    CalibrationSettings,\n    DeviceInfo,\n    DeveloperUtilities\n  }\n})\nexport default class AdminSettings extends Vue {\n  private tab: TabItem | null = null;\n  private tabItems: TabItem[] = [\n    {\n      tab: \"Calibration\",\n      content: CalibrationSettings\n    },\n    {\n      tab: \"Device info\",\n      content: DeviceInfo\n    },\n    {\n      tab: \"Developer\",\n      content: DeveloperUtilities\n    }\n  ];\n\n  @Emit(\"closed\")\n  close() {\n    return true;\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AdminSettings.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AdminSettings.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./AdminSettings.vue?vue&type=template&id=34541e83&scoped=true&\"\nimport script from \"./AdminSettings.vue?vue&type=script&lang=ts&\"\nexport * from \"./AdminSettings.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"34541e83\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VTab } from 'vuetify/lib/components/VTabs';\nimport { VTabItem } from 'vuetify/lib/components/VTabs';\nimport { VTabs } from 'vuetify/lib/components/VTabs';\nimport { VTabsItems } from 'vuetify/lib/components/VTabs';\nimport { VToolbar } from 'vuetify/lib/components/VToolbar';\nimport { VToolbarTitle } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VBtn,VCard,VSpacer,VTab,VTabItem,VTabs,VTabsItems,VToolbar,VToolbarTitle})\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// Possible states:\n// - Camera is still warming up\n//  (this should still want to find the constant heat source, because we want to make\n//   sure that's warming up at the same time)\n// - Frame is empty, no head detected.\n// - Head detected, but not centered.\n// - More than one head detected in frame.\n// - No constant heat-source detected.\n// - Head detected, and forehead isolated.\n// - Head has been front-on for x frames, with stable forehead lock.\n\n// - Other states:\n//      - Wifi has been lost (maybe don't care about this case now if we're wired?)\n//      - FFC is happening\n//      - Period *after* FFC, which we need to hide.\nimport { Component, Prop, Vue, Watch } from \"vue-property-decorator\";\nimport { mdiCog } from \"@mdi/js\";\nimport {\n  CalibrationConfig,\n  ScreeningEvent,\n  ScreeningState,\n  Span\n} from \"@/types\";\nimport { DegreesCelsius, temperatureForSensorValue } from \"@/utils\";\nimport { LerpAmount, Shape } from \"@/shape-processing\";\nimport AdminSettings from \"@/components/AdminSettings.vue\";\nimport { FaceInfo } from \"@/body-detection\";\nimport { WARMUP_TIME_SECONDS } from \"@/main\";\n\nfunction lerp(a: number, amt: number, b: number): number {\n  return a * amt + b * (1 - amt);\n}\n\nfunction closestY(prev: Span[], y: number): Span | undefined {\n  const best = prev\n    .map(x => ({ d: Math.abs(Number(x.y) - y), x }))\n    .sort((a, b) => b.d - a.d)\n    .pop() as { x: Span; d: number };\n  return prev.find(x => x.y === best.x.y);\n}\n\nfunction interpolateShapes(prev: Shape, amt: number, next: Shape): Shape {\n  // For each row with the same y, interpolate x0 and x0 and x1 and x1 linearly on x.\n  // Then it's a matter of figuring out what to do with the rest.\n  amt = 1 - amt;\n  const result = [];\n  // TODO(jon): Start at the bottom.\n\n  for (let i = 0; i < next.length; i++) {\n    const rowNext = next[i];\n    const y = rowNext.y;\n    if (prev[i]) {\n      // Move others across in x the same amount as the adjacent ones that *do* exist.\n      const rowPrev = prev[i];\n      result.push({\n        x0: lerp(rowPrev.x0, amt, rowNext.x0),\n        x1: lerp(rowPrev.x1, amt, rowNext.x1),\n        y: Number(y),\n        h: 0\n      });\n    } else {\n      // What's the closest point on prev?\n      // Let's use that.\n      const rowPrev = (closestY(prev, y) as unknown) as Span;\n      // Should actually be the amount that rowPrev moved compared with\n      // it's corresponding row in rowNext.\n      result.push({\n        x0: lerp(rowPrev.x0, amt, rowNext.x0),\n        x1: lerp(rowPrev.x1, amt, rowNext.x1),\n        y: Number(y),\n        h: 0\n      });\n    }\n  }\n  return result;\n}\n\nconst frameNum = 0;\n\nlet curveFitting: { fitCurveThroughPoints: (pts: Uint8Array) => number[] };\n\ninterface Message {\n  message: string;\n  count: number;\n}\n\nconst Sound = new Audio();\n\n@Component({\n  components: {\n    AdminSettings\n  }\n})\nexport default class UserFacingScreening extends Vue {\n  @Prop({ required: true }) state!: ScreeningState;\n  @Prop({ required: true }) screeningEvent!: ScreeningEvent;\n  @Prop({ required: true }) calibration!: CalibrationConfig;\n  @Prop({ required: true }) onReferenceDevice!: boolean;\n  @Prop({ required: true }) face!: FaceInfo | null;\n  @Prop({ required: true }) shapes!: [Shape[], Shape[]];\n  @Prop({ required: true }) warmupSecondsRemaining!: number;\n\n  get isLocal(): boolean {\n    return window.location.port === \"5000\" || window.location.port === \"8080\";\n  }\n\n  private didInteract = false;\n\n  private showSettings = false;\n  private hasSettings = false;\n\n  $refs!: {\n    beziers: HTMLCanvasElement;\n  };\n\n  stateQueue: Message[] = [];\n\n  closedAdminSettings() {\n    this.showSettings = false;\n    setTimeout(() => {\n      this.hasSettings = false;\n    }, 300);\n  }\n\n  set interacted(val: boolean) {\n    this.didInteract = val;\n    setTimeout(() => (this.didInteract = false), 5000);\n  }\n\n  get interacted(): boolean {\n    return this.didInteract;\n  }\n\n  get cogIcon() {\n    return mdiCog;\n  }\n\n  async beforeMount() {\n    curveFitting = await import(\"../../curve-fit\");\n  }\n\n  mounted() {\n    window.requestAnimationFrame(this.drawBezierOutline.bind(this));\n  }\n\n  @Watch(\"screeningEvent\")\n  onScreeningEventChange() {\n    if (this.temperatureIsNormal) {\n      const shouldPlay = JSON.parse(\n        window.localStorage.getItem(\"playNormalSound\") || \"true\"\n      );\n      if (shouldPlay) {\n        Sound.src = `${process.env.BASE_URL}sounds/341695_5858296-lq.mp3`;\n        Sound.play();\n      }\n    } else if (this.temperatureIsHigherThanNormal) {\n      const shouldPlay = JSON.parse(\n        window.localStorage.getItem(\"playWarningSound\") || \"true\"\n      );\n      if (shouldPlay) {\n        Sound.src = `${process.env.BASE_URL}sounds/445978_9159316-lq.mp3`;\n        Sound.play();\n      }\n    } else if (this.temperatureIsProbablyAnError) {\n      const shouldPlay = JSON.parse(\n        window.localStorage.getItem(\"playErrorSound\") || \"true\"\n      );\n      if (shouldPlay) {\n        Sound.src = `${process.env.BASE_URL}sounds/142608_1840739-lq.mp3`;\n        Sound.play();\n      }\n    }\n  }\n\n  drawBezierOutline() {\n    // Maybe we give the start and end shapes, and interpolate those, and convert to beziers each frame?\n    performance.mark(\"bezs\");\n    // const toRemove = [];\n    // for (const message of this.stateQueue) {\n    //   message.count--;\n    //   if (message.count === 0) {\n    //     toRemove.push(message);\n    //   }\n    // }\n    // for (const message of toRemove) {\n    //   if (this.stateQueue.length !== 1) {\n    //     //console.log(\"removing\", message.message);\n    //     this.stateQueue.splice(this.stateQueue.indexOf(message), 1);\n    //   }\n    // }\n\n    // If this is 9fps, we should interpolate ~5 frames in between.\n    // Let's try and draw a nice curve around the shape:\n    // Get the edge of the shape:\n    let ctx;\n    let canvasWidth = 810;\n    let canvasHeight = 1080;\n    if (this.$refs.beziers) {\n      const aspectRatio = 4 / 3;\n      if (navigator.userAgent.includes(\"Lenovo TB-X605LC\")) {\n        canvasHeight = document.body.getBoundingClientRect().height;\n      } else {\n        canvasHeight = (this.$refs.beziers\n          .parentElement as HTMLElement).getBoundingClientRect().height;\n      }\n      canvasWidth = canvasHeight / aspectRatio;\n      this.$refs.beziers.style.width = `${canvasWidth}px`;\n      this.$refs.beziers.style.height = `${canvasHeight}px`;\n      ctx = this.$refs.beziers.getContext(\"2d\") as CanvasRenderingContext2D;\n    }\n    if (ctx) {\n      ctx.clearRect(0, 0, 810, 1080);\n      ctx.save();\n      ctx.scale(6.75, 6.75);\n      if (this.shapes.length === 2) {\n        // TODO(jon): Would Object.freeze be a better strategy for opting out of reactivity?\n        const prevShape = this.shapes[0];\n        const nextShape = this.shapes[1];\n        if (prevShape && nextShape && prevShape.length && nextShape.length) {\n          const interpolatedShape = interpolateShapes(\n            prevShape[0],\n            LerpAmount.amount,\n            nextShape[0]\n          );\n          // TODO(jon): This lerp amount should be frame-rate independent, so time duration between frames.\n          LerpAmount.amount += 0.166;\n          LerpAmount.amount = Math.min(1, LerpAmount.amount);\n\n          const pointsArray = new Uint8Array(interpolatedShape.length * 4);\n          let i = 0;\n          for (const row of interpolatedShape) {\n            pointsArray[i++] = row.x1;\n            pointsArray[i++] = row.y;\n          }\n          for (const row of interpolatedShape.reverse()) {\n            pointsArray[i++] = row.x0;\n            pointsArray[i++] = row.y;\n          }\n\n          const bezierPts = curveFitting.fitCurveThroughPoints(pointsArray);\n          // TODO(jon): Run a smoothing pass on this to smooth out longer lines?\n          // Maybe have adaptive error for different parts of the curve?\n\n          if (bezierPts.length) {\n            {\n              {\n                ctx.fillStyle = \"rgba(255, 255, 255, 0.2)\";\n                ctx.strokeStyle = \"rgba(255, 255, 255, 0.2)\";\n                ctx.lineWidth = 2;\n                ctx.lineCap = \"round\";\n                // frameNum++;\n                if (frameNum % 2 === 0) {\n                  ctx.setLineDash([3, 6]);\n                } else {\n                  ctx.setLineDash([3, 4]);\n                }\n                ctx.beginPath();\n                ctx.moveTo(bezierPts[0], bezierPts[1]);\n                for (let i = 2; i < bezierPts.length; i += 6) {\n                  ctx.bezierCurveTo(\n                    bezierPts[i],\n                    bezierPts[i + 1],\n                    bezierPts[i + 2],\n                    bezierPts[i + 3],\n                    bezierPts[i + 4],\n                    bezierPts[i + 5]\n                  );\n                }\n                ctx.stroke();\n              }\n            }\n            ctx.save();\n\n            // TODO(jon): Bake this alpha mask to a texture if things seem slow.\n            ctx.globalCompositeOperation = \"destination-out\";\n            const leftGradient = ctx.createLinearGradient(0, 0, 20, 0);\n            leftGradient.addColorStop(1, \"rgba(0, 0, 0, 0)\");\n            leftGradient.addColorStop(0.25, \"rgba(0, 0, 0, 230)\");\n            leftGradient.addColorStop(0, \"rgba(0, 0, 0, 255)\");\n            const rightGradient = ctx.createLinearGradient(100, 0, 120, 0);\n            rightGradient.addColorStop(1, \"rgba(0, 0, 0, 255)\");\n            rightGradient.addColorStop(0.75, \"rgba(0, 0, 0, 230)\");\n            rightGradient.addColorStop(0, \"rgba(0, 0, 0, 0)\");\n\n            const topGradient = ctx.createLinearGradient(0, 0, 0, 10);\n            topGradient.addColorStop(0, \"rgba(0, 0, 0, 255)\");\n            topGradient.addColorStop(0.45, \"rgba(0, 0, 0, 230)\");\n            topGradient.addColorStop(1, \"rgba(0, 0, 0, 0)\");\n\n            const bottomGradient = ctx.createLinearGradient(0, 150, 0, 160);\n            bottomGradient.addColorStop(1, \"rgba(0, 0, 0, 255)\");\n            bottomGradient.addColorStop(0.75, \"rgba(0, 0, 0, 230)\");\n            bottomGradient.addColorStop(0, \"rgba(0, 0, 0, 0)\");\n\n            ctx.fillStyle = leftGradient;\n            ctx.fillRect(0, 0, 20, 160);\n            ctx.fillStyle = rightGradient;\n            ctx.fillRect(100, 0, 20, 160);\n            ctx.fillStyle = topGradient;\n            ctx.fillRect(0, 0, 120, 10);\n            ctx.fillStyle = bottomGradient;\n            ctx.fillRect(0, 150, 120, 10);\n\n            ctx.restore();\n          }\n        }\n\n        // Draw corner indicators:\n        ctx.lineWidth = 1;\n        ctx.strokeStyle = \"rgba(255, 255, 255, 0.5)\";\n        ctx.setLineDash([]);\n\n        const inset = 15;\n        const len = 10;\n        const width = 120;\n        const height = 160;\n        ctx.beginPath();\n        ctx.moveTo(inset + len, inset);\n        ctx.lineTo(inset, inset);\n        ctx.lineTo(inset, inset + len);\n\n        ctx.moveTo(inset + len, height - inset);\n        ctx.lineTo(inset, height - inset);\n        ctx.lineTo(inset, height - (inset + len));\n\n        ctx.moveTo(width - (inset + len), inset);\n        ctx.lineTo(width - inset, inset);\n        ctx.lineTo(width - inset, inset + len);\n\n        ctx.moveTo(width - (inset + len), height - inset);\n        ctx.lineTo(width - inset, height - inset);\n        ctx.lineTo(width - inset, height - (inset + len));\n        ctx.stroke();\n        ctx.restore();\n      }\n    }\n    performance.mark(\"beze\");\n    performance.measure(\"beziers\", \"bezs\", \"beze\");\n    window.requestAnimationFrame(this.drawBezierOutline.bind(this));\n  }\n\n  get temperature(): DegreesCelsius {\n    if (this.screeningEvent) {\n      return temperatureForSensorValue(\n        this.calibration.calibrationTemperature.val,\n        this.screeningEvent.rawTemperatureValue,\n        this.screeningEvent.thermalReferenceRawValue\n      );\n    }\n    return new DegreesCelsius(0);\n  }\n\n  get temperatureIsNormal(): boolean {\n    const temperature = this.temperature.val;\n    return (\n      temperature >= this.calibration.thresholdMinNormal &&\n      temperature < this.calibration.thresholdMinFever\n    );\n  }\n\n  get temperatureIsHigherThanNormal(): boolean {\n    const temperature = this.temperature.val;\n    return temperature >= this.calibration.thresholdMinFever;\n  }\n\n  get temperatureIsProbablyAnError(): boolean {\n    const temperature = this.temperature.val;\n    // TODO(jon)\n    return temperature > 42.5;\n  }\n\n  get classNameForState() {\n    return this.state.toLowerCase().replace(\"_\", \"-\");\n  }\n\n  get screeningResultClass() {\n    if (\n      this.state === ScreeningState.STABLE_LOCK ||\n      this.state === ScreeningState.LEAVING\n    ) {\n      if (this.temperatureIsNormal) {\n        return \"okay\"; // or possible-fever, or error-temp\n      } else if (this.temperatureIsHigherThanNormal) {\n        return \"possible-fever\";\n      } else if (this.temperatureIsProbablyAnError) {\n        return \"error\";\n      }\n    }\n    return null;\n  }\n\n  get hasScreeningResult(): boolean {\n    return this.screeningResultClass !== null;\n  }\n\n  get isTooFar(): boolean {\n    return this.state === ScreeningState.TOO_FAR;\n  }\n\n  get isWarmingUp(): boolean {\n    return this.state === ScreeningState.WARMING_UP;\n  }\n\n  get warmupBackgroundColour(): string {\n    // Lerp between\n    const hueStart = 37;\n    const saturationStart = 70;\n    const lightnessStart = 66;\n\n    const hueEnd = 198;\n    const saturationEnd = 100;\n    const lightnessEnd = 42;\n\n    const val = Math.min(\n      1,\n      (WARMUP_TIME_SECONDS - this.warmupSecondsRemaining) / WARMUP_TIME_SECONDS\n    );\n    const hue = lerp(hueEnd, val, hueStart);\n    const saturation = lerp(saturationEnd, val, saturationStart);\n    const lightness = lerp(lightnessEnd, val, lightnessStart);\n    return `hsl(${hue}, ${saturation}%, ${lightness}%)`;\n  }\n\n  get isAquiring(): boolean {\n    return (\n      this.state === ScreeningState.LARGE_BODY ||\n      this.state === ScreeningState.FACE_LOCK ||\n      this.state === ScreeningState.HEAD_LOCK ||\n      this.state === ScreeningState.FRONTAL_LOCK\n    );\n  }\n\n  get missingRef(): boolean {\n    return this.state === ScreeningState.MISSING_THERMAL_REF;\n  }\n\n  get remainingWarmupTime(): string {\n    const secondsRemaining = this.warmupSecondsRemaining;\n    const minsRemaining = Math.floor(secondsRemaining / 60);\n    const seconds = secondsRemaining - minsRemaining * 60;\n    return ` ${String(minsRemaining).padStart(2, \"0\")}:${String(\n      Math.floor(seconds)\n    ).padStart(2, \"0\")}`;\n  }\n\n  get message(): Message {\n    switch (this.state) {\n      case ScreeningState.WARMING_UP:\n        return { message: \"Please wait\", count: Number.MAX_SAFE_INTEGER };\n      case ScreeningState.MULTIPLE_HEADS:\n        return {\n          message: \"Only one person should be in front of the camera\",\n          count: 60\n        };\n\n      case ScreeningState.HEAD_LOCK:\n      case ScreeningState.FACE_LOCK:\n        return {\n          message: \"Please look straight ahead\",\n          count: -1\n        };\n      case ScreeningState.FRONTAL_LOCK:\n        return { message: \"Great, now hold still a moment\", count: 120 };\n      case ScreeningState.STABLE_LOCK:\n        if (this.screeningEvent) {\n          if (this.temperatureIsNormal) {\n            return { message: `Your temperature is normal`, count: 460 };\n          } else if (this.temperatureIsHigherThanNormal) {\n            return {\n              message:\n                \"Your temperature is higher than normal, please don't enter\",\n              count: 180\n            };\n          } else if (this.temperatureIsProbablyAnError) {\n            return {\n              message: \"Temperature anomaly, please check equipment\",\n              count: 360\n            };\n          }\n        }\n        break;\n      case ScreeningState.LEAVING:\n        if (this.screeningEvent) {\n          if (this.temperatureIsNormal) {\n            return { message: \"You're good to go!\", count: -1 };\n          } else {\n            return {\n              message: \"You can go, but you need to get a follow-up\",\n              count: -1\n            };\n          }\n        } else {\n          return {\n            message: \"\",\n            count: -1\n          };\n        }\n      case ScreeningState.READY:\n      default:\n        return { message: \"Ready to screen\", count: Number.MAX_SAFE_INTEGER };\n    }\n    return { message: \"\", count: 0 };\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserFacingScreening.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserFacingScreening.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./UserFacingScreening.vue?vue&type=template&id=501e7b82&scoped=true&\"\nimport script from \"./UserFacingScreening.vue?vue&type=script&lang=ts&\"\nexport * from \"./UserFacingScreening.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./UserFacingScreening.vue?vue&type=style&index=0&id=501e7b82&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"501e7b82\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardActions } from 'vuetify/lib/components/VCard';\nimport { VDialog } from 'vuetify/lib/components/VDialog';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\ninstallComponents(component, {VBtn,VCard,VCardActions,VDialog,VIcon})\n","import { BlobReader } from \"./utils\";\r\nimport { FrameInfo } from \"./api/types\";\r\nimport { DeviceApi } from \"./api/api\";\r\n\r\nexport interface Frame {\r\n  frameInfo: FrameInfo;\r\n  frame: Float32Array;\r\n  rotated: boolean;\r\n  smoothed: Float32Array;\r\n  medianed: Float32Array;\r\n  min: number;\r\n  max: number;\r\n  threshold: number;\r\n}\r\n\r\nexport enum CameraConnectionState {\r\n  Connecting,\r\n  Connected,\r\n  Disconnected\r\n}\r\n\r\nconst UUID = new Date().getTime();\r\n\r\ninterface CameraStats {\r\n  skippedFramesServer: number;\r\n  skippedFramesClient: number;\r\n}\r\n\r\ninterface CameraState {\r\n  socket: WebSocket | null;\r\n  UUID: number;\r\n  stats: CameraStats;\r\n  prevFrameNum: number;\r\n  frames: Frame[];\r\n  heartbeatInterval: number;\r\n  pendingFrame: number | null;\r\n}\r\n\r\nexport class CameraConnection {\r\n  constructor(\r\n    public deviceIp: string,\r\n    public onFrame: (frame: Frame) => void,\r\n    public onConnectionStateChange: (\r\n      connectionState: CameraConnectionState\r\n    ) => void\r\n  ) {\r\n    // If we're running in development mode, find the fake-thermal-camera server\r\n    if (window.location.port === \"8080\" || window.location.port === \"5000\") {\r\n      this.deviceIp = DeviceApi.debugPrefix.replace(\"http://\", \"\");\r\n    }\r\n    this.connect();\r\n  }\r\n  private state: CameraState = {\r\n    socket: null,\r\n    UUID: new Date().getTime(),\r\n    stats: {\r\n      skippedFramesServer: 0,\r\n      skippedFramesClient: 0\r\n    },\r\n    pendingFrame: null,\r\n    prevFrameNum: -1,\r\n    heartbeatInterval: 0,\r\n    frames: []\r\n  };\r\n\r\n  retryConnection(retryTime: number) {\r\n    if (retryTime > 0) {\r\n      setTimeout(() => this.retryConnection(retryTime - 1), 1000);\r\n    } else {\r\n      this.connect();\r\n    }\r\n  }\r\n  register() {\r\n    if (this.state.socket !== null) {\r\n      if (this.state.socket.readyState === WebSocket.OPEN) {\r\n        // We are waiting for frames now.\r\n        this.state.socket.send(\r\n          JSON.stringify({\r\n            type: \"Register\",\r\n            data: navigator.userAgent,\r\n            uuid: UUID\r\n          })\r\n        );\r\n        this.onConnectionStateChange(CameraConnectionState.Connected);\r\n\r\n        this.state.heartbeatInterval = window.setInterval(() => {\r\n          this.state.socket &&\r\n            this.state.socket.send(\r\n              JSON.stringify({\r\n                type: \"Heartbeat\",\r\n                uuid: UUID\r\n              })\r\n            );\r\n        }, 5000);\r\n      } else {\r\n        setTimeout(this.register.bind(this), 100);\r\n      }\r\n    }\r\n  }\r\n  connect() {\r\n    this.state.socket = new WebSocket(`ws://${this.deviceIp}/ws`);\r\n    this.onConnectionStateChange(CameraConnectionState.Connecting);\r\n    this.state.socket.addEventListener(\"error\", () => {\r\n      //...\r\n    });\r\n    // Connection opened\r\n    this.state.socket.addEventListener(\"open\", this.register.bind(this));\r\n    this.state.socket.addEventListener(\"close\", () => {\r\n      // When we do reconnect, we need to treat it as a new connection\r\n      this.state.socket = null;\r\n      this.onConnectionStateChange(CameraConnectionState.Disconnected);\r\n      clearInterval(this.state.heartbeatInterval);\r\n      this.retryConnection(5);\r\n    });\r\n    this.state.socket.addEventListener(\"message\", async event => {\r\n      if (event.data instanceof Blob) {\r\n        // TODO(jon): Only do this if we detect that we're dropping frames?\r\n        this.state.frames.push(\r\n          (await this.parseFrame(event.data as Blob)) as Frame\r\n        );\r\n        // Process the latest frame, after waiting half a frame delay\r\n        // to see if there are any more frames hot on its heels.\r\n        this.state.pendingFrame = window.setTimeout(\r\n          this.useLatestFrame.bind(this),\r\n          16\r\n        );\r\n        // Every time we get a frame, set a new timeout for when we decide that the camera has stalled sending us new frames.\r\n      }\r\n    });\r\n  }\r\n  async parseFrame(blob: Blob): Promise<Frame | null> {\r\n    // NOTE(jon): On iOS. it seems slow to do multiple fetches from the blob, so let's do it all at once.\r\n    const data = await BlobReader.arrayBuffer(blob);\r\n    const frameInfoLength = new Uint16Array(data.slice(0, 2))[0];\r\n    const frameStartOffset = 2 + frameInfoLength;\r\n    try {\r\n      const frameInfo = JSON.parse(\r\n        String.fromCharCode(...new Uint8Array(data.slice(2, frameStartOffset)))\r\n      ) as FrameInfo;\r\n      if (\r\n        this.state.prevFrameNum !== -1 &&\r\n        this.state.prevFrameNum + 1 !== frameInfo.Telemetry.FrameCount\r\n      ) {\r\n        this.state.stats.skippedFramesServer +=\r\n          frameInfo.Telemetry.FrameCount - this.state.prevFrameNum;\r\n        // Work out an fps counter.\r\n      }\r\n      this.state.prevFrameNum = frameInfo.Telemetry.FrameCount;\r\n      const frameSizeInBytes =\r\n        frameInfo.Camera.ResX * frameInfo.Camera.ResY * 2;\r\n\r\n      // TODO(jon): Some perf optimisations here.\r\n\r\n      const frame = Float32Array.from(\r\n        new Uint16Array(\r\n          data.slice(frameStartOffset, frameStartOffset + frameSizeInBytes)\r\n        )\r\n      );\r\n      return {\r\n        frameInfo,\r\n        frame,\r\n        rotated: false,\r\n        smoothed: new Float32Array(),\r\n        medianed: new Float32Array(),\r\n        threshold: 0,\r\n        min: 0,\r\n        max: 0\r\n      };\r\n    } catch (e) {\r\n      console.error(\"Malformed JSON payload\", e);\r\n    }\r\n    return null;\r\n  }\r\n  async useLatestFrame() {\r\n    if (this.state.pendingFrame) {\r\n      clearTimeout(this.state.pendingFrame);\r\n    }\r\n    let latestFrameTimeOnMs = 0;\r\n    let latestFrame: Frame | null = null;\r\n    // Turns out that we don't always get the messages in order from the pi, so make sure we take the latest one.\r\n    const framesToDrop: Frame[] = [];\r\n    while (this.state.frames.length !== 0) {\r\n      const frame = this.state.frames.shift() as Frame;\r\n      const frameHeader = frame.frameInfo;\r\n      if (frameHeader !== null) {\r\n        const timeOn = frameHeader.Telemetry.TimeOn / 1000 / 1000;\r\n        if (timeOn > latestFrameTimeOnMs) {\r\n          if (latestFrame !== null) {\r\n            framesToDrop.push(latestFrame);\r\n          }\r\n          latestFrameTimeOnMs = timeOn;\r\n          latestFrame = frame;\r\n        }\r\n      }\r\n    }\r\n    // Clear out and log any old frames that need to be dropped\r\n    while (framesToDrop.length !== 0) {\r\n      const dropFrame = framesToDrop.shift() as Frame;\r\n      const timeOn = dropFrame.frameInfo.Telemetry.TimeOn / 1000 / 1000;\r\n      this.state.stats.skippedFramesClient++;\r\n      (this.state.socket as WebSocket).send(\r\n        JSON.stringify({\r\n          type: \"Dropped late frame\",\r\n          data: `${latestFrameTimeOnMs - timeOn}ms behind current: frame#${\r\n            dropFrame.frameInfo.Telemetry.FrameCount\r\n          }`,\r\n          uuid: UUID\r\n        })\r\n      );\r\n    }\r\n\r\n    // Take the latest frame and process it.\r\n    if (latestFrame !== null) {\r\n      await this.onFrame(latestFrame);\r\n      // if (DEBUG_MODE) {\r\n      //   updateFpsCounter(skippedFramesServer, skippedFramesClient);\r\n      // } else if (fpsCount.innerText !== \"\") {\r\n      //   fpsCount.innerText = \"\";\r\n      // }\r\n    }\r\n    this.state.stats.skippedFramesClient = 0;\r\n    this.state.stats.skippedFramesServer = 0;\r\n  }\r\n}\r\n\r\nexport class LocalCameraConnection {\r\n  constructor(\r\n    public onFrame: (frame: Frame) => void,\r\n    public onConnectionStateChange: (\r\n      connectionState: CameraConnectionState\r\n    ) => void\r\n  ) {}\r\n\r\n  public loadCptvFile(blob: Blob) {\r\n    return blob;\r\n  }\r\n}\r\n","import { Frame } from \"./camera\";\nimport SmoothingWorker from \"worker-loader!./smoothing-worker\";\n\ninterface SmoothedImages {\n  medianSmoothed: Float32Array;\n  radialSmoothed: Float32Array;\n  thresholded: Uint8Array;\n  threshold: number;\n  min: number;\n  max: number;\n}\nconst smoothingWorker = new SmoothingWorker();\n\nexport const processSensorData = async (\n  sensorData: Frame\n): Promise<SmoothedImages> => {\n  return new Promise(function(resolve, reject) {\n    smoothingWorker.onmessage = r => {\n      resolve(r.data as SmoothedImages);\n    };\n    smoothingWorker.postMessage({\n      frame: sensorData.frame,\n      width: sensorData.frameInfo.Camera.ResX,\n      height: sensorData.frameInfo.Camera.ResY\n    });\n  });\n};\n\nconst rotate90u8 = (\n  src: Uint8Array,\n  dest: Uint8Array,\n  width: number,\n  height: number\n): Uint8Array => {\n  let i = 0;\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      dest[x * height + y] = src[i];\n      i++;\n    }\n  }\n  return dest;\n};\n\nconst rotate90 = (src: Float32Array, dest: Float32Array): Float32Array => {\n  let i = 0;\n  const width = 160;\n  const height = 120;\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      dest[x * height + y] = src[i];\n      i++;\n    }\n  }\n  return dest;\n};\n\nexport function rotateFrame(frame: Frame) {\n  if (!frame.rotated) {\n    frame.frameInfo.Camera.ResX = 120;\n    frame.frameInfo.Camera.ResY = 160;\n    frame.frame = rotate90(\n      frame.frame,\n      new Float32Array(\n        frame.frameInfo.Camera.ResX * frame.frameInfo.Camera.ResY\n      )\n    );\n\n    // TODO(jon): If thermal ref is always in the same place, maybe mask out the entire bottom of the frame?\n    // Just for visualisation purposes?\n    frame.rotated = true;\n  }\n}\n","import { HaarCascade, HaarFeature } from \"@/haar-cascade\";\r\n\r\nconst XBorder = 1;\r\nconst YBorder = 2;\r\n\r\nfunction euclDistance(x: number, y: number, x2: number, y2: number): number {\r\n  return Math.sqrt(Math.pow(x - x2, 2) + Math.pow(y - y2, 2));\r\n}\r\n\r\nfunction evaluateFeature(\r\n  feature: HaarFeature,\r\n  satData: Float32Array[],\r\n  width: number,\r\n  height: number,\r\n  mx: number,\r\n  my: number,\r\n  scale: number\r\n) {\r\n  const w2 = width + 2;\r\n  let result = 0;\r\n  if (feature.tilted) {\r\n    const tilted = satData[2];\r\n    for (const r of feature.rects) {\r\n      let value = 0;\r\n      const rw = r.x1 - r.x0;\r\n      const rh = r.y1 - r.y0;\r\n      //gp not sure about these tilt values, i think it's only + 1 for y, because\r\n      //of rotation but not sure why\r\n      const x1 = ~~(mx + XBorder + scale * r.x0);\r\n      const y1 = ~~(my + YBorder - 1 + scale * r.y0);\r\n      const x2 = ~~(mx + XBorder + scale * (r.x0 + rw));\r\n      const y2 = ~~(my + YBorder - 1 + scale * (r.y0 + rw));\r\n      const x3 = ~~(mx + XBorder + scale * (r.x0 - rh));\r\n      const y3 = ~~(my + YBorder - 1 + scale * (r.y0 + rh));\r\n      const x4 = ~~(mx + XBorder + scale * (r.x0 + rw - rh));\r\n      const y4 = ~~(my + YBorder - 1 + scale * (r.y0 + rw + rh));\r\n\r\n      value += tilted[x4 + y4 * w2];\r\n      value -= tilted[x3 + y3 * w2];\r\n      value -= tilted[x2 + y2 * w2];\r\n      value += tilted[x1 + y1 * w2];\r\n      result += value * r.weight;\r\n    }\r\n  } else {\r\n    const sat = satData[0];\r\n    for (const r of feature.rects) {\r\n      let value = 0;\r\n      const x0 = ~~(mx + XBorder + r.x0 * scale);\r\n      const y0 = ~~(my + YBorder + r.y0 * scale);\r\n      const x1 = ~~(mx + XBorder + r.x1 * scale);\r\n      const y1 = ~~(my + YBorder + r.y1 * scale);\r\n\r\n      value += sat[x0 + y0 * w2];\r\n      value -= sat[x0 + y1 * w2];\r\n      value -= sat[x1 + y0 * w2];\r\n      value += sat[x1 + y1 * w2];\r\n\r\n      result += value * r.weight;\r\n    }\r\n  }\r\n  return result;\r\n}\r\n\r\nexport class ROIFeature {\r\n  constructor() {\r\n    this.x0 = 0;\r\n    this.y0 = 0;\r\n    this.x1 = 0;\r\n    this.y1 = 0;\r\n    this.mergeCount = 1;\r\n    this.sensorMissing = 0;\r\n    this.sensorValue = 0;\r\n    this.sensorX = 0;\r\n    this.sensorY = 0;\r\n  }\r\n\r\n  wholeValues() {\r\n    const roundedRoi = new ROIFeature();\r\n    roundedRoi.x0 = ~~this.x0;\r\n    roundedRoi.x1 = ~~this.x1;\r\n    roundedRoi.y0 = ~~this.y0;\r\n    roundedRoi.y1 = ~~this.y1;\r\n    return roundedRoi;\r\n  }\r\n  extend(value: number, maxWidth: number, maxHeight: number): ROIFeature {\r\n    const roi = new ROIFeature();\r\n    roi.x0 = Math.max(0, this.x0 - value);\r\n    roi.x1 = Math.min(maxWidth, this.x1 + value);\r\n    roi.y0 = Math.max(0, this.y0 - value);\r\n    roi.y1 = Math.min(maxHeight, this.y1 + value);\r\n    return roi;\r\n  }\r\n\r\n  wider(other: ROIFeature | null | undefined): boolean {\r\n    return !other || this.width() > other.width();\r\n  }\r\n\r\n  higher(other: ROIFeature | null | undefined): boolean {\r\n    return !other || this.height() > other.height();\r\n  }\r\n\r\n  hasXValues() {\r\n    return this.x0 != -1 && this.x1 != -1;\r\n  }\r\n\r\n  hasYValues() {\r\n    return this.y0 != -1 && this.y1 != -1;\r\n  }\r\n\r\n  midX() {\r\n    return (this.x0 + this.x1) / 2;\r\n  }\r\n  midY() {\r\n    return (this.y0 + this.y1) / 2;\r\n  }\r\n\r\n  width() {\r\n    return this.x1 - this.x0;\r\n  }\r\n\r\n  height() {\r\n    return this.y1 - this.y0;\r\n  }\r\n\r\n  midDiff(other: ROIFeature): number {\r\n    return euclDistance(this.midX(), this.midY(), other.midX(), other.midY());\r\n  }\r\n\r\n  overlapsROI(other: ROIFeature): boolean {\r\n    return this.overlap(other.x0, other.y0, other.x1, other.y1);\r\n  }\r\n\r\n  overlap(x0: number, y0: number, x1: number, y1: number) {\r\n    if (x1 <= this.x0) {\r\n      return false;\r\n    }\r\n    if (y1 <= this.y0) {\r\n      return false;\r\n    }\r\n    if (this.x1 <= x0) {\r\n      return false;\r\n    }\r\n    if (this.y1 <= y0) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  contains(x: number, y: number) {\r\n    if (x <= this.x0) {\r\n      return false;\r\n    }\r\n    if (y <= this.y0) {\r\n      return false;\r\n    }\r\n    if (this.x1 < x) {\r\n      return false;\r\n    }\r\n    if (this.y1 < y) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  // checks if this roi fits completely inside a sqaure (x0,y0) - (x1,y1)\r\n  isContainedBy(x0: number, y0: number, x1: number, y1: number): boolean {\r\n    if (this.x0 > x0 && this.x1 < x1 && this.y0 > y0 && this.y1 < y1) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  tryMerge(x0: number, y0: number, x1: number, y1: number, mergeCount = 1) {\r\n    if (!this.overlap(x0, y0, x1, y1)) {\r\n      return false;\r\n    }\r\n    const newMerge = mergeCount + this.mergeCount;\r\n    this.x0 = (this.x0 * this.mergeCount + x0 * mergeCount) / newMerge;\r\n    this.y0 = (this.y0 * this.mergeCount + y0 * mergeCount) / newMerge;\r\n    this.x1 = (this.x1 * this.mergeCount + x1 * mergeCount) / newMerge;\r\n    this.y1 = (this.y1 * this.mergeCount + y1 * mergeCount) / newMerge;\r\n    this.mergeCount = newMerge;\r\n    return true;\r\n  }\r\n\r\n  x0: number;\r\n  y0: number;\r\n  x1: number;\r\n  y1: number;\r\n  mergeCount: number;\r\n  sensorValue: number;\r\n  sensorMissing: number;\r\n  sensorX: number;\r\n  sensorY: number;\r\n}\r\n\r\nfunction evalHaar(\r\n  satData: Float32Array[],\r\n  mx: number,\r\n  my: number,\r\n  scale: number,\r\n  frameWidth: number,\r\n  frameHeight: number,\r\n  cascade: HaarCascade\r\n) {\r\n  const w2 = frameWidth + YBorder;\r\n  const bx0 = ~~(mx + XBorder - scale);\r\n  const by0 = ~~(my + YBorder - scale);\r\n  const bx1 = ~~(mx + XBorder + scale);\r\n  const by1 = ~~(my + YBorder + scale);\r\n  const sat = satData[0];\r\n  const satSq = satData[1];\r\n  const recipArea = 1.0 / ((bx1 - bx0) * (by1 - by0));\r\n  const sumB =\r\n    recipArea *\r\n    (sat[bx1 + by1 * w2] -\r\n      sat[bx0 + by1 * w2] -\r\n      sat[bx1 + by0 * w2] +\r\n      sat[bx0 + by0 * w2]);\r\n  const sumBSq =\r\n    recipArea *\r\n    (satSq[bx1 + by1 * w2] -\r\n      satSq[bx0 + by1 * w2] -\r\n      satSq[bx1 + by0 * w2] +\r\n      satSq[bx0 + by0 * w2]);\r\n\r\n  const determinant = sumBSq - sumB * sumB;\r\n  if (determinant < 1024) {\r\n    return -1;\r\n  }\r\n\r\n  const sd = Math.sqrt(determinant);\r\n\r\n  for (let i = 0; i < cascade.stages.length; i++) {\r\n    const stage = cascade.stages[i];\r\n    let stageSum = 0;\r\n    for (const weakClassifier of stage.weakClassifiers) {\r\n      const ev = evaluateFeature(\r\n        weakClassifier.feature as HaarFeature,\r\n        satData,\r\n        frameWidth,\r\n        frameHeight,\r\n        mx,\r\n        my,\r\n        scale\r\n      );\r\n\r\n      if (ev * recipArea < weakClassifier.internalNodes[3] * sd) {\r\n        stageSum += weakClassifier.leafValues[0];\r\n      } else {\r\n        stageSum += weakClassifier.leafValues[1];\r\n      }\r\n    }\r\n    if (stageSum < stage.stageThreshold) {\r\n      return i;\r\n    }\r\n  }\r\n  return 1000;\r\n}\r\n\r\nexport function evalAtScale(\r\n  scale: number,\r\n  frameWidth: number,\r\n  frameHeight: number,\r\n  satData: Float32Array[],\r\n  cascade: HaarCascade\r\n): ROIFeature[] {\r\n  // console.log(`work startup time ${new Date().getTime() - s}`);\r\n  const result = [];\r\n  const skipper = Math.max(1, scale * 0.05);\r\n  for (\r\n    let x = XBorder + scale;\r\n    x + scale + XBorder < frameWidth;\r\n    x += skipper\r\n  ) {\r\n    for (\r\n      let y = YBorder + scale;\r\n      y + scale + YBorder < frameHeight;\r\n      y += skipper\r\n    ) {\r\n      const ev = evalHaar(\r\n        satData,\r\n        x,\r\n        y,\r\n        scale,\r\n        frameWidth,\r\n        frameHeight,\r\n        cascade\r\n      );\r\n      // Merging can be done later?\r\n      if (ev > 999) {\r\n        const r = new ROIFeature();\r\n        r.x0 = x - scale;\r\n        r.y0 = y - scale;\r\n        r.x1 = x + scale;\r\n        r.y1 = y + scale;\r\n        let didMerge = false;\r\n\r\n        for (let k = 0; k < result.length; k++) {\r\n          if (result[k].tryMerge(r.x0, r.y0, r.x1, r.y1)) {\r\n            didMerge = true;\r\n            break;\r\n          }\r\n        }\r\n\r\n        if (!didMerge) {\r\n          result.push(r);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  // console.log(`work took ${new Date().getTime() - s}`);\r\n  return result;\r\n}\r\n","import { evalAtScale, ROIFeature } from \"./worker-fns\";\r\n\r\nconst PERF_TEST = false;\r\nlet performance = {\r\n  mark: (arg: string): void => {\r\n    return;\r\n  },\r\n  measure: (arg0: string, arg1: string, arg2: string): void => {\r\n    return;\r\n  },\r\n  now: () => {\r\n    return;\r\n  }\r\n};\r\nif (PERF_TEST) {\r\n  performance = window.performance;\r\n}\r\n\r\ntype FeatureIndex = number;\r\nexport interface HaarWeakClassifier {\r\n  internalNodes: number[];\r\n  leafValues: number[];\r\n  feature: FeatureIndex | HaarFeature;\r\n}\r\n\r\nexport interface HaarStage {\r\n  stageThreshold: number;\r\n  weakClassifiers: HaarWeakClassifier[];\r\n}\r\n\r\nexport interface HaarRect {\r\n  x0: number;\r\n  y0: number;\r\n  x1: number;\r\n  y1: number;\r\n  weight: number;\r\n}\r\n\r\nexport interface HaarFeature {\r\n  rects: HaarRect[];\r\n  tilted: boolean;\r\n}\r\n\r\nexport interface HaarCascade {\r\n  stages: HaarStage[];\r\n  features: HaarFeature[];\r\n}\r\n\r\n/*\r\n// NOTE(jon): We've packed the result of this conversion up so we don't need to load and convert the xml file\r\n//  each time\r\n\r\nfunction convertCascadeXML(source: Document): HaarCascade {\r\n  const result: HaarCascade = {\r\n    features: [],\r\n    stages: []\r\n  };\r\n  const stages = source.getElementsByTagName(\"stages\").item(0);\r\n  const features = source.getElementsByTagName(\"features\").item(0);\r\n\r\n  if (stages == null || features == null) {\r\n    throw new Error(\"Invalid HaarCascade XML Data\");\r\n  }\r\n  const widthElement = source.getElementsByTagName(\"width\")[0];\r\n  const heightElement = source.getElementsByTagName(\"height\")[0];\r\n  const width = widthElement ? Number(widthElement.textContent) : 10;\r\n  const height = heightElement ? Number(heightElement.textContent) : 10;\r\n\r\n  for (\r\n    let featureIndex = 0;\r\n    featureIndex < features.childNodes.length;\r\n    featureIndex++\r\n  ) {\r\n    const currentFeature = features.childNodes[featureIndex] as HTMLElement;\r\n    if (currentFeature.childElementCount === undefined) {\r\n      continue;\r\n    }\r\n\r\n    const feature: HaarFeature = {\r\n      rects: [],\r\n      tilted: false\r\n    };\r\n    if (currentFeature.getElementsByTagName(\"tilted\").length > 0) {\r\n      const tiltedNode = currentFeature.getElementsByTagName(\"tilted\")[0];\r\n      feature.tilted = tiltedNode.textContent == \"1\";\r\n    }\r\n\r\n    const rectsNode = currentFeature.getElementsByTagName(\"rects\")[0];\r\n    for (let i = 0; i < rectsNode.childNodes.length; i++) {\r\n      const cc = rectsNode.childNodes[i];\r\n      if (cc.textContent == null) {\r\n        continue;\r\n      }\r\n      const qq = cc.textContent.trim().split(\" \");\r\n      if (qq.length != 5) {\r\n        continue;\r\n      }\r\n      const halfWidth = width / 2;\r\n      const halfHeight = height / 2;\r\n      const x0 = Number((Number(qq[0]) / halfWidth - 1.0).toFixed(2));\r\n      const x1 = Number((x0 + Number(qq[2]) / halfWidth).toFixed(2));\r\n      const y0 = Number((Number(qq[1]) / halfHeight - 1.0).toFixed(2));\r\n      const y1 = Number((y0 + Number(qq[3]) / halfHeight).toFixed(2));\r\n      feature.rects.push({\r\n        x0,\r\n        x1,\r\n        y0,\r\n        y1,\r\n        weight: Number(qq[4])\r\n      });\r\n    }\r\n    result.features.push(feature);\r\n  }\r\n\r\n  for (\r\n    let stageIndex = 0;\r\n    stageIndex < stages.childNodes.length;\r\n    stageIndex++\r\n  ) {\r\n    const currentStage = stages.childNodes[stageIndex] as HTMLElement;\r\n    if (currentStage.childElementCount === undefined) {\r\n      continue;\r\n    }\r\n    const stage: HaarStage = {\r\n      stageThreshold: 0,\r\n      weakClassifiers: []\r\n    };\r\n\r\n    const stageThresholdNode = currentStage.getElementsByTagName(\r\n      \"stageThreshold\"\r\n    )[0];\r\n    stage.stageThreshold = Number(stageThresholdNode.textContent);\r\n\r\n    const weakClassifiersNode = currentStage.getElementsByTagName(\r\n      \"weakClassifiers\"\r\n    )[0];\r\n    const internalNodesNode = weakClassifiersNode.getElementsByTagName(\r\n      \"internalNodes\"\r\n    );\r\n    const leafValuesNode = weakClassifiersNode.getElementsByTagName(\r\n      \"leafValues\"\r\n    );\r\n    for (let i = 0; i < internalNodesNode.length; i++) {\r\n      const txc1 = internalNodesNode[i].textContent;\r\n      const txc2 = leafValuesNode[i].textContent;\r\n      if (txc1 == null) {\r\n        continue;\r\n      }\r\n      if (txc2 == null) {\r\n        continue;\r\n      }\r\n\r\n      const internalNodes = txc1\r\n        .trim()\r\n        .split(\" \")\r\n        .map(Number);\r\n      const leafValues = txc2\r\n        .trim()\r\n        .split(\" \")\r\n        .map(Number);\r\n      stage.weakClassifiers.push({\r\n        internalNodes,\r\n        leafValues,\r\n        feature: internalNodes[2]\r\n      });\r\n    }\r\n    result.stages.push(stage);\r\n  }\r\n  return result;\r\n}\r\n\r\nexport async function loadFaceRecognitionModel(\r\n  source: string\r\n): Promise<HaarCascade> {\r\n  const modelResponse = await fetch(source);\r\n  const xmlDoc = new DOMParser().parseFromString(\r\n    await modelResponse.text(),\r\n    \"text/xml\"\r\n  );\r\n  return convertCascadeXML(xmlDoc);\r\n}\r\n*/\r\n\r\nexport function scanHaarSerial(\r\n  cascade: HaarCascade,\r\n  satData: Float32Array[],\r\n  frameWidth: number,\r\n  frameHeight: number\r\n): ROIFeature[] {\r\n  //https://stackoverflow.com/questions/41887868/haar-cascade-for-face-detection-xml-file-code-explanation-opencv\r\n  //https://github.com/opencv/opencv/blob/master/modules/objdetect/src/cascadedetect.hpp\r\n  const result = [];\r\n  const scales: number[] = [];\r\n  let scale = 10;\r\n  while (scale < frameHeight / 2) {\r\n    scale *= 1.25;\r\n    scales.push(scale);\r\n  }\r\n  performance.mark(\"ev start\");\r\n\r\n  // We want to try and divide this into workers, roughly the same as the number of hardware threads available:\r\n  // 16,882 passes each\r\n  const results: ROIFeature[][] = [];\r\n  for (const scale of scales) {\r\n    results.push(evalAtScale(scale, frameWidth, frameHeight, satData, cascade));\r\n  }\r\n\r\n  const allResults = results.reduce((acc: ROIFeature[], curr: ROIFeature[]) => {\r\n    acc.push(...curr);\r\n    return acc;\r\n  }, []);\r\n  // Merge all boxes.  I *think* this has the same result as doing this work in serial.\r\n  for (const r of allResults) {\r\n    let didMerge = false;\r\n    for (const mergedResult of result) {\r\n      // seems we get a lot of padding lets try find the smallest box\r\n      // could cause problems if a box contains 2 smaller independent boxes\r\n      if (mergedResult.isContainedBy(r.x0, r.y0, r.x1, r.y1)) {\r\n        didMerge = true;\r\n        break;\r\n      }\r\n\r\n      if (mergedResult.tryMerge(r.x0, r.y0, r.x1, r.y1, r.mergeCount)) {\r\n        didMerge = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!didMerge) {\r\n      const roi = new ROIFeature();\r\n      roi.x0 = r.x0;\r\n      roi.y0 = r.y0;\r\n      roi.x1 = r.x1;\r\n      roi.y1 = r.y1;\r\n      roi.mergeCount = r.mergeCount;\r\n      result.push(roi);\r\n    }\r\n  }\r\n  // Now try to merge the results of each scale.\r\n  performance.mark(\"ev end\");\r\n  performance.measure(`evalHaar: ${scales.length}`, \"ev start\", \"ev end\");\r\n  return result;\r\n}\r\n\r\nexport function buildSAT(\r\n  source: Float32Array,\r\n  width: number,\r\n  height: number,\r\n  thermalReference: ROIFeature\r\n): [Float32Array, Float32Array, Float32Array] {\r\n  if (window) {\r\n    if ((window as any).SharedArrayBuffer === undefined) {\r\n      // Having the array buffers able to be shared across workers should be faster\r\n      // where available.\r\n\r\n      (window as any).SharedArrayBuffer = (window as any).ArrayBuffer as any;\r\n    }\r\n  }\r\n\r\n  let thermalRefTemp = 0;\r\n\r\n  if (thermalReference) {\r\n    thermalReference = thermalReference.extend(5, height, width);\r\n    // get the values on edge and use them to \"black out\" the thermal ref\r\n    let count = 0;\r\n    for (let y = thermalReference.y0; y <= ~~thermalReference.y1; y++) {\r\n      thermalRefTemp += source[y * width + ~~thermalReference.x0];\r\n      thermalRefTemp += source[y * width + ~~thermalReference.x1];\r\n      count += 2;\r\n    }\r\n\r\n    if (count > 0) {\r\n      thermalRefTemp = thermalRefTemp / count;\r\n    }\r\n  }\r\n\r\n  const sizeOfFloat = 4;\r\n  const dest = new Float32Array(\r\n    new SharedArrayBuffer((width + 2) * (height + 3) * sizeOfFloat)\r\n  );\r\n  const destSq = new Float32Array(\r\n    new SharedArrayBuffer((width + 2) * (height + 3) * sizeOfFloat)\r\n  );\r\n  const destTilt = new Float32Array(\r\n    new SharedArrayBuffer((width + 2) * (height + 3) * sizeOfFloat)\r\n  );\r\n  const w2 = width + 2;\r\n  let vMin = source[0];\r\n  let vMax = source[0];\r\n  for (let i = 0; i < width * height; i++) {\r\n    vMin = Math.min(vMin, source[i]);\r\n    vMax = Math.max(vMax, source[i]);\r\n  }\r\n  // repeat top row twice\r\n  for (let y = -2; y <= height; y++) {\r\n    let runningSum = 0;\r\n    let runningSumSq = 0;\r\n    for (let x = -1; x <= width; x++) {\r\n      const indexD = (y + 2) * w2 + x + 1;\r\n      const sourceY = Math.min(Math.max(y, 0), height - 1);\r\n      const sourceX = Math.min(Math.max(x, 0), width - 1);\r\n\r\n      const indexS = sourceY * width + sourceX;\r\n\r\n      let value;\r\n      if (thermalReference && thermalReference.contains(sourceX, sourceY)) {\r\n        value = thermalRefTemp - vMin; //set to min\r\n      } else {\r\n        value = source[indexS] - vMin;\r\n      }\r\n\r\n      runningSum += value;\r\n      runningSumSq += value * value;\r\n\r\n      const prevValue = y > -2 ? dest[indexD - w2] : 0;\r\n      const prevSquared = y > -2 ? destSq[indexD - w2] : 0;\r\n      dest[indexD] = prevValue + runningSum;\r\n      destSq[indexD] = prevSquared + runningSumSq;\r\n      let tiltValue = value;\r\n      let valueAbove = 0;\r\n      if (y > -2) {\r\n        //gp missing something here about the rotated titl values feels\r\n        //like this should +=\r\n        tiltValue -= y >= 0 ? destTilt[indexD - w2 - w2] : 0;\r\n        tiltValue += x > -1 ? destTilt[indexD - w2 - 1] : 0;\r\n        tiltValue += destTilt[indexD - w2 + 1];\r\n        if (\r\n          thermalReference &&\r\n          thermalReference.contains(sourceX, Math.max(sourceY - 1, 0))\r\n        ) {\r\n          valueAbove = value;\r\n        } else {\r\n          valueAbove = y > 0 ? source[indexS - width] : source[indexS];\r\n          valueAbove = valueAbove - vMin;\r\n        }\r\n      }\r\n      tiltValue += valueAbove;\r\n      destTilt[indexD] = tiltValue;\r\n    }\r\n  }\r\n  return [dest, destSq, destTilt];\r\n}\r\n","import { featureLine, FeatureState } from \"./feature-detection\";\r\n//import { threshold, crop, getContourData } from \"./opencv-filters\";\r\nimport { ROIFeature } from \"./worker-fns\";\r\n\r\nexport enum Gradient {\r\n  Decreasing = -1,\r\n  Neutral = 0,\r\n  Increasing = 1\r\n}\r\n\r\nconst MaxFaceAreaPercent = 0.9;\r\n\r\n//the oval has to cover MinFaceOvalCoverage percent of detected edges to be considered a face\r\nconst MinFaceOvalCoverage = 80;\r\n//once an oval differs by CoverageErrorDiff percent from the best coverage\r\n//it is considered a mismatch\r\nconst CoverageErrorDiff = 3;\r\n\r\nconst DEBUG = false;\r\nconst FaceTrackingMaxDelta = 10;\r\nconst ForeheadPercent = 0.28;\r\nconst ForeheadPadding = 2;\r\nconst MaxErrors = 2;\r\nconst MaxWidthDeviationPercent = 1.2;\r\n\r\n// when tracking faces, once we have a std dev less than 3, we are tracking\r\nconst MaxDeviation = 3;\r\n// New Faces mid point cant be greater than this from previous\r\nconst MaxMidDeviation = 10;\r\nconst maxFrameSkip = 6;\r\n\r\nlet FaceID = 1;\r\n\r\n//checks that the shapes dont take more than MaxFaceAreaPercent of the area\r\nfunction validShapes(shapes: Shape[], roi: ROIFeature): boolean {\r\n  const roiArea = roi.width() * roi.height();\r\n\r\n  // If we have lines abutting the top of the haar shape, we definitely don't have a face.\r\n\r\n  for (const shape of shapes) {\r\n    let area = 0;\r\n    let numAbutting = 0;\r\n    let numAbuttingTop = 0;\r\n    for (const feature of Object.values(shape)) {\r\n      if (\r\n        Math.abs(feature.x1 - roi.x1) < 2 ||\r\n        Math.abs(feature.x0 - roi.x0) < 2\r\n      ) {\r\n        if (Math.abs(feature.y0 - roi.y0) < 2) {\r\n          numAbuttingTop++;\r\n        }\r\n        numAbutting++;\r\n      }\r\n      area += feature.width();\r\n    }\r\n    if (numAbuttingTop) {\r\n      if (DEBUG) {\r\n        console.warn(\"top abutting shape\");\r\n      }\r\n      return false;\r\n    }\r\n    if (numAbutting > roi.height() * 0.75) {\r\n      if (DEBUG) {\r\n        console.log(\"probably got ourselves a rectangle\");\r\n      }\r\n      return false;\r\n    }\r\n\r\n    // TODO(jon): Also check that all of the feature edges aren't lined up against the edge of the box...\r\n\r\n    if (area / roiArea > MaxFaceAreaPercent) {\r\n      if (DEBUG) {\r\n        console.log(\"face edges exceed maximum area percent\", area / roiArea);\r\n      }\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\nfunction backgroundTemp(\r\n  source: Float32Array,\r\n  roi: Mat,\r\n  offsetX: number,\r\n  offsetY: number,\r\n  sourceWidth: number,\r\n  max: number\r\n): number {\r\n  let backSum = 0;\r\n  let count = 0;\r\n  let minTemp = -1;\r\n  for (let y = 0; y < roi.rows; y++) {\r\n    for (let x = 0; x < roi.cols; x++) {\r\n      if (roi.data[y * roi.rows + x] == 0) {\r\n        const index = y + offsetY * sourceWidth + x + offsetX;\r\n        const val = source[index];\r\n        if (val < max) {\r\n          backSum += val;\r\n          count += 1;\r\n          if (minTemp == -1 || val < minTemp) {\r\n            minTemp = val;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  if (count == 0) {\r\n    return 0;\r\n  }\r\n\r\n  const avg = backSum / count;\r\n  return (avg + minTemp) / 2.0;\r\n}\r\n\r\ninterface Mat {\r\n  rows: number;\r\n  cols: number;\r\n  data: Float32Array;\r\n}\r\n\r\ntype Shape = Record<number, ROIFeature>;\r\n\r\ninterface Row {\r\n  data32S: [number, number];\r\n}\r\n\r\ninterface Contour {\r\n  rows: number;\r\n  row: (index: number) => Row;\r\n}\r\nexport interface Contours {\r\n  get: (index: number) => Contour;\r\n  size: () => number;\r\n  delete: () => void;\r\n}\r\n//for each independent edge detected, take array of edge coordinates\r\n//and get a set of horizontal lines\r\nexport function shapeData(\r\n  contours: Contours,\r\n  offsetX: number,\r\n  offsetY: number\r\n): Shape[] {\r\n  const shapes = [];\r\n  let line: ROIFeature;\r\n  for (let i = 0; i < contours.size(); ++i) {\r\n    // If there are two lines on the same y axis, remove the shorter one?\r\n\r\n    const faceFeatures: Shape = {};\r\n    const cont = contours.get(i);\r\n\r\n    // NOTE: cont.rows / 4 is how many scanlines the feature takes.\r\n    // We can discard small features.\r\n\r\n    for (let y = 0; y < cont.rows; y++) {\r\n      const row = cont.row(y);\r\n      let [xP, yP] = row.data32S;\r\n      xP += offsetX;\r\n      yP += offsetY;\r\n      if (yP in faceFeatures) {\r\n        line = faceFeatures[yP];\r\n        if (line.x1 == -1) {\r\n          if (line.x0 < xP) {\r\n            line.x1 = xP;\r\n          } else {\r\n            line.x1 = line.x0;\r\n            line.x0 = xP;\r\n          }\r\n        } else if (xP < line.x0) {\r\n          line.x0 = xP;\r\n        } else {\r\n          line.x1 = xP;\r\n        }\r\n      } else {\r\n        const roi = new ROIFeature();\r\n        roi.y0 = yP;\r\n        roi.x0 = xP;\r\n        roi.y1 = yP;\r\n        roi.x1 = -1;\r\n        faceFeatures[yP] = roi;\r\n      }\r\n    }\r\n    shapes.push(faceFeatures);\r\n  }\r\n\r\n  let bestArea = 0;\r\n  let bestShape;\r\n  for (const shape of shapes) {\r\n    const area = Object.values(shape).reduce(\r\n      (acc: number, item: ROIFeature) => {\r\n        acc += item.width();\r\n        return acc;\r\n      },\r\n      0\r\n    );\r\n    if (area > bestArea) {\r\n      bestArea = area as number;\r\n      bestShape = shape;\r\n    }\r\n  }\r\n  return bestShape ? [bestShape] : [];\r\n}\r\n\r\nfunction getSortedKeys(obj: Shape): number[] {\r\n  const keys = Object.keys(obj);\r\n  return keys\r\n    .sort(function(a, b) {\r\n      return Number(a) - Number(b);\r\n    })\r\n    .map(x => Number(x));\r\n}\r\n\r\nexport class Hotspot {\r\n  sensorValue: number;\r\n  sensorX: number;\r\n  sensorY: number;\r\n  constructor() {\r\n    this.sensorValue = 0;\r\n    this.sensorX = 0;\r\n    this.sensorY = 0;\r\n  }\r\n}\r\n\r\nclass Window {\r\n  values: number[];\r\n  savedDeviation: number;\r\n  savedAverage: number;\r\n\r\n  constructor(public size: number) {\r\n    this.values = [];\r\n    this.savedDeviation = -1;\r\n    this.savedAverage = -1;\r\n  }\r\n\r\n  reset() {\r\n    this.savedDeviation = -1;\r\n    this.savedAverage = -1;\r\n  }\r\n  add(value: number) {\r\n    this.reset();\r\n    if (this.values.length < this.size) {\r\n      this.values.push(value);\r\n    } else {\r\n      this.values.shift();\r\n      this.values.push(value);\r\n    }\r\n  }\r\n\r\n  length(): number {\r\n    return this.values.length;\r\n  }\r\n\r\n  deviation(): number {\r\n    if (this.savedAverage == -1) {\r\n      const mean = this.average();\r\n      this.savedDeviation = Math.sqrt(\r\n        this.values.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) /\r\n          this.values.length\r\n      );\r\n    }\r\n    return this.savedDeviation;\r\n  }\r\n  average(): number {\r\n    if (this.savedAverage == -1) {\r\n      this.savedAverage =\r\n        this.values.reduce((a, b) => a + b) / this.values.length;\r\n    }\r\n    return this.savedAverage;\r\n  }\r\n}\r\n\r\nexport class TempStats {\r\n  hotspot: Hotspot;\r\n  foreheadHotspot: Hotspot | null;\r\n  backgroundAvg: number;\r\n  minTemp: number;\r\n  maxTemp: number;\r\n  avgTemp: number;\r\n  count: number;\r\n  constructor() {\r\n    this.backgroundAvg = 0;\r\n    this.foreheadHotspot = null;\r\n    this.hotspot = new Hotspot();\r\n    this.minTemp = 0;\r\n    this.maxTemp = 0;\r\n    this.avgTemp = 0;\r\n    this.count = 0;\r\n  }\r\n  add(value: number, x: number, y: number) {\r\n    if (this.count == 0) {\r\n      this.minTemp = value;\r\n      this.maxTemp = value;\r\n      this.hotspot.sensorValue = value;\r\n      this.hotspot.sensorX = x;\r\n      this.hotspot.sensorY = y;\r\n    } else {\r\n      this.minTemp = Math.min(value, this.minTemp);\r\n      this.maxTemp = Math.max(value, this.maxTemp);\r\n      if (value > this.hotspot.sensorValue) {\r\n        this.hotspot.sensorValue = value;\r\n        this.hotspot.sensorX = x;\r\n        this.hotspot.sensorY = y;\r\n      }\r\n    }\r\n\r\n    this.avgTemp += value;\r\n    this.count += 1;\r\n  }\r\n}\r\n\r\n// measure the change in values over the last 3 values\r\nclass Delta {\r\n  deltas: Window;\r\n  states: Window;\r\n  previous: number;\r\n\r\n  constructor() {\r\n    this.deltas = new Window(3);\r\n    this.states = new Window(3);\r\n    this.previous = 0;\r\n  }\r\n\r\n  add(value: number) {\r\n    this.deltas.add(value - this.previous);\r\n    this.previous = value;\r\n    if (this.increasing()) {\r\n      this.states.add(Gradient.Increasing);\r\n    } else if (this.decreasing()) {\r\n      this.states.add(Gradient.Decreasing);\r\n    } else {\r\n      this.states.add(Gradient.Neutral);\r\n    }\r\n  }\r\n\r\n  decreasingState(): boolean {\r\n    return (\r\n      (this.state() == Gradient.Decreasing &&\r\n        this.previousState() <= Gradient.Neutral) ||\r\n      (this.state() == Gradient.Neutral &&\r\n        this.previousState() == Gradient.Decreasing)\r\n    );\r\n  }\r\n\r\n  increasingState(): boolean {\r\n    return (\r\n      (this.state() == Gradient.Increasing &&\r\n        this.previousState() >= Gradient.Neutral) ||\r\n      (this.state() == Gradient.Neutral &&\r\n        this.previousState() == Gradient.Increasing)\r\n    );\r\n  }\r\n  previousState(): Gradient {\r\n    if (this.states.values.length > 1) {\r\n      return this.states.values[this.states.values.length - 2];\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  state(): Gradient {\r\n    return this.states.values[this.states.values.length - 1];\r\n  }\r\n\r\n  // allow for 1 of the last 2 values to not be increasing i.e. noise\r\n  increasing(): boolean {\r\n    if (this.deltas.values.length < 3) {\r\n      return false;\r\n    }\r\n    return (\r\n      this.deltas.values[2] > 0 &&\r\n      (this.deltas.values[1] > 0 || this.deltas.values[0] > 0)\r\n    );\r\n  }\r\n\r\n  // allow for 1 of the last 2 values to not be decreasing i.e. noise\r\n  decreasing(): boolean {\r\n    if (this.deltas.values.length < 3) {\r\n      return false;\r\n    }\r\n    return (\r\n      this.deltas.values[2] < 0 &&\r\n      (this.deltas.values[1] < 0 || this.deltas.values[0] < 0)\r\n    );\r\n  }\r\n}\r\n\r\nclass Tracking {\r\n  features: ROIFeature[];\r\n  startX: number;\r\n  width: number;\r\n  facePosition: FeatureState;\r\n  stable: boolean;\r\n  widthWindow: Window;\r\n  startWindow: Window;\r\n  medianMid: ROIFeature | null;\r\n  maxWidth: number;\r\n  mismatch: number;\r\n  widthDelta: Delta;\r\n  widthDeviation: number;\r\n  startDeviation: number;\r\n  maxY: number;\r\n  minY: number;\r\n  oval: ROIFeature;\r\n  tempStats: TempStats;\r\n  area: number;\r\n  ovalMatch: number;\r\n  ovalCalcStart: number;\r\n\r\n  constructor() {\r\n    this.area = 0;\r\n    this.maxY = -1;\r\n    this.minY = -1;\r\n    this.facePosition = FeatureState.None;\r\n\r\n    this.widthDelta = new Delta();\r\n    this.maxWidth = 0;\r\n    this.medianMid = null;\r\n    this.features = [];\r\n    this.startX = 0;\r\n    this.mismatch = 0;\r\n    this.width = 0;\r\n    this.stable = false;\r\n    this.widthWindow = new Window(3);\r\n    this.startWindow = new Window(3);\r\n    this.widthDeviation = 0;\r\n    this.startDeviation = 0;\r\n    this.oval = new ROIFeature();\r\n    this.oval.y0 = -1;\r\n    this.ovalCalcStart = -1;\r\n    this.ovalMatch = 0;\r\n    this.tempStats = new TempStats();\r\n  }\r\n\r\n  yLine(): ROIFeature {\r\n    const yFace = featureLine(-1, this.minY);\r\n    yFace.y1 = this.maxY;\r\n    return yFace;\r\n  }\r\n\r\n  addFeature(feature: ROIFeature, source: Float32Array, frameWidth: number) {\r\n    if (this.minY == -1) {\r\n      this.minY = feature.y0;\r\n      this.oval.y0 = feature.y0;\r\n    }\r\n\r\n    this.maxY = feature.y1;\r\n\r\n    this.features.push(feature);\r\n    this.widthWindow.add(feature.width());\r\n    this.startWindow.add(feature.x0);\r\n    this.widthDelta.add(feature.width());\r\n\r\n    if (\r\n      this.features.length > 3 &&\r\n      this.widthWindow.deviation() < MaxDeviation &&\r\n      this.startWindow.deviation() < MaxDeviation\r\n    ) {\r\n      if (this.ovalCalcStart == -1) {\r\n        this.ovalCalcStart = feature.y0;\r\n      }\r\n      this.stable = true;\r\n      this.widthDeviation = this.widthWindow.deviation();\r\n      this.startDeviation = this.startWindow.deviation();\r\n\r\n      this.startX = feature.x0;\r\n      this.width = feature.width();\r\n      this.maxWidth = Math.max(feature.width(), this.maxWidth);\r\n    }\r\n    if (this.stable) {\r\n      this.area += feature.width();\r\n    }\r\n\r\n    if (\r\n      this.facePosition == FeatureState.Top &&\r\n      this.widthDelta.decreasingState()\r\n    ) {\r\n      this.facePosition = FeatureState.Bottom;\r\n    } else if (\r\n      this.facePosition == FeatureState.None &&\r\n      this.widthDelta.increasingState()\r\n    ) {\r\n      this.facePosition = FeatureState.Top;\r\n    }\r\n    if (\r\n      // once face stops increasing lets set a mid point\r\n      (this.medianMid == null && this.widthDelta.decreasingState()) ||\r\n      (this.widthDelta.state() == Gradient.Neutral && this.count() > 8)\r\n    ) {\r\n      if (!this.medianMid || feature.width() > this.medianMid.width()) {\r\n        this.medianMid = feature;\r\n        this.oval.x0 = this.medianMid.x0;\r\n        this.oval.x1 = this.medianMid.x1;\r\n      }\r\n    }\r\n\r\n    const y = ~~feature.y0 * frameWidth;\r\n    for (let x = ~~feature.x0; x < feature.x1; x++) {\r\n      this.tempStats.add(source[y + x], x, feature.y0);\r\n    }\r\n  }\r\n\r\n  // grow an oval inside the face until it doesn't fit\r\n  matchOval(y: number): boolean {\r\n    if (this.ovalCalcStart == -1) {\r\n      return true;\r\n    }\r\n    this.oval.y1 = y;\r\n    const h = this.oval.midX();\r\n    const k = this.oval.midY();\r\n    const a = Math.pow(this.oval.width() / 2.0, 2);\r\n    const b = Math.pow(this.oval.height() / 2.0, 2);\r\n    let percentCover = 0;\r\n    for (\r\n      let i = this.ovalCalcStart - this.minY;\r\n      i < this.features.length;\r\n      i++\r\n    ) {\r\n      const r = this.features[i];\r\n      //x location of oval edge at at r.y0\r\n      const xDiff = Math.sqrt(a * (1 - Math.pow(r.y0 - k, 2) / b));\r\n      const x0 = h - xDiff;\r\n      const x1 = h + xDiff;\r\n      const areaCovered = Math.min(x1, r.x1) - Math.max(x0, r.x0);\r\n      if (areaCovered > 0) {\r\n        percentCover += areaCovered;\r\n      }\r\n    }\r\n\r\n    const cover = ~~((100 * percentCover) / this.area);\r\n    this.ovalMatch = Math.max(cover, this.ovalMatch);\r\n\r\n    if (this.ovalMatch - cover > CoverageErrorDiff) {\r\n      // once we decrease we have found our optimum\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  // compares this feature to what we have learnt so far, and decides if it fits within a normal deviation of\r\n  // mid point, maximum width, expected width, expected start x, doesn't increase in width after decreasing (i.e shoulders)\r\n  matched(feature: ROIFeature): boolean {\r\n    if (this.medianMid) {\r\n      if (!this.matchOval(feature.y1) && this.ovalMatch > 90) {\r\n        this.mismatch++;\r\n        if (DEBUG) {\r\n          console.log(\"oval coverage worsened best cover - \", this.ovalMatch);\r\n        }\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  lastFeature(): ROIFeature {\r\n    return this.features[this.features.length - 1];\r\n  }\r\n\r\n  count(): number {\r\n    return this.features.length;\r\n  }\r\n}\r\nexport class Face {\r\n  numFrames: number;\r\n  framesMissing: number;\r\n  id: number;\r\n  roi: ROIFeature | null;\r\n  forehead: ROIFeature | null;\r\n  haarAge: number;\r\n  haarLastSeen: number;\r\n  xFeatures: ROIFeature[];\r\n  widthWindow: Window;\r\n  frontOnRatio: number;\r\n  foreheadX: number;\r\n  foreheadY: number;\r\n  heightWindow: Window;\r\n  faceWidth: number;\r\n  faceHeight: number;\r\n  heatStats: TempStats;\r\n  constructor(public haarFace: ROIFeature, public frameTime: number) {\r\n    this.roi = null;\r\n    this.forehead = null;\r\n    this.id = 0;\r\n    this.framesMissing = 0;\r\n    this.haarAge = 1;\r\n    this.haarLastSeen = 0;\r\n    this.heatStats = new TempStats();\r\n    this.numFrames = 0;\r\n    this.widthWindow = new Window(3);\r\n    this.heightWindow = new Window(3);\r\n    this.faceWidth = 0;\r\n    this.faceHeight = 0;\r\n    this.frontOnRatio = 0;\r\n    this.foreheadX = 0;\r\n    this.foreheadY = 0;\r\n    //debugging\r\n    this.xFeatures = [];\r\n    this.assignID();\r\n  }\r\n\r\n  hasMovedOrChangedInSize(oldFace: ROIFeature): boolean {\r\n    const movement = this.roi!.midDiff(oldFace);\r\n    const oldArea = oldFace.width() * oldFace.height();\r\n    const newArea = this.width() * this.height();\r\n    const areaChange = Math.abs(oldArea - newArea);\r\n    console.log(movement, areaChange);\r\n    return movement > 3 || areaChange > 40;\r\n  }\r\n\r\n  get isFrontOn(): boolean {\r\n    return this.frontOnRatio < 0.02;\r\n  }\r\n\r\n  get frontOnPercentage(): string {\r\n    return (100 * (1 - this.frontOnRatio)).toFixed(2);\r\n  }\r\n  // TODO(jon): Inspect the logic around updateHaar and haarActive.\r\n  //  Seems like haarLastSeen is maybe redundant\r\n  updateHaar(haar: ROIFeature) {\r\n    //this.haarFace = haar;\r\n    this.haarFace.x0 = haar.x0;\r\n    this.haarFace.x1 = haar.x1;\r\n    // if (\r\n    //   Math.abs(this.haarFace.y0 - haar.y0) < 5 &&\r\n    //   Math.abs(this.haarFace.y0 - haar.y0) < 5\r\n    // ) {\r\n    //   this.haarFace.y0 = haar.y0;\r\n    //   this.haarFace.y1 = haar.y1;\r\n    // }\r\n\r\n    // Don't allow too much jittering in y\r\n    if (this.haarFace.y0 - haar.y0 === Math.abs(this.haarFace.y0 - haar.y0)) {\r\n      // moving down\r\n      this.haarFace.y0 -= Math.min(Math.abs(this.haarFace.y0 - haar.y0), 2);\r\n      this.haarFace.y1 -= Math.min(Math.abs(this.haarFace.y1 - haar.y1), 2);\r\n    } else {\r\n      this.haarFace.y0 += Math.min(Math.abs(this.haarFace.y0 - haar.y0), 2);\r\n      this.haarFace.y1 += Math.min(Math.abs(this.haarFace.y1 - haar.y1), 2);\r\n    }\r\n    this.haarAge++;\r\n    this.haarLastSeen = this.numFrames + 1;\r\n  }\r\n\r\n  haarActive(): boolean {\r\n    return this.haarAge === 1 || this.haarLastSeen == this.numFrames;\r\n  }\r\n\r\n  tracked(): boolean {\r\n    return this.roi != null && this.forehead != null;\r\n  }\r\n\r\n  assignID() {\r\n    this.id = FaceID;\r\n    FaceID++;\r\n  }\r\n\r\n  height(): number {\r\n    if (this.roi) {\r\n      return this.roi.height();\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  width(): number {\r\n    if (this.roi) {\r\n      return this.roi.width();\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  active(): boolean {\r\n    return this.framesMissing < maxFrameSkip;\r\n  }\r\n\r\n  clear() {\r\n    this.forehead = null;\r\n    this.roi = null;\r\n    this.heatStats.foreheadHotspot = null;\r\n    this.framesMissing++;\r\n  }\r\n\r\n  update(forehead: ROIFeature, roi: ROIFeature) {\r\n    this.forehead = forehead;\r\n    this.roi = roi;\r\n    this.framesMissing = 0;\r\n\r\n    // give a rolling average of face width\r\n    this.widthWindow.add(roi.width());\r\n    this.heightWindow.add(roi.height());\r\n    if (\r\n      this.widthWindow.length() >= 3 &&\r\n      this.widthWindow.deviation() < MaxDeviation &&\r\n      this.heightWindow.deviation() < MaxDeviation\r\n    ) {\r\n      this.faceWidth = this.widthWindow.average();\r\n      this.faceHeight = this.heightWindow.average();\r\n    }\r\n  }\r\n\r\n  matchesPrevious(oval: ROIFeature): boolean {\r\n    if (!this.roi) {\r\n      return true;\r\n    }\r\n    if (this.roi.midDiff(oval) > MaxMidDeviation) {\r\n      return false;\r\n    }\r\n    if (\r\n      this.faceWidth != 0 &&\r\n      this.faceHeight != 0 &&\r\n      (oval.width() > this.faceWidth * MaxWidthDeviationPercent ||\r\n        oval.height() > this.faceHeight * MaxWidthDeviationPercent)\r\n    ) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  findFace(\r\n    shapes: Shape[],\r\n    source: Float32Array,\r\n    frameWidth: number\r\n  ): [ROIFeature | null, TempStats | null] {\r\n    let bestScore = -1;\r\n    let bestOval: ROIFeature | null = null;\r\n    let heatStats: TempStats | null = null;\r\n    for (const shape of shapes) {\r\n      const keys = getSortedKeys(shape);\r\n      const xTracking = new Tracking();\r\n      let longestLine: ROIFeature | null = null;\r\n\r\n      for (const key of keys) {\r\n        if (xTracking.mismatch >= MaxErrors) {\r\n          break;\r\n        }\r\n        const faceX = shape[key];\r\n        const matched = xTracking.matched(faceX);\r\n        if (!matched) {\r\n          continue;\r\n        }\r\n        xTracking.addFeature(faceX, source, frameWidth);\r\n        if (faceX.wider(longestLine)) {\r\n          longestLine = faceX;\r\n        }\r\n      }\r\n\r\n      // TODO(jon): Improve where we are getting the oval\r\n\r\n      if (\r\n        xTracking.ovalMatch > bestScore &&\r\n        xTracking.ovalMatch > MinFaceOvalCoverage &&\r\n        xTracking.features.length >= 4\r\n      ) {\r\n        const oval = xTracking.oval;\r\n        if (!this.matchesPrevious(oval)) {\r\n          if (DEBUG) {\r\n            console.log(\"New oval differs too much in width/height/midpoint\");\r\n          }\r\n\r\n          // NOTE(jon): Don't let the face get to long.  Could also have a max face width/height ratio that we cap face length at?\r\n          if (this.roi) {\r\n            if (\r\n              Math.abs(oval.midY() - this.roi!.midY()) >\r\n              this.roi.height() * 0.1\r\n            ) {\r\n              if (DEBUG) {\r\n                console.log(\"height changed to much, using last height\");\r\n              }\r\n              oval.y1 = this.roi!.y1;\r\n            }\r\n            if (\r\n              Math.abs(oval.midX() - this.roi!.midX()) >\r\n              this.roi.width() * 0.8\r\n            ) {\r\n              if (DEBUG) {\r\n                console.log(\"Too much movement on X, aborting tracking\");\r\n              }\r\n              return [null, null];\r\n            }\r\n          }\r\n        }\r\n        bestOval = oval;\r\n        bestScore = xTracking.ovalMatch;\r\n        heatStats = xTracking.tempStats;\r\n      }\r\n    }\r\n    return [bestOval, heatStats];\r\n  }\r\n\r\n  trackFace(\r\n    source: Float32Array,\r\n    values: Float32Array,\r\n    thermalRef: ROIFeature | null,\r\n    frameWidth: number,\r\n    frameHeight: number\r\n  ): void {\r\n    this.xFeatures = [];\r\n    this.numFrames += 1;\r\n    if (!this.tracked()) {\r\n      this.framesMissing++;\r\n    }\r\n    this.detectForehead(\r\n      this.haarFace,\r\n      source,\r\n      values,\r\n      thermalRef,\r\n      frameWidth,\r\n      frameHeight\r\n    );\r\n  }\r\n\r\n  setForeheadHotspot(source: Float32Array, frameWidth: number) {\r\n    const r = this.forehead;\r\n    if (!r) {\r\n      this.heatStats.foreheadHotspot = null;\r\n      return;\r\n    }\r\n    const hotspot = new Hotspot();\r\n    hotspot.sensorValue = 0;\r\n    for (let y = ~~r.y0; y < ~~r.y1; y++) {\r\n      for (let x = ~~r.x0; x < ~~r.x1; x++) {\r\n        const index = y * frameWidth + x;\r\n        const current = source[index];\r\n        if (hotspot.sensorValue < current) {\r\n          hotspot.sensorValue = current;\r\n          hotspot.sensorX = x;\r\n          hotspot.sensorY = y;\r\n        }\r\n      }\r\n    }\r\n    this.heatStats.foreheadHotspot = hotspot;\r\n  }\r\n\r\n  // scan the haar detected rectangle along y axis, to find range of x values,\r\n  // then along the x axis to find the range of y values\r\n  // choose the biggest x and y value to define xRad and yRad of the head\r\n  detectForehead(\r\n    roi: ROIFeature,\r\n    source: Float32Array,\r\n    values: Float32Array,\r\n    thermalRef: ROIFeature | null,\r\n    frameWidth: number,\r\n    frameHeight: number\r\n  ): void {\r\n    roi = roi.wholeValues();\r\n    // let roiCrop = crop(source, frameHeight, frameWidth, roi);\r\n    // roiCrop = threshold(roiCrop, roi, thermalRef);\r\n    // const contours = (getContourData(roiCrop) as unknown) as Contours;\r\n    const shapes: Shape[] = []; //shapeData(contours, roi.x0, roi.y0);\r\n    //contours.delete();\r\n\r\n    //TODO(jon): What if some shapes are valid and others aren't?\r\n    // Why do we need this?  Seems to mostly filter out synthetic cases where areas are square\r\n    // after a face disappears from one frame to the next?  Can this fail on square heads?\r\n\r\n    const valid = validShapes(shapes, roi);\r\n    if (!valid) {\r\n      this.clear();\r\n      return;\r\n    }\r\n    const [oval, heatStats] = this.findFace(shapes, source, frameWidth);\r\n    this.xFeatures = [];\r\n    for (const shape of shapes) {\r\n      this.xFeatures.push(...Object.values(shape));\r\n    }\r\n    // if (oval && heatStats) {\r\n    //   // NOTE(jon): We never use backgroundAvg for anything, it's just for debug purposes?\r\n    //   heatStats.backgroundAvg = backgroundTemp(\r\n    //     source,\r\n    //     roiCrop,\r\n    //     roi.x0,\r\n    //     roi.y0,\r\n    //     frameWidth,\r\n    //     heatStats.minTemp\r\n    //   );\r\n    // }\r\n    // roiCrop.delete();\r\n    if (!oval) {\r\n      if (DEBUG) {\r\n        console.log(\r\n          \"lost oval, maybe we should try using the one from the last frame?\"\r\n        );\r\n      }\r\n      this.clear();\r\n      return;\r\n    }\r\n\r\n    // Recenter oval onto xFeatures center of mass.\r\n    let centerX = 0;\r\n    let num = 0;\r\n\r\n    // TODO(jon): Should we clamp the x0,x1 values of the features to the bounds of the oval?\r\n\r\n    const featuresInOval = this.xFeatures.filter(\r\n      feature => feature.y0 >= oval.y0 && feature.y1 <= oval.y1\r\n    );\r\n    for (const feature of featuresInOval) {\r\n      if (feature.y0 >= oval.y0 && feature.y1 <= oval.y1) {\r\n        centerX += feature.midX();\r\n        num++;\r\n      }\r\n    }\r\n    centerX = centerX / num;\r\n    const halfWidth = oval.width() / 2;\r\n    oval.x0 = centerX - halfWidth;\r\n    oval.x1 = centerX + halfWidth;\r\n\r\n    // Now guess if the face is front-on, based on the symmetry of the xFeatures around the centerX.\r\n    // Evaluate the features up until the point where they flare out and don't go back in.\r\n\r\n    // TODO(jon): Maybe just consider the symmetry *below* the forehead box.\r\n    let leftSum = 0;\r\n    let rightSum = 0;\r\n    for (const feature of featuresInOval) {\r\n      if (feature.x0 < centerX) {\r\n        leftSum += Math.min(feature.x1, centerX) - feature.x0;\r\n      }\r\n      if (feature.x1 >= centerX) {\r\n        rightSum += feature.x1 - Math.max(feature.x0, centerX);\r\n      }\r\n    }\r\n    // Ratio or percent difference between left and right weights can indicate how front-on the face is.\r\n    this.frontOnRatio = Math.abs(1.0 - leftSum / rightSum);\r\n\r\n    // If we have a bunch of features abutting the edge on one side of the bottom, but not the other, we're also\r\n    // probably not front-on.\r\n\r\n    // Take the last six scanlines or so.  Might need to scale this based on the size of the face box.\r\n    let unevenEdges = 0;\r\n    for (const feature of featuresInOval.filter(\r\n      feature => Math.abs(feature.y1 - oval.y1) <= 10\r\n    )) {\r\n      const dX0 = Math.abs(Math.max(feature.x0, oval.x0) - oval.x0);\r\n      const dX1 = Math.abs(Math.min(feature.x1, oval.x1) - oval.x1);\r\n      if ((dX0 < 2 && dX1 >= 2) || (dX1 < 2 && dX0 >= 2)) {\r\n        unevenEdges++;\r\n      }\r\n    }\r\n    if (unevenEdges > 7) {\r\n      this.frontOnRatio = 1;\r\n      if (DEBUG) {\r\n        console.log(\"uneven edges\", unevenEdges);\r\n      }\r\n    }\r\n\r\n    const detectedROI = oval;\r\n    const forehead = new ROIFeature();\r\n    forehead.y0 = detectedROI.y0 - ForeheadPadding;\r\n    forehead.y1 =\r\n      forehead.y0 + detectedROI.height() * ForeheadPercent + ForeheadPadding;\r\n    forehead.x0 = detectedROI.x0 - ForeheadPadding;\r\n    forehead.x1 = detectedROI.x1 + ForeheadPadding;\r\n    this.update(forehead, detectedROI);\r\n\r\n    // Get the features in the forehead box.\r\n    // Weight them to either side of the center of the roi.\r\n    const featuresInForehead = this.xFeatures.filter(\r\n      feature => feature.y1 < forehead.y1\r\n    );\r\n    centerX = 0;\r\n    num = 0;\r\n    for (const feature of featuresInForehead) {\r\n      centerX += feature.midX();\r\n      num++;\r\n    }\r\n    this.foreheadX = centerX / num;\r\n    this.foreheadY = forehead.y1 - 2;\r\n    //console.log(\"foreheadX\", centerX);\r\n\r\n    if (heatStats) {\r\n      // NOTE(jon): heatStats are just for debugging purposes, not functional.\r\n      this.heatStats = heatStats;\r\n      if (this.heatStats.count > 0) {\r\n        this.heatStats.avgTemp /= this.heatStats.count;\r\n      }\r\n    }\r\n    //this.setForeheadHotspot(source, frameWidth);\r\n    this.heatStats.foreheadHotspot = new Hotspot();\r\n    this.heatStats.foreheadHotspot.sensorX = this.foreheadX;\r\n    this.heatStats.foreheadHotspot.sensorY = this.foreheadY;\r\n    // NOTE(jon): Get the hotspot from the median-smoothed data, not the radial smoothed data.\r\n    this.heatStats.foreheadHotspot.sensorValue =\r\n      values[~~this.foreheadY * frameWidth + ~~this.foreheadX];\r\n    if (DEBUG) {\r\n      console.log(\"Face\", detectedROI, heatStats);\r\n    }\r\n  }\r\n}\r\n","import {\r\n  circleDetect,\r\n  circleDetectRadius,\r\n  edgeDetect\r\n} from \"./circle-detection\";\r\nimport { buildSAT, HaarCascade, scanHaarSerial } from \"./haar-cascade\";\r\nimport { Face } from \"./face\";\r\nimport { FrameInfo } from \"./api/types\";\r\nimport { ROIFeature } from \"./worker-fns\";\r\n\r\nconst PERF_TEST = false;\r\nlet performance = {\r\n  mark: (arg: string): void => {\r\n    return;\r\n  },\r\n  measure: (arg0: string, arg1: string, arg2: string): void => {\r\n    return;\r\n  },\r\n  now: () => {\r\n    return;\r\n  }\r\n};\r\nif (PERF_TEST) {\r\n  performance = window.performance;\r\n}\r\n\r\nexport const MinFaceAge = 2;\r\nexport enum FeatureState {\r\n  LeftEdge,\r\n  RightEdge,\r\n  TopEdge,\r\n  BottomEdge,\r\n  Inside,\r\n  Outside,\r\n  None,\r\n  Top,\r\n  Bottom\r\n}\r\n\r\nexport function euclDistance(\r\n  x: number,\r\n  y: number,\r\n  x2: number,\r\n  y2: number\r\n): number {\r\n  return Math.sqrt(Math.pow(x - x2, 2) + Math.pow(y - y2, 2));\r\n}\r\n\r\nexport class Rect {\r\n  constructor(\r\n    public x0: number,\r\n    public x1: number,\r\n    public y0: number,\r\n    public y1: number\r\n  ) {}\r\n}\r\n//\r\n// export class ROIFeature {\r\n//   constructor() {\r\n//     this.x0 = 0;\r\n//     this.y0 = 0;\r\n//     this.x1 = 0;\r\n//     this.y1 = 0;\r\n//     this.mergeCount = 1;\r\n//     this.sensorMissing = 0;\r\n//     this.sensorValue = 0;\r\n//     this.sensorX = 0;\r\n//     this.sensorY = 0;\r\n//   }\r\n//\r\n//   wholeValues() {\r\n//     const roundedRoi = new ROIFeature();\r\n//     roundedRoi.x0 = ~~this.x0;\r\n//     roundedRoi.x1 = ~~this.x1;\r\n//     roundedRoi.y0 = ~~this.y0;\r\n//     roundedRoi.y1 = ~~this.y1;\r\n//     return roundedRoi;\r\n//   }\r\n//   extend(value: number, maxWidth: number, maxHeight: number): ROIFeature {\r\n//     const roi = new ROIFeature();\r\n//     roi.x0 = Math.max(0, this.x0 - value);\r\n//     roi.x1 = Math.min(maxWidth, this.x1 + value);\r\n//     roi.y0 = Math.max(0, this.y0 - value);\r\n//     roi.y1 = Math.min(maxHeight, this.y1 + value);\r\n//     return roi;\r\n//   }\r\n//\r\n//   wider(other: ROIFeature | null | undefined): boolean {\r\n//     return !other || this.width() > other.width();\r\n//   }\r\n//\r\n//   higher(other: ROIFeature | null | undefined): boolean {\r\n//     return !other || this.height() > other.height();\r\n//   }\r\n//\r\n//   hasXValues() {\r\n//     return this.x0 != -1 && this.x1 != -1;\r\n//   }\r\n//\r\n//   hasYValues() {\r\n//     return this.y0 != -1 && this.y1 != -1;\r\n//   }\r\n//\r\n//   midX() {\r\n//     return (this.x0 + this.x1) / 2;\r\n//   }\r\n//   midY() {\r\n//     return (this.y0 + this.y1) / 2;\r\n//   }\r\n//\r\n//   width() {\r\n//     return this.x1 - this.x0;\r\n//   }\r\n//\r\n//   height() {\r\n//     return this.y1 - this.y0;\r\n//   }\r\n//\r\n//   midDiff(other: ROIFeature): number {\r\n//     return euclDistance(this.midX(), this.midY(), other.midX(), other.midY());\r\n//   }\r\n//\r\n//   overlapsROI(other: ROIFeature): boolean {\r\n//     return this.overlap(other.x0, other.y0, other.x1, other.y1);\r\n//   }\r\n//\r\n//   overlap(x0: number, y0: number, x1: number, y1: number) {\r\n//     if (x1 <= this.x0) {\r\n//       return false;\r\n//     }\r\n//     if (y1 <= this.y0) {\r\n//       return false;\r\n//     }\r\n//     if (this.x1 <= x0) {\r\n//       return false;\r\n//     }\r\n//     if (this.y1 <= y0) {\r\n//       return false;\r\n//     }\r\n//     return true;\r\n//   }\r\n//\r\n//   contains(x: number, y: number) {\r\n//     if (x <= this.x0) {\r\n//       return false;\r\n//     }\r\n//     if (y <= this.y0) {\r\n//       return false;\r\n//     }\r\n//     if (this.x1 < x) {\r\n//       return false;\r\n//     }\r\n//     if (this.y1 < y) {\r\n//       return false;\r\n//     }\r\n//     return true;\r\n//   }\r\n//\r\n//   // checks if this roi fits completely inside a sqaure (x0,y0) - (x1,y1)\r\n//   isContainedBy(x0: number, y0: number, x1: number, y1: number): boolean {\r\n//     if (this.x0 > x0 && this.x1 < x1 && this.y0 > y0 && this.y1 < y1) {\r\n//       return true;\r\n//     }\r\n//     return false;\r\n//   }\r\n//\r\n//   tryMerge(x0: number, y0: number, x1: number, y1: number, mergeCount = 1) {\r\n//     if (!this.overlap(x0, y0, x1, y1)) {\r\n//       return false;\r\n//     }\r\n//     const newMerge = mergeCount + this.mergeCount;\r\n//     this.x0 = (this.x0 * this.mergeCount + x0 * mergeCount) / newMerge;\r\n//     this.y0 = (this.y0 * this.mergeCount + y0 * mergeCount) / newMerge;\r\n//     this.x1 = (this.x1 * this.mergeCount + x1 * mergeCount) / newMerge;\r\n//     this.y1 = (this.y1 * this.mergeCount + y1 * mergeCount) / newMerge;\r\n//     this.mergeCount = newMerge;\r\n//     return true;\r\n//   }\r\n//\r\n//   x0: number;\r\n//   y0: number;\r\n//   x1: number;\r\n//   y1: number;\r\n//   mergeCount: number;\r\n//   sensorValue: number;\r\n//   sensorMissing: number;\r\n//   sensorX: number;\r\n//   sensorY: number;\r\n// }\r\n\r\nfunction circleStillPresent(\r\n  r: ROIFeature,\r\n  saltPepperData: Float32Array,\r\n  edgeData: Float32Array,\r\n  frameWidth: number,\r\n  frameHeight: number\r\n) {\r\n  const width = frameWidth;\r\n  const height = frameHeight;\r\n  const dest = new Float32Array(width * height);\r\n  const radius = r.width() * 0.5;\r\n  const [value, cx, cy] = circleDetectRadius(\r\n    edgeData,\r\n    dest,\r\n    radius,\r\n    width,\r\n    height,\r\n    r.midX() - radius * 2,\r\n    r.midY() - radius * 2,\r\n    r.midX() + radius * 2,\r\n    r.midY() + radius * 2\r\n  );\r\n  if (!r.contains(cx, cy)) {\r\n    r.sensorMissing = Math.max(r.sensorMissing - 1, 0);\r\n    return r.sensorMissing > 0;\r\n  }\r\n  r.sensorMissing = Math.min(r.sensorMissing + 1, 20);\r\n  return true;\r\n}\r\n\r\nexport function detectThermalReference(\r\n  saltPepperData: Float32Array,\r\n  smoothedData: Float32Array,\r\n  previousThermalReference: ROIFeature | null,\r\n  frameWidth: number,\r\n  frameHeight: number\r\n): ROIFeature | null {\r\n  performance.mark(\"ed start\");\r\n  const edgeData = edgeDetect(smoothedData, frameWidth, frameHeight);\r\n  performance.mark(\"ed end\");\r\n  performance.measure(\"edge detection\", \"ed start\", \"ed end\");\r\n\r\n  performance.mark(\"cd start\");\r\n  if (\r\n    previousThermalReference &&\r\n    circleStillPresent(\r\n      previousThermalReference,\r\n      saltPepperData,\r\n      edgeData,\r\n      frameWidth,\r\n      frameHeight\r\n    )\r\n  ) {\r\n    return previousThermalReference;\r\n  }\r\n\r\n  const [bestRadius, bestX, bestY] = circleDetect(\r\n    edgeData,\r\n    frameWidth,\r\n    frameHeight\r\n  );\r\n\r\n  if (bestRadius <= 0) {\r\n    return null;\r\n  }\r\n  const r = new ROIFeature();\r\n  r.x0 = bestX - bestRadius;\r\n  r.y0 = bestY - bestRadius;\r\n  r.x1 = bestX + bestRadius;\r\n  r.y1 = bestY + bestRadius;\r\n  performance.mark(\"cd end\");\r\n  performance.measure(\"circle detection\", \"cd start\", \"cd end\");\r\n  return r;\r\n}\r\n\r\nexport function featureLine(x: number, y: number): ROIFeature {\r\n  const line = new ROIFeature();\r\n  line.y0 = y;\r\n  line.y1 = y;\r\n  line.x0 = x;\r\n  line.x1 = x;\r\n  return line;\r\n}\r\n\r\nexport function findFacesInFrameSync(\r\n  smoothedData: Float32Array,\r\n  saltPepperData: Float32Array,\r\n  frameWidth: number,\r\n  frameHeight: number,\r\n  model: HaarCascade,\r\n  existingFaces: Face[],\r\n  thermalReference: ROIFeature,\r\n  info: FrameInfo\r\n) {\r\n  // Now extract the faces(s), and their hotspots.\r\n  performance.mark(\"buildSat start\");\r\n  const satData = buildSAT(\r\n    smoothedData,\r\n    frameWidth,\r\n    frameHeight,\r\n    thermalReference\r\n  );\r\n  performance.mark(\"buildSat end\");\r\n  performance.measure(\"build SAT\", \"buildSat start\", \"buildSat end\");\r\n  performance.mark(\"scanHaar\");\r\n  const faceBoxes = scanHaarSerial(model, satData, frameWidth, frameHeight);\r\n  performance.mark(\"scanHaar end\");\r\n  performance.measure(\"scanHaarParallel\", \"scanHaar\", \"scanHaar end\");\r\n\r\n  performance.mark(\"track faces\");\r\n\r\n  // TODO(jon): May want to loop through this a few times until is stabilises.\r\n  const newFaces: Face[] = [];\r\n  for (const haarFace of faceBoxes) {\r\n    const existingFace = existingFaces.find(face =>\r\n      haarFace.overlapsROI(face.haarFace)\r\n    );\r\n\r\n    if (existingFace) {\r\n      existingFace.updateHaar(haarFace);\r\n    } else {\r\n      const face = new Face(haarFace, 0);\r\n      face.trackFace(\r\n        smoothedData,\r\n        saltPepperData,\r\n        thermalReference,\r\n        frameWidth,\r\n        frameHeight\r\n      );\r\n      newFaces.push(face);\r\n    }\r\n  }\r\n  // track faces from last frame\r\n  for (const face of existingFaces) {\r\n    face.trackFace(\r\n      smoothedData,\r\n      saltPepperData,\r\n      thermalReference,\r\n      frameWidth,\r\n      frameHeight\r\n    );\r\n    //console.log(face.id, face.haarActive());\r\n    //console.assert(face.haarActive(), info.Telemetry.FrameCount);\r\n    if (face.active()) {\r\n      // If the haar age is less than 10 frames, and\r\n      if (face.haarAge < MinFaceAge && !face.haarActive()) {\r\n        console.log(\"dropping face\", face.id);\r\n        continue;\r\n      }\r\n      newFaces.push(face);\r\n    }\r\n  }\r\n  performance.mark(\"track faces end\");\r\n  performance.measure(\"track faces\", \"track faces\", \"track faces end\");\r\n  return newFaces;\r\n}\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.hasFakeThermalCamera)?_c('div',[_c('label',[_vm._v(\" Cptv files: \"),_c('v-select',{attrs:{\"items\":_vm.cptvFiles},on:{\"change\":_vm.selectAndPlayVideo},model:{value:(_vm.selectedFile),callback:function ($$v) {_vm.selectedFile=$$v},expression:\"selectedFile\"}})],1),_c('label',[_vm._v(\" Repeat: \"),_c('v-text-field',{attrs:{\"type\":\"number\"},model:{value:(_vm.repeatCount),callback:function ($$v) {_vm.repeatCount=$$v},expression:\"repeatCount\"}})],1),_c('v-btn',{attrs:{\"disabled\":!_vm.hasFiles},on:{\"click\":function($event){return _vm.togglePlayback()}}},[_vm._v(\" \"+_vm._s(_vm.paused ? \"Play\" : \"Pause\")+\" \")]),_c('v-btn',{on:{\"click\":function($event){return _vm.listFiles()}}},[_vm._v(\"Refresh files\")])],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport { Component, Emit, Prop, Vue } from \"vue-property-decorator\";\r\nimport { FakeThermalCameraApi } from \"@/api/api\";\r\n\r\n@Component\r\nexport default class FakeThermalCameraControls extends Vue {\r\n  @Prop() public paused!: boolean;\r\n  @Prop() public playingLocal!: boolean;\r\n  private hasFakeThermalCamera = false;\r\n  private cptvFiles: string[] = [];\r\n  private selectedFile = \"\";\r\n  private repeatCount = 10;\r\n  private currentPlayingFile = \"\";\r\n\r\n  get hasFiles(): boolean {\r\n    return this.cptvFiles.length !== 0 && this.selectedFile !== \"\";\r\n  }\r\n\r\n  async beforeMount() {\r\n    try {\r\n      this.hasFakeThermalCamera = await FakeThermalCameraApi.isFakeThermalCamera();\r\n    } catch (e) {\r\n      this.hasFakeThermalCamera = false;\r\n    }\r\n    if (this.hasFakeThermalCamera) {\r\n      await FakeThermalCameraApi.stopPlayback();\r\n      await this.listFiles();\r\n    }\r\n  }\r\n\r\n  @Emit(\"toggle-playback\")\r\n  async selectAndPlayVideo() {\r\n    this.currentPlayingFile = this.selectedFile;\r\n    if (!this.playingLocal) {\r\n      return !(await FakeThermalCameraApi.playbackCptvFile(\r\n        this.selectedFile,\r\n        this.repeatCount\r\n      ));\r\n    } else {\r\n      return !this.paused;\r\n    }\r\n  }\r\n\r\n  @Emit()\r\n  async togglePlayback() {\r\n    if (!this.currentPlayingFile) {\r\n      return this.selectAndPlayVideo();\r\n    }\r\n    if (!this.playingLocal) {\r\n      if (!this.paused) {\r\n        return await FakeThermalCameraApi.pausePlayback();\r\n      } else {\r\n        return !(await FakeThermalCameraApi.resumePlayback());\r\n      }\r\n    } else {\r\n      return !this.paused;\r\n    }\r\n  }\r\n  async listFiles() {\r\n    this.cptvFiles = await FakeThermalCameraApi.listFakeThermalCameraFiles();\r\n    if (this.cptvFiles.length) {\r\n      this.selectedFile = this.cptvFiles[0];\r\n    }\r\n  }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FakeThermalCameraControls.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FakeThermalCameraControls.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./FakeThermalCameraControls.vue?vue&type=template&id=77da8a06&scoped=true&\"\nimport script from \"./FakeThermalCameraControls.vue?vue&type=script&lang=ts&\"\nexport * from \"./FakeThermalCameraControls.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"77da8a06\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VSelect } from 'vuetify/lib/components/VSelect';\nimport { VTextField } from 'vuetify/lib/components/VTextField';\ninstallComponents(component, {VBtn,VSelect,VTextField})\n","export enum TemperatureSource {\r\n  FOREHEAD = \"forehead\",\r\n  EAR = \"ear\",\r\n  ARMPIT = \"armpit\",\r\n  ORAL = \"oral\"\r\n}\r\n\r\nexport enum Modes {\r\n  CALIBRATE = \"calibrate\",\r\n  SCAN = \"scan\"\r\n}\r\n\r\nexport interface CalibrationInfo {\r\n  ThermalRefTemp: number;\r\n  SnapshotTime: number;\r\n  TemperatureCelsius: number;\r\n  SnapshotValue: number;\r\n  SnapshotUncertainty: number;\r\n  BodyLocation: string;\r\n  ThresholdMinNormal: number;\r\n  ThresholdMinFever: number;\r\n  Top: number;\r\n  Left: number;\r\n  Right: number;\r\n  Bottom: number;\r\n  CalibrationBinaryVersion: string;\r\n  UuidOfUpdater: number;\r\n}\r\n\r\nexport interface NetworkInterface {\r\n  Name: string;\r\n  IPAddresses: string[] | null;\r\n}\r\n\r\nexport interface CameraInfo {\r\n  Brand: string;\r\n  Model: string;\r\n  FPS: number;\r\n  ResX: number;\r\n  ResY: number;\r\n  Firmware: string;\r\n  CameraSerial: number;\r\n}\r\n\r\nexport interface Telemetry {\r\n  TimeOn: number;\r\n  FFCState: string;\r\n  FrameCount: number;\r\n  FrameMean: number;\r\n  TempC: number;\r\n  LastFFCTempC: number;\r\n  LastFFCTime: number;\r\n}\r\n\r\nexport interface FrameInfo {\r\n  Calibration: CalibrationInfo;\r\n  Telemetry: Telemetry;\r\n  AppVersion: string;\r\n  BinaryVersion: string;\r\n  Camera: CameraInfo;\r\n}\r\n\r\nexport const Dummy = 1;\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"fps-counter\"},[_vm._v(_vm._s(_vm.fps)+\" FPS\")])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\r\nimport { Component, Prop, Vue, Watch } from \"vue-property-decorator\";\r\n\r\n@Component\r\nexport default class FpsCounter extends Vue {\r\n  @Prop() frameCount!: number;\r\n\r\n  private fpsTimes: number[] = [];\r\n\r\n  @Watch(\"frameCount\")\r\n  onFrameComplete() {\r\n    this.fpsTimes.push(new Date().getTime());\r\n    while (this.fpsTimes.length > 25) {\r\n      this.fpsTimes.shift();\r\n    }\r\n  }\r\n\r\n  // TODO(jon): Draw sparklines\r\n\r\n  get fps(): number {\r\n    // How many frames rendered in the last second?\r\n    const now = new Date().getTime();\r\n    const framesRendered = this.fpsTimes.filter(x => x > now - 1000);\r\n    return framesRendered.length;\r\n  }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FpsCounter.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FpsCounter.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./FpsCounter.vue?vue&type=template&id=f9504f40&scoped=true&\"\nimport script from \"./FpsCounter.vue?vue&type=script&lang=ts&\"\nexport * from \"./FpsCounter.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./FpsCounter.vue?vue&type=style&index=0&id=f9504f40&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f9504f40\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('canvas',{ref:\"debugCanvas\",staticClass:\"debug-canvas\",attrs:{\"width\":\"256\",\"height\":\"240\"},on:{\"click\":_vm.setThreshold}}),_c('div',[_vm._v(\"MIN: \"+_vm._s(_vm.minC))]),_c('div',[_vm._v(\"MAX: \"+_vm._s(_vm.maxC))]),_c('div',[_vm._v(\" RANGE: \"+_vm._s((_vm.max - _vm.min).toFixed(2))+\", \"+_vm._s((_vm.maxC.val - _vm.minC.val).toFixed(2))+\" \")])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Emit, Prop, Vue, Watch } from \"vue-property-decorator\";\nimport { Frame } from \"@/camera\";\nimport {\n  DegreesCelsius,\n  getHistogram,\n  temperatureForSensorValue\n} from \"@/utils\";\nimport { ThermalRefValues } from \"@/circle-detection\";\n\n@Component\nexport default class Histogram extends Vue {\n  @Prop({ required: true }) frame!: Frame;\n  @Prop({ required: true }) thermalReferenceStats!: ThermalRefValues;\n  @Prop({ required: true }) calibratedTemp!: DegreesCelsius;\n\n  private min = 0;\n  private max = 0;\n\n  $refs!: {\n    debugCanvas: HTMLCanvasElement;\n  };\n\n  tempForVal(val: number): DegreesCelsius {\n    return temperatureForSensorValue(\n      this.calibratedTemp.val,\n      val,\n      this.thermalReferenceStats.mean\n    );\n  }\n\n  get minC(): DegreesCelsius {\n    return this.tempForVal(this.min);\n  }\n\n  get maxC(): DegreesCelsius {\n    return this.tempForVal(this.max);\n  }\n\n  mounted() {\n    this.updateCtx();\n  }\n\n  setThreshold(e: MouseEvent): number {\n    e.preventDefault();\n    return 0;\n  }\n\n  updateCtx() {\n    // TODO(jon): Put this in the main loop, so that we don't have a frame of delay.\n    const data = this.frame.smoothed;\n    const numBuckets = 16;\n    const { histogram, min, max } = getHistogram(data, numBuckets);\n    this.min = min;\n    this.max = max;\n\n    const thermalRefBucketLow = Math.floor(\n      ((this.thermalReferenceStats.min - min) / (max - min)) * numBuckets\n    );\n    const thermalRefBucketHigh = Math.floor(\n      ((this.thermalReferenceStats.max - min) / (max - min)) * numBuckets\n    );\n    const thermalRefBucketMean = Math.floor(\n      ((this.thermalReferenceStats.mean - min) / (max - min)) * numBuckets\n    );\n    const thermalRefBucketMedian = Math.floor(\n      ((this.thermalReferenceStats.median - min) / (max - min)) * numBuckets\n    );\n    ///console.log(thermalRefBucket, histogram[thermalRefBucket]);\n    {\n      const canvas = this.$refs.debugCanvas;\n      const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      const max = Math.max(...histogram);\n      for (let x = 0; x < histogram.length; x++) {\n        if (x === thermalRefBucketMean) {\n          ctx.fillStyle = \"purple\";\n        } else if (x === thermalRefBucketMedian) {\n          ctx.fillStyle = \"orange\";\n        } else if (x >= thermalRefBucketLow && x <= thermalRefBucketHigh) {\n          ctx.fillStyle = \"yellow\";\n        } else {\n          ctx.fillStyle = \"red\";\n        }\n        const bucket = histogram[x];\n        const v = (bucket / max) * canvas.height;\n        const xx = (canvas.width / numBuckets) * x;\n        ctx.fillRect(xx, canvas.height - v, canvas.width / numBuckets, v);\n      }\n    }\n  }\n\n  @Watch(\"frame\")\n  draw(prev: Frame, next: Frame) {\n    if (\n      prev.frameInfo.Telemetry.FrameCount !==\n      next.frameInfo.Telemetry.FrameCount\n    ) {\n      this.updateCtx();\n    }\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Histogram.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Histogram.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Histogram.vue?vue&type=template&id=60ef0ecb&scoped=true&\"\nimport script from \"./Histogram.vue?vue&type=script&lang=ts&\"\nexport * from \"./Histogram.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Histogram.vue?vue&type=style&index=0&id=60ef0ecb&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"60ef0ecb\",\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport AdminScreening from \"@/components/AdminScreening.vue\";\nimport UserFacingScreening from \"@/components/UserFacingScreening.vue\";\nimport { Component, Vue } from \"vue-property-decorator\";\nimport { CameraConnection, CameraConnectionState, Frame } from \"@/camera\";\nimport { processSensorData, rotateFrame } from \"@/processing\";\nimport { detectThermalReference } from \"@/feature-detection\";\nimport { extractSensorValueForCircle } from \"@/circle-detection\";\nimport { Hotspot } from \"@/face\";\nimport FakeThermalCameraControls from \"@/components/FakeThermalCameraControls.vue\";\nimport { CalibrationInfo, FrameInfo, TemperatureSource } from \"@/api/types\";\nimport { DeviceApi, ScreeningApi } from \"@/api/api\";\nimport {\n  AppState,\n  BoundingBox,\n  CropBox,\n  ScreeningAcceptanceStates,\n  ScreeningEvent,\n  ScreeningState\n} from \"@/types\";\nimport FpsCounter from \"@/components/FpsCounter.vue\";\nimport { FrameHeaderV2 } from \"../cptv-player\";\nimport { ROIFeature } from \"@/worker-fns\";\nimport {\n  checkForSoftwareUpdates,\n  DegreesCelsius,\n  mKToCelsius,\n  temperatureForSensorValue\n} from \"@/utils\";\nimport Histogram from \"@/components/Histogram.vue\";\nimport {\n  getHottestSpotInBounds,\n  ImmutableShape,\n  LerpAmount,\n  Point,\n  preprocessShapes\n} from \"@/shape-processing\";\nimport {\n  advanceState,\n  FFC_SAFETY_DURATION_SECONDS,\n  State,\n  WARMUP_TIME_SECONDS\n} from \"@/main\";\nimport {\n  detectBody,\n  extractFaceInfo,\n  FaceInfo,\n  getNeck,\n  guessApproximateHeadWidth,\n  refineHeadThresholdData,\n  refineThresholdData,\n  thresholdBit\n} from \"@/body-detection\";\nimport {\n  extendToBottom,\n  fillVerticalCracks,\n  getRawShapes,\n  largestShape\n} from \"@/geom\";\n\nconst InitialFrameInfo = {\n  Camera: {\n    ResX: 160,\n    ResY: 120,\n    FPS: 9,\n    Brand: \"flir\",\n    Model: \"lepton3.5\",\n    Firmware: \"3.3.26\",\n    CameraSerial: 12345\n  },\n  Telemetry: {\n    FrameCount: 1,\n    TimeOn: 1,\n    FFCState: \"On\",\n    FrameMean: 0,\n    TempC: 0,\n    LastFFCTempC: 0,\n    LastFFCTime: 0\n  },\n  AppVersion: \"\",\n  BinaryVersion: \"\",\n  Calibration: {\n    ThermalRefTemp: 38,\n    SnapshotTime: 0,\n    TemperatureCelsius: 34,\n    SnapshotValue: 0,\n    SnapshotUncertainty: 0,\n    BodyLocation: TemperatureSource.FOREHEAD,\n    ThresholdMinNormal: 0,\n    ThresholdMinFever: 0,\n    Bottom: 0,\n    Top: 0,\n    Left: 0,\n    Right: 0,\n    CalibrationBinaryVersion: \"fsdfd\",\n    UuidOfUpdater: 432423432432\n  }\n};\n\nlet cptvPlayer: any;\n\n// let outputJSON = false;\n// How much we pad out the top for helping haar cascade to work.  We don't need this if we get rid of haar.\n\n@Component({\n  components: {\n    Histogram,\n    FakeThermalCameraControls,\n    AdminScreening,\n    UserFacingScreening,\n    FpsCounter\n  }\n})\nexport default class App extends Vue {\n  private deviceID = 0;\n  private deviceName = \"\";\n  private appState: AppState = State;\n  private appVersion = \"\";\n  private isNotFullscreen = true;\n  private showUpdatedCalibrationSnackbar = false;\n  private prevFrameInfo: FrameInfo | null = null;\n  private droppedDebugFile = false;\n  private frameCounter = 0;\n  private frameTimeout = 0;\n  get isReferenceDevice(): boolean {\n    return (\n      window.navigator.userAgent.includes(\"Lenovo TB-X605LC\") ||\n      this.isRunningInAndroidWebview\n    );\n  }\n\n  get isRunningInAndroidWebview(): boolean {\n    return window.navigator.userAgent === \"feverscreen-app\";\n  }\n\n  get isFakeReferenceDevice(): boolean {\n    return window.navigator.userAgent.includes(\"Fake\");\n  }\n  async enableFullscreen() {\n    try {\n      await document.body.requestFullscreen();\n      this.isNotFullscreen = false;\n    } catch (e) {\n      return;\n    }\n  }\n  get isAdminScreen(): boolean {\n    return true;\n  }\n\n  private thresholdValue = 0;\n  private prevShape: ImmutableShape[] = [];\n  private nextShape: ImmutableShape[] = [];\n\n  onThresholdChange(val: number) {\n    this.thresholdValue = val;\n  }\n\n  public get playingLocal(): boolean {\n    return this.droppedDebugFile;\n  }\n\n  $refs!: {\n    debugCanvas: HTMLCanvasElement;\n  };\n\n  public advanceScreeningState(nextState: ScreeningState): boolean {\n    // We can only move from certain states to certain other states.\n    const prevState = this.appState.currentScreeningState;\n    if (prevState !== nextState) {\n      const allowedNextState = ScreeningAcceptanceStates[prevState];\n      if ((allowedNextState as ScreeningState[]).includes(nextState)) {\n        this.appState.currentScreeningState = nextState;\n        this.appState.currentScreeningStateFrameCount = 1;\n        console.log(\"Advanced to state\", nextState);\n        return true;\n      }\n    } else {\n      this.appState.currentScreeningStateFrameCount++;\n    }\n    return false;\n  }\n\n  public get thermalReferenceRawValue(): number {\n    return (\n      (this.appState.thermalReference &&\n        this.appState.thermalReference.sensorValue) ||\n      0\n    );\n  }\n\n  public get currentFrameCount(): number {\n    // NOTE(jon): This is always zero if it's the fake thermal camera.\n    if ((this.appState.currentFrame as Frame).frameInfo) {\n      return (this.appState.currentFrame as Frame).frameInfo.Telemetry\n        .FrameCount;\n    }\n    return 0;\n  }\n\n  private stepFrame() {\n    this.appState.paused = false;\n  }\n\n  private processFrame() {\n    this.onFrame(this.appState.currentFrame!);\n  }\n\n  private holdCurrentFrame() {\n    if (this.appState.paused && this.appState.currentFrame) {\n      this.onFrame(this.appState.currentFrame);\n      setTimeout(this.holdCurrentFrame.bind(this), this.frameInterval);\n    }\n  }\n\n  private get frameInterval(): number {\n    if (this.appState.currentFrame) {\n      return 1000 / 9; //this.appState.currentFrame.frameInfo.Camera.FPS;\n    }\n    return 1000 / 9;\n  }\n\n  public async dropLocalCptvFile(event: DragEvent) {\n    event.preventDefault();\n    this.droppedDebugFile = true;\n    if (event.dataTransfer && event.dataTransfer.items) {\n      for (let i = 0; i < event.dataTransfer.items.length; i++) {\n        if (event.dataTransfer.items[i].kind === \"file\") {\n          const file = event.dataTransfer.items[i].getAsFile() as File;\n          const buffer = await file.arrayBuffer();\n          await this.playLocalCptvFile(buffer);\n        }\n      }\n    }\n  }\n\n  updateCalibration(nextCalibration: CalibrationInfo, firstLoad = false) {\n    if (!firstLoad && this.appState.uuid !== nextCalibration.UuidOfUpdater) {\n      this.showUpdatedCalibrationSnackbar = true;\n      setTimeout(() => {\n        this.showUpdatedCalibrationSnackbar = false;\n      }, 3000);\n    }\n    this.appState.currentCalibration.thermalRefTemperature = new DegreesCelsius(\n      nextCalibration.ThermalRefTemp\n    );\n    this.appState.currentCalibration.calibrationTemperature = new DegreesCelsius(\n      nextCalibration.TemperatureCelsius\n    );\n    this.appState.currentCalibration.thresholdMinFever =\n      nextCalibration.ThresholdMinFever;\n    this.appState.currentCalibration.thresholdMinNormal =\n      nextCalibration.ThresholdMinNormal;\n    this.appState.currentCalibration.cropBox = {\n      top: nextCalibration.Top,\n      right: nextCalibration.Right,\n      bottom: nextCalibration.Bottom,\n      left: nextCalibration.Left\n    };\n  }\n\n  public async playLocalCptvFile(\n    buffer: ArrayBuffer,\n    startFrame = 0,\n    endFrame = -1,\n    pauseOn = -1\n  ) {\n    const frameBuffer = new ArrayBuffer(160 * 120 * 2);\n    let filledFrameBuffer = false;\n    cptvPlayer.initWithCptvData(new Uint8Array(buffer));\n    const getNextFrame = () => {\n      clearTimeout(this.frameTimeout);\n      let frameInfo: FrameHeaderV2;\n      let rotated = true;\n      if (!this.appState.paused || !filledFrameBuffer) {\n        filledFrameBuffer = true;\n        // If we're paused, we'll keep sending through the same frame each time.\n        frameInfo = cptvPlayer.getRawFrame(new Uint8Array(frameBuffer));\n        while (\n          frameInfo.frame_number < startFrame ||\n          (endFrame != -1 && frameInfo.frame_number > endFrame)\n        ) {\n          frameInfo = cptvPlayer.getRawFrame(new Uint8Array(frameBuffer));\n        }\n        rotated = false;\n      }\n      if (frameInfo! && frameInfo!.frame_number === pauseOn) {\n        this.appState.paused = true;\n      }\n\n      const { appVersion, binaryVersion } = JSON.parse(\n        window.localStorage.getItem(\"softwareVersion\") || '\"\"'\n      );\n      this.appState.currentFrame = {\n        frame: new Float32Array(new Uint16Array(frameBuffer)),\n        rotated,\n        frameInfo:\n          (frameInfo! && {\n            ...InitialFrameInfo,\n            AppVersion: appVersion,\n            BinaryVersion: binaryVersion,\n            Telemetry: {\n              ...InitialFrameInfo.Telemetry,\n              LastFFCTime: frameInfo!.last_ffc_time,\n              FrameCount: frameInfo!.frame_number,\n              TimeOn: frameInfo!.time_on\n            }\n          }) ||\n          this.appState.currentFrame!.frameInfo,\n        smoothed: new Float32Array(),\n        medianed: new Float32Array(),\n        threshold: 0,\n        min: 0,\n        max: 0\n      };\n      // Rotate the frame.\n      rotateFrame(this.appState.currentFrame);\n\n      // TODO(jon): If thermal ref is always in the same place, maybe mask out the entire bottom of the frame?\n      // Just for visualisation purposes?\n\n      if (!this.appState.paused) {\n        this.onFrame(this.appState.currentFrame);\n        if (this.startFrame !== 0) {\n          this.appState.paused = true;\n        }\n      }\n      this.frameTimeout = (setTimeout(\n        getNextFrame,\n        this.frameInterval\n      ) as unknown) as number;\n    };\n    clearTimeout(this.frameTimeout);\n    getNextFrame();\n  }\n\n  onCropChanged(cropBox: CropBox) {\n    this.appState.currentCalibration.cropBox = cropBox;\n  }\n\n  onTogglePlayback(paused: boolean) {\n    if (paused && !this.droppedDebugFile) {\n      // Repeat the current frame\n      setTimeout(this.holdCurrentFrame.bind(this), this.frameInterval);\n    }\n    this.appState.paused = paused;\n  }\n\n  saveCropChanges() {\n    console.log(\n      \"save crop changes\",\n      JSON.parse(JSON.stringify(this.appState.currentCalibration.cropBox))\n    );\n  }\n\n  get calibratedTemp(): DegreesCelsius {\n    return this.appState.currentCalibration.calibrationTemperature;\n  }\n\n  // TODO(jon): Setting to get temperature from hotspot on faces vs overall hotspot (excluding thermal ref)\n  get hotspotTemp(): DegreesCelsius | null {\n    const hotspot = this.hotspot;\n    if (hotspot !== null) {\n      return temperatureForSensorValue(\n        this.appState.currentCalibration.calibrationTemperature.val,\n        hotspot.sensorValue,\n        this.thermalReferenceRawValue\n      );\n    }\n    return null;\n  }\n\n  get thermalReferenceTemp(): DegreesCelsius {\n    return mKToCelsius(this.thermalReferenceRawValue);\n  }\n\n  get currentFrame(): Frame {\n    return this.appState.currentFrame as Frame;\n  }\n\n  get hasThermalReference(): boolean {\n    return this.appState.thermalReference !== null;\n  }\n\n  get timeOnInSeconds(): number {\n    if (this.prevFrameInfo) {\n      const telemetry = this.prevFrameInfo.Telemetry;\n      let timeOnSecs;\n      // NOTE: TimeOn is in nanoseconds when coming from the camera server, but in milliseconds when coming\n      // from a CPTV file - should make these the same.\n      if (this.useLiveCamera) {\n        timeOnSecs = telemetry.TimeOn / 1000 / 1000 / 1000;\n      } else {\n        timeOnSecs = telemetry.TimeOn / 1000;\n      }\n      return timeOnSecs;\n    }\n    return WARMUP_TIME_SECONDS;\n  }\n\n  get isWarmingUp(): boolean {\n    return this.timeOnInSeconds < WARMUP_TIME_SECONDS;\n  }\n\n  get remainingWarmupTime(): number {\n    return Math.max(0, WARMUP_TIME_SECONDS - this.timeOnInSeconds);\n  }\n\n  get isDuringFFCEvent(): boolean {\n    if (!this.isWarmingUp && this.prevFrameInfo) {\n      const telemetry = this.prevFrameInfo.Telemetry;\n      // TODO(jon): This needs to change based on whether camera is live or not\n      return (\n        (telemetry.TimeOn - telemetry.LastFFCTime) / 1000 <\n        FFC_SAFETY_DURATION_SECONDS\n      );\n    }\n    return false;\n  }\n\n  get isGettingFrames(): boolean {\n    // Did we receive any frames in the past second?\n    return this.appState.lastFrameTime > new Date().getTime() - 1000;\n  }\n\n  get isConnected(): boolean {\n    return (\n      this.appState.cameraConnectionState === CameraConnectionState.Connected\n    );\n  }\n\n  get isConnecting(): boolean {\n    return (\n      this.appState.cameraConnectionState === CameraConnectionState.Connecting\n    );\n  }\n\n  get hasFace(): boolean {\n    return false; //this.appState.face !== null;\n  }\n\n  get hotspot(): Hotspot | null {\n    // TODO(jon): Extract this from the radial smoothed data.\n    if (this.hasFace) {\n      const cropBox = this.cropBoxPixelBounds;\n      const hotspot = this.appState.faces[0].heatStats.foreheadHotspot;\n      if (!hotspot) {\n        return null;\n      }\n      if (\n        hotspot.sensorX >= cropBox.x0 &&\n        hotspot.sensorX < cropBox.x1 &&\n        hotspot.sensorY >= cropBox.y0 &&\n        hotspot.sensorY < cropBox.y1\n      ) {\n        return hotspot;\n      }\n    }\n    return null;\n  }\n\n  get hasHotspot(): boolean {\n    return this.hotspot !== null;\n  }\n\n  get cropBoxPixelBounds(): BoundingBox {\n    const cropBox = this.appState.currentCalibration.cropBox;\n    let width = 120;\n    let height = 160;\n    if (this.prevFrameInfo) {\n      const { ResX, ResY } = this.prevFrameInfo.Camera;\n      width = ResX;\n      height = ResY;\n    }\n    const onePercentWidth = width / 100;\n    const onePercentHeight = height / 100;\n    return {\n      x0: Math.floor(onePercentWidth * cropBox.left),\n      x1: width - Math.floor(onePercentWidth * cropBox.right),\n      y0: Math.floor(onePercentHeight * cropBox.top),\n      y1: height - Math.floor(onePercentHeight * cropBox.bottom)\n    };\n  }\n\n  samplePointIsInsideCroppingArea(point: Point): boolean {\n    const cropBoxPx = this.cropBoxPixelBounds;\n    return (\n      cropBoxPx.x0 < point.x &&\n      cropBoxPx.x1 >= point.x &&\n      cropBoxPx.y0 < point.y &&\n      cropBoxPx.y1 >= point.y\n    );\n  }\n\n  private async onFrame(frame: Frame) {\n    const newLine = frame.frameInfo.AppVersion.indexOf(\"\\n\");\n    if (newLine !== -1) {\n      frame.frameInfo.AppVersion = frame.frameInfo.AppVersion.substring(\n        0,\n        newLine\n      );\n    }\n    // Did the software get updated?\n    checkForSoftwareUpdates(\n      frame.frameInfo.BinaryVersion,\n      frame.frameInfo.AppVersion\n    );\n\n    if (this.prevFrameInfo) {\n      const prevCalibration = JSON.stringify(this.prevFrameInfo.Calibration);\n      const nextCalibration = JSON.stringify(frame.frameInfo.Calibration);\n      if (prevCalibration !== nextCalibration) {\n        console.log(\n          \"updating calibration\",\n          JSON.stringify(frame.frameInfo.Calibration, null, \"\\t\")\n        );\n        this.updateCalibration(frame.frameInfo.Calibration);\n      }\n    }\n    rotateFrame(frame);\n    this.appState.lastFrameTime = new Date().getTime();\n    this.prevFrameInfo = frame.frameInfo;\n    const { ResX: width, ResY: height } = frame.frameInfo.Camera;\n\n    const {\n      medianSmoothed,\n      radialSmoothed,\n      thresholded,\n      threshold,\n      min,\n      max\n    } = await processSensorData(frame);\n    frame.smoothed = radialSmoothed;\n    frame.medianed = medianSmoothed;\n    frame.threshold = threshold;\n    frame.min = min;\n    frame.max = max;\n    // TODO(jon): Sanity check - if the thermal reference is moving from frame to frame,\n    //  it's probably someones head...\n    const thermalReference = detectThermalReference(\n      medianSmoothed,\n      radialSmoothed,\n      this.appState.thermalReference,\n      width,\n      height\n    );\n\n    if (this.isWarmingUp) {\n      this.advanceScreeningState(ScreeningState.WARMING_UP);\n      this.appState.currentFrame = frame;\n    } else {\n      if (thermalReference) {\n        this.appState.thermalReferenceStats = Object.freeze(\n          extractSensorValueForCircle(thermalReference, medianSmoothed, width)\n        );\n        thermalReference.sensorValue = this.appState.thermalReferenceStats.median;\n\n        this.prevShape = this.nextShape;\n        const thermalRefC = temperatureForSensorValue(\n          this.appState.currentCalibration.calibrationTemperature.val,\n          thermalReference.sensorValue,\n          this.thermalReferenceRawValue\n        ).val;\n\n        // Process frame to see if there's a body.\n        this.appState.thermalReference = thermalReference;\n        const prevFrame = this.appState.prevFrame?.smoothed || null;\n        this.appState.prevFrame = frame;\n\n        const {\n          hasBody,\n          data,\n          filteredMotion,\n          adjustedThreshold,\n          motionStats\n        } = detectBody(\n          thermalReference,\n          medianSmoothed,\n          radialSmoothed,\n          prevFrame,\n          min,\n          max,\n          threshold,\n          thermalRefC,\n          thermalReference.sensorValue\n        );\n        if (hasBody) {\n          const pointCloud = refineThresholdData(data);\n          let approxHeadWidth = 0;\n          const rawShapes = getRawShapes(data, width, height, thresholdBit);\n          const { shapes, didMerge: maybeHasGlasses } = preprocessShapes(\n            rawShapes,\n            thermalReference\n          );\n          let body = null;\n          let face = null;\n          if (shapes.length) {\n            body = largestShape(shapes);\n            fillVerticalCracks(body);\n            approxHeadWidth = guessApproximateHeadWidth([body]);\n            let neck = null;\n            if (approxHeadWidth > 0) {\n              // FIXME(jon) - this method of guessing head width doesn't always work, ie. if the person has long hair or a hood,\n              // and they don't have a bit where their face dips in again after flaring out.\n\n              // Maybe get the possible range that the neck can be in from the width at the top of the body convex hull?\n              const searchStart = Math.min(\n                Math.ceil(approxHeadWidth),\n                body.length - 1\n              );\n              const searchEnd = Math.min(\n                Math.ceil(approxHeadWidth * 1.7),\n                body.length - 1\n              );\n              const slice = body.slice(searchStart, searchEnd);\n              if (slice.length) {\n                neck = getNeck(slice);\n              }\n            }\n            if (neck) {\n              refineHeadThresholdData(data, neck, pointCloud);\n              // Draw head hull into canvas context, mask out threshold bits we care about:\n              const rawShapes = getRawShapes(data, width, height, thresholdBit);\n              const {\n                shapes: faceShapes,\n                didMerge: maybeHasGlasses\n              } = preprocessShapes(rawShapes, thermalReference);\n              const faceShape = largestShape(faceShapes);\n              if (faceShape.length) {\n                face = extractFaceInfo(\n                  neck,\n                  faceShape,\n                  radialSmoothed,\n                  maybeHasGlasses\n                );\n              }\n            }\n            // TODO(jon): If half the face is off-frame, null out face.\n            if (hasBody) {\n              // TODO(jon): Infill ovals on faces that look dodgey, so we get a nice silhouette.\n              this.nextShape = [extendToBottom(body)].map(shape =>\n                Object.freeze(shape)\n              );\n              LerpAmount.amount = 0;\n            } else {\n              this.nextShape = [];\n            }\n          }\n\n          const { event, state, count } = advanceState(\n            this.appState.motionStats,\n            motionStats,\n            face,\n            body,\n            this.appState.face,\n            this.appState.currentScreeningState,\n            this.appState.currentScreeningStateFrameCount,\n            adjustedThreshold,\n            radialSmoothed,\n            thermalReference\n          );\n          this.appState.motionStats = motionStats;\n          this.appState.currentScreeningState = state;\n          this.appState.currentScreeningStateFrameCount = count;\n          this.appState.face = face;\n          if (event === \"Captured\" && face) {\n            const temperatureSamplePoint = getHottestSpotInBounds(\n              face,\n              threshold,\n              width,\n              height,\n              radialSmoothed\n            );\n            this.snapshotScreeningEvent(\n              thermalReference,\n              face,\n              frame,\n              temperatureSamplePoint\n            );\n          } else if (event === \"Recorded\") {\n            if (this.isReferenceDevice) {\n              ScreeningApi.recordScreeningEvent(\n                this.deviceName,\n                this.deviceID,\n                this.appState.currentScreeningEvent as ScreeningEvent\n              );\n            }\n            this.appState.currentScreeningEvent = null;\n          }\n        } else {\n          this.advanceScreeningState(ScreeningState.READY);\n          this.appState.currentFrame = frame;\n          this.nextShape = [];\n        }\n      } else {\n        // TODO(jon): Possibly thermal reference error?\n        this.advanceScreeningState(ScreeningState.MISSING_THERMAL_REF);\n        this.appState.currentFrame = frame;\n      }\n    }\n    this.frameCounter++;\n  }\n\n  snapshotScreeningEvent(\n    thermalReference: ROIFeature,\n    face: FaceInfo,\n    frame: Frame,\n    sample: { x: number; y: number; v: number }\n  ) {\n    this.appState.currentScreeningEvent = {\n      rawTemperatureValue: sample.v,\n      sampleX: sample.x,\n      sampleY: sample.y,\n      frame, // Really, we should be able to recreate the temperature value just from the frame + telemetry?\n      timestamp: new Date(),\n      thermalReferenceRawValue: thermalReference.sensorValue,\n      thermalReference,\n      face\n    };\n    // console.log(\"Record screening event\", frame, face);\n    return;\n  }\n\n  onConnectionStateChange(connection: CameraConnectionState) {\n    this.appState.cameraConnectionState = connection;\n  }\n\n  private startFrame = 0; //130; //0; //39; //116;\n  private showSoftwareVersionUpdatedPrompt = false;\n  private useLiveCamera = true;\n\n  async beforeMount() {\n    // Update the AppState:\n    this.appState.uuid = new Date().getTime();\n    const existingCalibration = await DeviceApi.getCalibration();\n    this.updateCalibration(existingCalibration, true);\n    const { appVersion, binaryVersion } = await DeviceApi.softwareVersion();\n    const { deviceID, devicename } = await DeviceApi.deviceInfo();\n    this.deviceID = deviceID;\n    this.deviceName = devicename;\n    const newLine = appVersion.indexOf(\"\\n\");\n    let newAppVersion = appVersion;\n    if (newLine !== -1) {\n      newAppVersion = newAppVersion.substring(0, newLine);\n    }\n\n    this.appVersion = newAppVersion;\n    if (checkForSoftwareUpdates(binaryVersion, newAppVersion, false)) {\n      this.showSoftwareVersionUpdatedPrompt = true;\n    }\n    clearTimeout(this.frameTimeout);\n    /*\n    // On startup:\n    // Load the face recognition model\n    // NOTE: Don't add this to the Vue state tree, since its state never changes.\n    FaceRecognitionModel = await loadFaceRecognitionModel(\"/cascade_stg17.xml\");\n\n    console.log(JSON.stringify(FaceRecognitionModel, null, \"\\t\"));\n\n    // Open the camera connection\n\n\n    new CameraConnection(\n      \"http://localhost:2041\",\n      this.onFrame,\n      this.onConnectionStateChange\n    );\n    );\n    */\n    //this.useLiveCamera = false;\n    if (this.useLiveCamera) {\n      // FIXME(jon): Add the proper camera url\n      // FIXME(jon): Get rid of browser full screen toggle\n      new CameraConnection(\n        window.location.hostname,\n        this.onFrame,\n        this.onConnectionStateChange\n      );\n    } else {\n      // TODO(jon): Queue multiple files\n      cptvPlayer = await import(\"../cptv-player/cptv_player\");\n      //const cptvFile = await fetch(\"/cptv-files/twopeople-calibration.cptv\");\n      const cptvFile = await fetch(\n        \"cptv-files/bunch of people in small meeting room 20200812.134427.735.cptv\"\n      ); // Jon\n      //const cptvFile = await fetch(\"/cptv-files/20200716.153342.441.cptv\");\n      //const cptvFile = await fetch(\"/cptv-files/20200716.153342.441.cptv\"); // Jon (too high in frame)\n      //const cptvFile = await fetch(\"/cptv-files/20200718.130624.941.cptv\"); // Sara\n\n      //const cptvFile = await fetch(\"/cptv-files/20200718.130606.382.cptv\"); // Sara\n      //const cptvFile = await fetch(\"/cptv-files/20200718.130536.950.cptv\"); // Sara (fringe)\n      //const cptvFile = await fetch(\"/cptv-files/20200718.130508.586.cptv\"); // Sara (fringe)\n      //const cptvFile = await fetch(\"/cptv-files/20200718.130059.393.cptv\"); // Jon\n      // const cptvFile = await fetch(\"/cptv-files/20200718.130017.220.cptv\"); // Jon\n      //\n      //const cptvFile = await fetch(\"/cptv-files/walking through Shaun.cptv\");\n      //const cptvFile = await fetch(\"/cptv-files/looking_down.cptv\");\n      // const cptvFile = await fetch(\n      //   \"/cptv-files/detecting part then whole face repeatedly.cptv\"\n      // );\n      //frontend\\public\\cptv-files\\detecting part then whole face repeatedly.cptv\n      // const cptvFile = await fetch(\n      //   \"/cptv-files/walking towards camera - calibrated at 2m.cptv\"\n      // );\n\n      // Shauns office:\n      //const cptvFile = await fetch(\"/cptv-files/20200729.104543.646.cptv\");\n      //const cptvFile = await fetch(\"/cptv-files/20200729.104622.519.cptv\");\n      //const cptvFile = await fetch(\"/cptv-files/20200729.104815.556.cptv\"); // Proximity\n\n      //const cptvFile = await fetch(\"/cptv-files/20200729.105022.389.cptv\");\n      // 20200729.105038.847\n      //const cptvFile = await fetch(\"/cptv-files/20200729.105038.847.cptv\");\n      //const cptvFile = await fetch(\"/cptv-files/20200729.105053.858.cptv\");\n      const buffer = await cptvFile.arrayBuffer();\n      // 30, 113, 141\n      await this.playLocalCptvFile(buffer, this.startFrame);\n      //if (this.appState.paused) {\n      //this.processFrame();\n    }\n\n    //new LocalCameraConnection(this.onFrame, this.onConnectionStateChange);\n  }\n}\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--14-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/ts-loader/index.js??ref--14-3!../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--14-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/ts-loader/index.js??ref--14-3!../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=2520e220&\"\nimport script from \"./App.vue?vue&type=script&lang=ts&\"\nexport * from \"./App.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VApp } from 'vuetify/lib/components/VApp';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardActions } from 'vuetify/lib/components/VCard';\nimport { VCardTitle } from 'vuetify/lib/components/VCard';\nimport { VDialog } from 'vuetify/lib/components/VDialog';\nimport { VSnackbar } from 'vuetify/lib/components/VSnackbar';\ninstallComponents(component, {VApp,VBtn,VCard,VCardActions,VCardTitle,VDialog,VSnackbar})\n","import Vue from \"vue\";\r\nimport Vuetify from \"vuetify/lib\";\r\nVue.use(Vuetify);\r\n\r\nexport default new Vuetify({\r\n  icons: {\r\n    iconfont: \"mdiSvg\"\r\n  }\r\n});\r\n","import Vue from \"vue\";\r\nimport App from \"./App.vue\";\r\n//import \"./registerServiceWorker\";\r\nimport vuetify from \"./plugins/vuetify\";\r\nimport { AppState, ScreeningAcceptanceStates, ScreeningState } from \"@/types\";\r\nimport { CameraConnectionState } from \"@/camera\";\r\nimport { DegreesCelsius } from \"@/utils\";\r\nimport {\r\n  faceArea,\r\n  faceHasMovedOrChangedInSize,\r\n  FaceInfo,\r\n  faceIsFrontOn\r\n} from \"@/body-detection\";\r\nimport { getHottestSpotInBounds, Shape } from \"@/shape-processing\";\r\nimport { ROIFeature } from \"@/worker-fns\";\r\nimport { faceIntersectsThermalRef } from \"@/geom\";\r\n\r\nVue.config.productionTip = false;\r\nexport const DEFAULT_THRESHOLD_MIN_NORMAL = 32.5;\r\nexport const DEFAULT_THRESHOLD_MIN_FEVER = 37.8;\r\nexport const WARMUP_TIME_SECONDS = 30 * 60; // 30 mins\r\nexport const FFC_SAFETY_DURATION_SECONDS = 5;\r\n\r\nexport const State: AppState = {\r\n  currentFrame: null,\r\n  prevFrame: null,\r\n  cameraConnectionState: CameraConnectionState.Disconnected,\r\n  thermalReference: null,\r\n  thermalReferenceStats: null,\r\n  faces: [],\r\n  face: null,\r\n  paused: false,\r\n  currentCalibration: {\r\n    calibrationTemperature: new DegreesCelsius(36),\r\n    thermalReferenceRawValue: 30000,\r\n    hotspotRawTemperatureValue: 31000,\r\n    timestamp: new Date(),\r\n    cropBox: {\r\n      top: 0,\r\n      right: 0,\r\n      bottom: 0,\r\n      left: 0\r\n    },\r\n    thresholdMinFever: DEFAULT_THRESHOLD_MIN_FEVER,\r\n    thresholdMinNormal: DEFAULT_THRESHOLD_MIN_NORMAL,\r\n    thermalRefTemperature: new DegreesCelsius(0)\r\n  },\r\n  currentScreeningEvent: null,\r\n  currentScreeningState: ScreeningState.WARMING_UP,\r\n  currentScreeningStateFrameCount: -1,\r\n  faceModel: null,\r\n  lastFrameTime: 0,\r\n  uuid: 0,\r\n  motionStats: {\r\n    actionInBottomHalf: 0,\r\n    motionPlusThreshold: 0,\r\n    thresholded: 0,\r\n    motion: 0\r\n  }\r\n};\r\n\r\n/*\r\n//these are the *lowest* temperature in celsius for each category\r\nlet GThreshold_error = 42.5;\r\nlet GThreshold_fever = 37.8;\r\nlet GThreshold_check = 37.4;\r\nlet GThreshold_normal = 35.7;\r\n */\r\n\r\nexport interface MotionStats {\r\n  motion: number;\r\n  thresholded: number;\r\n  motionPlusThreshold: number;\r\n  actionInBottomHalf: number;\r\n}\r\n\r\nfunction advanceScreeningState(\r\n  nextState: ScreeningState,\r\n  prevState: ScreeningState,\r\n  currentCount: number\r\n): { state: ScreeningState; count: number } {\r\n  // We can only move from certain states to certain other states.\r\n  if (prevState !== nextState) {\r\n    const allowedNextState = ScreeningAcceptanceStates[prevState];\r\n    if ((allowedNextState as ScreeningState[]).includes(nextState)) {\r\n      // console.log(\"Advanced to state\", nextState);\r\n      return {\r\n        state: nextState,\r\n        count: 1\r\n      };\r\n    }\r\n  }\r\n  return {\r\n    state: prevState,\r\n    count: currentCount + 1\r\n  };\r\n}\r\n\r\nexport function advanceState(\r\n  prevMotionStats: MotionStats,\r\n  motionStats: MotionStats,\r\n  face: FaceInfo | null,\r\n  body: Shape | null,\r\n  prevFace: FaceInfo | null,\r\n  screeningState: ScreeningState,\r\n  screeningStateCount: number,\r\n  threshold: number,\r\n  radialSmoothed: Float32Array,\r\n  thermalReference: ROIFeature | null\r\n): {\r\n  prevFace: FaceInfo | null;\r\n  state: ScreeningState;\r\n  count: number;\r\n  event: string;\r\n} {\r\n  let next;\r\n  let event = \"\";\r\n  //const prevAllMotion = prevMotionStats.motion + prevMotionStats.hotInnerEdge + prevMotionStats.hotInner + prevMotionStats.edge;\r\n  //const allMotion = motionStats.motion + motionStats.hotInnerEdge + motionStats.hotInner + motionStats.edge;\r\n  if (thermalReference === null) {\r\n    next = advanceScreeningState(\r\n      ScreeningState.MISSING_THERMAL_REF,\r\n      screeningState,\r\n      screeningStateCount\r\n    );\r\n  } else if (face !== null) {\r\n    if (screeningState === ScreeningState.MISSING_THERMAL_REF) {\r\n      if (faceArea(face) < 1500) {\r\n        next = advanceScreeningState(\r\n          ScreeningState.TOO_FAR,\r\n          screeningState,\r\n          screeningStateCount\r\n        );\r\n      } else {\r\n        next = advanceScreeningState(\r\n          ScreeningState.LARGE_BODY,\r\n          screeningState,\r\n          screeningStateCount\r\n        );\r\n      }\r\n    } else if (faceArea(face) < 1500) {\r\n      next = advanceScreeningState(\r\n        ScreeningState.TOO_FAR,\r\n        screeningState,\r\n        screeningStateCount\r\n      );\r\n    } else if (faceIntersectsThermalRef(face, thermalReference)) {\r\n      next = advanceScreeningState(\r\n        ScreeningState.LARGE_BODY,\r\n        screeningState,\r\n        screeningStateCount\r\n      );\r\n    } else if (face.headLock !== 0) {\r\n      if (faceIsFrontOn(face)) {\r\n        const faceMoved = faceHasMovedOrChangedInSize(face, prevFace);\r\n        if (faceMoved) {\r\n          screeningStateCount--;\r\n        }\r\n        if (\r\n          screeningState === ScreeningState.FRONTAL_LOCK &&\r\n          !faceMoved &&\r\n          face.headLock === 1 &&\r\n          screeningStateCount > 2 // Needs to be on this state for at least two frames.\r\n        ) {\r\n          next = advanceScreeningState(\r\n            ScreeningState.STABLE_LOCK,\r\n            screeningState,\r\n            screeningStateCount\r\n          );\r\n          if (next.state !== screeningState) {\r\n            // Capture the screening event here\r\n            event = \"Captured\";\r\n          }\r\n        } else if (screeningState === ScreeningState.STABLE_LOCK) {\r\n          next = advanceScreeningState(\r\n            ScreeningState.LEAVING,\r\n            screeningState,\r\n            screeningStateCount\r\n          );\r\n        } else {\r\n          next = advanceScreeningState(\r\n            ScreeningState.FRONTAL_LOCK,\r\n            screeningState,\r\n            screeningStateCount\r\n          );\r\n        }\r\n      } else {\r\n        // NOTE: Could stay here a while if we're in an FFC event.\r\n        next = advanceScreeningState(\r\n          ScreeningState.FACE_LOCK,\r\n          screeningState,\r\n          screeningStateCount\r\n        );\r\n      }\r\n    } else {\r\n      next = advanceScreeningState(\r\n        ScreeningState.HEAD_LOCK,\r\n        screeningState,\r\n        screeningStateCount\r\n      );\r\n    }\r\n    prevFace = face;\r\n  } else {\r\n    // TODO(jon): Ignore stats around FFC, just say that it's thinking...\r\n    const hasBody =\r\n      motionStats.actionInBottomHalf && motionStats.motionPlusThreshold > 45;\r\n    const prevFrameHasBody =\r\n      prevMotionStats.actionInBottomHalf &&\r\n      prevMotionStats.motionPlusThreshold > 45;\r\n    // TODO(jon): OR the threshold bounds are taller vertically than horizontally?\r\n    if (hasBody) {\r\n      next = advanceScreeningState(\r\n        ScreeningState.LARGE_BODY,\r\n        screeningState,\r\n        screeningStateCount\r\n      );\r\n    } else {\r\n      // Require 2 frames without a body before triggering leave event.\r\n      if (!prevFrameHasBody) {\r\n        if (screeningState === ScreeningState.LEAVING) {\r\n          // Record event now that we have lost the face?\r\n          event = \"Recorded\";\r\n        }\r\n        next = advanceScreeningState(\r\n          ScreeningState.READY,\r\n          screeningState,\r\n          screeningStateCount\r\n        );\r\n      } else {\r\n        next = advanceScreeningState(\r\n          ScreeningState.LARGE_BODY,\r\n          screeningState,\r\n          screeningStateCount\r\n        );\r\n      }\r\n    }\r\n    prevFace = null;\r\n  }\r\n  return {\r\n    prevFace,\r\n    state: next.state,\r\n    count: next.count,\r\n    event\r\n  };\r\n}\r\n\r\nnew Vue({\r\n  vuetify,\r\n  render: h => h(App)\r\n}).$mount(\"#app\");\r\n","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FpsCounter.vue?vue&type=style&index=0&id=f9504f40&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FpsCounter.vue?vue&type=style&index=0&id=f9504f40&scoped=true&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Histogram.vue?vue&type=style&index=0&id=60ef0ecb&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Histogram.vue?vue&type=style&index=0&id=60ef0ecb&scoped=true&lang=scss&\"","// extracted by mini-css-extract-plugin"],"sourceRoot":""}