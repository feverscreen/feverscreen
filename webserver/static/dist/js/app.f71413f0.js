(()=>{"use strict";var e={2300:(e,t,r)=>{r.d(t,{yH:()=>Bt,TD:()=>$t,AM:()=>Ht,QI:()=>jt,ZM:()=>Wt,Ed:()=>Ut});var a,n=r(144),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-app",{attrs:{id:"app"},on:{"skip-warmup":e.skipWarmup}},[r("UserFacingScreening",{attrs:{"on-reference-device":e.isReferenceDevice,state:e.appState.currentScreeningState,"screening-event":e.appState.currentScreeningEvent,calibration:e.appState.currentCalibration,face:e.face,"warmup-seconds-remaining":e.remainingWarmupTime,shapes:[e.prevShape,e.nextShape],isTesting:!e.useLiveCamera,"thermal-ref-side":e.thermalRefSide,showCanvas:!e.qrMode||!e.finishScan||e.finishScan&&e.registered}}),r("v-dialog",{attrs:{width:"500"},model:{value:e.showSoftwareVersionUpdatedPrompt,callback:function(t){e.showSoftwareVersionUpdatedPrompt=t},expression:"showSoftwareVersionUpdatedPrompt"}},[r("v-card",[r("v-card-title",[e._v(" This software has been updated. "+e._s(e.appVersion)+" ")]),r("v-card-actions",{attrs:{center:""}},[r("v-btn",{attrs:{text:""},on:{click:function(t){return e.showSoftwareVersionUpdatedPrompt=!1}}},[e._v(" Proceed ")])],1)],1)],1),r("v-overlay",{attrs:{absolute:"",width:"500"},model:{value:e.isNotGettingFrames,callback:function(t){e.isNotGettingFrames=t},expression:"isNotGettingFrames"}},[r("v-card",[r("v-card-title",[e._v("Waiting for camera input...")])],1)],1),r("v-snackbar",{model:{value:e.showUpdatedCalibrationSnackbar,callback:function(t){e.showUpdatedCalibrationSnackbar=t},expression:"showUpdatedCalibrationSnackbar"}},[e._v(" Calibration was updated ")]),r("QRVideo",{attrs:{startScanning:e.qrMode&&e.finishScan&&!e.registered,setQRCode:e.setQRCode}}),r("transition",{attrs:{name:"fade"}},[e.qrMode&&e.finishScan?r("QRImage",{attrs:{qrState:e.qrState}}):e._e()],1),e.isReferenceDevice?e._e():r("div",{staticClass:"debug-video"},[e.appState.currentFrame?r("VideoStream",{attrs:{frame:e.appState.currentFrame.frame,face:e.face,min:e.appState.currentFrame.analysisResult.heatStats.min,max:e.appState.currentFrame.analysisResult.heatStats.max,"crop-box":e.appState.currentCalibration.cropBox,"crop-enabled":!0,"draw-overlays":!0,"show-coords":!0}}):e._e(),r("div",{staticClass:"pa-6"},[r("v-btn",{attrs:{dark:"",color:"light-blue"},on:{click:function(){e.paused=!e.paused}}},[e._v(" "+e._s(e.paused?"Play":"Pause")+" ")]),r("v-row",[r("p",[e._v(e._s(e.minFrame))]),r("v-range-slider",{model:{value:e.rangeFrames,callback:function(t){e.rangeFrames=t},expression:"rangeFrames"}}),r("p",[e._v(e._s(e.maxFrame))])],1),r("LoggingInterface",{attrs:{framePos:e.framePos,frameLogs:e.frameLogs}})],1)],1)],1)},s=[],o=r(655),h=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"user-state",class:[e.classNameForState,e.screeningResultClass,{"mini-view":!e.onReferenceDevice}],style:{background:e.warmupBackgroundColour},attrs:{id:"user-facing-screening"},on:{click:function(t){e.interacted=!0}}},[r("canvas",{ref:"beziers",attrs:{hidden:!e.showCanvas||e.isWarmingUp,id:"beziers",width:"710",height:"1080"}}),r("div",{staticClass:"center",class:{"warming-up":e.isWarmingUp}},[e.hasScreeningResult?r("div",{class:["result",{"should-leave-frame":e.shouldLeaveFrame}]},[e._v(" "+e._s(e.temperature)+" "),r("br"),e.shouldLeaveFrame?r("span",[e._v(e._s(e.screeningAdvice))]):e._e(),r("br")]):r("div",{domProps:{innerHTML:e._s(e.messageText)}})]),e.onReferenceDevice||e.isLocal?r("v-card",{staticClass:"settings-toggle-button",class:{interacted:e.interacted},attrs:{dark:"",flat:"",height:"44",tile:"",color:"transparent"}},[r("v-card-actions",[r("v-btn",{attrs:{absolute:"",dark:"",fab:"",bottom:"",right:"",elevation:"0",color:"transparent"},on:{click:function(t){e.interacted&&(e.showSettings=!0,e.hasSettings=!0)}}},[r("v-icon",{attrs:{color:"rgba(255, 255, 255, 0.5)",large:""}},[e._v(e._s(e.cogIcon))])],1)],1)],1):e._e(),r("v-dialog",{attrs:{"hide-overlay":"",attach:"#user-facing-screening",fullscreen:"",transition:"dialog-bottom-transition"},model:{value:e.showSettings,callback:function(t){e.showSettings=t},expression:"showSettings"}},[e.hasSettings?r("AdminSettings",{on:{closed:e.closedAdminSettings}}):e._e()],1)],1)},c=[],l=r(4775),d=r(5317);(function(e){e[e["Valid"]=0]="Valid",e[e["Invalid"]=1]="Invalid",e[e["Unregistered"]=2]="Unregistered"})(a||(a={}));const u=37.5,p={ThermalRefTemp:37.87441329956055,SnapshotTime:0,TemperatureCelsius:37.5,SnapshotValue:30197.9765625,ThresholdMinFever:u,HeadBLX:0,HeadBLY:0,HeadBRX:0,HeadBRY:0,HeadTLX:0,HeadTLY:0,HeadTRX:0,HeadTRY:0,CalibrationBinaryVersion:"abcde",UuidOfUpdater:432423432432,UseNormalSound:!0,UseWarningSound:!0,UseErrorSound:!0};var m;(function(e){e["INIT"]="INIT",e["WARMING_UP"]="WARMING_UP",e["READY"]="READY",e["HEAD_LOCK"]="HEAD_LOCK",e["TOO_FAR"]="TOO_FAR",e["LARGE_BODY"]="LARGE_BODY",e["MULTIPLE_HEADS"]="MULTIPLE_HEADS",e["FACE_LOCK"]="FACE_LOCK",e["FRONTAL_LOCK"]="FRONTAL_LOCK",e["STABLE_LOCK"]="STABLE_LOCK",e["MEASURED"]="MEASURED",e["MISSING_THERMAL_REF"]="MISSING_REF",e["BLURRED"]="BLURRED",e["AFTER_FFC_EVENT"]="AFTER_FFC_EVENT"})(m||(m={}));const g={Camera:{ResX:160,ResY:120,FPS:9,Brand:"flir",Model:"lepton3.5",Firmware:"3.3.26",CameraSerial:12345},Telemetry:{FrameCount:1,TimeOn:1,FFCState:"On",FrameMean:0,TempC:0,LastFFCTempC:0,LastFFCTime:0},AppVersion:"",BinaryVersion:"",Calibration:p};(function(){const e="arrayBuffer"in Blob.prototype&&"function"===typeof Blob.prototype["arrayBuffer"]?e=>e["arrayBuffer"]():e=>new Promise(((t,r)=>{const a=new FileReader;a.addEventListener("load",(()=>{t(a.result)})),a.addEventListener("error",(()=>{r()})),a.readAsArrayBuffer(e)}))})();class v{constructor(e){this.val=e}toString(){return this.val,`${this.val.toFixed(1)}°`}}function f(e,t){window.localStorage.setItem("softwareVersion",JSON.stringify({appVersion:t,binaryVersion:e}))}function b(e,t,r=!0){const a=window.localStorage.getItem("softwareVersion");if(a)try{const n=JSON.parse(a);if(e&&t&&(n.binaryVersion!=e||n.appVersion!=t)){if(!r)return f(e,t),!0;console.log("reload because version changed",JSON.stringify(n),e,t),window.location.reload()}}catch(n){return f(e,t),!1}else f(e,t);return!1}var y=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-card",[r("v-toolbar",{attrs:{color:"light-blue",dark:""},scopedSlots:e._u([{key:"extension",fn:function(){return[r("v-tabs",{attrs:{centered:""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},e._l(e.tabItems,(function(t){return r("v-tab",{key:t.tab},[e._v(e._s(t.tab))])})),1)]},proxy:!0}])},[r("v-toolbar-title",[e._v("Settings")]),r("v-spacer"),r("v-btn",{attrs:{text:""},on:{click:e.close}},[e._v(" close ")])],1),r("v-tabs-items",{attrs:{touchless:""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},e._l(e.tabItems,(function(e){return r("v-tab-item",{key:e.tab},[r(e.content,{tag:"component"})],1)})),1)],1)},S=[],C=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-card",{attrs:{height:"calc(100vh - 112px)"}},[r("v-container",{staticClass:"cont"},[r("v-card",{staticClass:"split",attrs:{flat:""}},[r("v-card",[e.state.currentFrame?r("VideoStream",{attrs:{frame:e.state.currentFrame.frame,face:e.state.face,"crop-box":e.editedCropBox,"thermal-ref":e.state.currentFrame.analysisResult.thermalRef.geom,min:e.state.currentFrame.analysisResult.heatStats.min,max:e.state.currentFrame.analysisResult.heatStats.max,"crop-enabled":!1}}):e._e()],1),r("v-card",{staticClass:"settings",attrs:{width:"700"}},[r("v-card-title",[e._v(" Calibration: "+e._s(e.pendingCalibration)+" "),r("v-btn",{attrs:{text:"",disabled:!e.canCalibrate},on:{click:function(t){return t.stopPropagation(),function(){return e.editCalibration()}()}}},[r("v-icon",{attrs:{color:"#999",small:""}},[e._v(e._s(e.pencilIcon))]),e._v(" Edit ")],1)],1),r("v-dialog",{attrs:{"max-width":"400"},model:{value:e.showCalibrationDialog,callback:function(t){e.showCalibrationDialog=t},expression:"showCalibrationDialog"}},[r("v-card",[r("v-card-title",[e._v("Edit calibration")]),r("v-container",[e.snapshotScreeningEvent?r("VideoStream",{attrs:{frame:e.snapshotScreeningEvent.frame.frame,face:e.snapshotScreeningEvent.face,min:e.state.currentFrame.analysisResult.heatStats.min,max:e.state.currentFrame.analysisResult.heatStats.max,"crop-box":e.state.currentCalibration.cropBox,"crop-enabled":!1,"draw-overlays":!0,scale:.6}}):e._e()],1),r("v-card-subtitle",[e._v(" Take your temperature and enter it here to calibrate the system against the current screening event. ")]),r("v-card-text",[r("v-text-field",{attrs:{label:"calibrated temperature",value:e.editedCalibration},on:{blur:e.updateCalibration}}),r("v-card-actions",[r("v-btn",{on:{click:function(){return e.incrementCalibration(.1)}}},[r("v-icon",{attrs:{light:""}},[e._v(e._s(e.plusIcon))])],1),r("v-spacer"),r("v-btn",{on:{click:function(){return e.incrementCalibration(-.1)}}},[r("v-icon",{attrs:{light:""}},[e._v(e._s(e.minusIcon))])],1)],1)],1),r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{text:"",color:"grey darken-1"},on:{click:function(t){e.showCalibrationDialog=!1}}},[e._v(" Cancel ")]),r("v-btn",{attrs:{text:"",color:"green darken-1"},on:{click:function(t){return e.acceptCalibration()}}},[e._v(" Accept ")])],1)],1)],1),r("v-card-text",[r("v-checkbox",{attrs:{label:"Use custom alert threshold"},on:{change:e.toggleCustomTemperatureThresholds},model:{value:e.useCustomTemperatureRange,callback:function(t){e.useCustomTemperatureRange=t},expression:"useCustomTemperatureRange"}}),r("v-card-text",[r("v-slider",{attrs:{disabled:!e.useCustomTemperatureRange,min:"30",max:"40",step:"0.1","thumb-label":"",ticks:!0,color:"green","track-color":"rgba(255, 0, 0, 0.25)"},on:{change:function(t){return e.persistSettings()}},model:{value:e.editedTemperatureThreshold,callback:function(t){e.editedTemperatureThreshold=t},expression:"editedTemperatureThreshold"}}),r("span",{staticClass:"selected-temp-range",domProps:{innerHTML:e._s(e.selectedTemperatureRange)}})],1)],1),r("v-card-title",[e._v("Sounds:")]),r("v-container",{attrs:{fluid:"",width:"100%"}},[r("v-row",[r("v-col",{attrs:{cols:"4"}},[r("v-switch",{attrs:{label:"Play normal sound"},on:{change:function(t){return e.persistSettings()}},model:{value:e.playNormalSound,callback:function(t){e.playNormalSound=t},expression:"playNormalSound"}})],1),r("v-col",{attrs:{cols:"4"}},[r("v-switch",{attrs:{label:"Play warning sound"},on:{change:function(t){return e.persistSettings()}},model:{value:e.playWarningSound,callback:function(t){e.playWarningSound=t},expression:"playWarningSound"}})],1),r("v-col",{attrs:{cols:"4"}},[r("v-switch",{attrs:{label:"Play error sound"},on:{change:function(t){return e.persistSettings()}},model:{value:e.playErrorSound,callback:function(t){e.playErrorSound=t},expression:"playErrorSound"}})],1)],1)],1)],1)],1),r("v-overlay",{attrs:{value:e.saving,light:""}},[e._v(" Saving settings ")])],1)],1)},w=[],R=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"container",class:{recording:e.recording},attrs:{id:"video-stream-container"}},[r("canvas",{ref:"cameraStream",attrs:{id:"camera-stream",width:"160",height:"120"}}),r("canvas",{ref:"vizOverlay",attrs:{id:"debug-overlay",width:"480",height:"540"}}),e.canEditCropping&&e.cropEnabled?r("video-crop-controls",{attrs:{"crop-box":e.cropBox},on:{"crop-changed":e.gotCropChange}}):e._e(),e.cropEnabled?r("v-btn",{class:{on:e.canEditCropping},attrs:{text:"",title:"Edit cropping",id:"toggle-cropping",dark:""},on:{click:e.toggleCropping}},[r("v-icon",[e._v(e._s(e.cropIcon))])],1):e._e(),e.showCoords?r("p",{staticClass:"coords"},[e._v("("+e._s(e.coords.x)+", "+e._s(e.coords.y)+")")]):e._e(),r("p",[e._v(e._s(e.frameNum))])],1)},T=[],M=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"box",attrs:{id:"fov-box"}},[r("div",[r("div",{ref:"top",staticClass:"fov-handle",attrs:{id:"top-handle"},on:{mousedown:function(t){return e.startDrag(t)},mouseup:function(t){return e.endDrag(t)},touchstart:function(t){return e.startDrag(t)},touchend:function(t){return e.endDrag(t)}}},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 512"}},[r("path",{attrs:{fill:"currentColor",d:"M214.059 377.941H168V134.059h46.059c21.382 0 32.09-25.851 16.971-40.971L144.971 7.029c-9.373-9.373-24.568-9.373-33.941 0L24.971 93.088c-15.119 15.119-4.411 40.971 16.971 40.971H88v243.882H41.941c-21.382 0-32.09 25.851-16.971 40.971l86.059 86.059c9.373 9.373 24.568 9.373 33.941 0l86.059-86.059c15.12-15.119 4.412-40.971-16.97-40.971z"}})])]),r("div",{ref:"left",staticClass:"fov-handle",attrs:{id:"left-handle"},on:{mousedown:function(t){return e.startDrag(t)},mouseup:function(t){return e.endDrag(t)},touchstart:function(t){return e.startDrag(t)},touchend:function(t){return e.endDrag(t)}}},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[r("path",{attrs:{fill:"currentColor",d:"M377.941 169.941V216H134.059v-46.059c0-21.382-25.851-32.09-40.971-16.971L7.029 239.029c-9.373 9.373-9.373 24.568 0 33.941l86.059 86.059c15.119 15.119 40.971 4.411 40.971-16.971V296h243.882v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.568 0-33.941l-86.059-86.059c-15.119-15.12-40.971-4.412-40.971 16.97z"}})])]),r("div",{ref:"right",staticClass:"fov-handle",attrs:{id:"right-handle"},on:{mousedown:function(t){return e.startDrag(t)},mouseup:function(t){return e.endDrag(t)},touchstart:function(t){return e.startDrag(t)},touchend:function(t){return e.endDrag(t)}}},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[r("path",{attrs:{fill:"currentColor",d:"M377.941 169.941V216H134.059v-46.059c0-21.382-25.851-32.09-40.971-16.971L7.029 239.029c-9.373 9.373-9.373 24.568 0 33.941l86.059 86.059c15.119 15.119 40.971 4.411 40.971-16.971V296h243.882v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.568 0-33.941l-86.059-86.059c-15.119-15.12-40.971-4.412-40.971 16.97z"}})])]),r("div",{ref:"bottom",staticClass:"fov-handle",attrs:{id:"bottom-handle"},on:{mousedown:function(t){return e.startDrag(t)},mouseup:function(t){return e.endDrag(t)},touchstart:function(t){return e.startDrag(t)},touchend:function(t){return e.endDrag(t)}}},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 512"}},[r("path",{attrs:{fill:"currentColor",d:"M214.059 377.941H168V134.059h46.059c21.382 0 32.09-25.851 16.971-40.971L144.971 7.029c-9.373-9.373-24.568-9.373-33.941 0L24.971 93.088c-15.119 15.119-4.411 40.971 16.971 40.971H88v243.882H41.941c-21.382 0-32.09 25.851-16.971 40.971l86.059 86.059c9.373 9.373 24.568 9.373 33.941 0l86.059-86.059c15.12-15.119 4.412-40.971-16.97-40.971z"}})])])])])},F=[];let E=class extends l.w3{constructor(){super(...arguments),this.currentTarget=null,this.boundDragHandle=null,this.boundEndDrag=null}created(){this.boundEndDrag=this.endDrag.bind(this),window.addEventListener("mouseup",this.boundEndDrag),window.addEventListener("touchend",this.boundEndDrag)}mounted(){const{top:e,left:t,right:r,bottom:a}=this.cropBox;this.$refs.top.style.top=`${e}%`,this.$refs.right.style.right=`${r}%`,this.$refs.bottom.style.bottom=`${a}%`,this.$refs.left.style.left=`${t}%`;let n=e+.5*(100-(a+e));this.$refs.left.style.top=`${n}%`,this.$refs.right.style.top=`${n}%`,n=t+.5*(100-(t+r)),this.$refs.top.style.left=`${n}%`,this.$refs.bottom.style.left=`${n}%`}beforeDestroy(){this.boundEndDrag&&(window.removeEventListener("mouseup",this.boundEndDrag),window.removeEventListener("touchend",this.boundEndDrag))}startDrag(e){null===this.boundDragHandle&&(this.boundDragHandle=this.dragHandle.bind(this));const t="mousedown"===e.type?"mousemove":"touchmove";this.currentTarget=e.target,this.boundDragHandle&&window.addEventListener(t,this.boundDragHandle)}endDrag(e){const t="mouseup"===e.type?"mousemove":"touchmove";this.currentTarget=null,this.boundDragHandle&&window.removeEventListener(t,this.boundDragHandle)}dragHandle(e){const t=this.cropBox,r=this.$refs.top,a=this.$refs.right,n=this.$refs.bottom,i=this.$refs.left;let s;s=e instanceof MouseEvent?e:e.touches[0];const{clientX:o,clientY:h}=s,c=20;let l=35;const d=this.$refs.box.getBoundingClientRect();let u;if(this.currentTarget){const e="left",s="right";switch(this.currentTarget.id){case"top-handle":l=100-(t.bottom+c),t.top=Math.min(l,Math.max(0,(h-d.top)/d.height*100)),r.style.top=`${t.top}%`,u=t.top+.5*(100-(t.bottom+t.top)),i.style.top=`${u}%`,a.style.top=`${u}%`;break;case"right-handle":l=100-(t[e]+c),t[s]=Math.min(l,Math.max(0,(d.right-o)/d.width*100)),a.style.right=`${t[s]}%`,u=t[e]+.5*(100-(t[e]+t[s])),r.style.left=`${u}%`,n.style.left=`${u}%`;break;case"bottom-handle":l=100-(t.top+c),t.bottom=Math.min(l,Math.max(0,(d.bottom-h)/d.height*100)),n.style.bottom=`${t.bottom}%`,u=t.top+.5*(100-(t.bottom+t.top)),i.style.top=`${u}%`,a.style.top=`${u}%`;break;case"left-handle":l=100-(t[s]+c),t[e]=Math.min(l,Math.max(0,(o-d.left)/d.width*100)),i.style.left=`${t[e]}%`,u=t[e]+.5*(100-(t[e]+t[s])),r.style.left=`${u}%`,n.style.left=`${u}%`;break}this.$emit("crop-changed",t),this.$parent.$emit("crop-changed",t)}}};(0,o.gn)([(0,l.fI)({required:!0})],E.prototype,"cropBox",void 0),E=(0,o.gn)([l.wA],E);const I=E,x=I;var O=r(1001),_=(0,O.Z)(x,M,F,!1,null,"60b9dd6c",null);const A=_.exports;let D=class extends l.w3{constructor(){super(...arguments),this.canEditCropping=!1,this.coords={x:0,y:0},this.frameNum=0}get cropIcon(){return d.J_s}mounted(){const e=this.$refs.container;e.style.width=375*this.scale+"px",e.style.height=500*this.scale+"px",this.showCoords&&e.addEventListener("mousemove",this.onMouseMove),this.frame&&(this.onFrameUpdate(this.frame),this.updateOverlayCanvas())}onMouseMove(e){const t=e.target.getBoundingClientRect(),r=Math.floor(Math.min((e.clientX-t.x)/t.width*120,119)),a=Math.floor(Math.min((e.clientY-t.y)/t.height*160,159));this.coords={x:r,y:a}}beforeDestroy(){this.showCoords&&this.$refs.container.removeEventListener("mousemove",this.onMouseMove)}updateOverlayCanvas(){const e=this.$refs.cameraStream,t=this.$refs.vizOverlay,r=t.width*window.devicePixelRatio,a=t.height*window.devicePixelRatio,n=t.getContext("2d");if(n.clearRect(0,0,r,a),this.thermalRef){n.save();const t=r/(e.height*window.devicePixelRatio),i=a/(e.width*window.devicePixelRatio);n.scale(t,i),n.fillStyle="rgba(255, 0, 0, 0.4)",n.beginPath(),n.arc(this.thermalRef.center.x,this.thermalRef.center.y,this.thermalRef.radius,0,2*Math.PI),n.fill(),n.restore()}if(this.drawOverlays){n.save();const t=r/(e.height*window.devicePixelRatio),i=a/(e.width*window.devicePixelRatio);n.scale(t,i);const s=this.face;if(s&&(n.lineWidth=.25,s.isValid)){let e=s.isValid;if(s.headLock>=1?(n.strokeStyle="red",n.lineWidth=.5):.5===s.headLock?n.strokeStyle="blue":(n.strokeStyle="orange",e=!1),e){const e=s.samplePoint;n.beginPath(),n.strokeStyle="rgba(255, 0, 0, 0.7)",n.lineWidth=1,n.arc(e.x-.5,e.y-.5,2,0,2*Math.PI),n.stroke(),n.beginPath(),n.moveTo(s.head.bottomLeft.x,s.head.bottomLeft.y),n.lineTo(s.head.topLeft.x,s.head.topLeft.y),n.lineTo(s.head.topRight.x,s.head.topRight.y),n.lineTo(s.head.bottomRight.x,s.head.bottomRight.y),n.lineTo(s.head.bottomLeft.x,s.head.bottomLeft.y),n.stroke()}}n.restore()}}get cropBoxPixelBounds(){const e=this.cropBox,t=120,r=160,a=t/100,n=r/100,i={x0:Math.floor(a*e.left),x1:t-Math.floor(a*e.right),y0:Math.floor(n*e.top),y1:r-Math.floor(n*e.bottom)};return i}toggleCropping(){this.canEditCropping=!this.canEditCropping,this.canEditCropping||this.saveCropChanges()}saveCropChanges(){this.$parent.$emit("save-crop-changes")}onFrameUpdate(e){const t=this.$refs.cameraStream,r=t.getContext("2d"),a=r.getImageData(0,0,t.width,t.height),n=e,i=this.max,s=this.min;if(s!==Number.MAX_SAFE_INTEGER){const e=new Uint32Array(a.data.buffer),t=i-s;for(let r=0;r<e.length;r++){const a=Math.max(0,Math.min(255,(n[r]-s)/t*255));e[r]=255<<24|a<<16|a<<8|a}r.putImageData(a,0,0)}}onFaceChanged(){this.updateOverlayCanvas()}onThermalReferenceChanged(){this.updateOverlayCanvas()}onCropChanged(){this.updateOverlayCanvas()}gotCropChange(e){return this.updateOverlayCanvas(),e}};(0,o.gn)([(0,l.fI)()],D.prototype,"frame",void 0),(0,o.gn)([(0,l.fI)({required:!0})],D.prototype,"min",void 0),(0,o.gn)([(0,l.fI)({required:!0})],D.prototype,"max",void 0),(0,o.gn)([(0,l.fI)({required:!0})],D.prototype,"face",void 0),(0,o.gn)([(0,l.fI)({required:!0})],D.prototype,"cropBox",void 0),(0,o.gn)([(0,l.fI)({required:!0})],D.prototype,"cropEnabled",void 0),(0,o.gn)([(0,l.fI)({default:1})],D.prototype,"scale",void 0),(0,o.gn)([(0,l.fI)({required:!1})],D.prototype,"thermalRef",void 0),(0,o.gn)([(0,l.fI)({default:!0})],D.prototype,"drawOverlays",void 0),(0,o.gn)([(0,l.fI)({default:!1})],D.prototype,"recording",void 0),(0,o.gn)([(0,l.fI)({default:!1})],D.prototype,"showCoords",void 0),(0,o.gn)([(0,l.RL)("frame")],D.prototype,"onFrameUpdate",null),(0,o.gn)([(0,l.RL)("face")],D.prototype,"onFaceChanged",null),(0,o.gn)([(0,l.RL)("thermalReference")],D.prototype,"onThermalReferenceChanged",null),(0,o.gn)([(0,l.RL)("cropBox")],D.prototype,"onCropChanged",null),(0,o.gn)([(0,l.y1)("crop-changed")],D.prototype,"gotCropChange",null),D=(0,o.gn)([(0,l.wA)({components:{VideoCropControls:A}})],D);const L=D,z=L;var V=r(3453),k=r.n(V),P=r(6462),N=r(3428),U=(0,O.Z)(z,R,T,!1,null,"6a66e673",null);const $=U.exports;function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){W(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function W(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}k()(U,{VBtn:P.Z,VIcon:N.Z});const j="https://ixg63w0770.execute-api.ap-southeast-2.amazonaws.com/event",q=e=>`https://3pu8ojk2ej.execute-api.ap-southeast-2.amazonaws.com/default/devices/${e}`,Z={async setDeviceInfo(e,t){const r=fetch(q(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({qrMode:t})}),a=await r;if(200===a.status){const e=await a.json();return e}console.error(a)},async getDevice(e){const t=fetch(q(e),{method:"GET",headers:{"Content-Type":"application/json"}}),r=await t;if(200===r.status){const e=await r.json();return e}console.error(r)}},G={async recordScreeningEvent(e,t,r,a,n){if(""!==e){const t=r.frame.frameInfo.AppVersion,i=t.includes("beta")||t.includes("nightly")?"beta":"stable",s=fetch(j,{method:"POST",body:JSON.stringify(H({Channel:i,CameraID:`${e}`,Type:"Screen",Timestamp:r.timestamp.toISOString().replace(/:/g,"_").replace(/\./g,"_"),DisplayedTemperature:r.calculatedValue,AppVersion:t,FeverThreshold:a,Meta:{Face:{tL:r.face.head.topLeft,tR:r.face.head.topRight,bL:r.face.head.bottomLeft,bR:r.face.head.bottomRight},Sample:{x:r.sampleX,y:r.sampleY},SampleRaw:Math.round(r.rawTemperatureValue),RefTemp:r.thermalReference.temp,RefRaw:r.thermalReference.val,Telemetry:r.frame.frameInfo.Telemetry}},n&&{QRID:n}))}),o=await s,h=await o.text();h&&fetch(h,{method:"PUT",body:r.frame.frame,headers:{"Content-Type":"application/octet-stream","Content-Encoding":"utf8"}})}else console.error("Can't send telemetry, missing deviceId")},async recordCalibrationEvent(e,t,r,a,n,i,s,o){if(""!==e){const t=i.frameInfo.AppVersion,a=t.includes("beta")||t.includes("nightly")?"beta":"stable",h={Channel:a,CameraID:`${e}`,Type:"Calibrate",Timestamp:n.timestamp.toISOString().replace(/:/g,"_").replace(/\./g,"_"),CalibratedTemp:parseFloat(n.calibrationTemperature.val.toFixed(2)),MinFeverThreshold:n.thresholdMinFever,ThermalRefTemp:parseFloat(n.thermalRefTemperature.val.toFixed(2)),AppVersion:t,Meta:{Face:n.head,Sample:{x:s,y:o},SampleRaw:Math.round(n.hotspotRawTemperatureValue),RefRaw:Math.round(n.thermalReferenceRawValue),Telemetry:i.frameInfo.Telemetry}},c=fetch(j,{method:"POST",body:JSON.stringify(h)}),l=await c;if(200===l.status&&r){const e=await l.text();e&&fetch(e,{method:"PUT",body:i.frame,headers:{"Content-Type":"application/octet-stream","Content-Encoding":"utf8"}})}}else console.error("Can't sent calibration event, missing deviceId")}},Q={recordUserActivity:!1,disableRecordUserActivity:!0,registerQRID:"false"!==window.localStorage.getItem("registerQRID"),get DisableRecordUserActivity(){return this.disableRecordUserActivity},set DisableRecordUserActivity(e){this.disableRecordUserActivity=e,this.stopRecording(!1)},get RegisterQRID(){return this.registerQRID},set RegisterQRID(e){this.registerQRID=e},enableQRMode(e,t){this.registerQRID=t,Z.setDeviceInfo(e,t),window.localStorage.setItem("registerQRID",t?"true":"false")},get RecordUserActivity(){return this.recordUserActivity},set RecordUserActivity(e){this.recordUserActivity=e,window.localStorage.setItem("recordUserActivity",e?"true":"false"),this.stopRecording(!1)},get debugPrefix(){return"8080"===window.location.port||window.location.port,""},get SOFTWARE_VERSION(){return`${this.debugPrefix}/api/version`},get DEVICE_INFO(){return`${this.debugPrefix}/api/device-info`},get DEVICE_TIME(){return`${this.debugPrefix}/api/clock`},get RUN_FFC(){return`${this.debugPrefix}/api/camera/run-ffc`},get DEVICE_CONFIG(){return`${this.debugPrefix}/api/config`},get NETWORK_INFO(){return`${this.debugPrefix}/api/network-info`},get SAVE_CALIBRATION(){return`${this.debugPrefix}/api/calibration/save`},get LOAD_CALIBRATION(){return`${this.debugPrefix}/api/calibration/get`},get RECORDER_STATUS(){return`${this.debugPrefix}/recorderstatus`},get START_RECORDING(){return`${this.debugPrefix}/record?start=true`},get STOP_RECORDING(){return`${this.debugPrefix}/record?stop=true&dowload=false`},get DOWNLOAD_RECORDING(){return`${this.debugPrefix}/record?stop=true&download=true`},async get(e){return fetch(e,{method:"GET",headers:{Authorization:`Basic ${btoa("admin:feathers")}`}})},async post(e,t){return fetch(e,{method:"POST",headers:{Authorization:`Basic ${btoa("admin:feathers")}`,"Content-Type":"application/x-www-form-urlencoded"},body:t})},async put(e){return fetch(e,{method:"PUT",headers:{Authorization:`Basic ${btoa("admin:feathers")}`,"Content-Type":"application/x-www-form-urlencoded"}})},async getJSON(e){const t=await this.get(e);try{return t.json()}catch(r){return{}}},async getText(e){const t=await this.get(e);return t.text()},async softwareVersion(){return this.getJSON(this.SOFTWARE_VERSION)},async startRecording(){const e=await this.getText(this.START_RECORDING);return"<nil>"===e},async stopRecording(e=!0){const t=await this.getText(e?this.DOWNLOAD_RECORDING:this.STOP_RECORDING);return t},async deviceInfo(){return this.getJSON(this.DEVICE_INFO)},async deviceTime(){return this.getJSON(this.DEVICE_TIME)},async recorderStatus(){return this.getJSON(this.RECORDER_STATUS)},async deviceConfig(){return this.getJSON(this.DEVICE_CONFIG)},async runFFC(){return this.put(this.RUN_FFC)},async networkInfo(){return this.getJSON(this.NETWORK_INFO)},async saveCalibration(e){const t=new URLSearchParams;return t.append("calibration",JSON.stringify(e)),this.post(this.SAVE_CALIBRATION,t)},async getCalibration(){return this.getJSON(this.LOAD_CALIBRATION)}};let Y=class extends l.w3{constructor(){super(...arguments),this.useCustomTemperatureRange=!1,this.editedTemperatureThreshold=0,this.showCalibrationDialog=!1,this.editedCropBox=null,this.editedCalibration=new v(0),this.pendingCalibration=new v(0),this.snapshotScreeningEvent=null,this.playNormalSound=!0,this.playWarningSound=!0,this.playErrorSound=!0,this.deviceName="",this.deviceID="",this.piSerial="",this.saving=!1}toggleCustomTemperatureThresholds(e){e&&(this.editedTemperatureThreshold=this.state.currentCalibration.thresholdMinFever),e||(this.editedTemperatureThreshold=u),this.persistSettings()}get selectedTemperatureRange(){return`${new v(this.editedTemperatureThreshold)}`}get hasMadeEdits(){const e={head:this.state.currentCalibration.head,temperatureThreshold:this.state.currentCalibration.thresholdMinFever,calibration:parseFloat(this.state.currentCalibration.calibrationTemperature.val.toFixed(2)),sounds:{warning:this.state.currentCalibration.playWarningSound,normal:this.state.currentCalibration.playNormalSound,error:this.state.currentCalibration.playErrorSound}},t={head:this.state.currentCalibration.head,temperatureThreshold:this.editedTemperatureThreshold,calibration:parseFloat(this.editedCalibration.val.toFixed(2)),sounds:{warning:this.playWarningSound,normal:this.playNormalSound,error:this.playErrorSound}},r=JSON.stringify(t),a=JSON.stringify(e);return r!=a}get plusIcon(){return d.qX5}get pencilIcon(){return d.r9}get minusIcon(){return d.UHA}get state(){return Wt}get canCalibrate(){return null!==this.latestScreeningEvent}get screeningState(){return this.state.currentScreeningState}get latestScreeningEvent(){return this.state.currentScreeningEvent}get calibration(){return this.pendingCalibration}editCalibration(){this.editedCalibration=new v(this.calibration.val),this.snapshotScreeningEvent=this.latestScreeningEvent,this.showCalibrationDialog=!0}async acceptCalibration(){this.pendingCalibration=new v(this.editedCalibration.val),this.showCalibrationDialog=!1,await this.persistSettings()}async persistSettings(){const e=this.pendingCalibration;let t=this.state.currentCalibration.thermalRefTemperature.val,r=this.state.currentCalibration.thermalReferenceRawValue,a=this.state.currentCalibration.hotspotRawTemperatureValue;const n=this.editedTemperatureThreshold;let i=-1,s=-1,o=this.state.currentFrame,h={tL:{x:0,y:0},tR:{x:0,y:0},bL:{x:0,y:0},bR:{x:0,y:0}};this.snapshotScreeningEvent&&(o=this.snapshotScreeningEvent.frame,h={tL:this.snapshotScreeningEvent.face.head.topLeft,tR:this.snapshotScreeningEvent.face.head.topRight,bL:this.snapshotScreeningEvent.face.head.bottomLeft,bR:this.snapshotScreeningEvent.face.head.bottomRight},r=this.snapshotScreeningEvent.thermalReference.val,a=this.snapshotScreeningEvent.rawTemperatureValue,t=e.val-.01*(a-r),i=this.snapshotScreeningEvent.sampleX,s=this.snapshotScreeningEvent.sampleY);const c=new Date,l=e.val!==this.state.currentCalibration.calibrationTemperature.val,d=n!==this.state.currentCalibration.thresholdMinFever,u=JSON.stringify(h)!==JSON.stringify(this.state.currentCalibration.head);(l||d||u)&&G.recordCalibrationEvent(this.deviceID,this.piSerial,l,d,{head:h,timestamp:c,calibrationTemperature:e,hotspotRawTemperatureValue:a,thermalRefTemperature:new v(t),thermalReferenceRawValue:r,thresholdMinFever:n,playErrorSound:this.playErrorSound,playWarningSound:this.playWarningSound,playNormalSound:this.playNormalSound},o,i,s),g.Calibration.ThermalRefTemp=t,g.Calibration.TemperatureCelsius=parseFloat(e.val.toFixed(2)),g.Calibration.UseErrorSound=this.playErrorSound,g.Calibration.UseNormalSound=this.playNormalSound,g.Calibration.UseWarningSound=this.playWarningSound;const p={ThresholdMinFever:n,ThermalRefTemp:t,TemperatureCelsius:parseFloat(e.val.toFixed(2)),HeadTLX:h.tL.x,HeadTLY:h.tL.y,HeadBLX:h.bL.x,HeadBLY:h.bL.y,HeadTRX:h.tR.x,HeadTRY:h.tR.y,HeadBRX:h.bR.x,HeadBRY:h.bR.y,UuidOfUpdater:this.state.uuid,CalibrationBinaryVersion:this.state.currentFrame.frameInfo.BinaryVersion,SnapshotTime:c.getTime(),SnapshotValue:a,UseNormalSound:this.playNormalSound,UseWarningSound:this.playWarningSound,UseErrorSound:this.playErrorSound};return Q.saveCalibration(p)}incrementCalibration(e){this.editedCalibration=new v(this.editedCalibration.val+e)}updateCalibration(e){const t=e.target.value.replace("&deg;","").replace("°","");isNaN(Number(t))&&(this.editedCalibration=new v(36)),this.editedCalibration=new v(Number(t))}resetEdits(){this.pendingCalibration=new v(this.state.currentCalibration.calibrationTemperature.val),this.editedCalibration=new v(this.state.currentCalibration.calibrationTemperature.val),this.editedTemperatureThreshold=this.state.currentCalibration.thresholdMinFever,this.useCustomTemperatureRange=this.editedTemperatureThreshold!==u,this.playNormalSound=this.state.currentCalibration.playNormalSound,this.playWarningSound=this.state.currentCalibration.playWarningSound,this.playErrorSound=this.state.currentCalibration.playErrorSound}async saveEdits(){this.saving=!0,await this.persistSettings(),this.saving=!1}async beforeMount(){const{deviceID:e,devicename:t,serial:r}=await Q.deviceInfo();this.deviceID=e,this.deviceName=t,this.piSerial=r,this.resetEdits()}};Y=(0,o.gn)([(0,l.wA)({components:{VideoStream:$}})],Y);const X=Y,K=X;var J=r(6768),ee=r(306),te=r(6932),re=r(3121),ae=r(6446),ne=r(8827),ie=r(8432),se=r(4722),oe=r(6539),he=r(1453),ce=r(9395),le=r(76),de=(0,O.Z)(K,C,w,!1,null,"bf659bf4",null);const ue=de.exports;k()(de,{VBtn:P.Z,VCard:J.Z,VCardActions:ee.h7,VCardSubtitle:ee.Qq,VCardText:ee.ZB,VCardTitle:ee.EB,VCheckbox:te.Z,VCol:re.Z,VContainer:ae.Z,VDialog:ne.Z,VIcon:N.Z,VOverlay:ie.Z,VRow:se.Z,VSlider:oe.Z,VSpacer:he.Z,VSwitch:ce.Z,VTextField:le.Z});var pe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-card",{attrs:{flat:""}},[e.items?r("v-simple-table",{scopedSlots:e._u([{key:"default",fn:function(){return[r("thead",[r("tr",[r("th",{staticClass:"text-left"},[e._v("Device config")]),r("th",{staticClass:"text-left"})])]),r("tbody",e._l(e.items,(function(t){var a=t[0],n=t[1];return r("tr",{key:a},[r("td",[e._v(e._s(a))]),r("td",[e._v(e._s(n))])])})),0)]},proxy:!0}],null,!1,421180828)}):e._e()],1)},me=[];function ge(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(r),!0).forEach((function(t){fe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ge(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function fe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let be=class extends l.w3{constructor(){super(...arguments),this.info={},this.networkInfo={},this.softwareVersion={}}get items(){return[...Object.entries(this.info),...Object.entries(this.softwareVersion),...Object.entries(this.networkInfo),...Object.entries(this.cameraInfo)]}get cameraInfo(){var e;const t=ve({},null===(e=Wt.currentFrame)||void 0===e?void 0:e.frameInfo.Camera);return t}get state(){return Wt}async beforeMount(){const e=await Q.deviceInfo();this.info=e;const t=await Q.networkInfo();let r=t.Interfaces.filter((e=>null!==e.IPAddresses)).map((e=>e.IPAddresses[0]))[0];r=r.substring(0,r.indexOf("/")),this.networkInfo={Online:t.Config.Online,IPAddress:r};const a=await Q.softwareVersion();a.binaryVersion=a.binaryVersion.substring(0,10);const n=a.appVersion.indexOf("\n");-1!==n&&(a.appVersion=a.appVersion.substring(0,n)),this.softwareVersion=a}};be=(0,o.gn)([l.wA],be);const ye=be,Se=ye;var Ce=r(7543),we=(0,O.Z)(Se,pe,me,!1,null,"a2dc84ae",null);const Re=we.exports;k()(we,{VCard:J.Z,VSimpleTable:Ce.Z});var Te=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-card",{attrs:{flat:""}},[r("v-container",{staticClass:"cont",attrs:{height:"calc(100vh - 112px)"}},[r("v-card",[r("v-card-actions",[r("v-btn",{staticClass:"ml-6",on:{click:e.skipWarmup}},[e._v("Skip warmup period")]),e.disableRecordUserActivity?e._e():r("v-switch",{staticClass:"pl-6",attrs:{label:"Record User Activities"},model:{value:e.recordUserActivity,callback:function(t){e.recordUserActivity=t},expression:"recordUserActivity"}}),r("v-switch",{staticClass:"pl-6",attrs:{label:"Enable QR mode",disabled:e.cameraAvailable},model:{value:e.qrMode,callback:function(t){e.qrMode=t},expression:"qrMode"}})],1),r("VideoStream",{attrs:{frame:e.state.currentFrame.frame,face:e.state.face,min:e.state.currentFrame.analysisResult.heatStats.min,max:e.state.currentFrame.analysisResult.heatStats.max,"crop-box":e.editedThermalRefMask,"crop-enabled":!1,recording:e.isRecording},on:{"crop-changed":e.onMaskChanged}}),r("div",{staticClass:"buttons"},[e.isRunningInAndroidWebview?r("div",[e._v(" To make recordings this needs to be running inside a browser, not the Te Kahu Ora app. ")]):r("div",[r("v-btn",{staticClass:"mb-4",attrs:{center:""},on:{click:e.toggleRecording}},[e._v(" "+e._s(e.isRecording?"Stop Recording":"Record")+" ")])],1)])],1)],1)],1)},Me=[],Fe=r(4808);function Ee(e){const t=document.createElement("a");t.href=e,t.setAttribute("download",e),t.click()}let Ie=class extends l.w3{constructor(){super(...arguments),this.editedThermalRefMask=null,this.isRecording=!1,this.enableQR=!1}get cameraAvailable(){return this.enableQR}get recordUserActivity(){return jt.RecordUserActivity}set recordUserActivity(e){jt.RecordUserActivity=e}get disableRecordUserActivity(){return jt.DisableRecordUserActivity}get qrMode(){return jt.RegisterQRID}set qrMode(e){jt.deviceInfo().then((({deviceID:t})=>{jt.enableQRMode(t,e)}))}skipWarmup(){this.$root.$children[0].$children[0].$emit("skip-warmup")}onMaskChanged(e){this.editedThermalRefMask=e}get state(){return Wt}get isRunningInAndroidWebview(){return"feverscreen-app"===window.navigator.userAgent}async toggleRecording(){const{recording:e,processor:t}=await jt.recorderStatus();if(!t)return!1;e?(Ee(jt.DOWNLOAD_RECORDING),this.isRecording=!1):this.isRecording=await jt.startRecording()}async mounted(){const{recording:e}=await jt.recorderStatus();this.enableQR=!await Fe.Z.hasCamera(),this.isRecording=e}};Ie=(0,o.gn)([(0,l.wA)({components:{VideoStream:$}})],Ie);const xe=Ie,Oe=xe;var _e=(0,O.Z)(Oe,Te,Me,!1,null,"1eaa0af9",null);const Ae=_e.exports;k()(_e,{VBtn:P.Z,VCard:J.Z,VCardActions:ee.h7,VContainer:ae.Z,VSwitch:ce.Z});let De=class extends l.w3{constructor(){super(...arguments),this.tab=null,this.tabItems=[{tab:"Calibration",content:ue},{tab:"Device info",content:Re},{tab:"Developer",content:Ae}]}close(){return!0}};(0,o.gn)([(0,l.y1)("closed")],De.prototype,"close",null),De=(0,o.gn)([(0,l.wA)({components:{CalibrationSettings:ue,DeviceInfo:Re,DeveloperUtilities:Ae}})],De);const Le=De,ze=Le;var Ve=r(1100),ke=r(3313),Pe=r(1713),Ne=r(2050),Ue=r(1564),$e=r(3201),Be=(0,O.Z)(ze,y,S,!1,null,"dc077da8",null);const He=Be.exports;k()(Be,{VBtn:P.Z,VCard:J.Z,VSpacer:he.Z,VTab:Ve.Z,VTabItem:ke.Z,VTabs:Pe.Z,VTabsItems:Ne.Z,VToolbar:Ue.Z,VToolbarTitle:$e.qW});const We=42.5,je=42;function qe(e,t,r){return e*t+r*(1-t)}function Ze(e,t){const r=e.map((e=>({d:Math.abs(Number(e.y)-t),x:e}))).sort(((e,t)=>t.d-e.d)).pop();return e.find((e=>e.y===r.x.y))}function Ge(e,t,r){t=1-t;const a=[];for(let n=0;n<r.length;n++){const i=r[n],s=i.y;if(e[n]){const r=e[n];a.push({x0:qe(r.x0,t,i.x0),x1:qe(r.x1,t,i.x1),y:Number(s)})}else{const r=Ze(e,s);a.push({x0:qe(r.x0,t,i.x0),x1:qe(r.x1,t,i.x1),y:Number(s)})}}return a}let Qe,Ye=0;const Xe=new Audio;let Ke=class extends l.w3{constructor(){super(...arguments),this.didInteract=!1,this.showSettings=!1,this.hasSettings=!1,this.shouldLeaveFrame=!1,this.prevFrameTime=performance.now(),this.stateQueue=[],this.canvasWidth=710,this.canvasHeight=1080}get isLocal(){return("5000"===window.location.port||"8080"===window.location.port)&&!1}closedAdminSettings(){this.showSettings=!1,setTimeout((()=>{this.hasSettings=!1}),300)}set interacted(e){this.didInteract=e,setTimeout((()=>this.didInteract=!1),5e3)}get interacted(){return this.didInteract}get cogIcon(){return d.Shd}async beforeMount(){Qe=await r.e(641).then(r.bind(r,3641))}mounted(){if(this.$refs.beziers){const e=4/3;navigator.userAgent.includes("Lenovo TB-X605LC")?this.canvasHeight=document.body.getBoundingClientRect().height:this.canvasHeight=this.$refs.beziers.parentElement.getBoundingClientRect().height,this.canvasWidth=this.canvasHeight/e,this.$refs.beziers.style.width=`${this.canvasWidth}px`,this.$refs.beziers.style.height=`${this.canvasHeight}px`;const t=this.$refs.beziers.getContext("2d");t.lineWidth=1,t.strokeStyle="rgba(255, 255, 255, 0.5)",t.fillStyle="rgba(255, 255, 255, 0.2)",t.lineWidth=2,t.lineCap="round"}window.requestAnimationFrame(this.drawBezierOutline.bind(this))}get messageText(){let e="Ready";return this.isWarmingUp?e=`Warming up, <span>${this.remainingWarmupTime}</span> remaining`:this.isAfterFFCEvent?e="One moment...":this.isAquiring?e="Hold still...":this.isTooFar?e="Come closer":this.missingRef&&(e="Missing reference"),this.logForTest(e),e}get screeningAdvice(){return this.temperatureIsNormal?"You're good to go!":this.temperatureIsHigherThanNormal?"Get checked out now!":"Please check calibration"}get finishScan(){return this.state===m.MEASURED}onScreeningEventChange(e){if(null!==e){const t=e.frame.frameInfo.Calibration;this.temperatureIsNormal?t.UseNormalSound&&(Xe.src="/static/dist/sounds/341695_5858296-lq.mp3",Xe.play()):this.temperatureIsHigherThanNormal?t.UseWarningSound&&(Xe.src="/static/dist/sounds/445978_9159316-lq.mp3",Xe.play()):this.temperatureIsProbablyAnError&&t.UseErrorSound&&(Xe.src="/static/dist/sounds/142608_1840739-lq.mp3",Xe.play())}}drawBezierOutline(){this.screeningEvent&&(new Date).getTime()-this.screeningEvent.timestamp.getTime()>1e3?this.shouldLeaveFrame=!0:this.shouldLeaveFrame=!1,Ye++;const e=this.$refs.beziers.getContext("2d"),t=0,r=120-je;if(e&&(e.clearRect(0,0,810,1080),e.save(),e.translate(je/2,0),e.scale(6.75,6.75),2===this.shapes.length)){const a=this.shapes[0],n=this.shapes[1];if(a&&n&&a.length&&n.length){const i=Ge(a[0],Ht.amount,n[0]),s=performance.now(),o=s-this.prevFrameTime;this.prevFrameTime=s,Ht.amount+=o/100,Ht.amount=Math.min(1,Ht.amount);const h=new Uint8Array(4*i.length);let c=0;i.reverse();let l=0;"left"===this.thermalRefSide&&(l=je);for(const e of i)h[c++]=e.x1-l,h[c++]=e.y;i.reverse();for(const e of i)h[c++]=e.x0-l,h[c++]=e.y;let d=[];if(h.length>=4&&(d=Qe.fitCurveThroughPoints(h)),d.length){{let t=0;if(this.face){const e=(e,t)=>{const r=e.x-t.x,a=e.y-t.y;return Math.sqrt(r*r+a*a)};t=e(this.face.head.bottomLeft,this.face.head.bottomRight)}const r=.2+t/120;e.strokeStyle=`rgba(255, 255, 255, ${r})`,e.setLineDash([3,8]),e.lineDashOffset=Ye/5%10,e.beginPath(),e.moveTo(d[0],d[1]);for(let a=2;a<d.length;a+=6)e.bezierCurveTo(d[a],d[a+1],d[a+2],d[a+3],d[a+4],d[a+5]);e.stroke()}if(this.screeningEvent){let t=Math.min(1,((new Date).getTime()-this.screeningEvent.timestamp.getTime())/600);t*=t,e.beginPath(),e.fillStyle=`rgba(255, 255, 255, ${.6*Math.abs(1-t)})`,e.arc(this.screeningEvent.sampleX-l,this.screeningEvent.sampleY,8*t,0,2*Math.PI),e.fill()}e.save(),e.globalCompositeOperation="destination-out";const a=e.createLinearGradient(t,0,10,0);a.addColorStop(1,"rgba(0, 0, 0, 0)"),a.addColorStop(.25,"rgba(0, 0, 0, 230)"),a.addColorStop(0,"rgba(0, 0, 0, 255)");const n=e.createLinearGradient(r-10,0,r,0);n.addColorStop(1,"rgba(0, 0, 0, 255)"),n.addColorStop(.75,"rgba(0, 0, 0, 230)"),n.addColorStop(0,"rgba(0, 0, 0, 0)");const i=e.createLinearGradient(0,0,0,10);i.addColorStop(0,"rgba(0, 0, 0, 255)"),i.addColorStop(.45,"rgba(0, 0, 0, 230)"),i.addColorStop(1,"rgba(0, 0, 0, 0)");const s=e.createLinearGradient(0,150,0,160);s.addColorStop(1,"rgba(0, 0, 0, 255)"),s.addColorStop(.75,"rgba(0, 0, 0, 230)"),s.addColorStop(0,"rgba(0, 0, 0, 0)"),e.fillStyle=a,e.fillRect(t,0,15,160),e.fillStyle=n,e.fillRect(r-10,0,15,160),e.fillStyle=i,e.fillRect(0,0,120-je,10),e.fillStyle=s,e.fillRect(0,150,120-je,10),e.restore()}}e.setLineDash([]);const i=15,s=5,o=10,h=120-je,c=160;e.beginPath(),e.moveTo(s+o,i),e.lineTo(s,i),e.lineTo(s,i+o),e.moveTo(s+o,c-i),e.lineTo(s,c-i),e.lineTo(s,c-(i+o)),e.moveTo(h-(s+o),i),e.lineTo(h-s,i),e.lineTo(h-s,i+o),e.moveTo(h-(s+o),c-i),e.lineTo(h-s,c-i),e.lineTo(h-s,c-(i+o)),e.stroke(),e.restore()}requestAnimationFrame(this.drawBezierOutline.bind(this))}get temperature(){if(this.screeningEvent){const e=new v(this.screeningEvent.face.sampleTemp);return this.logForTest(`Temperature is ${e}`),e}return new v(0)}get temperatureIsNormal(){return this.temperature.val<this.calibration.thresholdMinFever}get temperatureIsHigherThanNormal(){return this.temperature.val>=this.calibration.thresholdMinFever&&this.temperature.val<=We}get temperatureIsProbablyAnError(){return this.temperature.val>We}get classNameForState(){return this.state.toLowerCase().replace("_","-")}get screeningResultClass(){if(this.screeningEvent){if(this.temperatureIsNormal)return"okay";if(this.temperatureIsHigherThanNormal)return"possible-fever";if(this.temperatureIsProbablyAnError)return"error"}return null}get hasScreeningResult(){return null!==this.screeningResultClass}get isTooFar(){return this.state===m.TOO_FAR}get isWarmingUp(){return this.state===m.WARMING_UP}get warmupBackgroundColour(){const e=37,t=70,r=66,a=198,n=100,i=42,s=Math.min(1,(Ut-this.warmupSecondsRemaining)/Ut),o=qe(a,s,e),h=qe(n,s,t),c=qe(i,s,r);return`hsl(${o}, ${h}%, ${c}%)`}get isAfterFFCEvent(){return this.state===m.AFTER_FFC_EVENT}get isAquiring(){return this.state===m.LARGE_BODY||this.state===m.FACE_LOCK||this.state===m.HEAD_LOCK||this.state===m.FRONTAL_LOCK||this.state===m.BLURRED||this.state===m.STABLE_LOCK}get missingRef(){return this.state===m.MISSING_THERMAL_REF}get remainingWarmupTime(){const e=this.warmupSecondsRemaining,t=Math.floor(e/60),r=e-60*t;return` ${String(t).padStart(2,"0")}:${String(Math.floor(r)).padStart(2,"0")}`}get message(){switch(this.state){case m.WARMING_UP:return{message:"Please wait",count:Number.MAX_SAFE_INTEGER};case m.MULTIPLE_HEADS:return{message:"Only one person should be in front of the camera",count:60};case m.HEAD_LOCK:case m.FACE_LOCK:return{message:"Please look straight ahead",count:-1};case m.FRONTAL_LOCK:case m.BLURRED:return{message:"Great, now hold still a moment",count:120};case m.STABLE_LOCK:if(this.screeningEvent){if(this.temperatureIsNormal)return{message:"Your temperature is normal",count:460};if(this.temperatureIsHigherThanNormal)return{message:"Your temperature is higher than normal, please don't enter",count:180};if(this.temperatureIsProbablyAnError)return{message:"Temperature anomaly, please check equipment",count:360}}break;case m.MEASURED:return this.screeningEvent?this.temperatureIsNormal?{message:"You're good to go!",count:-1}:{message:"You can go, but you need to get a follow-up",count:-1}:{message:"",count:-1};case m.READY:default:return{message:"Ready to screen",count:Number.MAX_SAFE_INTEGER}}return{message:"",count:0}}logForTest(e){this.isTesting&&this.$emit("new-message",e)}};(0,o.gn)([(0,l.fI)({required:!0})],Ke.prototype,"state",void 0),(0,o.gn)([(0,l.fI)({required:!0})],Ke.prototype,"screeningEvent",void 0),(0,o.gn)([(0,l.fI)({required:!0})],Ke.prototype,"calibration",void 0),(0,o.gn)([(0,l.fI)({required:!0})],Ke.prototype,"onReferenceDevice",void 0),(0,o.gn)([(0,l.fI)({required:!0})],Ke.prototype,"face",void 0),(0,o.gn)([(0,l.fI)({required:!0})],Ke.prototype,"shapes",void 0),(0,o.gn)([(0,l.fI)({required:!0})],Ke.prototype,"warmupSecondsRemaining",void 0),(0,o.gn)([(0,l.fI)({required:!0})],Ke.prototype,"isTesting",void 0),(0,o.gn)([(0,l.fI)({required:!0})],Ke.prototype,"thermalRefSide",void 0),(0,o.gn)([(0,l.fI)({default:!0})],Ke.prototype,"showCanvas",void 0),(0,o.gn)([(0,l.RL)("screeningEvent")],Ke.prototype,"onScreeningEventChange",null),Ke=(0,o.gn)([(0,l.wA)({components:{AdminSettings:He}})],Ke);const Je=Ke,et=Je;var tt=(0,O.Z)(et,h,c,!1,null,"19846409",null);const rt=tt.exports;k()(tt,{VBtn:P.Z,VCard:J.Z,VCardActions:ee.h7,VDialog:ne.Z,VIcon:N.Z});var at=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("pre",{ref:"logContainer",staticClass:"log-container"})])},nt=[];let it=class extends l.w3{mounted(){console.info("Test")}onFrameChange(){this.$refs.logContainer.innerText="";const e=this.frameLogs[this.framePos];e&&e.forEach((e=>{this.$refs.logContainer.innerText+=`${e}\n`}))}};(0,o.gn)([(0,l.fI)()],it.prototype,"framePos",void 0),(0,o.gn)([(0,l.fI)()],it.prototype,"frameLogs",void 0),(0,o.gn)([(0,l.RL)("framePos")],it.prototype,"onFrameChange",null),it=(0,o.gn)([l.wA],it);const st=it,ot=st;var ht=(0,O.Z)(ot,at,nt,!1,null,"4370d09e",null);const ct=ht.exports;var lt;(function(e){e[e["Connecting"]=0]="Connecting",e[e["Connected"]=1]="Connected",e[e["Disconnected"]=2]="Disconnected"})(lt||(lt={}));(new Date).getTime();var dt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"qr-container"},[r("transition",{attrs:{name:"fade"}},[e.registered?r("svg",{staticClass:"qr-image registered",attrs:{viewBox:"0,0,72,65",width:"86.4",height:"78",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[r("path",{attrs:{d:"M65 7L28 55 7 37",stroke:"#fff","stroke-width":"13","stroke-linecap":"round"}})]):r("svg",{staticClass:"qr-image",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0,0,1200,1200",width:150,height:150,fill:"white"}},[r("path",{attrs:{d:"M576 96h48v48h-48zM672 96h48v48h-48zM576 144h48v48h-48zM624 144h48v48h-48zM672 144h48v48h-48zM480 192h48v48h-48zM528 192h48v48h-48zM576 192h48v48h-48zM672 192h48v48h-48zM480 240h48v48h-48zM528 240h48v48h-48zM624 240h48v48h-48zM480 288h48v48h-48zM576 288h48v48h-48zM624 288h48v48h-48zM672 288h48v48h-48zM480 336h48v48h-48zM672 336h48v48h-48zM480 384h48v48h-48zM576 384h48v48h-48zM672 384h48v48h-48zM480 432h48v48h-48zM528 432h48v48h-48zM624 432h48v48h-48zM672 432h48v48h-48zM96 480h48v48H96zM192 480h48v48h-48zM240 480h48v48h-48zM288 480h48v48h-48zM336 480h48v48h-48zM384 480h48v48h-48zM576 480h48v48h-48zM672 480h48v48h-48zM768 480h48v48h-48zM816 480h48v48h-48zM864 480h48v48h-48zM912 480h48v48h-48zM960 480h48v48h-48zM192 528h48v48h-48zM288 528h48v48h-48zM336 528h48v48h-48zM432 528h48v48h-48zM480 528h48v48h-48zM576 528h48v48h-48zM672 528h48v48h-48zM816 528h48v48h-48zM912 528h48v48h-48zM960 528h48v48h-48zM1008 528h48v48h-48zM1056 528h48v48h-48zM96 576h48v48H96zM192 576h48v48h-48zM384 576h48v48h-48zM432 576h48v48h-48zM480 576h48v48h-48zM576 576h48v48h-48zM624 576h48v48h-48zM720 576h48v48h-48zM864 576h48v48h-48zM960 576h48v48h-48zM1056 576h48v48h-48zM96 624h48v48H96zM144 624h48v48h-48zM240 624h48v48h-48zM288 624h48v48h-48zM480 624h48v48h-48zM576 624h48v48h-48zM816 624h48v48h-48zM864 624h48v48h-48zM960 624h48v48h-48zM1008 624h48v48h-48zM1056 624h48v48h-48zM96 672h48v48H96zM192 672h48v48h-48zM288 672h48v48h-48zM336 672h48v48h-48zM384 672h48v48h-48zM432 672h48v48h-48zM624 672h48v48h-48zM720 672h48v48h-48zM864 672h48v48h-48zM960 672h48v48h-48zM1008 672h48v48h-48zM480 720h48v48h-48zM528 720h48v48h-48zM576 720h48v48h-48zM624 720h48v48h-48zM672 720h48v48h-48zM720 720h48v48h-48zM768 720h48v48h-48zM912 720h48v48h-48zM528 768h48v48h-48zM576 768h48v48h-48zM672 768h48v48h-48zM768 768h48v48h-48zM816 768h48v48h-48zM480 816h48v48h-48zM528 816h48v48h-48zM624 816h48v48h-48zM672 816h48v48h-48zM720 816h48v48h-48zM768 816h48v48h-48zM912 816h48v48h-48zM1008 816h48v48h-48zM480 864h48v48h-48zM672 864h48v48h-48zM816 864h48v48h-48zM960 864h48v48h-48zM480 912h48v48h-48zM528 912h48v48h-48zM576 912h48v48h-48zM672 912h48v48h-48zM816 912h48v48h-48zM960 912h48v48h-48zM480 960h48v48h-48zM528 960h48v48h-48zM576 960h48v48h-48zM624 960h48v48h-48zM720 960h48v48h-48zM864 960h48v48h-48zM912 960h48v48h-48zM960 960h48v48h-48zM816 1008h48v48h-48zM864 1008h48v48h-48zM960 1008h48v48h-48zM1008 1008h48v48h-48zM480 1056h48v48h-48zM576 1056h48v48h-48zM624 1056h48v48h-48zM720 1056h48v48h-48zM864 1056h48v48h-48zM912 1056h48v48h-48zM960 1056h48v48h-48z"}}),r("path",{attrs:{fill:"none",d:"M146 146h236v236H146z"}}),r("path",{attrs:{d:"M382 96H96v336h336V96h-50zm0 286H146V146h236v236z"}}),r("path",{attrs:{fill:"none",d:"M818 146h236v236H818z"}}),r("path",{attrs:{d:"M1054 96H768v336h336V96h-50zm0 286H818V146h236v236z"}}),r("path",{attrs:{fill:"none",d:"M146 818h236v236H146z"}}),r("path",{attrs:{d:"M382 768H96v336h336V768h-50zm0 286H146V818h236v236z"}}),r("g",[r("path",{attrs:{d:"M192 192h144v144H192z"}})]),r("g",[r("path",{attrs:{d:"M864 192h144v144H864z"}})]),r("g",[r("path",{attrs:{d:"M192 864h144v144H192z"}})])])]),r("p",{staticClass:"qr-text"},[e._v(e._s(e.qrMessage))])],1)},ut=[];let pt=class extends l.w3{get qrMessage(){switch(this.qrState){case a.Valid:return"Registered";case a.Invalid:return"Invalid ID Try Again";case a.Unregistered:return"Present ID to register"}return"Present ID to register"}get registered(){return this.qrState===a.Valid}};(0,o.gn)([(0,l.fI)({required:!0})],pt.prototype,"qrState",void 0),pt=(0,o.gn)([l.wA],pt);const mt=pt,gt=mt;var vt=(0,O.Z)(gt,dt,ut,!1,null,null,null);const ft=vt.exports;var bt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"video-container"},[r("transition",{attrs:{name:"fade"}},[r("video",{ref:"videoStream",staticClass:"video-canvas",class:{"stream-loaded":e.streamLoaded,"stream-not-loaded":!e.streamLoaded},attrs:{autoplay:""},domProps:{srcObject:e.stream}})])],1)},yt=[];Fe.Z.WORKER_PATH="../qr-scanner-worker.min.js";let St=class extends l.w3{constructor(){super(...arguments),this.stream={},this.timeQRFound=0,this.streamLoaded=!1,this.qrScanner=void 0}async mounted(){try{this.$refs.videoStream.oncanplay=()=>{this.streamLoaded=!0};const e=await Fe.Z.listCameras(!0);this.qrScanner=new Fe.Z(this.$refs.videoStream,(e=>{this.setQRCode(e)}),void 0,(e=>({x:0,y:0,width:e.width,height:e.height})),e[0].id)}catch(e){console.error(e)}}destroy(){this.qrScanner&&(this.streamLoaded=!1,this.qrScanner.destroy())}runScan(){var e;this.startScanning?null===(e=this.qrScanner)||void 0===e||e.start():(this.streamLoaded=!1,setTimeout((()=>{var e;null===(e=this.qrScanner)||void 0===e||e.stop()}),500))}};(0,o.gn)([(0,l.fI)({required:!0})],St.prototype,"setQRCode",void 0),(0,o.gn)([(0,l.fI)({required:!0})],St.prototype,"startScanning",void 0),(0,o.gn)([(0,l.RL)("startScanning")],St.prototype,"runScan",null),St=(0,o.gn)([l.wA],St);const Ct=St,wt=Ct;var Rt=(0,O.Z)(wt,bt,yt,!1,null,"085cdd7e",null);const Tt=Rt.exports;function Mt(){const e=e=>1e3*e,t=()=>jt.recorderStatus().then((({recording:e})=>e));return{startTimeInFrame:0,startTimeOutFrame:0,isRecording:t(),hasMeasured:!1,async process(r){const a=this.getTimeInFrame(r),{hasExit:n,isInFrame:i}=this.isObjectStillInFrame(r);if(this.measuredInFrame(r),i&&!this.isRecording)await jt.startRecording(),this.isRecording=await t();else if(n&&this.isRecording){const r=a>e(8)||this.hasMeasured&&a>e(1);this.hasMeasured=!1,await jt.stopRecording(r),this.isRecording=await t()}},measuredInFrame(e){const t=e.analysisResult.nextState;this.hasMeasured=t===m.MEASURED||this.hasMeasured},isObjectInFrame(e){const t=e.analysisResult.nextState;return[m.HEAD_LOCK,m.LARGE_BODY,m.FRONTAL_LOCK,m.STABLE_LOCK,m.MULTIPLE_HEADS,m.MEASURED,m.TOO_FAR].includes(t)},hasObjectExitFrame(t){const r=this.isObjectInFrame(t),a=e(3),n=Date.now();this.startTimeOutFrame=r?n:this.startTimeOutFrame;const i=Math.abs(n-this.startTimeOutFrame),s=i>a;return this.startTimeOutFrame=s?1/0:this.startTimeOutFrame,s},isObjectStillInFrame(e){const t=this.isObjectInFrame(e),r=this.hasObjectExitFrame(e);return{isInFrame:t,hasExit:r}},getTimeInFrame(e){const t=Date.now(),{isInFrame:r,hasExit:a}=this.isObjectStillInFrame(e);if(r)return this.startTimeInFrame=0===this.startTimeInFrame?t:this.startTimeInFrame,t-this.startTimeInFrame;if(0===this.startTimeInFrame)return 0;if(a){const e=t-this.startTimeInFrame;return this.startTimeInFrame=0,e}return t-this.startTimeInFrame}}}const Ft=Mt;function Et(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function It(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Et(Object(r),!0).forEach((function(t){xt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Et(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function xt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let Ot=class extends l.w3{constructor(){super(...arguments),this.deviceID="",this.deviceName="",this.piSerial="",this.appVersion="",this.appState=Wt,this.isNotFullscreen=!0,this.showUpdatedCalibrationSnackbar=!1,this.frameHandler=Ft(),this.frameListener=new Worker(new URL(r.p+r.u(352),r.b)),this.showSoftwareVersionUpdatedPrompt=!1,this.useLiveCamera=!0,this.gotFirstFrame=!1,this.cptvStartFrame=0,this.cptvEndFrame=0,this.qrCode=null,this.startTimeInFrame=0,this.startTimeOutFrame=1/0,this.isRecording=!1,this.skippedWarmup=!1,this.thermalRefSide="left",this.prevShape=[],this.nextShape=[],this.attemptingFFC=!1,this.runningFFC=!1,this.frameLogs=[],this.startLoad=!0,this.frames=[],this.framePos=0,this.rangeFrames=[0,100],this.paused=!1,this.hostname=""}get isReferenceDevice(){return window.navigator.userAgent.includes("Lenovo TB-X605LC")||this.isRunningInAndroidWebview}get face(){var e;return(null===(e=this.appState.currentFrame)||void 0===e?void 0:e.analysisResult.face)||null}get finishScan(){return this.appState.currentScreeningState===m.MEASURED}get qrMode(){return jt.RegisterQRID}get isRunningInAndroidWebview(){return"feverscreen-app"===window.navigator.userAgent}get isFakeReferenceDevice(){return window.navigator.userAgent.includes("Fake")}async enableFullscreen(){try{await document.body.requestFullscreen(),this.isNotFullscreen=!1}catch(e){return}}skipWarmup(){this.skippedWarmup=!0}get currentFrameCount(){return this.appState.currentFrame.frameInfo?this.appState.currentFrame.frameInfo.Telemetry.FrameCount:0}setQRCode(e){this.qrCode=e}get qrState(){return null!==this.qrCode?this.isValidQR()?a.Valid:a.Invalid:a.Unregistered}isValidQR(){return!!this.qrCode&&"tko-"===this.qrCode.slice(0,4)}get registered(){return this.qrState===a.Valid}updateCalibration(e,t=!1){t||this.appState.uuid===e.UuidOfUpdater||(this.showUpdatedCalibrationSnackbar=!0,setTimeout((()=>{this.showUpdatedCalibrationSnackbar=!1}),3e3)),this.appState.currentCalibration.thermalRefTemperature=new v(e.ThermalRefTemp),this.appState.currentCalibration.calibrationTemperature=new v(e.TemperatureCelsius),this.appState.currentCalibration.thresholdMinFever=e.ThresholdMinFever,this.appState.currentCalibration.head={tL:{x:e.HeadTLX,y:e.HeadTLY},tR:{x:e.HeadTRX,y:e.HeadTRY},bL:{x:e.HeadBLX,y:e.HeadBLY},bR:{x:e.HeadBRX,y:e.HeadBRY}},this.appState.currentCalibration.playNormalSound=e.UseNormalSound,this.appState.currentCalibration.playWarningSound=e.UseWarningSound,this.appState.currentCalibration.playErrorSound=e.UseErrorSound}get currentFrame(){return this.appState.currentFrame}get timeOnInSeconds(){var e;const t=null===(e=this.frameInfo)||void 0===e?void 0:e.Telemetry;if(t){let e;return e=this.useLiveCamera?t.TimeOn/1e3/1e3/1e3:t.TimeOn/1e3,e}return Ut}get isWarmingUp(){return!this.skippedWarmup&&this.timeOnInSeconds<Ut&&0!==this.timeOnInSeconds}get remainingWarmupTime(){return this.skippedWarmup?0:Math.max(0,Ut-this.timeOnInSeconds)}get isDuringFFCEvent(){var e;const t=null===(e=this.frameInfo)||void 0===e?void 0:e.Telemetry;return!(this.isWarmingUp||!t)&&(t.TimeOn-t.LastFFCTime)/1e3<$t}get isGettingFrames(){return this.appState.lastFrameTime>(new Date).getTime()-1e3}get isNotGettingFrames(){return!(this.appState.lastFrameTime>(new Date).getTime()-1e3)}get isConnected(){return this.appState.cameraConnectionState===lt.Connected}get isConnecting(){return this.appState.cameraConnectionState===lt.Connecting}updateBodyOutline(e){this.prevShape=this.nextShape;const t=[];for(let r=0;r<e.length;r+=3){const a=e[r],n=e[r+1],i=e[r+2];t.push({x0:n,x1:i,y:a})}Ht.amount=0,t.length?this.nextShape=[Object.freeze(t)]:this.nextShape=[]}checkForSoftwareUpdatesThisFrame(e){const t=e.frameInfo.AppVersion.indexOf("\n");-1!==t&&(e.frameInfo.AppVersion=e.frameInfo.AppVersion.substring(0,t)),b(e.frameInfo.BinaryVersion,e.frameInfo.AppVersion,this.gotFirstFrame)}checkForCalibrationUpdatesThisFrame(e){if(this.frameInfo){const t=JSON.stringify(this.frameInfo.Calibration),r=JSON.stringify(e.frameInfo.Calibration);t!==r&&this.updateCalibration(e.frameInfo.Calibration)}}async onFrame(e){this.checkForSoftwareUpdatesThisFrame(e),this.checkForCalibrationUpdatesThisFrame(e),this.updateBodyOutline(e.bodyShape),this.appState.lastFrameTime=(new Date).getTime();const t=this.appState.currentScreeningState,r=e.analysisResult.nextState;if(this.appState.currentFrame=e,jt.RecordUserActivity&&this.frameHandler.process(e),e.analysisResult.thermalRef.geom.center.x<60?this.thermalRefSide="left":this.thermalRefSide="right",this.isWarmingUp)this.appState.currentScreeningState=m.WARMING_UP;else{let a=e.frameInfo.Telemetry.TimeOn-e.frameInfo.Telemetry.LastFFCTime;this.useLiveCamera&&(a=a/1e3/1e3);const n=Bt-a;if(t===m.STABLE_LOCK&&r===m.MEASURED){const t=e.analysisResult.face,r=e.analysisResult.thermalRef;this.snapshotScreeningEvent(r,t,e,It(It({},t.samplePoint),{},{v:t.sampleValue,t:t.sampleTemp}))}else if(t===m.MEASURED&&r===m.READY){if(this.isReferenceDevice){n<3e4&&this.runFFC();const e=this.isValidQR()?this.qrCode:null;G.recordScreeningEvent(this.deviceID,this.piSerial,this.appState.currentScreeningEvent,this.appState.currentCalibration.thresholdMinFever,e),this.qrCode=null}this.appState.currentScreeningEvent=null}else this.isReferenceDevice&&n<3e4&&this.runFFC();this.appState.currentScreeningState=r,r!==m.MEASURED&&this.setQRCode(null)}}runFFC(){if(!this.attemptingFFC){this.attemptingFFC=!0;let e=0;const t=setInterval((()=>{this.appState.currentScreeningState===m.READY?e+=1:e=0,12===e&&(this.attemptingFFC=!1,this.appState.currentScreeningState=m.AFTER_FFC_EVENT,this.runningFFC=!0,jt.runFFC(),setTimeout((()=>{this.runningFFC=!1}),5e3),clearInterval(t))}),300)}}get frameInfo(){var e;return null===(e=this.appState.currentFrame)||void 0===e?void 0:e.frameInfo}snapshotScreeningEvent(e,t,r,a){this.appState.currentScreeningEvent={rawTemperatureValue:a.v,calculatedValue:a.t,sampleX:a.x,sampleY:a.y,frame:r,timestamp:new Date,thermalReference:e,face:t}}onConnectionStateChange(e){this.appState.cameraConnectionState=e}async checkForSettingsChanges(e){const t=await Z.getDevice(e);if(void 0!==t){var r,a;const e=t.recordUserActivity["BOOL"],n=await Fe.Z.hasCamera();jt.RegisterQRID=!!n&&(null!==(r=null===(a=t.qrMode)||void 0===a?void 0:a["BOOL"])&&void 0!==r&&r),jt.RecordUserActivity=e,jt.DisableRecordUserActivity=!e}else jt.DisableRecordUserActivity=!1,jt.RecordUserActivity="false"!==window.localStorage.getItem("recordUserActivity")}async mounted(){let e="/cptv-files/0.7.5beta recording-1 2708.cptv";const t=window.location.search.substring(1),r=new URLSearchParams(t);if(r.get("cptvfile")&&(e=`/cptv-files/${r.get("cptvfile")}.cptv`,this.useLiveCamera=!1),this.useLiveCamera){var a,n,i;this.appState.uuid=(new Date).getTime(),await jt.stopRecording(!1),jt.getCalibration().then((e=>{null===e&&(e=It({},p)),this.updateCalibration(e,!0),jt.softwareVersion().then((({appVersion:e,binaryVersion:t})=>{jt.deviceInfo().then((({deviceID:r,devicename:a,serial:n})=>{this.deviceID=r,this.deviceName=a,this.piSerial=n;const i=e.indexOf("\n");let s=e;this.checkForSettingsChanges(r),setInterval((()=>{this.checkForSettingsChanges(r)}),18e5),-1!==i&&(s=s.substring(0,i)),this.appVersion=s,b(t,s,this.gotFirstFrame)&&(this.showSoftwareVersionUpdatedPrompt=!0)}))}))}));const e=await jt.networkInfo();this.hostname=null!==(a=null===(n=e.Interfaces.find((e=>e.Name===(this.isReferenceDevice?"usb0":"eth0")&&null!==e.IPAddresses)))||void 0===n||null===(i=n.IPAddresses)||void 0===i?void 0:i[0].split("/")[0].replace(/\s/g,""))&&void 0!==a?a:window.location.hostname}this.frameListener.onmessage=e=>{const t=e.data,r=t.payload;t.payload;switch(t.type){case"gotFrame":0===r.frameInfo.Telemetry.FrameCount&&this.gotFirstFrame?(this.cptvEndFrame=this.frames.length,this.playLoadedCptv(),this.frameListener.terminate()):(this.gotFirstFrame=!0,this.isReferenceDevice||this.frames.push(r),this.runningFFC||this.onFrame(r));break;case"connectionStateChange":this.onConnectionStateChange(t.payload);break;case"info":this.frameLogs[this.frames.length]?this.frameLogs[this.frames.length].push(...t.payload):this.frameLogs.push(t.payload)}};const s=setInterval((()=>{this.isGettingFrames&&clearInterval(s),this.frameListener.postMessage({useLiveCamera:this.useLiveCamera,hostname:this.hostname,port:window.location.port,cptvFileToPlayback:e})}),1e3)}get currFramePos(){return this.framePos}get minFrame(){return Math.floor(this.frames.length*(this.rangeFrames[0]/100))}get maxFrame(){return Math.ceil(this.frames.length*(this.rangeFrames[1]/100))}incrementFramePos(){this.framePos+=1,this.framePos=this.framePos%this.maxFrame,(0===this.framePos||this.framePos<this.minFrame)&&(this.framePos=this.minFrame)}playLoadedCptv(){setInterval((()=>{this.paused||(this.incrementFramePos(),this.onFrame(this.frames[this.framePos]))}),1e3/9)}};Ot=(0,o.gn)([(0,l.wA)({components:{UserFacingScreening:rt,VideoStream:$,QRVideo:Tt,QRImage:ft,LoggingInterface:ct}})],Ot);const _t=Ot,At=_t;var Dt=r(3559),Lt=r(6794),zt=r(8704),Vt=(0,O.Z)(At,i,s,!1,null,null,null);const kt=Vt.exports;k()(Vt,{VApp:Dt.Z,VBtn:P.Z,VCard:J.Z,VCardActions:ee.h7,VCardTitle:ee.EB,VDialog:ne.Z,VOverlay:ie.Z,VRangeSlider:Lt.Z,VRow:se.Z,VSnackbar:zt.Z});var Pt=r(7850);n.Z.use(Pt.Z);const Nt=new Pt.Z({icons:{iconfont:"mdiSvg"}});n.Z.config.productionTip=!1;const Ut=1200,$t=5,Bt=6e5,Ht={amount:0},Wt={currentFrame:null,cameraConnectionState:lt.Disconnected,face:null,paused:!1,currentCalibration:{calibrationTemperature:new v(36),thermalReferenceRawValue:3e4,hotspotRawTemperatureValue:31e3,timestamp:new Date,head:{tL:{x:0,y:0},tR:{x:0,y:0},bL:{x:0,y:0},bR:{x:0,y:0}},thresholdMinFever:u,thermalRefTemperature:new v(0),playErrorSound:!0,playNormalSound:!0,playWarningSound:!0},currentScreeningEvent:null,currentScreeningState:m.INIT,currentScreeningStateFrameCount:-1,lastFrameTime:0,uuid:0,analysisResult:{thresholdSum:0,motionThresholdSum:0,heatStats:{max:0,min:0,threshold:0},face:{isValid:!1,headLock:0,halfwayRatio:0,samplePoint:{x:0,y:0},sampleValue:0,sampleTemp:0,head:{topLeft:{x:0,y:0},topRight:{x:0,y:0},bottomLeft:{x:0,y:0},bottomRight:{x:0,y:0}}},thermalRef:{geom:{center:{x:0,y:0},radius:0},val:0,temp:0},hasBody:!1,nextState:m.INIT,motionSum:0,frameBottomSum:0}},jt=n.Z.observable(Q);new n.Z({vuetify:Nt,render:e=>e(kt)}).$mount("#app")}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={id:a,exports:{}};return e[a](i,i.exports,r),i.exports}r.m=e,r.c=t,(()=>{var e=[];r.O=(t,a,n,i)=>{if(!a){var s=1/0;for(l=0;l<e.length;l++){for(var[a,n,i]=e[l],o=!0,h=0;h<a.length;h++)(!1&i||s>=i)&&Object.keys(r.O).every((e=>r.O[e](a[h])))?a.splice(h--,1):(o=!1,i<s&&(s=i));if(o){e.splice(l--,1);var c=n();void 0!==c&&(t=c)}}return t}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[a,n,i]}})(),(()=>{r.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return r.d(t,{a:t}),t}})(),(()=>{r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}})(),(()=>{r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,a)=>(r.f[a](e,t),t)),[]))})(),(()=>{r.u=e=>"js/"+e+"."+{352:"a7ab1c51",641:"775b6dd3"}[e]+".js"})(),(()=>{r.miniCssF=e=>"css/chunk-vendors.d9ee0f11.css"})(),(()=>{r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={},t="frontend:";r.l=(a,n,i,s)=>{if(e[a])e[a].push(n);else{var o,h;if(void 0!==i)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var d=c[l];if(d.getAttribute("src")==a||d.getAttribute("data-webpack")==t+i){o=d;break}}o||(h=!0,o=document.createElement("script"),o.charset="utf-8",o.timeout=120,r.nc&&o.setAttribute("nonce",r.nc),o.setAttribute("data-webpack",t+i),o.src=a),e[a]=[n];var u=(t,r)=>{o.onerror=o.onload=null,clearTimeout(p);var n=e[a];if(delete e[a],o.parentNode&&o.parentNode.removeChild(o),n&&n.forEach((e=>e(r))),t)return t(r)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),h&&document.head.appendChild(o)}}})(),(()=>{r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{r.p="/static/dist/"})(),(()=>{r.b=document.baseURI||self.location.href;var e={143:0};r.f.j=(t,a)=>{var n=r.o(e,t)?e[t]:void 0;if(0!==n)if(n)a.push(n[2]);else{var i=new Promise(((r,a)=>n=e[t]=[r,a]));a.push(n[2]=i);var s=r.p+r.u(t),o=new Error,h=a=>{if(r.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var i=a&&("load"===a.type?"missing":a.type),s=a&&a.target&&a.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",o.name="ChunkLoadError",o.type=i,o.request=s,n[1](o)}};r.l(s,h,"chunk-"+t,t)}},r.O.j=t=>0===e[t];var t=(t,a)=>{var n,i,[s,o,h]=a,c=0;for(n in o)r.o(o,n)&&(r.m[n]=o[n]);if(h)var l=h(r);for(t&&t(a);c<s.length;c++)i=s[c],r.o(e,i)&&e[i]&&e[i][0](),e[s[c]]=0;return r.O(l)},a=globalThis["webpackChunkfrontend"]=globalThis["webpackChunkfrontend"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})(),(()=>{var e,t,a,n,i,s={};var o={9534:function(){return{"./curve_fitting_bg.js":{__wbindgen_number_new:function(t){return void 0===e&&(e=r.c[476].exports),e["pT"](t)},__wbindgen_object_drop_ref:function(e){return void 0===t&&(t=r.c[476].exports),t["ug"](e)},__wbg_new_6b6f346b4912cdae:function(){return void 0===a&&(a=r.c[476].exports),a["w_"]()},__wbg_push_f353108e20ec67a0:function(e,t){return void 0===n&&(n=r.c[476].exports),n["TJ"](e,t)},__wbindgen_throw:function(e,t){return void 0===i&&(i=r.c[476].exports),i["Or"](e,t)}}}}},h={641:[9534]};r.w={},r.f.wasm=function(e,t){var a=h[e]||[];a.forEach((function(a,n){var i=s[a];if(i)t.push(i);else{var h,c=o[a](),l=fetch(r.p+""+{641:{9534:"e3f7296217571fdd8bb8"}}[e][a]+".module.wasm");if(c&&"function"===typeof c.then&&"function"===typeof WebAssembly.compileStreaming)h=Promise.all([WebAssembly.compileStreaming(l),c]).then((function(e){return WebAssembly.instantiate(e[0],e[1])}));else if("function"===typeof WebAssembly.instantiateStreaming)h=WebAssembly.instantiateStreaming(l,c);else{var d=l.then((function(e){return e.arrayBuffer()}));h=d.then((function(e){return WebAssembly.instantiate(e,c)}))}t.push(s[a]=h.then((function(e){return r.w[a]=(e.instance||e).exports})))}}))}})();var a=r.O(void 0,[998],(()=>r(2300)));a=r.O(a)})();
//# sourceMappingURL=app.f71413f0.js.map