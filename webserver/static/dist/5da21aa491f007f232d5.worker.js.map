{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/processing.ts","webpack:///./src/utils.ts","webpack:///./src/types.ts","webpack:///./src/camera.ts","webpack:///./cptv-player/cptv_player.js","webpack:///./src/frame-listener.ts"],"names":["__exports","wasm","initBufferWithSize","size","cachegetUint8Memory","getUint8Memory","buffer","memory","Uint8Array","WASM_VECTOR_LEN","passArray8ToWasm","arg","ptr","__wbindgen_malloc","length","set","insertChunkAtOffset","chunk","offset","heap","Array","fill","undefined","push","getObject","idx","heap_next","dropObject","takeObject","ret","initWithCptvData","input","getNumFrames","getWidth","getHeight","getFrameRate","getFramesPerIframe","getMinValue","getMaxValue","getHeader","addHeapObject","obj","queueFrame","number","callback","getFrame","image_data","ptr0","len0","subarray","__wbindgen_free","getRawFrame","FrameHeaderV2","__wrap","cachedTextDecoder","TextDecoder","ignoreBOM","fatal","decode","getStringFromWasm","len","cachedTextEncoder","TextEncoder","encodeString","encodeInto","view","buf","encode","read","written","passStringToWasm","mem","code","charCodeAt","slice","__wbindgen_realloc","cachegetInt32Memory","getInt32Memory","Int32Array","Object","create","prototype","free","__wbg_frameheaderv2_free","time_on","__wbg_get_frameheaderv2_time_on","arg0","__wbg_set_frameheaderv2_time_on","last_ffc_time","__wbg_get_frameheaderv2_last_ffc_time","__wbg_set_frameheaderv2_last_ffc_time","frame_number","__wbg_get_frameheaderv2_frame_number","__wbg_set_frameheaderv2_frame_number","has_next_frame","__wbg_get_frameheaderv2_has_next_frame","__wbg_set_frameheaderv2_has_next_frame","init","module","result","imports","wbg","__wbindgen_object_drop_ref","__wbindgen_string_new","arg1","__widl_f_debug_1_","console","debug","__widl_f_error_1_","error","__widl_f_info_1_","info","__widl_f_log_1_","log","__widl_f_warn_1_","warn","__wbg_new_59cb74e423758ede","Error","__wbg_stack_558ba5917b466edd","stack","ret0","ret1","__wbg_error_4bb6c2a97407129a","v0","__wbindgen_throw","__wbindgen_rethrow","URL","Request","response","fetch","WebAssembly","instantiateStreaming","catch","e","then","r","headers","get","arrayBuffer","bytes","instantiate","Instance","instance","exports","__wbindgen_wasm_module","self","wasm_bindgen","assign"],"mappings":"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","file":"5da21aa491f007f232d5.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/static/dist/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"fbd5\");\n","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"c423efc09b1832f59f76.worker.js\");\n};","export const BlobReader = (function(): {\r\n  arrayBuffer: (blob: Blob) => Promise<ArrayBuffer>;\r\n} {\r\n  // For comparability with older browsers/iOS that don't yet support arrayBuffer()\r\n  // directly off the blob object\r\n  const arrayBuffer: (blob: Blob) => Promise<ArrayBuffer> =\r\n    \"arrayBuffer\" in Blob.prototype &&\r\n    typeof (Blob.prototype as Blob)[\"arrayBuffer\"] === \"function\"\r\n      ? (blob: Blob) => blob[\"arrayBuffer\"]()\r\n      : (blob: Blob) =>\r\n          new Promise((resolve, reject) => {\r\n            const fileReader = new FileReader();\r\n            fileReader.addEventListener(\"load\", () => {\r\n              resolve(fileReader.result as ArrayBuffer);\r\n            });\r\n            fileReader.addEventListener(\"error\", () => {\r\n              reject();\r\n            });\r\n            fileReader.readAsArrayBuffer(blob);\r\n          });\r\n\r\n  return {\r\n    arrayBuffer\r\n  };\r\n})();\r\n\r\nexport class DegreesCelsius {\r\n  public val: number;\r\n  constructor(val: number) {\r\n    this.val = val;\r\n  }\r\n  public toString(): string {\r\n    if (this.val === undefined) {\r\n      debugger;\r\n    }\r\n    return `${this.val.toFixed(1)}°`;\r\n  }\r\n}\r\n\r\nexport const temperatureForSensorValue = (\r\n  savedThermalRefValue: number,\r\n  rawValue: number,\r\n  currentThermalRefValue: number\r\n): DegreesCelsius => {\r\n  return new DegreesCelsius(\r\n    savedThermalRefValue + (rawValue - currentThermalRefValue) * 0.01\r\n  );\r\n};\r\n\r\nexport function saveCurrentVersion(binaryVersion: string, appVersion: string) {\r\n  window.localStorage.setItem(\r\n    \"softwareVersion\",\r\n    JSON.stringify({\r\n      appVersion,\r\n      binaryVersion\r\n    })\r\n  );\r\n}\r\n\r\nexport function checkForSoftwareUpdates(\r\n  binaryVersion: string,\r\n  appVersion: string,\r\n  shouldReloadIfChanged = true\r\n): boolean {\r\n  const prevVersionJSON = window.localStorage.getItem(\"softwareVersion\");\r\n  if (prevVersionJSON) {\r\n    try {\r\n      const prevVersion = JSON.parse(prevVersionJSON);\r\n      if (\r\n          binaryVersion && appVersion && (\r\n        prevVersion.binaryVersion != binaryVersion ||\r\n        prevVersion.appVersion != appVersion\r\n          )\r\n      ) {\r\n        if (shouldReloadIfChanged) {\r\n          console.log(\r\n            \"reload because version changed\",\r\n            JSON.stringify(prevVersion),\r\n            binaryVersion,\r\n            appVersion\r\n          );\r\n          window.location.reload();\r\n        } else {\r\n          saveCurrentVersion(binaryVersion, appVersion);\r\n          // Display info that the software has updated since last started up.\r\n          return true;\r\n        }\r\n      }\r\n    } catch (e) {\r\n      saveCurrentVersion(binaryVersion, appVersion);\r\n      return false;\r\n    }\r\n  } else {\r\n    saveCurrentVersion(binaryVersion, appVersion);\r\n  }\r\n  return false;\r\n}\r\n","import { CameraConnectionState, Frame } from \"./camera\";\r\nimport { DegreesCelsius } from \"@/utils\";\r\nimport { Point } from \"@/geom\";\r\n\r\nexport const DEFAULT_THRESHOLD_MIN_FEVER = 37.5;\r\nexport const FactoryDefaultCalibration: CalibrationInfo = {\r\n  ThermalRefTemp: 38.190234374999996,\r\n  SnapshotTime: 0,\r\n  TemperatureCelsius: 37.1,\r\n  SnapshotValue: 30197.9765625,\r\n  ThresholdMinFever: DEFAULT_THRESHOLD_MIN_FEVER,\r\n  HeadBLX: 0,\r\n  HeadBLY: 0,\r\n  HeadBRX: 0,\r\n  HeadBRY: 0,\r\n  HeadTLX: 0,\r\n  HeadTLY: 0,\r\n  HeadTRX: 0,\r\n  HeadTRY: 0,\r\n  CalibrationBinaryVersion: \"abcde\", // Fill these out.\r\n  UuidOfUpdater: 432423432432, // Fill these out.\r\n  UseNormalSound: true,\r\n  UseWarningSound: true,\r\n  UseErrorSound: true\r\n}\r\n\r\nexport interface CalibrationInfo {\r\n  ThermalRefTemp: number;\r\n  SnapshotTime: number;\r\n  TemperatureCelsius: number;\r\n  SnapshotValue: number;\r\n  ThresholdMinFever: number;\r\n  HeadTLX: number;\r\n  HeadTLY: number;\r\n  HeadBLX: number;\r\n  HeadBLY: number;\r\n  HeadTRX: number;\r\n  HeadTRY: number;\r\n  HeadBRX: number;\r\n  HeadBRY: number;\r\n  CalibrationBinaryVersion: string;\r\n  UuidOfUpdater: number;\r\n  UseNormalSound: boolean;\r\n  UseWarningSound: boolean;\r\n  UseErrorSound: boolean;\r\n}\r\n\r\n\r\nexport type BoxOffset = \"left\" | \"right\" | \"top\" | \"bottom\";\r\nexport interface CropBox {\r\n  left: number;\r\n  right: number;\r\n  top: number;\r\n  bottom: number;\r\n}\r\nexport interface BoundingBox {\r\n  x0: number;\r\n  x1: number;\r\n  y0: number;\r\n  y1: number;\r\n}\r\n\r\nexport enum ScreeningState {\r\n  INIT = \"INIT\",\r\n  WARMING_UP = \"WARMING_UP\",\r\n  READY = \"READY\", // no face\r\n  HEAD_LOCK = \"HEAD_LOCK\",\r\n  TOO_FAR = \"TOO_FAR\",\r\n  LARGE_BODY = \"LARGE_BODY\",\r\n  MULTIPLE_HEADS = \"MULTIPLE_HEADS\",\r\n  FACE_LOCK = \"FACE_LOCK\", // has face\r\n  FRONTAL_LOCK = \"FRONTAL_LOCK\", // Face is front-on\r\n  STABLE_LOCK = \"STABLE_LOCK\", // Face has not changed in size or position for a couple of frames.\r\n  MEASURED = \"MEASURED\", // has face, but not front-on\r\n  MISSING_THERMAL_REF = \"MISSING_REF\",\r\n  BLURRED = \"BLURRED\",\r\n  AFTER_FFC_EVENT = \"AFTER_FFC_EVENT\"\r\n}\r\n\r\nexport interface CalibrationConfig {\r\n  timestamp: Date;\r\n  thermalReferenceRawValue: number;\r\n  hotspotRawTemperatureValue: number;\r\n  calibrationTemperature: DegreesCelsius;\r\n  thermalRefTemperature: DegreesCelsius;\r\n  thresholdMinFever: number;\r\n  playNormalSound: boolean;\r\n  playErrorSound: boolean;\r\n  playWarningSound: boolean;\r\n  head: { tL: Point, tR: Point, bL: Point, bR: Point }\r\n}\r\n\r\nexport interface Circle {\r\n  center: Point;\r\n  radius: number;\r\n}\r\n\r\nexport interface ThermalReference {\r\n  geom: Circle;\r\n  val: number;\r\n  temp: number;\r\n}\r\n\r\nexport interface ScreeningEvent {\r\n  timestamp: Date;\r\n  rawTemperatureValue: number;\r\n  calculatedValue: number;\r\n  sampleX: number;\r\n  sampleY: number;\r\n  frame: Frame;\r\n  thermalReference: ThermalReference;\r\n  face: FaceInfo;\r\n}\r\n\r\nexport interface FaceInfo {\r\n  halfwayRatio: number;\r\n  headLock: number;\r\n  isValid: boolean;\r\n  samplePoint: Point;\r\n  sampleValue: number;\r\n  sampleTemp: number;\r\n  head: {\r\n    topLeft: Point;\r\n    topRight: Point;\r\n    bottomLeft: Point;\r\n    bottomRight: Point;\r\n  };\r\n}\r\n\r\nexport interface AnalysisResult {\r\n  motionSum: number;\r\n  motionThresholdSum: number;\r\n  thresholdSum: number;\r\n  frameBottomSum: number;\r\n  heatStats: {\r\n    min: number;\r\n    max: number;\r\n    threshold: number;\r\n  };\r\n  face: FaceInfo;\r\n  nextState: ScreeningState;\r\n  hasBody: boolean;\r\n  thermalRef: ThermalReference;\r\n}\r\n\r\nexport const InitialFrameInfo = {\r\n  Camera: {\r\n    ResX: 160,\r\n    ResY: 120,\r\n    FPS: 9,\r\n    Brand: \"flir\",\r\n    Model: \"lepton3.5\",\r\n    Firmware: \"3.3.26\",\r\n    CameraSerial: 12345\r\n  },\r\n  Telemetry: {\r\n    FrameCount: 1,\r\n    TimeOn: 1,\r\n    FFCState: \"On\",\r\n    FrameMean: 0,\r\n    TempC: 0,\r\n    LastFFCTempC: 0,\r\n    LastFFCTime: 0\r\n  },\r\n  AppVersion: \"\",\r\n  BinaryVersion: \"\",\r\n  Calibration: FactoryDefaultCalibration\r\n};\r\n\r\nexport interface AppState {\r\n  currentFrame: Frame | null;\r\n  cameraConnectionState: CameraConnectionState;\r\n  face: FaceInfo | null;\r\n  currentCalibration: CalibrationConfig;\r\n  currentScreeningEvent: ScreeningEvent | null;\r\n  currentScreeningState: ScreeningState;\r\n  currentScreeningStateFrameCount: number;\r\n  paused: boolean;\r\n  lastFrameTime: number;\r\n  uuid: number;\r\n  analysisResult: AnalysisResult;\r\n}\r\n\r\nfunction getScreeningState(state: number): ScreeningState {\r\n  let screeningState = ScreeningState.INIT;\r\n  switch (state) {\r\n    case 0:\r\n      screeningState = ScreeningState.WARMING_UP;\r\n      break;\r\n    case 1:\r\n      screeningState = ScreeningState.READY;\r\n      break;\r\n    case 2:\r\n      screeningState = ScreeningState.HEAD_LOCK;\r\n      break;\r\n    case 3:\r\n      screeningState = ScreeningState.TOO_FAR;\r\n      break;\r\n    case 4:\r\n      screeningState = ScreeningState.LARGE_BODY;\r\n      break;\r\n    case 5:\r\n      screeningState = ScreeningState.FACE_LOCK;\r\n      break;\r\n    case 6:\r\n      screeningState = ScreeningState.FRONTAL_LOCK;\r\n      break;\r\n    case 7:\r\n      screeningState = ScreeningState.STABLE_LOCK;\r\n      break;\r\n    case 8:\r\n      screeningState = ScreeningState.MEASURED;\r\n      break;\r\n    case 9:\r\n      screeningState = ScreeningState.MISSING_THERMAL_REF;\r\n      break;\r\n    case 10:\r\n      screeningState = ScreeningState.BLURRED;\r\n      break;\r\n    case 11:\r\n      screeningState = ScreeningState.AFTER_FFC_EVENT;\r\n      break;\r\n  }\r\n  return screeningState;\r\n}\r\n\r\nexport function extractResult(analysisResult: any) {\r\n  const f = analysisResult.face;\r\n  const h = f.head;\r\n  const tL = h.top_left;\r\n  const tR = h.top_right;\r\n  const bL = h.bottom_left;\r\n  const bR = h.bottom_right;\r\n  const sP = f.sample_point;\r\n  const hS = analysisResult.heat_stats;\r\n  const ref = analysisResult.thermal_ref;\r\n  const geom = ref.geom;\r\n  const cP = geom.center;\r\n  const copiedAnalysisResult: AnalysisResult = {\r\n    face: {\r\n      headLock: f.head_lock,\r\n      head: {\r\n        topLeft: {\r\n          x: tL.x,\r\n          y: tL.y\r\n        },\r\n        topRight: {\r\n          x: tR.x,\r\n          y: tR.y\r\n        },\r\n        bottomLeft: {\r\n          x: bL.x,\r\n          y: bL.y\r\n        },\r\n        bottomRight: {\r\n          x: bR.x,\r\n          y: bR.y\r\n        }\r\n      },\r\n      samplePoint: {\r\n        x: sP.x,\r\n        y: sP.y\r\n      },\r\n      sampleTemp: f.sample_temp,\r\n      sampleValue: f.sample_value,\r\n      halfwayRatio: f.halfway_ratio,\r\n      isValid: f.is_valid\r\n    },\r\n    frameBottomSum: analysisResult.frame_bottom_sum,\r\n    motionSum: analysisResult.motion_sum,\r\n    heatStats: {\r\n      threshold: hS.threshold,\r\n      min: hS.min,\r\n      max: hS.max\r\n    },\r\n    motionThresholdSum: analysisResult.motion_threshold_sum,\r\n    thresholdSum: analysisResult.threshold_sum,\r\n    nextState: getScreeningState(analysisResult.next_state),\r\n    hasBody: analysisResult.has_body,\r\n    thermalRef: {\r\n      geom: {\r\n        center: {\r\n          x: cP.x,\r\n          y: cP.y\r\n        },\r\n        radius: geom.radius\r\n      },\r\n      val: ref.val,\r\n      temp: ref.temp\r\n    }\r\n  };\r\n\r\n  f.free();\r\n  h.free();\r\n  tL.free();\r\n  tR.free();\r\n  bL.free();\r\n  bR.free();\r\n  sP.free();\r\n  hS.free();\r\n  cP.free();\r\n  geom.free();\r\n  ref.free();\r\n  analysisResult.free();\r\n  return copiedAnalysisResult;\r\n}\r\n","import { BlobReader } from \"./utils\";\r\nimport { FrameInfo, PartialFrameInfo} from \"./api/types\";\r\nimport {AnalysisResult, FactoryDefaultCalibration} from \"@/types\";\r\n\r\nexport interface Frame {\r\n  frameInfo: FrameInfo;\r\n  frame: Uint16Array;\r\n  bodyShape: Uint8Array;\r\n  analysisResult: AnalysisResult;\r\n}\r\n\r\nexport interface PartialFrame {\r\n  frameInfo: PartialFrameInfo;\r\n  frame: Uint16Array;\r\n}\r\n\r\nexport enum CameraConnectionState {\r\n  Connecting,\r\n  Connected,\r\n  Disconnected\r\n}\r\n\r\nconst UUID = new Date().getTime();\r\n\r\ninterface CameraStats {\r\n  skippedFramesServer: number;\r\n  skippedFramesClient: number;\r\n}\r\n\r\ninterface CameraState {\r\n  socket: WebSocket | null;\r\n  UUID: number;\r\n  stats: CameraStats;\r\n  prevFrameNum: number;\r\n  frames: PartialFrame[];\r\n  heartbeatInterval: number;\r\n  pendingFrame: number | null;\r\n}\r\n\r\n\r\nexport class CameraConnection {\r\n  constructor(\r\n    public host: string,\r\n    port: string,\r\n    public onFrame: (frame: PartialFrame) => void,\r\n    public onConnectionStateChange: (\r\n      connectionState: CameraConnectionState\r\n    ) => void\r\n  ) {\r\n    if (port === \"8080\" || port === \"5000\") {\r\n      // If we're running in development mode, find the remote camera server\r\n      this.host = \"192.168.178.21\";\r\n      //this.host = \"192.168.0.181\";\r\n      //this.host = \"192.168.0.82\";\r\n      //this.host = \"192.168.0.41\";\r\n    }\r\n    this.connect();\r\n  }\r\n  private state: CameraState = {\r\n    socket: null,\r\n    UUID: new Date().getTime(),\r\n    stats: {\r\n      skippedFramesServer: 0,\r\n      skippedFramesClient: 0\r\n    },\r\n    pendingFrame: null,\r\n    prevFrameNum: -1,\r\n    heartbeatInterval: 0,\r\n    frames: []\r\n  };\r\n\r\n  retryConnection(retryTime: number) {\r\n    if (retryTime > 0) {\r\n      setTimeout(() => this.retryConnection(retryTime - 1), 1000);\r\n    } else {\r\n      this.connect();\r\n    }\r\n  }\r\n  register() {\r\n    if (this.state.socket !== null) {\r\n      if (this.state.socket.readyState === WebSocket.OPEN) {\r\n        // We are waiting for frames now.\r\n        this.state.socket.send(\r\n          JSON.stringify({\r\n            type: \"Register\",\r\n            data: navigator.userAgent,\r\n            uuid: UUID\r\n          })\r\n        );\r\n        this.onConnectionStateChange(CameraConnectionState.Connected);\r\n\r\n        this.state.heartbeatInterval = (setInterval(() => {\r\n          this.state.socket &&\r\n            this.state.socket.send(\r\n              JSON.stringify({\r\n                type: \"Heartbeat\",\r\n                uuid: UUID\r\n              })\r\n            );\r\n        }, 5000) as unknown) as number;\r\n      } else {\r\n        setTimeout(this.register.bind(this), 100);\r\n      }\r\n    }\r\n  }\r\n  connect() {\r\n    this.state.socket = new WebSocket(`ws://${this.host}/ws`);\r\n    this.onConnectionStateChange(CameraConnectionState.Connecting);\r\n    this.state.socket.addEventListener(\"error\", e => {\r\n      console.warn(\"Websocket Connection error\", e);\r\n      //...\r\n    });\r\n    // Connection opened\r\n    this.state.socket.addEventListener(\"open\", this.register.bind(this));\r\n    this.state.socket.addEventListener(\"close\", () => {\r\n      // When we do reconnect, we need to treat it as a new connection\r\n      console.warn(\"Websocket closed\");\r\n      this.state.socket = null;\r\n      this.onConnectionStateChange(CameraConnectionState.Disconnected);\r\n      clearInterval(this.state.heartbeatInterval);\r\n      this.retryConnection(5);\r\n    });\r\n    this.state.socket.addEventListener(\"message\", async event => {\r\n      if (event.data instanceof Blob) {\r\n        // TODO(jon): Only do this if we detect that we're dropping frames?\r\n        const droppingFrames = false;\r\n        if (droppingFrames) {\r\n          this.state.frames.push(\r\n            (await this.parseFrame(event.data as Blob)) as PartialFrame\r\n          );\r\n          // Process the latest frame, after waiting half a frame delay\r\n          // to see if there are any more frames hot on its heels.\r\n          this.state.pendingFrame = (setTimeout(\r\n            this.useLatestFrame.bind(this),\r\n            1\r\n          ) as unknown) as number;\r\n        } else {\r\n          this.onFrame(\r\n            (await this.parseFrame(event.data as Blob)) as PartialFrame\r\n          );\r\n        }\r\n        // Every time we get a frame, set a new timeout for when we decide that the camera has stalled sending us new frames.\r\n      }\r\n    });\r\n  }\r\n  async parseFrame(blob: Blob): Promise<{frameInfo: PartialFrameInfo, frame: Uint16Array} | null> {\r\n    // NOTE(jon): On iOS. it seems slow to do multiple fetches from the blob, so let's do it all at once.\r\n    const data = await BlobReader.arrayBuffer(blob);\r\n    const frameInfoLength = new Uint16Array(data.slice(0, 2))[0];\r\n    const frameStartOffset = 2 + frameInfoLength;\r\n    try {\r\n      const frameInfo = JSON.parse(\r\n        String.fromCharCode(...new Uint8Array(data.slice(2, frameStartOffset)))\r\n      ) as PartialFrameInfo;\r\n\r\n      if (frameInfo.Calibration === null) {\r\n        frameInfo.Calibration = {...FactoryDefaultCalibration};\r\n        frameInfo.Calibration.UuidOfUpdater = UUID;\r\n        frameInfo.Calibration.CalibrationBinaryVersion = frameInfo.BinaryVersion;\r\n      }\r\n\r\n      const frameNumber = frameInfo.Telemetry.FrameCount;\r\n      if (frameNumber % 20 === 0) {\r\n        performance.clearMarks();\r\n        performance.clearMeasures();\r\n        performance.clearResourceTimings();\r\n      }\r\n      performance.mark(`start frame ${frameNumber}`);\r\n      if (\r\n        this.state.prevFrameNum !== -1 &&\r\n        this.state.prevFrameNum + 1 !== frameInfo.Telemetry.FrameCount\r\n      ) {\r\n        this.state.stats.skippedFramesServer +=\r\n          frameInfo.Telemetry.FrameCount - this.state.prevFrameNum;\r\n        // Work out an fps counter.\r\n      }\r\n      this.state.prevFrameNum = frameInfo.Telemetry.FrameCount;\r\n      const frameSizeInBytes =\r\n        frameInfo.Camera.ResX * frameInfo.Camera.ResY * 2;\r\n      // TODO(jon): Some perf optimisations here.\r\n      const frame = new Uint16Array(\r\n        data.slice(frameStartOffset, frameStartOffset + frameSizeInBytes)\r\n      );\r\n      return {\r\n        frameInfo,\r\n        frame\r\n      };\r\n    } catch (e) {\r\n      console.error(\"Malformed JSON payload\", e);\r\n    }\r\n    return null;\r\n  }\r\n  async useLatestFrame() {\r\n    if (this.state.pendingFrame) {\r\n      clearTimeout(this.state.pendingFrame);\r\n    }\r\n    let latestFrameTimeOnMs = 0;\r\n    let latestFrame: PartialFrame | null = null;\r\n    // Turns out that we don't always get the messages in order from the pi, so make sure we take the latest one.\r\n    const framesToDrop: PartialFrame[] = [];\r\n    while (this.state.frames.length !== 0) {\r\n      const frame = this.state.frames.shift() as PartialFrame;\r\n      const frameHeader = frame.frameInfo;\r\n      const timeOn = frameHeader.Telemetry.TimeOn / 1000 / 1000;\r\n      if (timeOn > latestFrameTimeOnMs) {\r\n        if (latestFrame !== null) {\r\n          framesToDrop.push(latestFrame);\r\n        }\r\n        latestFrameTimeOnMs = timeOn;\r\n        latestFrame = frame;\r\n      }\r\n    }\r\n    // Clear out and log any old frames that need to be dropped\r\n    while (framesToDrop.length !== 0) {\r\n      const dropFrame = framesToDrop.shift() as PartialFrame;\r\n      const timeOn = dropFrame.frameInfo.Telemetry.TimeOn / 1000 / 1000;\r\n      this.state.stats.skippedFramesClient++;\r\n      if (this.state.socket) {\r\n        (this.state.socket as WebSocket).send(\r\n          JSON.stringify({\r\n            type: \"Dropped late frame\",\r\n            data: `${latestFrameTimeOnMs - timeOn}ms behind current: frame#${\r\n              dropFrame.frameInfo.Telemetry.FrameCount\r\n            }`,\r\n            uuid: UUID\r\n          })\r\n        );\r\n      } else {\r\n        console.warn(\"Lost web socket connection\");\r\n      }\r\n    }\r\n\r\n    // Take the latest frame and process it.\r\n    if (latestFrame !== null) {\r\n      await this.onFrame(latestFrame);\r\n      // if (DEBUG_MODE) {\r\n      //   updateFpsCounter(skippedFramesServer, skippedFramesClient);\r\n      // } else if (fpsCount.innerText !== \"\") {\r\n      //   fpsCount.innerText = \"\";\r\n      // }\r\n    }\r\n    this.state.stats.skippedFramesClient = 0;\r\n    this.state.stats.skippedFramesServer = 0;\r\n  }\r\n}\r\n","(function() {\n    const __exports = {};\n    let wasm;\n\n    /**\n    * @param {number} size\n    */\n    __exports.initBufferWithSize = function(size) {\n        wasm.initBufferWithSize(size);\n    };\n\n    let cachegetUint8Memory = null;\n    function getUint8Memory() {\n        if (cachegetUint8Memory === null || cachegetUint8Memory.buffer !== wasm.memory.buffer) {\n            cachegetUint8Memory = new Uint8Array(wasm.memory.buffer);\n        }\n        return cachegetUint8Memory;\n    }\n\n    let WASM_VECTOR_LEN = 0;\n\n    function passArray8ToWasm(arg) {\n        const ptr = wasm.__wbindgen_malloc(arg.length * 1);\n        getUint8Memory().set(arg, ptr / 1);\n        WASM_VECTOR_LEN = arg.length;\n        return ptr;\n    }\n    /**\n    * @param {Uint8Array} chunk\n    * @param {number} offset\n    */\n    __exports.insertChunkAtOffset = function(chunk, offset) {\n        wasm.insertChunkAtOffset(passArray8ToWasm(chunk), WASM_VECTOR_LEN, offset);\n    };\n\n    const heap = new Array(32);\n\n    heap.fill(undefined);\n\n    heap.push(undefined, null, true, false);\n\nfunction getObject(idx) { return heap[idx]; }\n\nlet heap_next = heap.length;\n\nfunction dropObject(idx) {\n    if (idx < 36) return;\n    heap[idx] = heap_next;\n    heap_next = idx;\n}\n\nfunction takeObject(idx) {\n    const ret = getObject(idx);\n    dropObject(idx);\n    return ret;\n}\n/**\n* @param {Uint8Array} input\n* @returns {any}\n*/\n__exports.initWithCptvData = function(input) {\n    const ret = wasm.initWithCptvData(passArray8ToWasm(input), WASM_VECTOR_LEN);\n    return takeObject(ret);\n};\n\n/**\n* @returns {number}\n*/\n__exports.getNumFrames = function() {\n    const ret = wasm.getNumFrames();\n    return ret >>> 0;\n};\n\n/**\n* @returns {number}\n*/\n__exports.getWidth = function() {\n    const ret = wasm.getWidth();\n    return ret >>> 0;\n};\n\n/**\n* @returns {number}\n*/\n__exports.getHeight = function() {\n    const ret = wasm.getHeight();\n    return ret >>> 0;\n};\n\n/**\n* @returns {number}\n*/\n__exports.getFrameRate = function() {\n    const ret = wasm.getFrameRate();\n    return ret;\n};\n\n/**\n* @returns {number}\n*/\n__exports.getFramesPerIframe = function() {\n    const ret = wasm.getFramesPerIframe();\n    return ret;\n};\n\n/**\n* @returns {number}\n*/\n__exports.getMinValue = function() {\n    const ret = wasm.getMinValue();\n    return ret;\n};\n\n/**\n* @returns {number}\n*/\n__exports.getMaxValue = function() {\n    const ret = wasm.getMaxValue();\n    return ret;\n};\n\n/**\n* @returns {any}\n*/\n__exports.getHeader = function() {\n    const ret = wasm.getHeader();\n    return takeObject(ret);\n};\n\nfunction addHeapObject(obj) {\n    if (heap_next === heap.length) heap.push(heap.length + 1);\n    const idx = heap_next;\n    heap_next = heap[idx];\n\n    heap[idx] = obj;\n    return idx;\n}\n/**\n* @param {number} number\n* @param {any} callback\n* @returns {boolean}\n*/\n__exports.queueFrame = function(number, callback) {\n    const ret = wasm.queueFrame(number, addHeapObject(callback));\n    return ret !== 0;\n};\n\n/**\n* @param {number} number\n* @param {Uint8Array} image_data\n* @returns {boolean}\n*/\n__exports.getFrame = function(number, image_data) {\n    const ptr0 = passArray8ToWasm(image_data);\n    const len0 = WASM_VECTOR_LEN;\n    try {\n        const ret = wasm.getFrame(number, ptr0, len0);\n        return ret !== 0;\n    } finally {\n        image_data.set(getUint8Memory().subarray(ptr0 / 1, ptr0 / 1 + len0));\n        wasm.__wbindgen_free(ptr0, len0 * 1);\n    }\n};\n\n/**\n* @param {Uint8Array} image_data\n* @returns {FrameHeaderV2}\n*/\n__exports.getRawFrame = function(image_data) {\n    const ptr0 = passArray8ToWasm(image_data);\n    const len0 = WASM_VECTOR_LEN;\n    try {\n        const ret = wasm.getRawFrame(ptr0, len0);\n        return FrameHeaderV2.__wrap(ret);\n    } finally {\n        image_data.set(getUint8Memory().subarray(ptr0 / 1, ptr0 / 1 + len0));\n        wasm.__wbindgen_free(ptr0, len0 * 1);\n    }\n};\n\nlet cachedTextDecoder = new TextDecoder('utf-8', { ignoreBOM: true, fatal: true });\n\ncachedTextDecoder.decode();\n\nfunction getStringFromWasm(ptr, len) {\n    return cachedTextDecoder.decode(getUint8Memory().subarray(ptr, ptr + len));\n}\n\nlet cachedTextEncoder = new TextEncoder('utf-8');\n\nconst encodeString = (typeof cachedTextEncoder.encodeInto === 'function'\n    ? function (arg, view) {\n    return cachedTextEncoder.encodeInto(arg, view);\n}\n    : function (arg, view) {\n    const buf = cachedTextEncoder.encode(arg);\n    view.set(buf);\n    return {\n        read: arg.length,\n        written: buf.length\n    };\n});\n\nfunction passStringToWasm(arg) {\n\n    let len = arg.length;\n    let ptr = wasm.__wbindgen_malloc(len);\n\n    const mem = getUint8Memory();\n\n    let offset = 0;\n\n    for (; offset < len; offset++) {\n        const code = arg.charCodeAt(offset);\n        if (code > 0x7F) break;\n        mem[ptr + offset] = code;\n    }\n\n    if (offset !== len) {\n        if (offset !== 0) {\n            arg = arg.slice(offset);\n        }\n        ptr = wasm.__wbindgen_realloc(ptr, len, len = offset + arg.length * 3);\n        const view = getUint8Memory().subarray(ptr + offset, ptr + len);\n        const ret = encodeString(arg, view);\n\n        offset += ret.written;\n    }\n\n    WASM_VECTOR_LEN = offset;\n    return ptr;\n}\n\nlet cachegetInt32Memory = null;\nfunction getInt32Memory() {\n    if (cachegetInt32Memory === null || cachegetInt32Memory.buffer !== wasm.memory.buffer) {\n        cachegetInt32Memory = new Int32Array(wasm.memory.buffer);\n    }\n    return cachegetInt32Memory;\n}\n/**\n*/\nclass FrameHeaderV2 {\n\n    static __wrap(ptr) {\n        const obj = Object.create(FrameHeaderV2.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_frameheaderv2_free(ptr);\n    }\n    /**\n    * @returns {number}\n    */\n    get time_on() {\n        const ret = wasm.__wbg_get_frameheaderv2_time_on(this.ptr);\n        return ret >>> 0;\n    }\n    /**\n    * @param {number} arg0\n    */\n    set time_on(arg0) {\n        wasm.__wbg_set_frameheaderv2_time_on(this.ptr, arg0);\n    }\n    /**\n    * @returns {number}\n    */\n    get last_ffc_time() {\n        const ret = wasm.__wbg_get_frameheaderv2_last_ffc_time(this.ptr);\n        return ret >>> 0;\n    }\n    /**\n    * @param {number} arg0\n    */\n    set last_ffc_time(arg0) {\n        wasm.__wbg_set_frameheaderv2_last_ffc_time(this.ptr, arg0);\n    }\n    /**\n    * @returns {number}\n    */\n    get frame_number() {\n        const ret = wasm.__wbg_get_frameheaderv2_frame_number(this.ptr);\n        return ret >>> 0;\n    }\n    /**\n    * @param {number} arg0\n    */\n    set frame_number(arg0) {\n        wasm.__wbg_set_frameheaderv2_frame_number(this.ptr, arg0);\n    }\n    /**\n    * @returns {boolean}\n    */\n    get has_next_frame() {\n        const ret = wasm.__wbg_get_frameheaderv2_has_next_frame(this.ptr);\n        return ret !== 0;\n    }\n    /**\n    * @param {boolean} arg0\n    */\n    set has_next_frame(arg0) {\n        wasm.__wbg_set_frameheaderv2_has_next_frame(this.ptr, arg0);\n    }\n}\n__exports.FrameHeaderV2 = FrameHeaderV2;\n\nfunction init(module) {\n\n    let result;\n    const imports = {};\n    imports.wbg = {};\n    imports.wbg.__wbindgen_object_drop_ref = function(arg0) {\n        takeObject(arg0);\n    };\n    imports.wbg.__wbindgen_string_new = function(arg0, arg1) {\n        const ret = getStringFromWasm(arg0, arg1);\n        return addHeapObject(ret);\n    };\n    imports.wbg.__widl_f_debug_1_ = function(arg0) {\n        console.debug(getObject(arg0));\n    };\n    imports.wbg.__widl_f_error_1_ = function(arg0) {\n        console.error(getObject(arg0));\n    };\n    imports.wbg.__widl_f_info_1_ = function(arg0) {\n        console.info(getObject(arg0));\n    };\n    imports.wbg.__widl_f_log_1_ = function(arg0) {\n        console.log(getObject(arg0));\n    };\n    imports.wbg.__widl_f_warn_1_ = function(arg0) {\n        console.warn(getObject(arg0));\n    };\n    imports.wbg.__wbg_new_59cb74e423758ede = function() {\n        const ret = new Error();\n        return addHeapObject(ret);\n    };\n    imports.wbg.__wbg_stack_558ba5917b466edd = function(arg0, arg1) {\n        const ret = getObject(arg1).stack;\n        const ret0 = passStringToWasm(ret);\n        const ret1 = WASM_VECTOR_LEN;\n        getInt32Memory()[arg0 / 4 + 0] = ret0;\n        getInt32Memory()[arg0 / 4 + 1] = ret1;\n    };\n    imports.wbg.__wbg_error_4bb6c2a97407129a = function(arg0, arg1) {\n        const v0 = getStringFromWasm(arg0, arg1).slice();\n        wasm.__wbindgen_free(arg0, arg1 * 1);\n        console.error(v0);\n    };\n    imports.wbg.__wbindgen_throw = function(arg0, arg1) {\n        throw new Error(getStringFromWasm(arg0, arg1));\n    };\n    imports.wbg.__wbindgen_rethrow = function(arg0) {\n        throw takeObject(arg0);\n    };\n\n    if ((typeof URL === 'function' && module instanceof URL) || typeof module === 'string' || (typeof Request === 'function' && module instanceof Request)) {\n\n        const response = fetch(module);\n        if (typeof WebAssembly.instantiateStreaming === 'function') {\n            result = WebAssembly.instantiateStreaming(response, imports)\n            .catch(e => {\n                return response\n                .then(r => {\n                    if (r.headers.get('Content-Type') != 'application/wasm') {\n                        console.warn(\"`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", e);\n                        return r.arrayBuffer();\n                    } else {\n                        throw e;\n                    }\n                })\n                .then(bytes => WebAssembly.instantiate(bytes, imports));\n            });\n        } else {\n            result = response\n            .then(r => r.arrayBuffer())\n            .then(bytes => WebAssembly.instantiate(bytes, imports));\n        }\n    } else {\n\n        result = WebAssembly.instantiate(module, imports)\n        .then(result => {\n            if (result instanceof WebAssembly.Instance) {\n                return { instance: result, module };\n            } else {\n                return result;\n            }\n        });\n    }\n    return result.then(({instance, module}) => {\n        wasm = instance.exports;\n        init.__wbindgen_wasm_module = module;\n\n        return wasm;\n    });\n}\n\nself.wasm_bindgen = Object.assign(init, __exports);\n\n})();\nexport default self.wasm_bindgen;\r\n","import {\r\n  CameraConnection,\r\n  CameraConnectionState,\r\n  Frame,\r\n  PartialFrame\r\n} from \"@/camera\";\r\n// import { WasmTracingAllocator } from \"@/tracing-allocator\";\r\nimport cptvPlayer, { FrameHeaderV2 } from \"../cptv-player\";\r\nimport ProcessingWorker from \"worker-loader!./processing\";\r\nimport { ImageInfo } from \"@/processing\";\r\nimport {InitialFrameInfo, ScreeningState} from \"@/types\";\r\nconst { initWithCptvData, getRawFrame } = cptvPlayer as any;\r\n\r\nlet usingLiveCamera = false;\r\n\r\nconst smoothingWorkers: Array<{\r\n  worker: ProcessingWorker;\r\n  pending: null | any;\r\n}> = [\r\n  {\r\n    worker: new ProcessingWorker(),\r\n    pending: null\r\n  }\r\n];\r\n\r\nfor (let i = 0; i < smoothingWorkers.length; i++) {\r\n  const s = smoothingWorkers[i];\r\n  s.worker.onmessage = result => {\r\n    if (s.pending) {\r\n      // TODO(jon): See if we're ever getting frame number mis-matches here.\r\n      (s.pending as any)(result.data);\r\n      s.pending = null;\r\n    } else {\r\n      if (result.data.analysisResult.nextState !== ScreeningState.READY) {\r\n        console.error(\"Couldn't find callback for\", result.data);\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nlet workerIndex = 0;\r\n\r\nexport const processSensorData = async (\r\n  frame: PartialFrame\r\n): Promise<ImageInfo> => {\r\n  const index = workerIndex;\r\n  return new Promise((resolve, reject) => {\r\n    smoothingWorkers[index].pending = resolve as any;\r\n    let msSinceLastFFC = frame.frameInfo.Telemetry.TimeOn - frame.frameInfo.Telemetry.LastFFCTime;\r\n    if (usingLiveCamera) {\r\n      msSinceLastFFC = msSinceLastFFC / 1000 / 1000;\r\n    }\r\n    smoothingWorkers[index].worker.postMessage({\r\n      frame: frame.frame,\r\n      calibrationTempC: frame.frameInfo.Calibration!.ThermalRefTemp,\r\n      msSinceLastFFC\r\n    });\r\n  }) as Promise<ImageInfo>;\r\n};\r\n\r\nconst workerContext: Worker = self as any;\r\nlet frameTimeout = 0;\r\nlet frameBuffer: Uint8Array = new Uint8Array(0);\r\n\r\nexport interface FrameMessage {\r\n  type: \"connectionStateChange\" | \"gotFrame\" | \"noThermalReference\";\r\n  payload: CameraConnectionState | Frame;\r\n}\r\n\r\ninterface PlaybackCommand {\r\n  useLiveCamera?: boolean;\r\n  dumpMemoryAllocations?: boolean;\r\n  hostname?: string;\r\n  port?: string;\r\n  cptvFileToPlayback?: string;\r\n  startFrame?: number;\r\n  endFrame?: number;\r\n}\r\n\r\nasync function processFrame(frame: PartialFrame) {\r\n  // console.log(\"got frame\", frame);\r\n  // Do the frame processing, then postMessage the relevant payload to the view app.\r\n  // Do this in yet another worker(s)?\r\n  const imageInfo = await processSensorData(frame);\r\n  performance.mark(`end frame ${frame.frameInfo.Telemetry.FrameCount}`);\r\n  performance.measure(\r\n    `frame ${frame.frameInfo.Telemetry.FrameCount}`,\r\n    `start frame ${frame.frameInfo.Telemetry.FrameCount}`,\r\n    `end frame ${frame.frameInfo.Telemetry.FrameCount}`\r\n  );\r\n\r\n  workerContext.postMessage({\r\n    type: \"gotFrame\",\r\n    payload: {\r\n      frameInfo: frame.frameInfo,\r\n      frame: frame.frame,\r\n      bodyShape: imageInfo.bodyShape,\r\n      analysisResult: imageInfo.analysisResult\r\n    } as Frame\r\n  });\r\n}\r\n\r\nfunction onConnectionStateChange(connectionState: CameraConnectionState) {\r\n  workerContext.postMessage({\r\n    type: \"connectionStateChange\",\r\n    payload: connectionState\r\n  } as FrameMessage);\r\n}\r\n\r\nfunction getNextFrame(startFrame = -1, endFrame = -1) {\r\n  let frameInfo: FrameHeaderV2 = getRawFrame(frameBuffer);\r\n  while (\r\n    frameInfo.frame_number < startFrame ||\r\n    (endFrame != -1 && frameInfo.frame_number > endFrame)\r\n  ) {\r\n    frameInfo = getRawFrame(frameBuffer);\r\n  }\r\n  const appVersion = \"\";\r\n  const binaryVersion = \"\";\r\n  const currentFrame = {\r\n    frame: new Uint16Array(frameBuffer!.buffer),\r\n    frameInfo: {\r\n      ...InitialFrameInfo,\r\n      AppVersion: appVersion,\r\n      BinaryVersion: binaryVersion,\r\n      Telemetry: {\r\n        ...InitialFrameInfo.Telemetry,\r\n        LastFFCTime: frameInfo!.last_ffc_time,\r\n        FrameCount: frameInfo!.frame_number,\r\n        TimeOn: frameInfo!.time_on\r\n      },\r\n    }\r\n  };\r\n  frameInfo.free();\r\n  frameTimeout = (setTimeout(getNextFrame, 1000 / 9) as unknown) as number;\r\n\r\n  const frameNumber = currentFrame.frameInfo.Telemetry.FrameCount;\r\n  if (frameNumber % 20 === 0) {\r\n    performance.clearMarks();\r\n    performance.clearMeasures();\r\n    performance.clearResourceTimings();\r\n  }\r\n  performance.mark(`start frame ${frameNumber}`);\r\n\r\n  processFrame(currentFrame);\r\n}\r\n\r\nfunction playLocalCptvFile(\r\n  cptvFileBytes: ArrayBuffer,\r\n  startFrame = 0,\r\n  endFrame = -1\r\n) {\r\n  frameBuffer = new Uint8Array(160 * 120 * 2);\r\n  initWithCptvData(new Uint8Array(cptvFileBytes));\r\n  getNextFrame();\r\n}\r\n\r\n(async function run() {\r\n  workerContext.addEventListener(\"message\", async event => {\r\n    const message = event.data as PlaybackCommand;\r\n    usingLiveCamera = message.useLiveCamera || false;\r\n    if (message.useLiveCamera) {\r\n      new CameraConnection(\r\n        message.hostname!,\r\n        message.port!,\r\n        processFrame,\r\n        onConnectionStateChange\r\n      );\r\n      // Init live camera web-socket connection\r\n    } else if (message.cptvFileToPlayback) {\r\n      // Init CPTV file playback\r\n      await cptvPlayer(`${process.env.BASE_URL}cptv_player_bg.wasm`);\r\n      const cptvFile = await fetch(message.cptvFileToPlayback);\r\n      const buffer = await cptvFile.arrayBuffer();\r\n      playLocalCptvFile(\r\n        buffer,\r\n        message.startFrame || 0,\r\n        message.endFrame || -1\r\n      );\r\n    }\r\n    return;\r\n  });\r\n})();\r\n"],"sourceRoot":""}